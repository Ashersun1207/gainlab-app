import{j as e}from"./mosaic-86Umg_jF.js";import{a}from"./echarts-DW2iXprX.js";import{b}from"./index-CG7r0aNw.js";function N(r){return r>=1e4?r.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}):r>=100||r>=1?r.toFixed(2):r.toFixed(4)}function v(r){return`${r>=0?"+":""}${r.toFixed(2)}%`}function w(r,s){const n=r>=0?"+":"";return s>=100?`${n}${r.toFixed(2)}`:s>=1?`${n}${r.toFixed(2)}`:`${n}${r.toFixed(4)}`}function P({title:r,items:s,onRowClick:n,refreshInterval:d=3e4}){const[f,g]=a.useState(()=>s.map(t=>({...t,price:null,change:null,changePercent:null}))),[j,p]=a.useState(!0),[m,h]=a.useState(null),c=a.useRef(!1),o=a.useRef(null),i=a.useCallback(async()=>{c.current=!1,p(!0),h(null);try{const t=await b(s);if(c.current)return;g(s.map((x,l)=>{const u=t[l];return{...x,price:u?.price??null,change:u?.change??null,changePercent:u?.changePercent??null}}))}catch(t){c.current||h(t instanceof Error?t.message:"Failed to fetch quotes")}finally{c.current||p(!1)}},[s]);return a.useEffect(()=>(i(),o.current=setInterval(()=>{i()},d),()=>{c.current=!0,o.current&&clearInterval(o.current)}),[i,d]),m&&f.every(t=>t.price===null)?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center gap-2 bg-[#0d0d20]",children:[e.jsx("span",{className:"text-[#ef4444] text-sm",children:m}),e.jsx("button",{onClick:()=>{i()},className:"px-3 py-1 text-xs bg-[#1e1e3a] text-[#a0a0cc] rounded hover:bg-[#2a2a4a] transition-colors",children:"重试"})]}):e.jsxs("div",{className:"w-full h-full flex flex-col bg-[#0d0d20] overflow-hidden",children:[r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-[#1e1e3a] flex-shrink-0",children:[e.jsx("span",{className:"text-[13px] font-semibold text-[#a0a0cc]",children:r}),j&&e.jsx("span",{className:"text-[10px] text-[#5a5a8a]",children:"更新中..."})]}),e.jsxs("div",{className:"grid grid-cols-[1fr_auto_auto_auto] gap-x-3 px-3 py-1.5 text-[10px] text-[#5a5a8a] uppercase tracking-wider border-b border-[#1e1e3a]/50 flex-shrink-0",children:[e.jsx("span",{children:"名称"}),e.jsx("span",{className:"text-right w-[72px]",children:"价格"}),e.jsx("span",{className:"text-right w-[56px]",children:"涨跌"}),e.jsx("span",{className:"text-right w-[56px]",children:"涨跌%"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:f.map(t=>{const x=(t.changePercent??0)>=0,l=t.price!==null?x?"text-[#22c55e]":"text-[#ef4444]":"text-[#5a5a8a]";return e.jsxs("div",{className:"grid grid-cols-[1fr_auto_auto_auto] gap-x-3 px-3 py-1.5 hover:bg-[#1a1a2e] cursor-pointer transition-colors items-center",onClick:()=>n?.(t.symbol,t.market),children:[e.jsx("span",{className:"text-[12px] text-[#e0e0f0] truncate",children:t.displayName}),t.price!==null?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`text-[12px] font-mono text-right w-[72px] ${l}`,children:N(t.price)}),e.jsx("span",{className:`text-[11px] font-mono text-right w-[56px] ${l}`,children:w(t.change??0,t.price)}),e.jsx("span",{className:`text-[11px] font-mono text-right w-[56px] ${l}`,children:v(t.changePercent??0)})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-[72px] h-3 bg-[#1e1e3a] rounded animate-pulse"}),e.jsx("span",{className:"w-[56px] h-3 bg-[#1e1e3a] rounded animate-pulse"}),e.jsx("span",{className:"w-[56px] h-3 bg-[#1e1e3a] rounded animate-pulse"})]})]},t.symbol)})})]})}export{P as QuoteTableWidget};
