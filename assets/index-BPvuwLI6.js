import{j as e}from"./mosaic-86Umg_jF.js";import{a}from"./echarts-DW2iXprX.js";import{b}from"./index-B4uBFvqj.js";function u(n){if(typeof n=="number"&&!Number.isNaN(n))return n;if(typeof n=="string"){const t=Number(n);if(!Number.isNaN(t))return t}return 0}function w(n){const t=u(n);return t>=1e4?t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}):t>=100||t>=1?t.toFixed(2):t.toFixed(4)}function y(n){const t=u(n);return`${t>=0?"+":""}${t.toFixed(2)}%`}function v(n,t){const s=u(n),i=u(t),c=s>=0?"+":"";return i>=100?`${c}${s.toFixed(2)}`:i>=1?`${c}${s.toFixed(2)}`:`${c}${s.toFixed(4)}`}function k({title:n,items:t,onRowClick:s,refreshInterval:i=3e4}){const[c,N]=a.useState(()=>t.map(r=>({...r,price:null,change:null,changePercent:null}))),[j,m]=a.useState(!0),[h,g]=a.useState(null),l=a.useRef(!1),p=a.useRef(null),x=a.useCallback(async()=>{l.current=!1,m(!0),g(null);try{const r=await b(t);if(l.current)return;N(t.map((d,o)=>{const f=r[o];return{...d,price:f?.price??null,change:f?.change??null,changePercent:f?.changePercent??null}}))}catch(r){l.current||g(r instanceof Error?r.message:"Failed to fetch quotes")}finally{l.current||m(!1)}},[t]);return a.useEffect(()=>(x(),p.current=setInterval(()=>{x()},i),()=>{l.current=!0,p.current&&clearInterval(p.current)}),[x,i]),h&&c.every(r=>r.price===null)?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center gap-2 bg-[#0d0d20]",children:[e.jsx("span",{className:"text-[#ef4444] text-sm",children:h}),e.jsx("button",{onClick:()=>{x()},className:"px-3 py-1 text-xs bg-[#1e1e3a] text-[#a0a0cc] rounded hover:bg-[#2a2a4a] transition-colors",children:"重试"})]}):e.jsxs("div",{className:"w-full h-full flex flex-col bg-[#0d0d20] overflow-hidden",children:[n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-[#1e1e3a] flex-shrink-0",children:[e.jsx("span",{className:"text-[13px] font-semibold text-[#a0a0cc]",children:n}),j&&e.jsx("span",{className:"text-[10px] text-[#5a5a8a]",children:"更新中..."})]}),e.jsxs("div",{className:"grid grid-cols-[1fr_auto_auto_auto] gap-x-3 px-3 py-1.5 text-[10px] text-[#5a5a8a] uppercase tracking-wider border-b border-[#1e1e3a]/50 flex-shrink-0",children:[e.jsx("span",{children:"名称"}),e.jsx("span",{className:"text-right w-[72px]",children:"价格"}),e.jsx("span",{className:"text-right w-[56px]",children:"涨跌"}),e.jsx("span",{className:"text-right w-[56px]",children:"涨跌%"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:c.map(r=>{const d=(r.changePercent??0)>=0,o=r.price!==null?d?"text-[#22c55e]":"text-[#ef4444]":"text-[#5a5a8a]";return e.jsxs("div",{className:"grid grid-cols-[1fr_auto_auto_auto] gap-x-3 px-3 py-1.5 hover:bg-[#1a1a2e] cursor-pointer transition-colors items-center",onClick:()=>s?.(r.symbol,r.market),children:[e.jsx("span",{className:"text-[12px] text-[#e0e0f0] truncate",children:r.displayName}),r.price!==null?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`text-[12px] font-mono text-right w-[72px] ${o}`,children:w(r.price)}),e.jsx("span",{className:`text-[11px] font-mono text-right w-[56px] ${o}`,children:v(r.change??0,r.price)}),e.jsx("span",{className:`text-[11px] font-mono text-right w-[56px] ${o}`,children:y(r.changePercent??0)})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-[72px] h-3 bg-[#1e1e3a] rounded animate-pulse"}),e.jsx("span",{className:"w-[56px] h-3 bg-[#1e1e3a] rounded animate-pulse"}),e.jsx("span",{className:"w-[56px] h-3 bg-[#1e1e3a] rounded animate-pulse"})]})]},r.symbol)})})]})}export{k as QuoteTableWidget};
