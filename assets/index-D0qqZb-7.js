const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Dth5tUFx.js","assets/mosaic-86Umg_jF.js","assets/echarts-DW2iXprX.js"])))=>i.map(i=>d[i]);
import{a as y,_ as S}from"./index-C_ZR5nEK.js";import{j as n}from"./mosaic-86Umg_jF.js";import{a as o}from"./echarts-DW2iXprX.js";function v(e,r){const[l,c]=o.useState([]),[t,s]=o.useState(!1),d=o.useRef(!1),u=o.useCallback(async()=>{d.current=!1,s(!0);const x=e.split(",").filter(Boolean);try{const f=await Promise.all(x.map(i=>y(i,r).then(p=>({symbol:i,data:p})).catch(()=>({symbol:i,data:[]}))));d.current||c(f.filter(i=>i.data.length>0))}finally{d.current||s(!1)}},[e,r]);return o.useEffect(()=>(e&&u(),()=>{d.current=!0}),[u,e]),{datasets:l,loading:t}}const C=o.lazy(()=>S(()=>import("./index-Dth5tUFx.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.EChartsWidget}))),h=5,b=["#60a5fa","#fbbf24","#a78bfa","#34d399","#f87171"];function j(e){if(e.length===0)return[];const r=e[0].close;return r===0?e.map(()=>0):e.map(l=>(l.close-r)/r*100)}function k(e){if(e.length===0)return{backgroundColor:"#0d0d20",title:{text:"Overlay — 加载数据中...",textStyle:{color:"#666",fontSize:12},left:"center",top:"center"}};const l=e.reduce((t,s)=>t.data.length>=s.data.length?t:s).data.map(t=>new Date(t.timestamp).toLocaleDateString()),c=e.map((t,s)=>({name:t.symbol,type:"line",data:j(t.data),smooth:!0,symbol:"none",lineStyle:{width:s===0?2:1.5},itemStyle:{color:b[s%b.length]}}));return{backgroundColor:"#0d0d20",tooltip:{trigger:"axis",backgroundColor:"#1a1a2e",borderColor:"#2a2a4a",textStyle:{color:"#e0e0e0",fontSize:11}},legend:{data:e.map(t=>t.symbol),textStyle:{color:"#888",fontSize:10},top:5,right:10},grid:{left:50,right:20,top:35,bottom:30},xAxis:{type:"category",data:l,axisLabel:{color:"#666",fontSize:9},axisTick:{show:!1}},yAxis:{type:"value",name:"变化 %",nameTextStyle:{color:"#666",fontSize:10},axisLabel:{color:"#888",formatter:t=>`${t.toFixed(1)}%`},splitLine:{lineStyle:{color:"#1e1e3a"}}},series:c}}function E({symbol:e,market:r}){const[l,c]=o.useState([]),[t,s]=o.useState(""),d=o.useMemo(()=>[e,...l].join(","),[e,l]),{datasets:u,loading:x}=v(d,r),f=o.useCallback(()=>{const a=t.trim().toUpperCase();a&&l.length<h-1&&!l.includes(a)&&a!==e.toUpperCase()&&(c(m=>[...m,a]),s(""))},[t,l,e]),i=o.useCallback(a=>{c(m=>m.filter(g=>g!==a))},[]),p=o.useMemo(()=>k(u),[u]);return n.jsxs("div",{className:"w-full h-full flex flex-col",children:[n.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 border-b border-[#1e1e3a] flex-shrink-0",children:[n.jsx("input",{type:"text",value:t,onChange:a=>s(a.target.value),onKeyDown:a=>a.key==="Enter"&&f(),placeholder:`添加对比资产（最多 ${h-1} 个）`,className:`flex-1 bg-[#13132a] border border-[#2a2a4a] rounded px-2 py-1 text-xs text-[#d0d0f0]
                     placeholder-[#4a4a7a] focus:outline-none focus:border-[#4a4a8a]`}),n.jsx("button",{type:"button",onClick:f,disabled:l.length>=h-1,className:`text-xs px-2 py-1 rounded bg-[#1e1e3a] text-[#8888aa] hover:text-white
                     disabled:opacity-30 disabled:cursor-not-allowed`,children:"添加"}),l.map(a=>n.jsxs("span",{className:"text-[10px] bg-[#1e1e3a] px-1.5 py-0.5 rounded text-[#aaaacc] flex items-center gap-1",children:[a,n.jsx("button",{type:"button",onClick:()=>i(a),className:"text-[#ef4444] hover:text-white",children:"✕"})]},a))]}),n.jsxs("div",{className:"flex-1 relative",children:[x&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-[#0d0d20]/80 z-10",children:n.jsx("span",{className:"text-[#8888aa] text-sm",children:"加载中..."})}),n.jsx(o.Suspense,{fallback:n.jsx("div",{className:"w-full h-full bg-[#0d0d20]"}),children:n.jsx(C,{option:p,style:{height:"100%"}})})]})]})}export{E as OverlayWidget};
