const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Dth5tUFx.js","assets/mosaic-86Umg_jF.js","assets/echarts-DW2iXprX.js"])))=>i.map(i=>d[i]);
import{_ as V}from"./index-H6ngIi6w.js";import{j as u}from"./mosaic-86Umg_jF.js";import{a as f}from"./echarts-DW2iXprX.js";function b(e,o=50){if(e.length===0)return{levels:[],poc:0,vah:0,val:0};const i=e.flatMap(t=>[t.high,t.low]),r=Math.min(...i),v=(Math.max(...i)-r)/o||1,l=Array.from({length:o},(t,c)=>({price:r+v*(c+.5),volume:0,buyVolume:0,sellVolume:0}));for(const t of e){const c=(t.high+t.low)/2,n=Math.min(Math.floor((c-r)/v),o-1);if(n>=0&&n<o){const x=t.volume??0;l[n].volume+=x,t.close>=t.open?l[n].buyVolume+=x:l[n].sellVolume+=x}}const y=Math.max(...l.map(t=>t.volume)),p=l.find(t=>t.volume===y)??l[0],h=l.indexOf(p),g=l.reduce((t,c)=>t+c.volume,0);let m=p.volume,a=h,s=h;for(;m<g*.7&&(a>0||s<o-1);){const t=a>0?l[a-1].volume:0,c=s<o-1?l[s+1].volume:0;t>=c&&a>0?(a--,m+=l[a].volume):s<o-1?(s++,m+=l[s].volume):(a--,m+=l[a].volume)}return{levels:l,poc:p.price,vah:l[s].price,val:l[a].price}}const $=f.lazy(()=>V(()=>import("./index-Dth5tUFx.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.EChartsWidget})));function F(e){return{backgroundColor:"#0d0d20",tooltip:{trigger:"axis",formatter:o=>{const i=o[0];if(!i)return"";const r=e.levels.find(d=>d.price.toFixed(2)===i.name);return r?[`<b>$${i.name}</b>`,`总量: ${r.volume.toFixed(0)}`,`<span style="color:#22c55e">买: ${r.buyVolume.toFixed(0)}</span>`,`<span style="color:#ef4444">卖: ${r.sellVolume.toFixed(0)}</span>`].join("<br/>"):`${i.name}: ${i.value.toFixed(0)}`}},grid:{left:70,right:20,top:40,bottom:30},xAxis:{type:"value",axisLabel:{color:"#888"},splitLine:{lineStyle:{color:"#1e1e3a"}}},yAxis:{type:"category",data:e.levels.map(o=>o.price.toFixed(2)),axisLabel:{color:"#888",fontSize:9},axisTick:{show:!1}},series:[{type:"bar",data:e.levels.map(o=>({value:o.volume,itemStyle:{color:o.price===e.poc?"#ffc107":o.price>=e.val&&o.price<=e.vah?"rgba(34,197,94,0.5)":"rgba(100,100,180,0.25)"}})),barWidth:"80%"}],title:{text:`VP · POC ${e.poc.toFixed(2)} | VAH ${e.vah.toFixed(2)} | VAL ${e.val.toFixed(2)}`,textStyle:{color:"#ccc",fontSize:11},left:10,top:8}}}function w({klineData:e,bins:o=50}){const i=f.useMemo(()=>b(e,o),[e,o]),r=f.useMemo(()=>F(i),[i]);return e.length===0?u.jsx("div",{className:"w-full h-full flex items-center justify-center text-[#6666aa] text-sm",children:"请先选择资产以查看筹码分布"}):u.jsx(f.Suspense,{fallback:u.jsx("div",{className:"w-full h-full bg-[#0d0d20]"}),children:u.jsx($,{option:r,style:{height:"100%"}})})}export{w as VolumeProfileWidget};
