import{j as er}from"./mosaic-86Umg_jF.js";import{g as kl,c as tr,b as Bl,a as qt}from"./echarts-DW2iXprX.js";import{d as Tl}from"./detectWRB-BUzBMQ2u.js";import{c as Il}from"./calculateVP-BKR8mp0V.js";function Se(i,t){if(!(!tt(i)&&!tt(t))){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const n=i[e],r=t[e];tt(r)&&tt(n)?Se(n,r):H(t[e])&&(i[e]=An(t[e]))}}}function An(i){if(!tt(i))return i;let t=null;ze(i)?t=[]:t={};for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e)){const n=i[e];tt(n)?t[e]=An(n):t[e]=n}return t}function ze(i){return Object.prototype.toString.call(i)==="[object Array]"}function Ve(i){return typeof i=="function"}function tt(i){return typeof i=="object"&&H(i)}function L(i){return typeof i=="number"&&Number.isFinite(i)}function H(i){return i!=null}function Ri(i){return typeof i=="boolean"}function se(i){return typeof i=="string"}const Pl=/\\(\\)?/g,Vl=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g");function Ue(i,t,e){if(H(i)){const n=[];t.replace(Vl,(l,...c)=>{let a=l;return H(c[1])?a=c[2].replace(Pl,"$1"):H(c[0])&&(a=c[0].trim()),n.push(a),""});let r=i,s=0;const o=n.length;for(;H(r)&&s<o;)r=r?.[n[s++]];return H(r)?r:e??"--"}return e??"--"}function Fl(i,t){const e={};return i.formatToParts(new Date(t)).forEach(({type:n,value:r})=>{switch(n){case"year":{e.YYYY=r;break}case"month":{e.MM=r;break}case"day":{e.DD=r;break}case"hour":{e.HH=r==="24"?"00":r;break}case"minute":{e.mm=r;break}case"second":{e.ss=r;break}}}),e}function Go(i,t,e){const n=Fl(i,t);return e.replace(/YYYY|MM|DD|HH|mm|ss/g,r=>n[r])}function ke(i,t){const e=+i;return L(e)?e.toFixed(t??2):`${i}`}function Ko(i){const t=+i;if(L(t)){if(t>1e9)return`${+(t/1e9).toFixed(3)}B`;if(t>1e6)return`${+(t/1e6).toFixed(3)}M`;if(t>1e3)return`${+(t/1e3).toFixed(3)}K`}return`${i}`}function Qo(i,t){const e=`${i}`;if(t.length===0)return e;if(e.includes(".")){const n=e.split(".");return`${n[0].replace(/(\d)(?=(\d{3})+$)/g,r=>`${r}${t}`)}.${n[1]}`}return e.replace(/(\d)(?=(\d{3})+$)/g,n=>`${n}${t}`)}function Jo(i,t){const e=`${i}`;if(new RegExp("\\.0{"+t+",}[1-9][0-9]*$").test(e)){const r=e.split("."),s=r.length-1,o=r[s],l=/0*/.exec(o);if(H(l)){const c=l[0].length;return r[s]=o.replace(/0*/,`0{${c}}`),r.join(".")}}return e}function es(i,t){return i.replace(/\{(\w+)\}/g,(e,n)=>{const r=t[n];return H(r)?r:`{${n}}`})}let hn=null;function Ct(i){return i.ownerDocument.defaultView?.devicePixelRatio??1}function pt(i,t,e){return`${t??"normal"} ${i??12}px ${e??"Helvetica Neue"}`}function qe(i,t,e,n){if(!H(hn)){const r=document.createElement("canvas"),s=Ct(r);hn=r.getContext("2d"),hn.scale(s,s)}return hn.font=pt(t,e,n),Math.round(hn.measureText(i).width)}function zi(i){const t={width:0,height:0,left:0,right:0,top:0,bottom:0};return H(i)&&Se(t,i),t}var J=(i=>(i[i.Main=0]="Main",i[i.Overlay=1]="Overlay",i[i.Separator=2]="Separator",i[i.Drawer=3]="Drawer",i[i.All=4]="All",i))(J||{});const Jt=-1;function ot(i){return Ve(window.requestAnimationFrame)?window.requestAnimationFrame(i):window.setTimeout(i,20)}function ts(i){Ve(window.cancelAnimationFrame)?window.cancelAnimationFrame(i):window.clearTimeout(i)}function ns(i){if(Ve(window.requestIdleCallback))return window.requestIdleCallback(i);const t=performance.now();return window.setTimeout(function(){i({didTimeout:!1,timeRemaining(){return Math.max(0,50-(performance.now()-t))}})},1)}function Rl(i){Ve(window.cancelIdleCallback)?window.cancelIdleCallback(i):window.clearTimeout(i)}class Ni{constructor(t){this._options={duration:500,iterationCount:1},this._currentIterationCount=0,this._running=!1,this._time=0,Se(this._options,t)}_loop(){this._running=!0;const t=()=>{if(this._running){const e=new Date().getTime()-this._time;e<this._options.duration?(this._doFrameCallback?.(e),ot(t)):(this.stop(),this._currentIterationCount++,this._currentIterationCount<this._options.iterationCount&&this.start())}};ot(t)}doFrame(t){return this._doFrameCallback=t,this}setDuration(t){return this._options.duration=t,this}setIterationCount(t){return this._options.iterationCount=t,this}start(){this._running||(this._time=new Date().getTime(),this._loop())}stop(){this._running&&this._doFrameCallback?.(this._options.duration),this._running=!1}}let nr=1,is=new Date().getTime();function Qt(i){const t=new Date().getTime();return t===is?++nr:nr=1,is=t,`${i??""}${t}_${nr}`}function xt(i,t){const e=document.createElement(i),n=t??{};for(const r in n)e.style[r]=n[r]??"";return e}function yr(i,t,e){let n=0,r=0;for(r=i.length-1;n!==r;){const s=Math.floor((r+n)/2),o=r-n,l=i[s][t];if(e===i[n][t])return n;if(e===i[r][t])return r;if(e===l)return s;if(e>l?n=s:r=s,o<=2)break}return n}function zl(i){const t=Math.floor(ut(i)),e=It(t),n=i/e;let r=0;return n<1.5?r=1:n<2.5?r=2:n<3.5?r=3:n<4.5?r=4:n<5.5?r=5:n<6.5?r=6:r=8,i=r*e,+i.toFixed(Math.abs(t))}function rs(i,t){t=Math.max(0,t??0);const e=Math.pow(10,t);return Math.round(i*e)/e}function Nl(i){const t=i.toString(),e=t.indexOf("e");if(e>0){const r=+t.slice(e+1);return r<0?-r:0}const n=t.indexOf(".");return n<0?0:t.length-1-n}function ut(i){return i===0?0:Math.log10(i)}function It(i){return Math.pow(10,i)}function ss(){return{from:0,to:0,realFrom:0,realTo:0}}function os(...i){return i.join("_")}class Wl{constructor(t){this._requestIdleCallbackId=Jt,this._tasks=t??[],this._operateTasks()}_operateTasks(t){this._requestIdleCallbackId!==Jt&&(Rl(this._requestIdleCallbackId),this._requestIdleCallbackId=Jt),t?.(),this._requestIdleCallbackId=ns(e=>{this._runTasks(e)})}_runTasks(t){for(;t.timeRemaining()>0&&this._tasks.length>0;)this._tasks.shift()?.handler();this._tasks.length>0&&(this._requestIdleCallbackId=ns(e=>{this._runTasks(e)}))}addTask(t){return this._operateTasks(()=>{const e=this._tasks.findIndex(n=>n.id===t.id);e>-1?this._tasks[e]=t:this._tasks.push(t)}),this}removeTask(t){return H(t)&&this._operateTasks(()=>{if(H(t)){const e=this._tasks.findIndex(n=>n.id===t);e>-1&&this._tasks.splice(e,1)}else this._tasks=[]}),this}}class Ol{constructor(){this._callbacks=[]}subscribe(t){this._callbacks.indexOf(t)<0&&this._callbacks.push(t)}unsubscribe(t){if(Ve(t)){const e=this._callbacks.indexOf(t);e>-1&&this._callbacks.splice(e,1)}else this._callbacks=[]}execute(t){this._callbacks.forEach(e=>{e(t)})}isEmpty(){return this._callbacks.length===0}}function he(i){return i==="transparent"||i==="none"||/^[rR][gG][Bb][Aa]\(([\s]*(2[0-4][0-9]|25[0-5]|[01]?[0-9][0-9]?)[\s]*,){3}[\s]*0[\s]*\)$/.test(i)||/^[hH][Ss][Ll][Aa]\(([\s]*(360｜3[0-5][0-9]|[012]?[0-9][0-9]?)[\s]*,)([\s]*((100|[0-9][0-9]?)%|0)[\s]*,){2}([\s]*0[\s]*)\)$/.test(i)}function At(i,t){const e=i.replace(/^#/,""),n=parseInt(e,16),r=n>>16&255,s=n>>8&255,o=n&255;return`rgba(${r}, ${s}, ${o}, ${t??1})`}const U={RED:"#F92855",GREEN:"#2DC08E",WHITE:"#FFFFFF",GREY:"#76808F",BLUE:"#1677FF"};function Hl(){return{show:!0,horizontal:{show:!0,size:1,color:"#EDEDED",style:"dashed",length:0,dashedValue:[2,2]},vertical:{show:!0,size:1,color:"#EDEDED",style:"dashed",length:0,dashedValue:[2,2]}}}function $l(){const i={show:!0,color:U.GREY,textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"};return{type:"candle_solid",bar:{compareRule:"current_open",upColor:U.GREEN,downColor:U.RED,noChangeColor:U.GREY,upBorderColor:U.GREEN,downBorderColor:U.RED,noChangeBorderColor:U.GREY,upWickColor:U.GREEN,downWickColor:U.RED,noChangeWickColor:U.GREY},area:{lineSize:2,lineColor:U.BLUE,smooth:!1,value:"close",backgroundColor:[{offset:0,color:At(U.BLUE,.01)},{offset:1,color:At(U.BLUE,.2)}],point:{show:!0,color:U.BLUE,radius:4,rippleColor:At(U.BLUE,.3),rippleRadius:8,animation:!0,animationDuration:1e3}},footprint:{dataKey:"footprint",barWidthMultiplier:2,gapMultiplier:1,buyColor:U.GREEN,sellColor:U.RED,neutralColor:U.GREY,pocHighlightColor:"rgba(0, 118, 255, 0.2)",dividerColor:"rgba(255,255,255,0.2)",text:{show:!0,color:U.WHITE,size:10,family:"Helvetica Neue",weight:"normal"},padding:{body:4,textTop:6,textBottom:6,textHorizontal:4},delta:{show:!0,size:10},cell:{height:18,size:10},vol:{show:!0,color:"#FFFFFF",size:10,family:"Helvetica Neue",weight:"normal"},border:{size:1,dividerWidth:1}},footprintPeriod:{dataKey:"footprint",barWidthMultiplier:2,gapMultiplier:1,buyColor:U.GREEN,sellColor:U.RED,neutralColor:U.GREY,leftBar:{width:6,gap:1,backgroundAlpha:.35,borderAlpha:.6},histogram:{minAlpha:.3,maxAlpha:1},textOffset:{gap:6,centerOffset:10,rightPadding:12},delta:{show:!0,size:10},vol:{show:!0,color:"#FFFFFF",size:10,family:"Helvetica Neue",weight:"normal"},cell:{height:12,size:10,text:{show:!0,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal"}},padding:{body:4,textTop:6,textBottom:6,textHorizontal:2},border:{dividerWidth:1}},priceMark:{show:!0,high:{...i},low:{...i},last:{show:!0,compareRule:"current_open",upColor:U.GREEN,downColor:U.RED,noChangeColor:U.GREY,line:{show:!0,style:"dashed",dashedValue:[4,4],size:1,length:0},text:{show:!0,style:"fill",size:12,paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderColor:"transparent",borderStyle:"solid",borderSize:0,borderDashedValue:[2,2],color:U.WHITE,family:"Helvetica Neue",weight:"normal",borderRadius:2},extendTexts:[]}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:"always",showType:"standard",rect:{show:!0,position:"fixed",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,offsetLeft:4,offsetTop:4,offsetRight:4,offsetBottom:4,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",color:"#FEFEFE"},title:{show:!0,size:14,family:"Helvetica Neue",weight:"normal",color:U.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,template:"{ticker} · {period}"},legend:{size:12,family:"Helvetica Neue",weight:"normal",color:U.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,defaultValue:"n/a",template:[{title:"time",value:"{time}"},{title:"open",value:"{open}"},{title:"high",value:"{high}"},{title:"low",value:"{low}"},{title:"close",value:"{close}"},{title:"volume",value:"{volume}"}]},features:[]}}}function Yl(){const i=At(U.GREEN,.7),t=At(U.RED,.7);return{ohlc:{compareRule:"current_open",upColor:i,downColor:t,noChangeColor:U.GREY},bars:[{show:!0,style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:i,downColor:t,noChangeColor:U.GREY}],lines:["#FF9600","#935EBD",U.BLUE,"#E11D74","#01C5C4"].map(e=>({show:!0,style:"solid",smooth:!1,size:1,length:0,dashedValue:[2,2],color:e})),circles:[{show:!0,style:"fill",borderStyle:"solid",borderSize:1,borderDashedValue:[2,2],upColor:i,downColor:t,noChangeColor:U.GREY}],lastValueMark:{show:!1,text:{show:!1,style:"fill",color:U.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderColor:"transparent",borderSize:0,borderDashedValue:[2,2],paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderRadius:2}},tooltip:{offsetLeft:4,offsetTop:6,offsetRight:4,offsetBottom:6,showRule:"always",showType:"standard",title:{show:!0,showName:!0,showParams:!0,size:12,family:"Helvetica Neue",weight:"normal",color:U.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4},legend:{size:12,family:"Helvetica Neue",weight:"normal",color:U.GREY,marginLeft:8,marginTop:4,marginRight:8,marginBottom:4,defaultValue:"n/a"},features:[]}}}function as(){return{show:!0,size:"auto",axisLine:{show:!0,color:"#DDDDDD",size:1,length:0},tickText:{show:!0,color:U.GREY,size:12,family:"Helvetica Neue",weight:"normal",marginStart:4,marginEnd:6},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}}}function Xl(){return{show:!0,horizontal:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,length:0,color:U.GREY},text:{show:!0,style:"fill",color:U.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderColor:U.GREY,borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:U.GREY},features:[]},vertical:{show:!0,line:{show:!0,style:"dashed",dashedValue:[4,2],size:1,length:0,color:U.GREY},text:{show:!0,style:"fill",color:U.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderColor:U.GREY,borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:U.GREY}}}}function Ll(){const i=At(U.BLUE,.35),t=At(U.BLUE,.25);function e(){return{show:!0,style:"fill",color:U.WHITE,size:12,family:"Helvetica Neue",weight:"normal",borderStyle:"solid",borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:U.BLUE,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:U.BLUE}}return{point:{color:U.BLUE,borderColor:i,borderSize:1,radius:5,activeColor:U.BLUE,activeBorderColor:i,activeBorderSize:3,activeRadius:5},line:{show:!0,style:"solid",smooth:!1,color:U.BLUE,size:1,length:0,dashedValue:[2,2]},rect:{show:!0,style:"fill",color:t,borderColor:U.BLUE,borderSize:1,borderRadius:0,borderStyle:"solid",borderDashedValue:[2,2]},polygon:{show:!0,style:"fill",color:U.BLUE,borderColor:U.BLUE,borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},circle:{show:!0,style:"fill",color:t,borderColor:U.BLUE,borderSize:1,borderStyle:"solid",borderDashedValue:[2,2]},arc:{show:!0,style:"solid",color:U.BLUE,size:1,length:0,dashedValue:[2,2]},text:e()}}function Ul(){return{size:1,color:"#DDDDDD",fill:!0,activeBackgroundColor:At(U.BLUE,.08)}}function ql(){return{grid:Hl(),candle:$l(),indicator:Yl(),xAxis:as(),yAxis:as(),separator:Ul(),crosshair:Xl(),overlay:Ll()}}function Pr(i,t,e,n){const r=i.result,s=i.figures,o=i.styles,l=Ue(o,"circles",e.circles),c=l.length,a=Ue(o,"bars",e.bars),h=a.length,f=Ue(o,"lines",e.lines),d=f.length;let u=0,p=0,x=0,g,m=0;s.forEach(y=>{switch(y.type){case"circle":{m=u;const v=l[u%c];g={...v,color:v.noChangeColor},u++;break}case"bar":{m=p;const v=a[p%h];g={...v,color:v.noChangeColor},p++;break}case"line":{m=x,g=f[x%d],x++;break}}if(H(y.type)){const v=y.styles?.({data:{prev:r[t-1],current:r[t],next:r[t+1]},indicator:i,defaultStyles:e});n(y,{...g,...v},m)}})}const jl={};function ea(i){return jl[i]??null}function Je(i,t){const e=t?.ignoreEvent??!1;return Ri(e)?!e:!e.includes(i)}const ls=1,un=-1,Zl="overlay_",jt="overlay_figure_";class Ui{constructor(t){this.groupId="",this.group="",this.totalStep=1,this.currentStep=ls,this.lock=!1,this.visible=!0,this.zLevel=0,this.needDefaultPointFigure=!1,this.needDefaultXAxisFigure=!1,this.needDefaultYAxisFigure=!1,this.mode="normal",this.modeSensitivity=8,this.points=[],this.styles=null,this.createPointFigures=null,this.createXAxisFigures=null,this.createYAxisFigures=null,this.performEventPressedMove=null,this.performEventMoveForDrawing=null,this.onDrawStart=null,this.onDrawing=null,this.onDrawEnd=null,this.onClick=null,this.onDoubleClick=null,this.onRightClick=null,this.onPressedMoveStart=null,this.onPressedMoving=null,this.onPressedMoveEnd=null,this.onMouseMove=null,this.onMouseEnter=null,this.onMouseLeave=null,this.onRemoved=null,this.onSelected=null,this.onDeselected=null,this._prevZLevel=0,this._prevPressedPoint=null,this._prevPressedPoints=[],this._hasMoved=!1,this.override(t)}override(t){this._prevOverlay=An(this);const{id:e,name:n,currentStep:r,points:s,styles:o,...l}=t;if(Se(this,l),se(this.name)||(this.name=n??""),!se(this.id)&&se(e)&&(this.id=e),H(o)&&(this.styles??={},Se(this.styles,o)),ze(s)&&s.length>0){let c=0;if(this.points=[...s],s.length>=this.totalStep-1?(this.currentStep=un,c=this.totalStep-1):(this.currentStep=s.length+1,c=s.length),Ve(this.performEventMoveForDrawing))for(let a=0;a<c;a++)this.performEventMoveForDrawing({currentStep:a+2,mode:this.mode,points:this.points,performPointIndex:a,performPoint:this.points[a]});this.currentStep===un&&this.performEventPressedMove?.({currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:this.points.length-1,performPoint:this.points[this.points.length-1]})}}getPrevZLevel(){return this._prevZLevel}setPrevZLevel(t){this._prevZLevel=t}shouldUpdate(){const t=this._prevOverlay.zLevel!==this.zLevel,e=t||JSON.stringify(this._prevOverlay.points)!==JSON.stringify(this.points)||this._prevOverlay.visible!==this.visible||this._prevOverlay.extendData!==this.extendData||this._prevOverlay.styles!==this.styles;return{sort:t,draw:e}}nextStep(){this.currentStep===this.totalStep-1?this.currentStep=un:this.currentStep++}forceComplete(){this.currentStep=un}isDrawing(){return this.currentStep!==un}isStart(){return this.currentStep===ls}eventMoveForDrawing(t){const e=this.currentStep-1,n={};L(t.timestamp)&&(n.timestamp=t.timestamp),L(t.dataIndex)&&(n.dataIndex=t.dataIndex),L(t.value)&&(n.value=t.value),this.points[e]=n,this.performEventMoveForDrawing?.({currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:e,performPoint:n})}eventPressedPointMove(t,e){this.points[e].timestamp=t.timestamp,L(t.value)&&(this.points[e].value=t.value),this.performEventPressedMove?.({currentStep:this.currentStep,points:this.points,mode:this.mode,performPointIndex:e,performPoint:this.points[e]})}startPressedMove(t){this._prevPressedPoint={...t},this._prevPressedPoints=An(this.points)}eventPressedOtherMove(t,e){if(this._prevPressedPoint!==null){let n=null;L(t.dataIndex)&&L(this._prevPressedPoint.dataIndex)&&(n=t.dataIndex-this._prevPressedPoint.dataIndex);let r=null;L(t.value)&&L(this._prevPressedPoint.value)&&(r=t.value-this._prevPressedPoint.value),this.points=this._prevPressedPoints.map(s=>{L(s.timestamp)&&(s.dataIndex=e.timestampToDataIndex(s.timestamp));const o={...s};return L(n)&&L(s.dataIndex)&&(o.dataIndex=s.dataIndex+n,o.timestamp=e.dataIndexToTimestamp(o.dataIndex)??void 0),L(r)&&L(s.value)&&(o.value=s.value+r),o})}}static extend(t){class e extends Ui{constructor(){super(t)}}return e}setHasMoved(t){this._hasMoved=t}getHasMoved(){return this._hasMoved}}const Gl={name:"fibonacci",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createPointFigures:i=>{const{chart:t,coordinates:e,bounding:n,overlay:r,yAxis:s}=i,o=r.points;if(e.length>0){let l=0;s?.isInCandle()??!0?l=t.getSymbol()?.pricePrecision??2:t.getIndicators({paneId:r.paneId}).forEach(p=>{l=Math.max(l,p.precision)});const c=[],a=[],h=[],f=0,d=n.width;if(e.length>1&&L(o[0].value)&&L(o[1].value)){const u=r.styles?.param,p=Array.isArray(u)&&u.length>0?u:[1,.786,.618,.5,.382,.236,0],x=e[0].y-e[1].y,g=o[0].value-o[1].value;p.forEach(m=>{const y=e[1].y+x*m,v=t.getDecimalFold().format(t.getThousandsSeparator().format(((o[1].value??0)+g*m).toFixed(l)));c.push({coordinates:[{x:f,y},{x:d,y}]}),a.push({x:f,y,text:`${v} (${(m*100).toFixed(1)}%)`,baseline:"bottom"})}),h.push({coordinates:[{x:f,y:e[0].y},{x:d,y:e[0].y},{x:d,y:e[1].y},{x:f,y:e[1].y}]})}return[{type:"polygon",attrs:h},{type:"line",attrs:c},{type:"text",ignoreEvent:!0,attrs:a}]}return[]}},Kl={name:"horizontalRay",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i,bounding:t})=>{const e={x:0,y:i[0].y};return H(i[1])&&i[0].x<i[1].x&&(e.x=t.width),[{type:"line",attrs:{coordinates:[i[0],e]}}]},performEventPressedMove:({points:i,performPoint:t})=>{i[0].value=t.value,i[1].value=t.value},performEventMoveForDrawing:({currentStep:i,points:t,performPoint:e})=>{i===2&&(t[0].value=e.value)}},Ql={name:"horizontalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i})=>{const t=[];return i.length===2&&t.push({coordinates:i}),[{type:"line",attrs:t}]},performEventPressedMove:({points:i,performPoint:t})=>{i[0].value=t.value,i[1].value=t.value},performEventMoveForDrawing:({currentStep:i,points:t,performPoint:e})=>{i===2&&(t[0].value=e.value)}},Jl={name:"horizontalStraight",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i,bounding:t})=>[{type:"line",attrs:{coordinates:[{x:0,y:i[0].y},{x:t.width,y:i[0].y}]}}]};class Vr{constructor(){this._children=[],this._callbacks=new Map}registerEvent(t,e){return this._callbacks.set(t,e),this}onEvent(t,e){const n=this._callbacks.get(t);return H(n)&&this.checkEventOn(e)?n(e):!1}dispatchEventToChildren(t,e){const n=this._children.length-1;if(n>-1){for(let r=n;r>-1;r--)if(this._children[r].dispatchEvent(t,e))return!0}return!1}dispatchEvent(t,e){return this.dispatchEventToChildren(t,e)?!0:this.onEvent(t,e)}addChild(t){return this._children.push(t),this}clear(){this._children=[]}}const Ae=2;class Fr extends Vr{constructor(t){super(),this.attrs=t.attrs,this.styles=t.styles}checkEventOn(t){return this.checkEventOnImp(t,this.attrs,this.styles)}setAttrs(t){return this.attrs=t,this}setStyles(t){return this.styles=t,this}draw(t){this.drawImp(t,this.attrs,this.styles)}getBounding(){const t=this.attrs;if(t&&typeof t.x=="number"&&typeof t.y=="number"){const e=t.width||0,n=t.height||0;return{left:t.x,top:t.y,right:t.x+e,bottom:t.y+n}}return{left:0,top:0,right:0,bottom:0}}static extend(t){class e extends Fr{checkEventOnImp(r,s,o){return t.checkEventOn(r,s,o)}drawImp(r,s,o){t.draw(r,s,o)}}return e}}function ta(i,t){let e=[];e=e.concat(t);for(const n of e){const{coordinates:r}=n;if(r.length>1)for(let s=1;s<r.length;s++){const o=r[s-1],l=r[s];if(o.x===l.x){if(Math.abs(o.y-i.y)+Math.abs(l.y-i.y)-Math.abs(o.y-l.y)<Ae+Ae&&Math.abs(i.x-o.x)<Ae)return!0}else{const c=qi(o,l),a=Rr(c,i),h=Math.abs(a-i.y);if(Math.abs(o.x-i.x)+Math.abs(l.x-i.x)-Math.abs(o.x-l.x)<Ae+Ae&&h*h/(c[0]*c[0]+1)<Ae*Ae)return!0}}}return!1}function Rr(i,t){return i!==null?t.x*i[0]+i[1]:t.y}function Sn(i,t,e){const n=qi(i,t);return Rr(n,e)}function qi(i,t){const e=i.x-t.x;if(e!==0){const n=(i.y-t.y)/e,r=i.y-n*i.x;return[n,r]}return null}function na(i,t,e){const n=t.length,r=L(e)?e>0&&e<1?e:0:e?.5:0;if(r>0&&n>2){let s=t[0].x,o=t[0].y;for(let c=1;c<n-1;c++){const a=t[c-1],h=t[c],f=t[c+1],d=h.x-a.x,u=h.y-a.y,p=f.x-h.x,x=f.y-h.y;let g=f.x-a.x,m=f.y-a.y;const y=Math.sqrt(d*d+u*u),v=Math.sqrt(p*p+x*x),_=v/(v+y);let w=h.x+g*r*_,b=h.y+m*r*_;w=Math.min(w,Math.max(f.x,h.x)),b=Math.min(b,Math.max(f.y,h.y)),w=Math.max(w,Math.min(f.x,h.x)),b=Math.max(b,Math.min(f.y,h.y)),g=w-h.x,m=b-h.y;let C=h.x-g*y/v,M=h.y-m*y/v;C=Math.min(C,Math.max(a.x,h.x)),M=Math.min(M,Math.max(a.y,h.y)),C=Math.max(C,Math.min(a.x,h.x)),M=Math.max(M,Math.min(a.y,h.y)),g=h.x-C,m=h.y-M,w=h.x+g*v/y,b=h.y+m*v/y,i.bezierCurveTo(s,o,C,M,h.x,h.y),s=w,o=b}const l=t[n-1];i.bezierCurveTo(s,o,l.x,l.y,l.x,l.y)}else for(let s=1;s<n;s++)i.lineTo(t[s].x,t[s].y)}function ec(i,t,e){let n=[];n=n.concat(t);const{style:r="solid",smooth:s=!1,size:o=1,color:l="currentColor",dashedValue:c=[2,2],show:a=!0}=e;if(!a)return;switch(i.lineWidth=o,i.strokeStyle=l,r){case"dashed":i.setLineDash(c.map(f=>f*o));break;case"dotted":i.setLineDash([o,o*2]);break;default:i.setLineDash([]);break}const h=o%2===1?.5:0;n.forEach(({coordinates:f})=>{f.length>1&&(f.length===2&&(f[0].x===f[1].x||f[0].y===f[1].y)?(i.beginPath(),f[0].x===f[1].x?(i.moveTo(f[0].x+h,f[0].y),i.lineTo(f[1].x+h,f[1].y)):(i.moveTo(f[0].x,f[0].y+h),i.lineTo(f[1].x,f[1].y+h)),i.stroke(),i.closePath()):(i.save(),o%2===1&&i.translate(.5,.5),i.beginPath(),i.moveTo(f[0].x,f[0].y),na(i,f,s),i.stroke(),i.closePath(),i.restore()))})}const tc={name:"line",checkEventOn:ta,draw:(i,t,e)=>{ec(i,t,e)}};function ia(i,t,e){const n=e??0,r=[];if(i.length>1)if(i[0].x===i[1].x){const o=t.height;if(r.push({coordinates:[{x:i[0].x,y:0},{x:i[0].x,y:o}]}),i.length>2){r.push({coordinates:[{x:i[2].x,y:0},{x:i[2].x,y:o}]});const l=i[0].x-i[2].x;for(let c=0;c<n;c++){const a=l*(c+1);r.push({coordinates:[{x:i[0].x+a,y:0},{x:i[0].x+a,y:o}]})}}}else{const o=t.width,l=qi(i[0],i[1]),c=l[0],a=l[1];if(r.push({coordinates:[{x:0,y:0*c+a},{x:o,y:o*c+a}]}),i.length>2){const h=i[2].y-c*i[2].x;r.push({coordinates:[{x:0,y:0*c+h},{x:o,y:o*c+h}]});const f=a-h;for(let d=0;d<n;d++){const u=a+f*(d+1);r.push({coordinates:[{x:0,y:0*c+u},{x:o,y:o*c+u}]})}}}return r}const nc={name:"parallelStraight",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i,bounding:t})=>{const e=ia(i,t);return e.length>1?[{type:"polygon",attrs:{coordinates:[e[0].coordinates[0],e[0].coordinates[1],e[1].coordinates[1],e[1].coordinates[0]]}},{type:"line",attrs:e}]:[{type:"line",attrs:e}]}},ic={name:"priceChannel",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i,bounding:t})=>{const e=ia(i,t,1);return e.length>2?[{type:"polygon",attrs:{coordinates:[e[1].coordinates[0],e[1].coordinates[1],e[2].coordinates[1],e[2].coordinates[0]]}},{type:"line",attrs:e}]:[{type:"line",attrs:e}]}},rc={name:"priceLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({chart:i,coordinates:t,bounding:e,overlay:n,yAxis:r})=>{let s=0;r?.isInCandle()??!0?s=i.getSymbol()?.pricePrecision??2:i.getIndicators({paneId:n.paneId}).forEach(c=>{s=Math.max(s,c.precision)});const{value:o=0}=n.points[0];return[{type:"line",attrs:{coordinates:[t[0],{x:e.width,y:t[0].y}]}},{type:"text",ignoreEvent:!0,attrs:{x:t[0].x,y:t[0].y,text:i.getDecimalFold().format(i.getThousandsSeparator().format(o.toFixed(s))),baseline:"bottom"}}]}};function sc(i,t){if(i.length>1){let e={x:0,y:0};return i[0].x===i[1].x&&i[0].y!==i[1].y?i[0].y<i[1].y?e={x:i[0].x,y:t.height}:e={x:i[0].x,y:0}:i[0].x>i[1].x?e={x:0,y:Sn(i[0],i[1],{x:0,y:i[0].y})}:e={x:t.width,y:Sn(i[0],i[1],{x:t.width,y:i[0].y})},{coordinates:[i[0],e]}}return[]}const oc={name:"ray",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i,bounding:t})=>[{type:"line",attrs:sc(i,t)}]},ac={name:"segment",totalStep:3,needDefaultPointFigure:!0,createPointFigures:({coordinates:i})=>i.length===2?[{type:"line",attrs:{coordinates:i}}]:[]},lc={name:"straight",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i,bounding:t})=>i.length===2?i[0].x===i[1].x?[{type:"line",attrs:{coordinates:[{x:i[0].x,y:0},{x:i[0].x,y:t.height}]}}]:[{type:"line",attrs:{coordinates:[{x:0,y:Sn(i[0],i[1],{x:0,y:i[0].y})},{x:t.width,y:Sn(i[0],i[1],{x:t.width,y:i[0].y})}]}}]:[]},cc={name:"verticalRay",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i,bounding:t})=>{if(i.length===2){const e={x:i[0].x,y:0};return i[0].y<i[1].y&&(e.y=t.height),[{type:"line",attrs:{coordinates:[i[0],e]}}]}return[]},performEventPressedMove:({points:i,performPoint:t})=>{i[0].timestamp=t.timestamp,i[0].dataIndex=t.dataIndex,i[1].timestamp=t.timestamp,i[1].dataIndex=t.dataIndex},performEventMoveForDrawing:({currentStep:i,points:t,performPoint:e})=>{i===2&&(t[0].timestamp=e.timestamp,t[0].dataIndex=e.dataIndex)}},hc={name:"verticalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i})=>i.length===2?[{type:"line",attrs:{coordinates:i}}]:[],performEventPressedMove:({points:i,performPoint:t})=>{i[0].timestamp=t.timestamp,i[0].dataIndex=t.dataIndex,i[1].timestamp=t.timestamp,i[1].dataIndex=t.dataIndex},performEventMoveForDrawing:({currentStep:i,points:t,performPoint:e})=>{i===2&&(t[0].timestamp=e.timestamp,t[0].dataIndex=e.dataIndex)}},uc={name:"verticalStraight",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i,bounding:t})=>[{type:"line",attrs:{coordinates:[{x:i[0].x,y:0},{x:i[0].x,y:t.height}]}}]},fc={name:"simpleAnnotation",totalStep:2,createPointFigures:({overlay:i,coordinates:t})=>{let e="";H(i.extendData)&&(Ve(i.extendData)?e=i.extendData(i):e=i.extendData??"");const n=t[0].x,r=t[0].y-6,s=r-(i?.styles?.line?.length||10),o=s-5;return[{type:"line",attrs:{coordinates:[{x:n,y:r},{x:n,y:s}]},ignoreEvent:!0},{type:"polygon",attrs:{coordinates:[{x:n,y:s},{x:n-4,y:o},{x:n+4,y:o}]}},{type:"text",attrs:{x:n,y:o,text:e,align:"center",baseline:"bottom"}}]}},dc={name:"simpleTag",totalStep:2,createPointFigures:({bounding:i,coordinates:t})=>({type:"line",attrs:{coordinates:[{x:0,y:t[0].y},{x:i.width,y:t[0].y}]},ignoreEvent:!0}),createYAxisFigures:({chart:i,overlay:t,coordinates:e,bounding:n,yAxis:r})=>{const s=r?.isFromZero()??!1;let o="left",l=0;s?(o="left",l=0):(o="right",l=n.width);let c="";return H(t.extendData)&&(Ve(t.extendData)?c=t.extendData(t):c=t.extendData??""),!H(c)&&L(t.points[0].value)&&(c=ke(t.points[0].value,i.getSymbol()?.pricePrecision??2)),{type:"text",attrs:{x:l,y:e[0].y,text:c,align:o,baseline:"middle"}}}};function vn(i,t,e){const n=(i.x-t.x)*Math.cos(e)-(i.y-t.y)*Math.sin(e)+t.x,r=(i.x-t.x)*Math.sin(e)+(i.y-t.y)*Math.cos(e)+t.y;return{x:n,y:r}}function et(i,t){if(i.length>1){let e;return i[0].x===i[1].x&&i[0].y!==i[1].y?i[0].y<i[1].y?e={x:i[0].x,y:t.height}:e={x:i[0].x,y:0}:i[0].x>i[1].x?e={x:0,y:Yi.getLinearYFromCoordinates(i[0],i[1],{x:0,y:i[0].y})}:e={x:t.width,y:Yi.getLinearYFromCoordinates(i[0],i[1],{x:t.width,y:i[0].y})},{coordinates:[i[0],e]}}return[]}function ra(i,t){const e=Math.abs(i.x-t.x),n=Math.abs(i.y-t.y);return Math.sqrt(e*e+n*n)}const pc={name:"arrow",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i})=>{if(i.length>1){const t=i[1].x>i[0].x?0:1,e=Yi.getLinearSlopeIntercept(i[0],i[1]);let n;e?n=Math.atan(e[0])+Math.PI*t:i[1].y>i[0].y?n=Math.PI/3:n=Math.PI/3*3;const r=vn({x:i[1].x-18,y:i[1].y+6},i[1],n),s=vn({x:i[1].x-18,y:i[1].y-6},i[1],n);return[{type:"line",attrs:{coordinates:i}},{type:"polygon",ignoreEvent:!0,attrs:{coordinates:[r,i[1],s]}}]}return[]}};function xc(i,t,e){const n=[];if(i.length>1)if(i[0].x===i[1].x){let r=t.height;i[1].y<i[0].y&&(r=0),n.push({coordinates:[i[0],{x:i[0].x,y:r}]});for(let s=2;s<i.length;s++)n.push({coordinates:[i[s],{x:i[s].x,y:r}]})}else{const r=(i[1].y-i[0].y)/(i[1].x-i[0].x),s=i[0].y-r*i[0].x;let o=t.width;i[1].x<i[0].x&&(o=0),n.push({coordinates:[i[0],{x:o,y:r*o+s}]});for(let l=2;l<i.length;l++){const c=i[l].y-r*i[l].x;let a=t.width;i[1].x<i[0].x&&(a=0),n.push({coordinates:[i[l],{x:a,y:r*a+c}]})}}return n}const gc={name:"parallelRay",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i,bounding:t})=>{const e=xc(i,t);return e.length>1?[{type:"polygon",attrs:{coordinates:[e[0].coordinates[0],e[0].coordinates[1],e[1].coordinates[1],e[1].coordinates[0]]}},{type:"line",attrs:e}]:[{type:"line",attrs:e}]}};function mc(i,t,e){const n=[];if(i.length>1){const r=i[1].x-i[0].x,s=i[1].y-i[0].y;n.push({coordinates:[i[0],i[1]]});for(let o=2;o<i.length;o++)n.push({coordinates:[i[o],{x:i[o].x+r,y:i[o].y+s}]})}return n}const yc={name:"parallelSegment",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i,bounding:t})=>{const e=mc(i);return e.length>1?[{type:"polygon",attrs:{coordinates:[e[0].coordinates[0],e[0].coordinates[1],e[1].coordinates[1],e[1].coordinates[0]]}},{type:"line",attrs:e}]:[{type:"line",attrs:e}]}};function vc(i,t){if(i.length<3)return[];const[e,n,r]=i,s=[];s.push({key:"base_segment",type:"line",attrs:{coordinates:[n,r]}});const o={x:(n.x+r.x)/2,y:(n.y+r.y)/2},l=et([e,o],t).coordinates,c={x:n.x-e.x+o.x,y:n.y-e.y+o.y},a=et([n,c],t).coordinates,h={x:r.x-e.x+o.x,y:r.y-e.y+o.y},f=et([r,h],t).coordinates,d={x:(n.x+o.x)/2,y:(n.y+o.y)/2},u={x:d.x-e.x+o.x,y:d.y-e.y+o.y},p=et([d,u],t).coordinates,x={x:(r.x+o.x)/2,y:(r.y+o.y)/2},g={x:x.x-e.x+o.x,y:x.y-e.y+o.y},m=et([x,g],t).coordinates;return s.push({key:"area",type:"polygon",attrs:{coordinates:[a[0],a[1],f[1],f[0]]}}),s.push({key:"median_line",type:"line",attrs:{coordinates:l}},{key:"upper_line",type:"line",attrs:{coordinates:a}},{key:"lower_line",type:"line",attrs:{coordinates:f}},{key:"assist5",type:"line",attrs:{coordinates:p}},{key:"assist6",type:"line",attrs:{coordinates:m}}),s}const _c={name:"bifurcate",totalStep:4,needDefaultPointFigure:!0,createPointFigures:({coordinates:i,bounding:t})=>!i||i.length<3?[]:vc(i,t)},wc={name:"circle",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i})=>{if(i.length>1){const t=ra(i[0],i[1]);return{type:"circle",attrs:{...i[0],r:t}}}return[]}},bc={name:"triangle",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i})=>[{type:"polygon",attrs:{coordinates:i}}]},Cc={name:"rect",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i})=>i.length>1?[{type:"polygon",attrs:{coordinates:[i[0],{x:i[1].x,y:i[0].y},i[1],{x:i[0].x,y:i[1].y}]}}]:[]},Ac={name:"parallelogram",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i})=>{if(i.length===2)return[{type:"line",attrs:{coordinates:i}}];if(i.length>=3){const t={x:i[0].x+i[2].x-i[1].x,y:i[0].y+i[2].y-i[1].y};return[{type:"polygon",attrs:{coordinates:[i[0],i[1],i[2],t]}}]}return[]},performEventPressedMove:({points:i,performPointIndex:t,performPoint:e})=>{t<2&&(i[0].price=e.price,i[1].price=e.price)},performEventMoveForDrawing:({currentStep:i,points:t,performPoint:e})=>{i===2&&(t[0].price=e.price)}},Sc={name:"oval",totalStep:3,needDefaultPointFigure:!0,createPointFigures:({coordinates:i})=>{if(i.length>=2){const[t,e]=i,n=(t.x+e.x)/2,r=(t.y+e.y)/2,s=Math.abs(t.x-e.x)/2,o=Math.abs(t.y-e.y)/2;if(s<=0||o<=0)return[];const l=Math.PI*2/180,c=[];for(let a=0;a<Math.PI*2;a+=l)c.push({x:n+s*Math.cos(a),y:r+o*Math.sin(a)});return[{type:"polygon",attrs:{coordinates:c}}]}return[]}},Ec={name:"fibonacciSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({chart:i,coordinates:t,overlay:e,yAxis:n})=>{if(t.length>0){let r=0;n?.isInCandle()??!0?r=i.getSymbol()?.pricePrecision??2:i.getIndicators({paneId:e.paneId}).forEach(a=>{r=Math.max(r,a.precision)});const s=[],o=[],l=[];if(t.length>1){const c=t[1].x>t[0].x?t[0].x:t[1].x,a=e.styles?.param,h=Array.isArray(a)&&a.length>0?a:[1,.786,.618,.5,.382,.236,0],f=t[0].y-t[1].y,d=e.points,u=d[0].value-d[1].value;h.forEach(p=>{const x=t[1].y+f*p,g=i.getDecimalFold().format(i.getThousandsSeparator().format(((d[1].value??0)+u*p).toFixed(r)));s.push({coordinates:[{x:t[0].x,y:x},{x:t[1].x,y:x}]}),o.push({x:c,y:x,text:`${g} (${(p*100).toFixed(1)}%)`,baseline:"bottom"})}),l.push({coordinates:[{x:t[0].x,y:t[0].y},{x:t[1].x,y:t[0].y},{x:t[1].x,y:t[1].y},{x:t[0].x,y:t[1].y}]})}return[{type:"polygon",attrs:l},{type:"line",attrs:s},{type:"text",ignoreEvent:!0,attrs:o}]}return[]}},Mc={name:"fibonacciChannel",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)"}},createPointFigures:({chart:i,coordinates:t,overlay:e,yAxis:n})=>{const r=[],s=[],o=[];if(t.length===2)return r.push({coordinates:[{x:t[0].x,y:t[0].y},{x:t[1].x,y:t[1].y}]}),[{type:"line",attrs:r}];if(t.length>=3){let l=0;n?.isInCandle()??!0?l=i.getSymbol()?.pricePrecision??2:i.getIndicators({paneId:e.paneId}).forEach(b=>{l=Math.max(l,b.precision)});const c=e.points,a=c[0]?.value??0;c[1]?.value;const h=c[2]?.value??0,f=e.styles?.param,d=Array.isArray(f)&&f.length>0?f:[0,.236,.382,.5,.618,.786,1,1.618,2.618,3.618],u=h-a,p=t[1].x-t[0].x,x=t[1].y-t[0].y,g=t[2].x-t[0].x,m=t[2].y-t[0].y,y=[],v=[],_=[];for(let w=0;w<d.length;w++){const b=d[w],C=a+u*b,M=t[0].x+g*b,T=t[0].y+m*b,S=M,E=T,I=M+p,k=T+x;y.push({coordinates:[{x:S,y:E},{x:I,y:k}]});const P=C.toFixed(l);if(v.push({x:M,y:T,text:`${P} (${(b*100).toFixed(1)}%)`,baseline:"bottom"}),w>0){const B=d[w-1],V=t[0].x+g*B,R=t[0].y+m*B,W=V+p,F=R+x;_.push({coordinates:[{x:V,y:R},{x:W,y:F},{x:I,y:k},{x:S,y:E}]})}}return r.push(...y),s.push(...v),o.push(..._),[{type:"polygon",attrs:o},{type:"line",attrs:r},{type:"text",ignoreEvent:!0,attrs:s}]}return[]}},Dc={name:"fibonacciCircle",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i,overlay:t})=>{if(i.length>1){const e=Math.abs(i[0].x-i[1].x),n=Math.abs(i[0].y-i[1].y),r=Math.sqrt(e*e+n*n),s=t.styles?.param,o=Array.isArray(s)&&s.length>0?s:[1,.786,.618,.5,.382,.236,0],l=[],c=[];return o.forEach(a=>{const h=r*a;l.push({...i[0],r:h}),c.push({x:i[0].x,y:i[0].y+h+6,text:`${(a*100).toFixed(1)}%`})}),[{type:"circle",attrs:l},{type:"text",ignoreEvent:!0,attrs:c}]}return[]}},kc={name:"fibonacciExtension",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({chart:i,coordinates:t,overlay:e,yAxis:n})=>{const r=[],s=[],o=[];if(t.length>2){let l=0;n?.isInCandle()??!0?l=i.getSymbol()?.pricePrecision??2:i.getIndicators({paneId:e.paneId}).forEach(p=>{l=Math.max(l,p.precision)});const c=e.points,a=c[1].value-c[0].value,h=t[1].y-t[0].y,f=[0,.236,.382,.5,.618,.786,1],d=t[2].x>t[1].x?t[1].x:t[2].x;f.forEach(u=>{const p=t[2].y+h*u,x=i.getDecimalFold().format(i.getThousandsSeparator().format(((c[1].value??0)+a*u).toFixed(l)));r.push({coordinates:[{x:t[1].x,y:p},{x:t[2].x,y:p}]}),s.push({x:d,y:p,text:`${x} (${(u*100).toFixed(1)}%)`,baseline:"bottom"})}),o.push({coordinates:[{x:t[1].x,y:t[2].y},{x:t[2].x,y:t[2].y},{x:t[2].x,y:t[2].y+h},{x:t[1].x,y:t[2].y+h}]})}return[{type:"line",attrs:{coordinates:t},styles:{style:"dashed"}},{type:"polygon",attrs:o},{type:"line",attrs:r},{type:"text",ignoreEvent:!0,attrs:s}]}},Bc={name:"fibonacciSector",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i,bounding:t})=>{const e=[];let n=[];const r=[];if(i.length>1){const s=i[1].x>i[0].x?-38:4,o=i[1].y>i[0].y?-2:20,l=i[1].x-i[0].x,c=i[1].y-i[0].y;[1,.75,.618,.5,.382,.25,0].forEach(h=>{const f=i[1].x-l*h,d=i[1].y-c*h;e.push({coordinates:[{x:f,y:i[0].y},{x:f,y:i[1].y}]}),e.push({coordinates:[{x:i[0].x,y:d},{x:i[1].x,y:d}]}),n=n.concat(et([i[0],{x:f,y:i[1].y}],t)),n=n.concat(et([i[0],{x:i[1].x,y:d}],t)),r.unshift({x:i[0].x+s,y:d+10,text:`${h.toFixed(3)}`}),r.unshift({x:f-18,y:i[0].y+o,text:`${h.toFixed(3)}`})})}return[{type:"line",attrs:e},{type:"line",attrs:n},{type:"text",ignoreEvent:!0,attrs:r}]}},Tc={name:"fibonacciSpiral",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i,bounding:t})=>{if(i.length>1){const e=ra(i[0],i[1])/Math.sqrt(24),n=i[1].x>i[0].x?0:1,r=Yi.getLinearSlopeIntercept(i[0],i[1]);let s;r?s=Math.atan(r[0])+Math.PI*n:i[1].y>i[0].y?s=Math.PI/2:s=Math.PI/2*3;const o=vn({x:i[0].x-e,y:i[0].y},i[0],s),l=vn({x:i[0].x-e,y:i[0].y-e},i[0],s),c=[{...o,r:e,startAngle:s,endAngle:s+Math.PI/2},{...l,r:e*2,startAngle:s+Math.PI/2,endAngle:s+Math.PI}];let a=i[0].x-e,h=i[0].y-e;for(let f=2;f<9;f++){const d=c[f-2].r+c[f-1].r;let u=0;switch(f%4){case 0:{u=s,a-=c[f-2].r;break}case 1:{u=s+Math.PI/2,h-=c[f-2].r;break}case 2:{u=s+Math.PI,a+=c[f-2].r;break}case 3:{u=s+Math.PI/2*3,h+=c[f-2].r;break}}const p=u+Math.PI/2,x=vn({x:a,y:h},i[0],s);c.push({...x,r:d,startAngle:u,endAngle:p})}return[{type:"arc",attrs:c},{type:"line",attrs:et(i,t)}]}return[]}},Ic={name:"gannBox",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i})=>{if(i.length>1){const t=(i[1].y-i[0].y)/4,e=i[1].x-i[0].x,n=[{coordinates:[i[0],{x:i[1].x,y:i[1].y-t}]},{coordinates:[i[0],{x:i[1].x,y:i[1].y-t*2}]},{coordinates:[{x:i[0].x,y:i[1].y},{x:i[1].x,y:i[0].y+t}]},{coordinates:[{x:i[0].x,y:i[1].y},{x:i[1].x,y:i[0].y+t*2}]},{coordinates:[{...i[0]},{x:i[0].x+e*.236,y:i[1].y}]},{coordinates:[{...i[0]},{x:i[0].x+e*.5,y:i[1].y}]},{coordinates:[{x:i[0].x,y:i[1].y},{x:i[0].x+e*.236,y:i[0].y}]},{coordinates:[{x:i[0].x,y:i[1].y},{x:i[0].x+e*.5,y:i[0].y}]}],r=[{coordinates:[i[0],i[1]]},{coordinates:[{x:i[0].x,y:i[1].y},{x:i[1].x,y:i[0].y}]}];return[{type:"line",attrs:[{coordinates:[i[0],{x:i[1].x,y:i[0].y}]},{coordinates:[{x:i[1].x,y:i[0].y},i[1]]},{coordinates:[i[1],{x:i[0].x,y:i[1].y}]},{coordinates:[{x:i[0].x,y:i[1].y},i[0]]}]},{type:"polygon",ignoreEvent:!0,attrs:{coordinates:[i[0],{x:i[1].x,y:i[0].y},i[1],{x:i[0].x,y:i[1].y}]}},{type:"line",attrs:n,styles:{style:"dashed"}},{type:"line",attrs:r}]}return[]}},Pc={name:"threeWaves",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i})=>{let t=0;const e=[];return i.forEach((n,r)=>{let s=n.x,o=n.y;s=n.x-11,r>0&&(o>t?(r===1&&(e[0].y=e[0].y-6),o+=26):(r===1&&(e[0].y=e[0].y+26),o-=6)),t=o,e.push({x:s,y:o,text:`(${r})`,baseline:"bottom"})}),[{type:"line",attrs:{coordinates:i}},{type:"text",ignoreEvent:!0,attrs:e}]}},Vc={name:"fiveWaves",totalStep:7,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i})=>{let t=0;const e=[];return i.forEach((n,r)=>{let s=n.x,o=n.y;s=n.x-11,r>0&&(o>t?(r===1&&(e[0].y=e[0].y-6),o+=26):(r===1&&(e[0].y=e[0].y+26),o-=6)),t=o,e.push({x:s,y:o,text:`(${r})`,baseline:"bottom"})}),[{type:"line",attrs:{coordinates:i}},{type:"text",ignoreEvent:!0,attrs:e}]}},Fc={name:"eightWaves",totalStep:10,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i})=>{let t=0;const e=[];return i.forEach((n,r)=>{let s=n.x,o=n.y;s=n.x-11,r>0&&(o>t?(r===1&&(e[0].y=e[0].y-6),o+=26):(r===1&&(e[0].y=e[0].y+26),o-=6)),t=o,e.push({x:s,y:o,text:`(${r})`,baseline:"bottom"})}),[{type:"line",attrs:{coordinates:i}},{type:"text",ignoreEvent:!0,attrs:e}]}},Rc={name:"continuousLine",totalStep:Number.MAX_SAFE_INTEGER,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i})=>{let t=0;const e=[];return i.forEach((n,r)=>{let s=n.x,o=n.y;s=n.x-11,r>0&&(o>t?(r===1&&(e[0].y=e[0].y-6),o+=26):(r===1&&(e[0].y=e[0].y+26),o-=6)),t=o,e.push({x:s,y:o,text:`(${r})`,baseline:"bottom"})}),[{type:"line",attrs:{coordinates:i}},{type:"text",ignoreEvent:!0,attrs:e}]}},zc={name:"xabcd",totalStep:6,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i,overlay:t})=>{const e=[],n=[],r=["X","A","B","C","D"],s=i.map((o,l)=>({...o,baseline:"bottom",text:`(${r[l]})`}));return i.length>2&&(e.push({coordinates:[i[0],i[2]]}),n.push({coordinates:[i[0],i[1],i[2]]}),i.length>3&&(e.push({coordinates:[i[1],i[3]]}),i.length>4&&(e.push({coordinates:[i[2],i[4]]}),n.push({coordinates:[i[2],i[3],i[4]]})))),[{type:"line",attrs:{coordinates:i}},{type:"line",attrs:e,styles:{style:"dashed"}},{type:"polygon",ignoreEvent:!0,attrs:n},{type:"text",ignoreEvent:!0,attrs:s}]}},Nc={name:"abcd",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i})=>{let t=[],e=[];const n=[],r=["A","B","C","D"],s=i.map((o,l)=>({...o,baseline:"bottom",text:`(${r[l]})`}));return i.length>2&&(t=[i[0],i[2]],n.push({coordinates:[i[0],i[1],i[2]]}),i.length>3&&(e=[i[1],i[3]],n.push({coordinates:[i[1],i[2],i[3]]}))),[{type:"polygon",attrs:n},{type:"line",attrs:{coordinates:i}},{type:"line",attrs:[{coordinates:t},{coordinates:e}],styles:{style:"dashed"}},{type:"text",ignoreEvent:!0,attrs:s}]}};function Xn(i,t,e){if(i.x===t.x)return e.y;const n=(t.y-i.y)/(t.x-i.x),r=i.y-n*i.x;return n*e.x+r}function cs(i,t,e,n){const r=(t.y-i.y)*(n.x-e.x)-(n.y-e.y)*(t.x-i.x);if(r===0)return null;const s=((e.y-i.y)*(n.x-e.x)-(n.y-e.y)*(e.x-i.x))/r,o=i.x+s*(t.x-i.x),l=i.y+s*(t.y-i.y);return{x:o,y:l}}const Wc={name:"headShoulders",totalStep:8,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i,bounding:t})=>{const e=[],n=[],r=[],s=[null,"左肩",null,"头部",null,"右肩",null];if(i.length>0){i.forEach((a,h)=>{h>0&&e.push({coordinates:[i[h-1],a]});const f=s[h];f&&n.push({x:a.x,y:a.y-10,text:f,baseline:"bottom"})});let l=null,c=null;if(i.length>=5)if(r.push({coordinates:[i[2],i[3],i[4]]}),Xn(i[2],i[4],i[0])<i[0].y)l={x:0,y:Xn(i[2],i[4],{x:0,y:0})},c={x:t.width,y:Xn(i[2],i[4],{x:t.width,y:0})};else{const h=cs(i[0],i[1],i[2],i[4]);h&&(l=h,c=et([h,i[4]],t).coordinates[1],r.push({coordinates:[h,i[1],i[2]]}))}if(i.length>=7&&Xn(i[2],i[4],i[6])>=i[6].y){const h=cs(i[5],i[6],i[2],i[4]);h&&l&&(c=h,r.push({coordinates:[h,i[4],i[5]]}))}l&&c&&e.push({coordinates:[l,c]})}return[{type:"line",attrs:e},{type:"polygon",ignoreEvent:!0,attrs:r},{type:"text",ignoreEvent:!0,attrs:n}]}};function fn(i,t,e){if(i.x===t.x)return e.y;const n=(t.y-i.y)/(t.x-i.x),r=i.y-n*i.x;return n*e.x+r}function Oc(i,t,e,n){const r=i.x===t.x,s=e.x===n.x;let o,l,c,a;if(r?(o=1/0,l=1/0):(o=(t.y-i.y)/(t.x-i.x),l=i.y-o*i.x),s?(c=1/0,a=1/0):(c=(n.y-e.y)/(n.x-e.x),a=e.y-c*e.x),o===c)return null;let h,f;return r?(h=i.x,f=c*h+a):s?(h=e.x,f=o*h+l):(h=(a-l)/(o-c),f=o*h+l),{point:{x:h,y:f},kb1:{k:o,b:l},kb2:{k:c,b:a}}}const Hc={name:"triangleTruss",totalStep:5,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i})=>{const t=[],e=[],n=[],r=["A","B","C","D"];if(i.length>0&&i.forEach((s,o)=>{const l=r[o];l&&n.push({x:s.x,y:s.y-10,text:l,baseline:"bottom"}),o>0&&t.push({coordinates:[i[o-1],s]})}),i.length===3&&i[2].x>i[0].x){const s=fn(i[2],i[1],i[0]),o={x:i[0].x,y:s};t.push({coordinates:[i[0],i[2]]}),t.push({coordinates:[i[0],o]}),t.push({coordinates:[o,i[2]]}),e.push({coordinates:[i[0],i[2],o]})}if(i.length===4){const s=Oc(i[0],i[2],i[1],i[3]);if(s){let o,l,c,a;s.kb1.k>s.kb2.k?i[0].x<i[1].x?(o=i[0].x,l=i[0].y,c=i[0].x,a=fn(i[1],i[3],i[0])):(o=i[1].x,l=i[1].y,c=i[1].x,a=fn(i[2],i[0],i[1])):i[2].x<i[3].x?(o=i[3].x,l=i[3].y,c=i[3].x,a=fn(i[0],i[2],i[3])):(o=i[2].x,l=i[2].y,c=i[2].x,a=fn(i[1],i[3],i[2])),t.push({coordinates:[{x:o,y:l},s.point]}),t.push({coordinates:[{x:o,y:l},{x:c,y:a}]}),t.push({coordinates:[{x:o,y:a},s.point]}),e.push({coordinates:[{x:o,y:l},{x:o,y:a},s.point]})}}return[{type:"line",attrs:t},{type:"polygon",ignoreEvent:!0,attrs:e},{type:"text",ignoreEvent:!0,attrs:n}]}};function hs(i,t,e){if(!i||!t||!e)return"";const n=i.value??0,r=t.value??0,s=e.value??0,o=n-r,l=s-r;return o===0?"N/A":(l/o).toFixed(3)}const $c={name:"threePush",totalStep:8,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i,overlay:t})=>{const e=[],n=[],r=[],s=[],o=t.points;return i.length>1&&i.forEach((l,c)=>{if(c>0&&e.push({coordinates:[i[c-1],l]}),c===3){const a=o[c-2],h=o[c-1],f=o[c];if(a&&h&&f){n.push({coordinates:[i[c-2],l]});const d=hs(a,h,f);d&&r.push({x:l.x,y:l.y+8,text:d,baseline:"bottom"}),s.push({coordinates:[i[c-2],i[c-1],l]})}}if(c===5){const a=o[c-2],h=o[c-1],f=o[c];if(a&&h&&f){n.push({coordinates:[i[c-2],l]});const d=hs(a,h,f);d&&r.push({x:l.x,y:l.y+8,text:d,baseline:"bottom"}),s.push({coordinates:[i[c-2],i[c-1],l]})}}}),[{type:"polygon",attrs:s},{type:"line",attrs:e},{type:"line",attrs:n,styles:{style:"dashed"}},{type:"text",ignoreEvent:!0,attrs:r}]}},Yc={name:"mw",totalStep:6,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i})=>{let t=0;const e=[];return i.forEach((n,r)=>{let s=n.x,o=n.y;s=n.x-11,r>0&&(o>t?(r===1&&(e[0].y=e[0].y-6),o+=26):(r===1&&(e[0].y=e[0].y+26),o-=6)),t=o,e.push({x:s,y:o,text:`(${r})`,baseline:"bottom"})}),[{type:"line",attrs:{coordinates:i}},{type:"text",ignoreEvent:!0,attrs:e}]}};function Xc(i){const t=Math.round(i),e=Math.floor(t/(24*3600)),n=Math.floor(t%(24*3600)/3600),r=Math.floor(t%3600/60);let s="";return e>0&&(s+=`${e}D`),n>0&&(s+=`${n}H`),r>0&&(s+=`${r}M`),s}const Lc={name:"ruler",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:i,overlay:t})=>{if(i.length!==2)return[];const e=t.points;if(e.length!==2)return[];const n=e[0],r=e[1],s=i[0],o=i[1],l=r.value-n.value,c=l/n.value*100,a=`${l.toFixed(2)} (${c.toFixed(2)}%)`,h=Math.abs(r.dataIndex-n.dataIndex),f=Math.abs(r.timestamp-n.timestamp);let d=`${h} bars`;f>0&&(d+=` (${Xc(f/1e3)})`);const u=(s.x+o.x)/2,p=(s.y+o.y)/2,x=s.y<o.y?-8:8,g=s.x<o.x?-8:8,y=12*1.3,v=Math.max(s.y,o.y),_=u,w=v+y/2+5,b=w+y+6;return[{type:"polygon",attrs:[{coordinates:[s,{x:o.x,y:s.y},o,{x:s.x,y:o.y}]}]},{type:"line",attrs:[{coordinates:[s,{x:o.x,y:s.y}]},{coordinates:[{x:o.x,y:s.y},o]},{coordinates:[o,{x:s.x,y:o.y}]},{coordinates:[{x:s.x,y:o.y},s]}]},{type:"line",attrs:[{coordinates:[{x:u,y:s.y},{x:u,y:o.y}]},{coordinates:[{x:u,y:o.y},{x:u-4,y:o.y+x}]},{coordinates:[{x:u,y:o.y},{x:u+4,y:o.y+x}]},{coordinates:[{x:s.x,y:p},{x:o.x,y:p}]},{coordinates:[{x:o.x,y:p},{x:o.x+g,y:p-4}]},{coordinates:[{x:o.x,y:p},{x:o.x+g,y:p+4}]}]},{type:"text",ignoreEvent:!0,attrs:[{x:_,y:w,text:a,align:"center",baseline:"middle"},{x:_,y:b,text:d,align:"center",baseline:"middle"}]}]}};function Uc(i){const t=Math.round(i),e=Math.floor(t/(24*3600)),n=Math.floor(t%(24*3600)/3600),r=Math.floor(t%3600/60);let s="";return e>0&&(s+=`${e}D`),n>0&&(s+=`${n}H`),r>0&&(s+=`${r}M`),s}const qc={name:"timeRuler",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)",style:"fill",borderColor:"rgba(22, 119, 255, 1)"},line:{color:"rgba(22, 119, 255, 1)"},text:{color:"#FFF",size:12,paddingLeft:4,paddingRight:4,backgroundColor:"rgba(22, 119, 255, 0.8)"}},createPointFigures:({coordinates:i,overlay:t})=>{if(i.length===2){const e=t.points;if(e.length!==2)return[];const n=e[0],r=e[1],s=i[0],o=i[1],l=[],c=[{coordinates:[s,{x:o.x,y:s.y},o,{x:s.x,y:o.y}]}];l.push({type:"polygon",attrs:c}),l.push({type:"line",attrs:[{coordinates:[s,{x:o.x,y:s.y}]},{coordinates:[{x:o.x,y:s.y},o]},{coordinates:[o,{x:s.x,y:o.y}]},{coordinates:[{x:s.x,y:o.y},s]}],styles:{style:"dashed"}});const a=[],h=(s.y+o.y)/2;a.push({coordinates:[{x:s.x,y:h},{x:o.x,y:h}]}),s.x<o.x?(a.push({coordinates:[{x:o.x,y:h},{x:o.x-8,y:h-4}]}),a.push({coordinates:[{x:o.x,y:h},{x:o.x-8,y:h+4}]})):(a.push({coordinates:[{x:o.x,y:h},{x:o.x+8,y:h-4}]}),a.push({coordinates:[{x:o.x,y:h},{x:o.x+8,y:h+4}]})),l.push({type:"line",attrs:a});const f=Math.abs(r.dataIndex-n.dataIndex),d=Math.abs(r.timestamp-n.timestamp);let u=`${f} bars`;d>0&&(u+=` (${Uc(d/1e3)})`);const p=Math.max(s.y,o.y),x=(s.x+o.x)/2,g=p+16,m=[{x,y:g,text:u,align:"center",baseline:"middle"}];return l.push({type:"text",attrs:m,ignoreEvent:!0}),l}return[]}},jc={name:"spaceRuler",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,styles:{polygon:{color:"rgba(22, 119, 255, 0.15)",style:"fill",borderColor:"rgba(22, 119, 255, 1)"},line:{color:"rgba(22, 119, 255, 1)"},text:{color:"#FFF",size:12,paddingLeft:4,paddingRight:4,backgroundColor:"rgba(22, 119, 255, 0.8)"}},createPointFigures:({coordinates:i,overlay:t})=>{if(i.length===2){const e=t.points;if(e.length!==2)return[];const n=e[0],r=e[1],s=i[0],o=i[1],l=[],c=[{coordinates:[s,{x:o.x,y:s.y},o,{x:s.x,y:o.y}]}];l.push({type:"polygon",attrs:c}),l.push({type:"line",attrs:[{coordinates:[s,{x:o.x,y:s.y}]},{coordinates:[{x:o.x,y:s.y},o]},{coordinates:[o,{x:s.x,y:o.y}]},{coordinates:[{x:s.x,y:o.y},s]}]});const a=[],h=(s.x+o.x)/2;a.push({coordinates:[{x:h,y:s.y},{x:h,y:o.y}]}),s.y<o.y?(a.push({coordinates:[{x:h,y:o.y},{x:h-4,y:o.y-8}]}),a.push({coordinates:[{x:h,y:o.y},{x:h+4,y:o.y-8}]})):(a.push({coordinates:[{x:h,y:o.y},{x:h-4,y:o.y+8}]}),a.push({coordinates:[{x:h,y:o.y},{x:h+4,y:o.y+8}]})),l.push({type:"line",attrs:a});const f=r.value-n.value,d=f/n.value*100,u=`${f.toFixed(2)} (${d.toFixed(2)}%)`,x=Math.max(s.y,o.y)+16,g=[{x:h,y:x,text:u,align:"center",baseline:"middle"}];return l.push({type:"text",attrs:g,ignoreEvent:!0}),l}return[]}};function Zc(i,t){if(i.length<2)return[];const[e,n]=i,r=e.x<=n.x?e:n,s=e.x>n.x?e:n,o=Math.min(e.y,n.y),l=Math.max(e.y,n.y),c=et([{x:r.x,y:o},{x:s.x,y:o}],t).coordinates,a=et([{x:r.x,y:l},{x:s.x,y:l}],t).coordinates,h=[{x:r.x,y:o},{x:r.x,y:l}];return[{key:"area",type:"polygon",attrs:{coordinates:[c[0],c[1],a[1],a[0]]}},{key:"top_line",type:"line",attrs:{coordinates:c}},{key:"bottom_line",type:"line",attrs:{coordinates:a}},{key:"left_line",type:"line",attrs:{coordinates:h}}]}const Gc={name:"horizontalChannel",totalStep:3,needDefaultPointFigure:!0,createPointFigures:({coordinates:i,bounding:t})=>!i||i.length<2?[]:Zc(i,t)};function Kc(i,t){if(i.length<4)return[];const[e,n,r,s]=i,o={x:e.x,y:n.y},l={x:r.x,y:n.y},c={x:r.x,y:s.y},a={x:e.x,y:s.y};return[{key:"area",type:"polygon",attrs:{coordinates:[o,l,c,a]}},{key:"left_line",type:"line",attrs:{coordinates:[o,a]}},{key:"top_line",type:"line",attrs:{coordinates:[o,l]}},{key:"bottom_line",type:"line",attrs:{coordinates:[a,c]}},{key:"right_line",type:"line",attrs:{coordinates:[l,c]}},{key:"label_open",type:"label",attrs:{coordinate:e,text:"开仓"}},{key:"label_tp",type:"label",attrs:{coordinate:r,text:"目标"}},{key:"label_sl",type:"label",attrs:{coordinate:s,text:"止损"}}]}const Qc={name:"bullish",totalStep:2,needDefaultPointFigure:!0,createPointFigures:({coordinates:i,bounding:t})=>{if(!i||i.length<1)return[];if(i.length===1){let e=i[0],n={x:e.x-100,y:e.y},r={x:e.x+100,y:e.y},s={x:e.x,y:e.y+100};i=[e,n,r,s]}return Kc(i)}},zr={},Jc=[Gl,Kl,Ql,Jl,nc,ic,rc,oc,ac,lc,cc,hc,uc,fc,dc,pc,gc,yc,_c,wc,bc,Cc,Ac,Sc,Ec,Mc,Dc,kc,Bc,Tc,Ic,Pc,Vc,Fc,Rc,zc,Nc,Wc,Hc,$c,Yc,Lc,qc,jc,Gc,Qc];Jc.forEach(i=>{zr[i.name]=Ui.extend(i)});function sa(i){zr[i.name]=Ui.extend(i)}function e0(i){return zr[i]??null}const t0={grid:{horizontal:{color:"#EDEDED"},vertical:{color:"#EDEDED"}},candle:{priceMark:{high:{color:"#76808F"},low:{color:"#76808F"}},tooltip:{rect:{color:"#FEFEFE",borderColor:"#F2F3F5"},title:{color:"#76808F"},legend:{color:"#76808F"}}},indicator:{tooltip:{title:{color:"#76808F"},legend:{color:"#76808F"}}},xAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},yAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},separator:{color:"#DDDDDD"},crosshair:{horizontal:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}},vertical:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}}}},n0={grid:{horizontal:{color:"#292929"},vertical:{color:"#292929"}},candle:{priceMark:{high:{color:"#929AA5"},low:{color:"#929AA5"}},tooltip:{rect:{color:"rgba(10, 10, 10, .6)",borderColor:"rgba(10, 10, 10, .6)"},title:{color:"#929AA5"},legend:{color:"#929AA5"}}},indicator:{tooltip:{title:{color:"#929AA5"},legend:{color:"#929AA5"}}},xAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},yAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},separator:{color:"#333333"},crosshair:{horizontal:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}},vertical:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}}}},i0={light:t0,dark:n0};function r0(i){return i0[i]??null}const Qn=30,vr=100,Q={CANDLE:"candle_pane",INDICATOR:"indicator_pane_",X_AXIS:"x_axis_pane"},vt={MIN:1,MAX:50},s0=10,o0=80,a0=.2,_r=10;class l0{constructor(t,e){this._styles=ql(),this._formatter={formatDate:({dateTimeFormat:a,timestamp:h,template:f})=>Go(a,h,f),formatBigNumber:Ko,formatExtendText:a=>""},this._innerFormatter={formatDate:(a,h,f)=>this._formatter.formatDate({dateTimeFormat:this._dateTimeFormat,timestamp:a,template:h,type:f}),formatBigNumber:a=>this._formatter.formatBigNumber(a),formatExtendText:a=>this._formatter.formatExtendText(a)},this._locale="en-US",this._thousandsSeparator={sign:",",format:a=>Qo(a,this._thousandsSeparator.sign)},this._decimalFold={threshold:3,format:a=>Jo(a,this._decimalFold.threshold)},this._symbol=null,this._period=null,this._dataList=[],this._dataLoader=null,this._hasSubscribedBars=!1,this._loading=!1,this._dataLoadMore={forward:!1,backward:!1},this._zoomEnabled=!0,this._scrollEnabled=!0,this._totalBarSpace=0,this._barSpace=s0,this._offsetRightDistance=o0,this._startLastBarRightSideDiffBarCount=0,this._scrollLimitRole="bar_count",this._minVisibleBarCount={left:2,right:2},this._maxOffsetDistance={left:50,right:50},this._visibleRange=ss(),this._visibleRangeDataList=[],this._visibleRangeHighLowPrice=[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}],this._crosshair={},this._actions=new Map,this._indicators=new Map,this._scripts=new Map,this._paneYAxisInited=new Set,this._taskScheduler=new Wl,this._overlays=new Map,this._progressOverlayInfo=null,this._lastPriceMarkExtendTextUpdateTimers=[],this._pressedOverlayInfo={paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null},this._hoverOverlayInfo={paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null},this._clickOverlayInfo={paneId:"",overlay:null,figureType:"none",figureIndex:-1,figure:null},this._chart=t,this._calcOptimalBarSpace(),this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace;const{styles:n,locale:r,timezone:s,formatter:o,thousandsSeparator:l,decimalFold:c}=e??{};H(n)&&this.setStyles(n),se(r)&&this.setLocale(r),this.setTimezone(s??""),H(o)&&this.setFormatter(o),H(l)&&this.setThousandsSeparator(l),H(c)&&this.setDecimalFold(c)}setStyles(t){let e=null;se(t)?e=r0(t):e=t,Se(this._styles,e);const n=this._styles.candle.type;if(n==="footprint"||n==="footprint_period"?(vt.MAX=120,vt.MIN=42,this._barSpace<vt.MIN&&(this._barSpace=vt.MIN)):(vt.MIN=1,vt.MAX=50,this._barSpace>vt.MAX&&(this._barSpace=vt.MAX)),ze(e?.candle?.tooltip?.legend?.template)&&(this._styles.candle.tooltip.legend.template=e.candle.tooltip.legend.template),H(e?.candle?.priceMark?.last?.extendTexts)){this._clearLastPriceMarkExtendTextUpdateTimer();const r=[];this._styles.candle.priceMark.last.extendTexts.forEach(s=>{const o=s.updateInterval;if(s.show&&o>0&&!r.includes(o)){r.push(o);const l=setInterval(()=>{this._chart.updatePane(J.Main,Q.CANDLE)},o);this._lastPriceMarkExtendTextUpdateTimers.push(l)}})}}getStyles(){return this._styles}setFormatter(t){Se(this._formatter,t)}getFormatter(){return this._formatter}getInnerFormatter(){return this._innerFormatter}setLocale(t){this._locale=t}getLocale(){return this._locale}setTimezone(t){if(!H(this._dateTimeFormat)||this.getTimezone()!==t){const e={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};t.length>0&&(e.timeZone=t);let n=null;try{n=new Intl.DateTimeFormat("en",e)}catch{}n!==null&&(this._dateTimeFormat=n)}}getTimezone(){return this._dateTimeFormat.resolvedOptions().timeZone}getDateTimeFormat(){return this._dateTimeFormat}setThousandsSeparator(t){Se(this._thousandsSeparator,t)}getThousandsSeparator(){return this._thousandsSeparator}setDecimalFold(t){Se(this._decimalFold,t)}getDecimalFold(){return this._decimalFold}setSymbol(t){this._processDataUnsubscribe(),this._symbol=t,this._synchronizeIndicatorSeriesPrecision(),this.resetData()}getSymbol(){return this._symbol}setPeriod(t){this._processDataUnsubscribe(),this._period=t,this.resetData()}getPeriod(){return this._period}getDataList(){return this._dataList}getVisibleRangeDataList(){return this._visibleRangeDataList}getVisibleRangeHighLowPrice(){return this._visibleRangeHighLowPrice}_addData(t,e,n){let r=!1,s=!1,o=0;if(ze(t)){const l={backward:!1,forward:!1};switch(Ri(n)?(l.backward=n,l.forward=n):(l.backward=n?.backward??!1,l.forward=n?.forward??!1),o=t.length,e){case"init":{this._clearData(),this._dataList=t,this._dataLoadMore.backward=l.backward,this._dataLoadMore.forward=l.forward,this.setOffsetRightDistance(this._offsetRightDistance),s=!0;break}case"backward":{this._dataList=this._dataList.concat(t),this._dataLoadMore.backward=l.backward,this._lastBarRightSideDiffBarCount-=o,s=o>0;break}case"forward":{this._dataList=t.concat(this._dataList),this._dataLoadMore.forward=l.forward,s=o>0;break}}r=!0}else{const l=this._dataList.length,c=t.timestamp,a=Ue(this._dataList[l-1],"timestamp",0);if(c>a){this._dataList.push(t);let h=this.getLastBarRightSideDiffBarCount();h<0&&this.setLastBarRightSideDiffBarCount(--h),o=1,r=!0,s=!0}else if(c===a)this._dataList[l-1]=t,r=!0,s=!0;else if(c<a){let h=l-1;for(let f=l-2;f>=0;f--){const d=Ue(this._dataList[f],"timestamp",0);if(c>d){h=f+1;break}else if(c===d){this._dataList[f]=t,r=!0,s=!0;return}h=f}this._dataList.splice(h,0,t),o=1,r=!0,s=!0}}r&&s&&(this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this.getIndicatorsByFilter({}).forEach(c=>{this._addIndicatorCalcTask(c,e)}),this._chart.checkScriptStateChanges().catch(c=>{console.error("检查脚本状态变化失败",c)}),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:e!=="init"}))}setDataLoader(t){this._dataLoader=t,this.resetData()}setDataList(t){const e={backward:this._dataLoadMore.backward,forward:this._dataLoadMore.forward};this._addData(t,"init",e),!this._hasSubscribedBars&&H(this._dataLoader)&&H(this._symbol)&&H(this._period)&&(this._dataLoader?.subscribeBar?.({symbol:this._symbol,period:this._period,callback:n=>{this._addData(n,"update")}}),this._hasSubscribedBars=!0)}upsertDataList(t){if(!ze(t)||t.length===0)return;const e=[...t].sort((r,s)=>r.timestamp-s.timestamp);let n=!1;for(const r of e){const s=this._dataList.length,o=r.timestamp,l=Ue(this._dataList[s-1],"timestamp",0);if(s===0||o>l){this._dataList.push(r);let a=this.getLastBarRightSideDiffBarCount();a<0&&this.setLastBarRightSideDiffBarCount(--a),n=!0;continue}if(o===l){this._dataList[s-1]=r,n=!0;continue}let c=s-1;for(let a=s-2;a>=0;a--){const h=Ue(this._dataList[a],"timestamp",0);if(o>h){c=a+1;break}else if(o===h){this._dataList[a]=r,n=!0,c=-1;break}c=a}c>=0&&(this._dataList.splice(c,0,r),n=!0)}n&&(this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this.getIndicatorsByFilter({}).forEach(s=>{this._addIndicatorCalcTask(s,"update")}),this._chart.checkScriptStateChanges().catch(()=>{}),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0}))}appendDataList(t){if(!ze(t)||t.length===0)return;const e={backward:this._dataLoadMore.backward,forward:this._dataLoadMore.forward};this._addData(t,"backward",e)}_calcOptimalBarSpace(){const e=1-a0*Math.atan(Math.max(4,this._barSpace)-4)/(Math.PI*.5);let n=Math.min(Math.floor(this._barSpace*e),Math.floor(this._barSpace));n%2===0&&n+2>=this._barSpace&&--n,this._gapBarSpace=Math.max(1,n)}_adjustVisibleRange(){const t=this._dataList.length,e=this._totalBarSpace/this._barSpace;let n=0,r=0;this._scrollLimitRole==="distance"?(n=(this._totalBarSpace-this._maxOffsetDistance.right)/this._barSpace,r=(this._totalBarSpace-this._maxOffsetDistance.left)/this._barSpace):(n=this._minVisibleBarCount.left,r=this._minVisibleBarCount.right),n=Math.max(0,n),r=Math.max(0,r);const s=e-Math.min(n,t);this._lastBarRightSideDiffBarCount>s&&(this._lastBarRightSideDiffBarCount=s);const o=-t+Math.min(r,t);this._lastBarRightSideDiffBarCount<o&&(this._lastBarRightSideDiffBarCount=o);let l=Math.round(this._lastBarRightSideDiffBarCount+t+.5);const c=l;l>t&&(l=t);let a=Math.round(l-e)-1;a<0&&(a=0);const h=this._lastBarRightSideDiffBarCount>0?Math.round(t+this._lastBarRightSideDiffBarCount-e)-1:a;this._visibleRange={from:a,to:l,realFrom:h,realTo:c},this.executeAction("onVisibleRangeChange",this._visibleRange),this._visibleRangeDataList=[],this._visibleRangeHighLowPrice=[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}];for(let f=h;f<c;f++){const d=this._dataList[f],u=this.dataIndexToCoordinate(f);this._visibleRangeDataList.push({dataIndex:f,x:u,data:{prev:this._dataList[f-1]??d,current:d,next:this._dataList[f+1]??d}}),H(d)&&(this._visibleRangeHighLowPrice[0].price<d.high&&(this._visibleRangeHighLowPrice[0].price=d.high,this._visibleRangeHighLowPrice[0].x=u),this._visibleRangeHighLowPrice[1].price>d.low&&(this._visibleRangeHighLowPrice[1].price=d.low,this._visibleRangeHighLowPrice[1].x=u))}a===0?this._dataLoadMore.forward&&this._processDataLoad("forward"):l===t&&this._dataLoadMore.backward&&this._processDataLoad("backward")}_processDataLoad(t){if(!this._loading&&H(this._dataLoader)&&H(this._symbol)&&H(this._period)){this._loading=!0;const e={type:t,symbol:this._symbol,period:this._period,timestamp:null,callback:(n,r)=>{this._loading=!1,this._addData(n,t,r),t==="init"&&(this._hasSubscribedBars||(this._dataLoader?.subscribeBar?.({symbol:this._symbol,period:this._period,callback:s=>{this._addData(s,"update")}}),this._hasSubscribedBars=!0))}};switch(t){case"backward":{e.timestamp=this._dataList[this._dataList.length-1]?.timestamp??null;break}case"forward":{e.timestamp=this._dataList[0]?.timestamp??null;break}}this._dataLoader.getBars(e)}}_processDataUnsubscribe(){H(this._dataLoader)&&H(this._symbol)&&H(this._period)&&this._dataLoader.unsubscribeBar?.({symbol:this._symbol,period:this._period}),this._hasSubscribedBars=!1}resetData(){this._loading=!1,this._processDataLoad("init")}getBarSpace(){return{bar:this._barSpace,halfBar:this._barSpace/2,gapBar:this._gapBarSpace,halfGapBar:Math.floor(this._gapBarSpace/2)}}setBarSpace(t,e){const n=this._styles.candle.type,r=n==="footprint"||n==="footprint_period"?42:1,s=n==="footprint"||n==="footprint_period"?120:50;t<r||t>s||this._barSpace===t||(this._barSpace=t,this._calcOptimalBarSpace(),e?.(),this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0}))}setTotalBarSpace(t){this._totalBarSpace!==t&&(this._totalBarSpace=t,this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}))}setOffsetRightDistance(t,e){return this._offsetRightDistance=this._scrollLimitRole==="distance"?Math.min(this._maxOffsetDistance.right,t):t,this._lastBarRightSideDiffBarCount=this._offsetRightDistance/this._barSpace,(e??!1)&&(this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0})),this}getInitialOffsetRightDistance(){return this._offsetRightDistance}getOffsetRightDistance(){return Math.max(0,this._lastBarRightSideDiffBarCount*this._barSpace)}getLastBarRightSideDiffBarCount(){return this._lastBarRightSideDiffBarCount}setLastBarRightSideDiffBarCount(t){this._lastBarRightSideDiffBarCount=t}setMaxOffsetLeftDistance(t){this._scrollLimitRole="distance",this._maxOffsetDistance.left=t}setMaxOffsetRightDistance(t){this._scrollLimitRole="distance",this._maxOffsetDistance.right=t}setLeftMinVisibleBarCount(t){this._scrollLimitRole="bar_count",this._minVisibleBarCount.left=t}setRightMinVisibleBarCount(t){this._scrollLimitRole="bar_count",this._minVisibleBarCount.right=t}getVisibleRange(){return this._visibleRange}startScroll(){this._startLastBarRightSideDiffBarCount=this._lastBarRightSideDiffBarCount}scroll(t){if(!this._scrollEnabled)return;const e=t/this._barSpace,n=this._lastBarRightSideDiffBarCount*this._barSpace;this._lastBarRightSideDiffBarCount=this._startLastBarRightSideDiffBarCount-e,this._adjustVisibleRange(),this.setCrosshair(this._crosshair,{notInvalidate:!0}),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!0});const r=Math.round(n-this._lastBarRightSideDiffBarCount*this._barSpace);r!==0&&this.executeAction("onScroll",{distance:r})}getDataByDataIndex(t){return this._dataList[t]??null}coordinateToFloatIndex(t){const e=this._dataList.length,n=(this._totalBarSpace-t)/this._barSpace,r=e+this._lastBarRightSideDiffBarCount-n;return Math.round(r*1e6)/1e6}dataIndexToTimestamp(t){const e=this._dataList.length;if(e===0)return null;const n=this.getDataByDataIndex(t);if(H(n))return n.timestamp;if(H(this._period)){const r=e-1;let s=null,o=0;if(t>r?(s=this._dataList[r].timestamp,o=t-r):t<0&&(s=this._dataList[0].timestamp,o=t),L(s)){const{type:l,span:c}=this._period;switch(l){case"second":return s+c*1e3*o;case"minute":return s+c*60*1e3*o;case"hour":return s+c*60*60*1e3*o;case"day":return s+c*24*60*60*1e3*o;case"week":return s+c*7*24*60*60*1e3*o;case"month":{const a=new Date(s),h=a.getDate();a.setDate(1),a.setMonth(a.getMonth()+c*o);const f=new Date(a.getFullYear(),a.getMonth()+1,0).getDate();return a.setDate(Math.min(h,f)),a.getTime()}case"year":{const a=new Date(s);return a.setFullYear(a.getFullYear()+c*o),a.getTime()}}}}return null}timestampToDataIndex(t){const e=this._dataList.length;if(e===0)return 0;if(H(this._period)){let n=null,r=0;const s=e-1,o=this._dataList[s].timestamp;t>o&&(n=o,r=s);const l=this._dataList[0].timestamp;if(t<l&&(n=l,r=0),L(n)){const{type:c,span:a}=this._period;switch(c){case"second":return r+Math.floor((t-n)/(a*1e3));case"minute":return r+Math.floor((t-n)/(a*60*1e3));case"hour":return r+Math.floor((t-n)/(a*60*60*1e3));case"day":return r+Math.floor((t-n)/(a*24*60*60*1e3));case"week":return r+Math.floor((t-n)/(a*7*24*60*60*1e3));case"month":{const h=new Date(n),f=new Date(t),d=h.getFullYear(),u=f.getFullYear(),p=h.getMonth(),x=f.getMonth();return r+Math.floor(((u-d)*12+(x-p))/a)}case"year":{const h=new Date(n).getFullYear(),f=new Date(t).getFullYear();return r+Math.floor((f-h)/a)}}}}return yr(this._dataList,"timestamp",t)}dataIndexToCoordinate(t){const n=this._dataList.length+this._lastBarRightSideDiffBarCount-t;return Math.floor(this._totalBarSpace-(n-.5)*this._barSpace+.5)}coordinateToDataIndex(t){return Math.ceil(this.coordinateToFloatIndex(t))-1}zoom(t,e){if(!this._zoomEnabled)return;let n=e??null;L(n?.x)||(n={x:this._crosshair.x??this._totalBarSpace/2});const r=n.x,s=this.coordinateToFloatIndex(r),o=this._barSpace,l=this._barSpace+t*(this._barSpace/_r);this.setBarSpace(l,()=>{this._lastBarRightSideDiffBarCount+=s-this.coordinateToFloatIndex(r)});const c=this._barSpace/o;c!==1&&this.executeAction("onZoom",{scale:c})}setZoomEnabled(t){this._zoomEnabled=t}isZoomEnabled(){return this._zoomEnabled}setScrollEnabled(t){this._scrollEnabled=t}isScrollEnabled(){return this._scrollEnabled}setCrosshair(t,e){const{notInvalidate:n,notExecuteAction:r,forceInvalidate:s}=e??{},o=t??{};let l=0,c=0;L(o.x)?(l=this.coordinateToDataIndex(o.x),l<0?c=0:l>this._dataList.length-1?c=this._dataList.length-1:c=l):(l=this._dataList.length-1,c=l);const a=this._dataList[c];let h;if(L(o.x)){const d=this._dataList.length-1;l<0||l>d?h=o.x:h=this.dataIndexToCoordinate(l)}else h=this.dataIndexToCoordinate(l);const f={x:this._crosshair.x,y:this._crosshair.y,paneId:this._crosshair.paneId};this._crosshair={...o,realX:h,kLineData:a,realDataIndex:l,dataIndex:c,timestamp:this.dataIndexToTimestamp(l)??void 0},(f.x!==o.x||f.y!==o.y||f.paneId!==o.paneId||(s??!1))&&(H(a)&&!(r??!1)&&this._chart.crosshairChange(this._crosshair),(n??!1)||this._chart.updatePane(J.Overlay))}getCrosshair(){return this._crosshair}executeAction(t,e){this._actions.get(t)?.execute(e)}subscribeAction(t,e){this._actions.has(t)||this._actions.set(t,new Ol),this._actions.get(t)?.subscribe(e)}unsubscribeAction(t,e){const n=this._actions.get(t);H(n)&&(n.unsubscribe(e),n.isEmpty()&&this._actions.delete(t))}hasAction(t){const e=this._actions.get(t);return H(e)&&!e.isEmpty()}_sortIndicators(t){se(t)?this._indicators.get(t)?.sort((e,n)=>e.zLevel-n.zLevel):this._indicators.forEach(e=>{e.sort((n,r)=>n.zLevel-r.zLevel)})}_addIndicatorCalcTask(t,e){this._taskScheduler.addTask({id:os(t.id),handler:()=>{t.onDataStateChange?.({state:"loading",type:e,indicator:t}),t.calcImp(this._dataList).then(n=>{if(n){const r=t.paneId,s=e==="init"||!this._paneYAxisInited.has(r);if(s&&this._chart.updatePane(J.Main,r),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0,cacheYAxisWidth:!s}),s){this._paneYAxisInited.add(r);try{this._chart.setPaneOptions({id:r})}catch{}}t.onDataStateChange?.({state:"ready",type:e,indicator:t})}}).catch(()=>{t.onDataStateChange?.({state:"error",type:e,indicator:t})})}})}addIndicator(t,e,n){const{name:r}=t;if(this.getIndicatorsByFilter(t).length>0)return!1;let o=this.getIndicatorsByPaneId(e);const l=ea(r),c=new l;return this._synchronizeIndicatorSeriesPrecision(c),c.paneId=e,c.override(t),n||(this.removeIndicator({paneId:e}),o=[]),o.push(c),this._indicators.set(e,o),this._sortIndicators(e),this._addIndicatorCalcTask(c,"init"),!0}getIndicatorsByPaneId(t){return this._indicators.get(t)??[]}getIndicatorsByFilter(t){const{paneId:e,name:n,id:r}=t,s=l=>H(r)?l.id===r:!H(n)||l.name===n;let o=[];return H(e)?o=o.concat(this.getIndicatorsByPaneId(e).filter(s)):this._indicators.forEach(l=>{o=o.concat(l.filter(s))}),o}removeIndicator(t){let e=!1;return this.getIndicatorsByFilter(t??{}).forEach(r=>{const s=this.getIndicatorsByPaneId(r.paneId),o=s.findIndex(l=>l.id===r.id);o>-1&&(this._taskScheduler.removeTask(os(r.id)),s.splice(o,1),e=!0),s.length===0&&this._indicators.delete(r.paneId)}),e}hasIndicators(t){return this._indicators.has(t)}addScript(t,e,n){const r=this._scripts.get(e)??[];return n?r.push(t):r.unshift(t),this._scripts.set(e,r),t.key}_sortScripts(t){}getScriptsByPaneId(t){return this._scripts.get(t)??[]}getScriptsByFilter(t){const{paneId:e,name:n,key:r}=t,s=l=>H(r)?l.key===r:!H(n)||l.name===n;let o=[];if(H(e)){const l=this.getScriptsByPaneId(e);o=o.concat(l.filter(s))}else this._scripts.forEach(l=>{o=o.concat(l.filter(s))});return o}removeScript(t){let e=!1;return this.getScriptsByFilter(t??{}).forEach(r=>{const s=this.getScriptsByPaneId(r.paneId),o=s.findIndex(l=>l.key===r.key);o>-1&&(s.splice(o,1),e=!0),s.length===0&&this._scripts.delete(r.paneId)}),e}hasScripts(t){return this._scripts.has(t)}overrideScript(t){let e=!1;return this.getScriptsByFilter(t).forEach(r=>{r.shouldUpdateImp&&r.shouldUpdateImp()&&(e=!0)}),e?(this._chart.layout({update:!0}),!0):!1}_synchronizeIndicatorSeriesPrecision(t){if(H(this._symbol)){const{pricePrecision:e=2,volumePrecision:n=0}=this._symbol,r=s=>{switch(s.series){case"price":{s.setSeriesPrecision(e);break}case"volume":{s.setSeriesPrecision(n);break}}};H(t)?r(t):this._indicators.forEach(s=>{s.forEach(o=>{r(o)})})}}overrideIndicator(t){let e=!1,n=!1;return this.getIndicatorsByFilter(t).forEach(s=>{s.override(t);const{calc:o,draw:l,sort:c}=s.shouldUpdateImp();c&&(n=!0),o?this._addIndicatorCalcTask(s,"update"):l&&(e=!0)}),n&&this._sortIndicators(),e?(this._chart.layout({update:!0}),!0):!1}getOverlaysByFilter(t){const{id:e,groupId:n,group:r,paneId:s,name:o}=t,l=h=>H(e)?h.id===e:H(n)?h.groupId===n&&(!H(o)||h.name===o):H(r)?h.group===r&&(!H(o)||h.name===o):!H(o)||h.name===o;let c=[];H(s)?c=c.concat(this.getOverlaysByPaneId(s).filter(l)):this._overlays.forEach(h=>{c=c.concat(h.filter(l))});const a=this._progressOverlayInfo?.overlay;return H(a)&&l(a)&&c.push(a),c}getOverlaysByPaneId(t){if(!se(t)){let e=[];return this._overlays.forEach(n=>{e=e.concat(n)}),e}return this._overlays.get(t)??[]}_sortOverlays(t){se(t)?this._overlays.get(t)?.sort((e,n)=>e.zLevel-n.zLevel):this._overlays.forEach(e=>{e.sort((n,r)=>n.zLevel-r.zLevel)})}addOverlays(t,e){const n=[],r=t.map((s,o)=>{if(H(s.id)){let c=null;for(const a of this._overlays){const f=a[1].find(d=>d.id===s.id);if(H(f)){c=f;break}}if(H(c))return s.id}const l=e0(s.name);if(H(l)){const c=s.id??Qt(Zl),a=new l,h=s.paneId??Q.CANDLE;s.id=c,s.groupId??=c;const f=this.getOverlaysByPaneId(h).length;return s.zLevel??=f,a.override(s),n.includes(h)||n.push(h),a.isDrawing()?this._progressOverlayInfo={paneId:h,overlay:a,appointPaneFlag:e[o]}:(this._overlays.has(h)||this._overlays.set(h,[]),this._overlays.get(h)?.push(a)),a.isStart()&&a.onDrawStart?.({overlay:a,chart:this._chart}),c}return null});return n.length>0&&(this._sortOverlays(),n.forEach(s=>{this._chart.updatePane(J.Overlay,s)}),this._chart.updatePane(J.Overlay,Q.X_AXIS)),r}getProgressOverlayInfo(){return this._progressOverlayInfo}progressOverlayComplete(){if(this._progressOverlayInfo!==null){const{overlay:t,paneId:e}=this._progressOverlayInfo;t.isDrawing()||(this._overlays.has(e)||this._overlays.set(e,[]),this._overlays.get(e)?.push(t),this._sortOverlays(e),this._progressOverlayInfo=null)}}updateProgressOverlayInfo(t,e){this._progressOverlayInfo!==null&&(Ri(e)&&e&&(this._progressOverlayInfo.appointPaneFlag=e),this._progressOverlayInfo.paneId=t,this._progressOverlayInfo.overlay.override({paneId:t}))}overrideOverlay(t){let e=!1;const n=[];return this.getOverlaysByFilter(t).forEach(s=>{s.override(t);const{sort:o,draw:l}=s.shouldUpdate();o&&(e=!0),(o||l)&&(n.includes(s.paneId)||n.push(s.paneId))}),e&&this._sortOverlays(),n.length>0?(n.forEach(s=>{this._chart.updatePane(J.Overlay,s)}),this._chart.updatePane(J.Overlay,Q.X_AXIS),!0):!1}removeOverlay(t){const e=[];return this.getOverlaysByFilter(t??{}).forEach(r=>{const s=r.paneId,o=this.getOverlaysByPaneId(r.paneId);if(r.onRemoved?.({overlay:r,chart:this._chart}),e.includes(s)||e.push(s),r.isDrawing())this._progressOverlayInfo=null;else{const l=o.findIndex(c=>c.id===r.id);l>-1&&o.splice(l,1)}o.length===0&&this._overlays.delete(s)}),e.length>0?(e.forEach(r=>{this._chart.updatePane(J.Overlay,r)}),this._chart.updatePane(J.Overlay,Q.X_AXIS),!0):!1}removeOverlays(t){if(!t||t.length===0)return!1;const e=[];return t.forEach(n=>{this.getOverlaysByFilter({id:n}).forEach(s=>{const o=s.paneId,l=this.getOverlaysByPaneId(s.paneId);if(s.onRemoved?.({overlay:s,chart:this._chart}),e.includes(o)||e.push(o),s.isDrawing())this._progressOverlayInfo=null;else{const c=l.findIndex(a=>a.id===s.id);c>-1&&l.splice(c,1)}l.length===0&&this._overlays.delete(o)})}),e.length>0?(e.forEach(n=>{this._chart.updatePane(J.Overlay,n)}),this._chart.updatePane(J.Overlay,Q.X_AXIS),!0):!1}setPressedOverlayInfo(t){this._pressedOverlayInfo=t}getPressedOverlayInfo(){return this._pressedOverlayInfo}setHoverOverlayInfo(t,e,n){const{overlay:r,figureType:s,figureIndex:o,figure:l}=this._hoverOverlayInfo,c=t.overlay;if((r?.id!==c?.id||s!==t.figureType||o!==t.figureIndex)&&(this._hoverOverlayInfo=t,r?.id!==c?.id)){let a=!1,h=!1;r!==null&&(r.override({zLevel:r.getPrevZLevel()}),h=!0,n(r,l)&&(a=!0)),c!==null&&(c.setPrevZLevel(c.zLevel),c.override({zLevel:Number.MAX_SAFE_INTEGER}),h=!0,e(c,t.figure)&&(a=!0)),h&&this._sortOverlays(),a||this._chart.updatePane(J.Overlay)}}getHoverOverlayInfo(){return this._hoverOverlayInfo}setClickOverlayInfo(t,e,n){const{paneId:r,overlay:s,figureType:o,figure:l,figureIndex:c}=this._clickOverlayInfo,a=t.overlay;(s?.id!==a?.id||o!==t.figureType||c!==t.figureIndex)&&(this._clickOverlayInfo=t,s?.id!==a?.id&&(H(s)&&n(s,l),H(a)&&e(a,t.figure),this._chart.updatePane(J.Overlay,t.paneId),r!==t.paneId&&this._chart.updatePane(J.Overlay,r),this._chart.updatePane(J.Overlay,Q.X_AXIS)))}getClickOverlayInfo(){return this._clickOverlayInfo}isOverlayEmpty(){return this._overlays.size===0&&this._progressOverlayInfo===null}isOverlayDrawing(){return this._progressOverlayInfo?.overlay.isDrawing()??!1}_clearLastPriceMarkExtendTextUpdateTimer(){this._lastPriceMarkExtendTextUpdateTimers.forEach(t=>{clearInterval(t)}),this._lastPriceMarkExtendTextUpdateTimers=[]}_clearData(){this._dataLoadMore.backward=!1,this._dataLoadMore.forward=!1,this._loading=!1,this._dataList=[],this._visibleRangeDataList=[],this._visibleRangeHighLowPrice=[{x:0,price:Number.MIN_SAFE_INTEGER},{x:0,price:Number.MAX_SAFE_INTEGER}],this._visibleRange=ss(),this._crosshair={}}getChart(){return this._chart}destroy(){this._clearData(),this._clearLastPriceMarkExtendTextUpdateTimer(),this._taskScheduler.removeTask(),this._overlays.clear(),this._indicators.clear(),this._actions.clear()}setPriceVolumePrecision(t){this._symbol&&(typeof t.pricePrecision=="number"&&(this._symbol.pricePrecision=t.pricePrecision),typeof t.volumePrecision=="number"&&(this._symbol.volumePrecision=t.volumePrecision)),this._synchronizeIndicatorSeriesPrecision(),this._chart.layout({update:!0})}}const Z={MAIN:"main",X_AXIS:"xAxis",Y_AXIS:"yAxis",SEPARATOR:"separator",SCRIPT:"script"},_n=7;async function c0(){return await new Promise(i=>{const t=new ResizeObserver(e=>{i(e.every(n=>"devicePixelContentBoxSize"in n)),t.disconnect()});t.observe(document.body,{box:"device-pixel-content-box"})}).catch(()=>!1)}class us{constructor(t,e){this._supportedDevicePixelContentBox=!1,this._width=0,this._height=0,this._pixelWidth=0,this._pixelHeight=0,this._nextPixelWidth=0,this._nextPixelHeight=0,this._requestAnimationId=Jt,this._mediaQueryListener=()=>{const n=Ct(this._element);this._nextPixelWidth=Math.round(this._element.clientWidth*n),this._nextPixelHeight=Math.round(this._element.clientHeight*n),this._resetPixelRatio()},this._listener=e,this._element=xt("canvas",t),this._ctx=this._element.getContext("2d"),c0().then(n=>{this._supportedDevicePixelContentBox=n,n?(this._resizeObserver=new ResizeObserver(r=>{const o=r.find(l=>l.target===this._element)?.devicePixelContentBoxSize[0];H(o)&&(this._nextPixelWidth=o.inlineSize,this._nextPixelHeight=o.blockSize,(this._pixelWidth!==this._nextPixelWidth||this._pixelHeight!==this._nextPixelHeight)&&this._resetPixelRatio())}),this._resizeObserver.observe(this._element,{box:"device-pixel-content-box"})):(this._mediaQueryList=window.matchMedia(`(resolution: ${Ct(this._element)}dppx)`),this._mediaQueryList.addListener(this._mediaQueryListener))}).catch(n=>!1)}_resetPixelRatio(){this._executeListener(()=>{const t=this._element.clientWidth,e=this._element.clientHeight;this._width=t,this._height=e,this._pixelWidth=this._nextPixelWidth,this._pixelHeight=this._nextPixelHeight,this._element.width=this._nextPixelWidth,this._element.height=this._nextPixelHeight;const n=this._nextPixelWidth/t,r=this._nextPixelHeight/e;this._ctx.scale(n,r)})}_executeListener(t){this._requestAnimationId===Jt&&(this._requestAnimationId=ot(()=>{this._ctx.clearRect(0,0,this._width,this._height),t?.(),this._listener(),this._requestAnimationId=Jt}))}update(t,e){if(this._width!==t||this._height!==e){if(this._element.style.width=`${t}px`,this._element.style.height=`${e}px`,!this._supportedDevicePixelContentBox){const n=Ct(this._element);this._nextPixelWidth=Math.round(t*n),this._nextPixelHeight=Math.round(e*n),this._resetPixelRatio()}}else this._executeListener()}getElement(){return this._element}getContext(){return this._ctx}destroy(){H(this._resizeObserver)&&this._resizeObserver.unobserve(this._element),H(this._mediaQueryList)&&this._mediaQueryList.removeListener(this._mediaQueryListener)}}class oa extends Vr{constructor(t,e){super(),this._bounding=zi(),this._cursor="crosshair",this._forceCursor=null,this._pane=e,this._rootContainer=t,this._container=this.createContainer(),t.appendChild(this._container)}setBounding(t){return Se(this._bounding,t),this}getContainer(){return this._container}getBounding(){return this._bounding}getPane(){return this._pane}checkEventOn(t){return!0}setCursor(t){se(this._forceCursor)||t!==this._cursor&&(this._cursor=t,this._container.style.cursor=this._cursor)}setForceCursor(t){t!==this._forceCursor&&(this._forceCursor=t,this._container.style.cursor=this._forceCursor??this._cursor)}getForceCursor(){return this._forceCursor}update(t){this.updateImp(this._container,this._bounding,t??J.Drawer)}destroy(){this._rootContainer.removeChild(this._container)}}class ji extends oa{constructor(t,e){super(t,e),this._mainCanvas=new us({position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"},()=>{this.updateMain(this._mainCanvas.getContext())}),this._overlayCanvas=new us({position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"},()=>{this.updateOverlay(this._overlayCanvas.getContext())});const n=this.getContainer();n.appendChild(this._mainCanvas.getElement()),n.appendChild(this._overlayCanvas.getElement())}createContainer(){return xt("div",{margin:"0",padding:"0",position:"absolute",top:"0",overflow:"hidden",boxSizing:"border-box",zIndex:"1"})}updateImp(t,e,n){const{width:r,height:s,left:o}=e;t.style.left=`${o}px`;let l=n;const c=t.clientWidth,a=t.clientHeight;switch((r!==c||s!==a)&&(t.style.width=`${r}px`,t.style.height=`${s}px`,l=J.Drawer),l){case J.Main:{this._mainCanvas.update(r,s);break}case J.Overlay:{this._overlayCanvas.update(r,s);break}case J.Drawer:case J.All:{this._mainCanvas.update(r,s),this._overlayCanvas.update(r,s);break}}}destroy(){this._mainCanvas.destroy(),this._overlayCanvas.destroy()}getImage(t){const{width:e,height:n}=this.getBounding(),r=xt("canvas",{width:`${e}px`,height:`${n}px`,boxSizing:"border-box"}),s=r.getContext("2d"),o=Ct(r);return r.width=e*o,r.height=n*o,s.scale(o,o),s.drawImage(this._mainCanvas.getElement(),0,0,e,n),t&&s.drawImage(this._overlayCanvas.getElement(),0,0,e,n),r}}function aa(i,t){let e=[];e=e.concat(t);for(const n of e){const{x:r,y:s,r:o}=n,l=i.x-r,c=i.y-s;if(!(l*l+c*c>o*o))return!0}return!1}function h0(i,t,e){let n=[];n=n.concat(t);const{show:r=!0,style:s="fill",color:o="currentColor",borderSize:l=1,borderColor:c="currentColor",borderStyle:a="solid",borderDashedValue:h=[2,2]}=e;if(!r)return;const f=(s==="fill"||e.style==="stroke_fill")&&(!se(o)||!he(o));if(f&&(i.fillStyle=o,n.forEach(({x:d,y:u,r:p})=>{i.beginPath();let x=p;x>p&&(x=p),i.arc(d,u,x,0,Math.PI*2),i.closePath(),i.fill()})),(s==="stroke"||e.style==="stroke_fill")&&l>0&&!he(c)){switch(i.strokeStyle=c,i.lineWidth=l,a){case"dashed":i.setLineDash(h.map(d=>d*l));break;case"dotted":i.setLineDash([l,l*2]);break;default:i.setLineDash([]);break}n.forEach(({x:d,y:u,r:p})=>{if(!f||p>l){let x=p;x>p&&(x=p),i.beginPath(),i.arc(d,u,x,0,Math.PI*2),i.closePath(),i.stroke()}})}}const u0={name:"circle",checkEventOn:aa,draw:(i,t,e)=>{h0(i,t,e)}};function la(i,t){let e=[];e=e.concat(t);for(const n of e){let r=!1;const{coordinates:s}=n;for(let o=0,l=s.length-1;o<s.length;l=o++)s[o].y>i.y!=s[l].y>i.y&&i.x<(s[l].x-s[o].x)*(i.y-s[o].y)/(s[l].y-s[o].y)+s[o].x&&(r=!r);if(r)return!0}return!1}function f0(i,t,e){let n=[];n=n.concat(t);const{style:r="fill",color:s="currentColor",borderSize:o=1,borderColor:l="currentColor",borderStyle:c="solid",borderDashedValue:a=[2,2],show:h=!0}=e;if(h&&((r==="fill"||e.style==="stroke_fill")&&(!se(s)||!he(s))&&(i.fillStyle=s,n.forEach(({coordinates:f})=>{i.beginPath(),i.moveTo(f[0].x,f[0].y);for(let d=1;d<f.length;d++)i.lineTo(f[d].x,f[d].y);i.closePath(),i.fill()})),(r==="stroke"||e.style==="stroke_fill")&&o>0&&!he(l))){switch(i.strokeStyle=l,i.lineWidth=o,c){case"dashed":i.setLineDash(a.map(f=>f*o));break;case"dotted":i.setLineDash([o,o*2]);break;default:i.setLineDash([]);break}n.forEach(({coordinates:f})=>{i.beginPath(),i.moveTo(f[0].x,f[0].y);for(let d=1;d<f.length;d++)i.lineTo(f[d].x,f[d].y);i.closePath(),i.stroke()})}}const d0={name:"polygon",checkEventOn:la,draw:(i,t,e)=>{f0(i,t,e)}};function Rn(i,t,e={},n){const{color:r="#000000",borderColor:s="#000000",borderSize:o=1,alpha:l=1,show:c=!0,size:a=10,filled:h=!0,style:f=h?"fill":"stroke"}=e;if(!c)return;const{x:d,y:u}=t;i.save(),i.globalAlpha=l,i.setLineDash([]),i.beginPath();const p=a,x=a*.3,g=a*.6;switch(n){case"up":i.moveTo(d,u),i.lineTo(d-p/2,u+p*.6),i.lineTo(d-x/2,u+p*.6),i.lineTo(d-x/2,u+p*.6+g),i.lineTo(d+x/2,u+p*.6+g),i.lineTo(d+x/2,u+p*.6),i.lineTo(d+p/2,u+p*.6);break;case"down":i.moveTo(d,u),i.lineTo(d-p/2,u-p*.6),i.lineTo(d-x/2,u-p*.6),i.lineTo(d-x/2,u-p*.6-g),i.lineTo(d+x/2,u-p*.6-g),i.lineTo(d+x/2,u-p*.6),i.lineTo(d+p/2,u-p*.6);break;case"left":i.moveTo(d,u),i.lineTo(d+p*.6,u-p/2),i.lineTo(d+p*.6,u-x/2),i.lineTo(d+p*.6+g,u-x/2),i.lineTo(d+p*.6+g,u+x/2),i.lineTo(d+p*.6,u+x/2),i.lineTo(d+p*.6,u+p/2);break;case"right":i.moveTo(d,u),i.lineTo(d-p*.6,u-p/2),i.lineTo(d-p*.6,u-x/2),i.lineTo(d-p*.6-g,u-x/2),i.lineTo(d-p*.6-g,u+x/2),i.lineTo(d-p*.6,u+x/2),i.lineTo(d-p*.6,u+p/2);break}i.closePath(),(f==="fill"||f==="stroke_fill")&&!he(r)&&(i.fillStyle=r,i.fill()),(f==="stroke"||f==="stroke_fill")&&o>0&&!he(s)&&(i.strokeStyle=s,i.lineWidth=o,i.stroke()),i.restore()}function fs(i,t,e={}){Rn(i,t,e,"up")}function ds(i,t,e={}){Rn(i,t,e,"down")}function ps(i,t,e={}){Rn(i,t,e,"left")}function xs(i,t,e={}){Rn(i,t,e,"right")}function zn(i,t,e={},n="up"){const{color:r="#000",borderColor:s="#000",borderSize:o=1,alpha:l=1,show:c=!0,filled:a=!0,size:h=10,style:f=a?"fill":"stroke"}=e;if(!c)return;const{x:d,y:u}=t;i.save(),i.globalAlpha=l,i.setLineDash([]),i.beginPath();let p=[];const x=Math.sqrt(3)/2*h;switch(n){case"up":p=[{x:d,y:u-x/2},{x:d-h/2,y:u+x/2},{x:d+h/2,y:u+x/2}];break;case"down":p=[{x:d,y:u+x/2},{x:d-h/2,y:u-x/2},{x:d+h/2,y:u-x/2}];break;case"left":p=[{x:d-x/2,y:u},{x:d+x/2,y:u-h/2},{x:d+x/2,y:u+h/2}];break;case"right":p=[{x:d+x/2,y:u},{x:d-x/2,y:u-h/2},{x:d-x/2,y:u+h/2}];break}i.moveTo(p[0].x,p[0].y),i.lineTo(p[1].x,p[1].y),i.lineTo(p[2].x,p[2].y),i.closePath(),(f==="fill"||f==="stroke_fill")&&!he(r)&&(i.fillStyle=r,i.fill()),(f==="stroke"||f==="stroke_fill")&&o>0&&!he(s)&&(i.strokeStyle=s,i.lineWidth=o,i.stroke()),i.restore()}function p0(i,t,e={}){zn(i,t,e,"up")}function x0(i,t,e={}){zn(i,t,e,"down")}function g0(i,t,e={}){zn(i,t,e,"left")}function m0(i,t,e={}){zn(i,t,e,"right")}function y0(i,t,e={}){const{color:n="#000",borderColor:r="#000",borderSize:s=1,alpha:o=1,show:l=!0,filled:c=!0,size:a=10,style:h=c?"fill":"stroke"}=e;if(!l)return;const{x:f,y:d}=t;i.save(),i.globalAlpha=o,i.setLineDash([]);const u=a/2;i.beginPath(),i.rect(f-u,d-u,a,a),(h==="fill"||h==="stroke_fill")&&!he(n)&&(i.fillStyle=n,i.fill()),(h==="stroke"||h==="stroke_fill")&&s>0&&!he(r)&&(i.strokeStyle=r,i.lineWidth=s,i.stroke()),i.restore()}function v0(i,t,e={}){const{color:n="#000",borderColor:r="#000",borderSize:s=1,alpha:o=1,show:l=!0,filled:c=!0,size:a=10,style:h=c?"fill":"stroke"}=e;if(!l)return;const{x:f,y:d}=t;i.save(),i.globalAlpha=o,i.setLineDash([]);const u=a/2;i.beginPath(),i.moveTo(f,d-u),i.lineTo(f+u,d),i.lineTo(f,d+u),i.lineTo(f-u,d),i.closePath(),(h==="fill"||h==="stroke_fill")&&!he(n)&&(i.fillStyle=n,i.fill()),(h==="stroke"||h==="stroke_fill")&&s>0&&!he(r)&&(i.strokeStyle=r,i.lineWidth=s,i.stroke()),i.restore()}function _0(i,t,e={}){const{color:n="#000",borderColor:r="#000",borderSize:s=1,alpha:o=1,show:l=!0,filled:c=!0,size:a=10,style:h=c?"fill":"stroke"}=e;if(!l)return;const{x:f,y:d}=t;i.save(),i.globalAlpha=o,i.setLineDash([]),i.beginPath(),i.arc(f,d,a/2,0,Math.PI*2),(h==="fill"||h==="stroke_fill")&&!he(n)&&(i.fillStyle=n,i.fill()),(h==="stroke"||h==="stroke_fill")&&s>0&&!he(r)&&(i.strokeStyle=r,i.lineWidth=s,i.stroke()),i.restore()}function w0(i,t,e={}){const{color:n="#000",borderColor:r="#000",borderSize:s=1,alpha:o=1,show:l=!0,filled:c=!0,size:a=10,style:h=c?"fill":"stroke"}=e;if(!l)return;const{x:f,y:d}=t;i.save(),i.globalAlpha=o,i.setLineDash([]),i.beginPath();const u=a/2,p=u*.5;for(let x=0;x<5;x++){const g=Math.PI/5*(2*x-.5),m=f+Math.cos(g)*u,y=d+Math.sin(g)*u;x===0?i.moveTo(m,y):i.lineTo(m,y);const v=g+Math.PI/5;i.lineTo(f+Math.cos(v)*p,d+Math.sin(v)*p)}i.closePath(),(h==="fill"||h==="stroke_fill")&&!he(n)&&(i.fillStyle=n,i.fill()),(h==="stroke"||h==="stroke_fill")&&s>0&&!he(r)&&(i.strokeStyle=r,i.lineWidth=s,i.stroke()),i.restore()}function b0(i,t,e={}){const{color:n="#000",borderColor:r="#000",borderSize:s=1,alpha:o=1,show:l=!0,filled:c=!0,size:a=10,style:h=c?"fill":"stroke"}=e;if(!l)return;const{x:f,y:d}=t;i.save(),i.globalAlpha=o,i.setLineDash([]);const u=a/2,p=a*.2;i.beginPath(),i.rect(f-p/2,d-u,p,a),i.rect(f-u,d-p/2,a,p),(h==="fill"||h==="stroke_fill")&&!he(n)&&(i.fillStyle=n,i.fill()),(h==="stroke"||h==="stroke_fill")&&s>0&&!he(r)&&(i.strokeStyle=r,i.lineWidth=s,i.stroke()),i.restore()}function C0(i,t,e={}){const{color:n="#000",borderColor:r="#000",borderSize:s=1,alpha:o=1,show:l=!0,filled:c=!0,size:a=10,style:h=c?"fill":"stroke"}=e;if(!l)return;const{x:f,y:d}=t;i.save(),i.globalAlpha=o,i.setLineDash([]);const u=a/2,p=a*.2;i.beginPath(),i.save(),i.translate(f,d),i.rotate(Math.PI/4),i.rect(-p/2,-u,p,a),i.restore(),i.save(),i.translate(f,d),i.rotate(-Math.PI/4),i.rect(-p/2,-u,p,a),i.restore(),i.closePath(),(h==="fill"||h==="stroke_fill")&&!he(n)&&(i.fillStyle=n,i.fill()),(h==="stroke"||h==="stroke_fill")&&s>0&&!he(r)&&(i.strokeStyle=r,i.lineWidth=s,i.stroke()),i.restore()}function A0(i,t,e={}){const{color:n="#000",borderColor:r="#000",borderSize:s=1,alpha:o=1,show:l=!0,filled:c=!0,size:a=10,style:h=c?"fill":"stroke"}=e;if(!l)return;const{x:f,y:d}=t;i.save(),i.globalAlpha=o,i.setLineDash([]);const u=a,p=f-a*.2,x=a*.6,g=a*.5,m=d-u/2;i.beginPath(),i.moveTo(p,d-u/2),i.lineTo(p,d+u/2),i.moveTo(p,m),i.lineTo(p+x,m+g/2),i.lineTo(p,m+g),i.closePath(),(h==="fill"||h==="stroke_fill")&&!he(n)&&(i.fillStyle=n,i.fill()),(h==="stroke"||h==="stroke_fill")&&s>0&&!he(r)&&(i.strokeStyle=r,i.lineWidth=s,i.stroke()),i.beginPath(),i.moveTo(p,d-u/2),i.lineTo(p,d+u/2),i.strokeStyle=r,i.lineWidth=Math.max(1,s),i.stroke(),i.restore()}function S0(i,t,e={}){const{color:n="#000",borderColor:r="#000",borderSize:s=1,alpha:o=1,show:l=!0,filled:c=!0,size:a=10,style:h=c?"fill":"stroke"}=e;if(!l)return;const{x:f,y:d}=t;i.save(),i.globalAlpha=o,i.setLineDash([]);const u=a/4;i.beginPath(),i.moveTo(f,d+u),i.bezierCurveTo(f+u*2,d-u,f+u,d-u*2,f,d-u),i.bezierCurveTo(f-u,d-u*2,f-u*2,d-u,f,d+u),i.closePath(),(h==="fill"||h==="stroke_fill")&&!he(n)&&(i.fillStyle=n,i.fill()),(h==="stroke"||h==="stroke_fill")&&s>0&&!he(r)&&(i.strokeStyle=r,i.lineWidth=s,i.stroke()),i.restore()}function E0(i,t,e={}){const{color:n="#000",borderColor:r="#000",borderSize:s=2,alpha:o=1,show:l=!0,filled:c=!0,size:a=10,style:h=c?"fill":"stroke"}=e;if(!l)return;const{x:f,y:d}=t;i.save(),i.globalAlpha=o,i.setLineDash([]),i.beginPath();const u=a*.5,p=a*.5;i.moveTo(f-u*.5,d),i.lineTo(f-u*.1,d+p*.4),i.lineTo(f+u*.5,d-p*.4),(h==="fill"||h==="stroke_fill")&&(i.strokeStyle=n,i.lineWidth=s,i.lineCap="round",i.stroke()),i.restore()}const ca={arrow:Rn,arrowUp:fs,arrowDown:ds,arrowLeft:ps,arrowRight:xs,drawArrowUp:fs,drawArrowDown:ds,drawArrowLeft:ps,drawArrowRight:xs,circle:_0,square:y0,triangle:zn,triangleUp:p0,triangleDown:x0,triangleLeft:g0,triangleRight:m0,diamond:v0,star:w0,cross:b0,x:C0,flag:A0,heart:S0,check:E0};function Nr(i,t){let e=[];e=e.concat(t);for(const n of e){let r=n.x,s=n.width;s<Ae*2&&(r-=Ae,s=Ae*2);let o=n.y,l=n.height;if(l<Ae*2&&(o-=Ae,l=Ae*2),i.x>=r&&i.x<=r+s&&i.y>=o&&i.y<=o+l)return!0}return!1}function ha(i,t,e){let n=[];n=n.concat(t);const{style:r="fill",color:s="transparent",borderSize:o=1,borderColor:l="transparent",borderStyle:c="solid",borderRadius:a=0,borderDashedValue:h=[2,2],show:f=!0}=e;if(!f)return;const d=i.roundRect??i.rect,u=(r==="fill"||e.style==="stroke_fill")&&(!se(s)||!he(s));if(u&&(i.fillStyle=s,n.forEach(({x:p,y:x,width:g,height:m})=>{i.beginPath(),d.call(i,p,x,g,m,a),i.closePath(),i.fill()})),(r==="stroke"||e.style==="stroke_fill")&&o>0&&!he(l)){switch(i.strokeStyle=l,i.fillStyle=l,i.lineWidth=o,c){case"dashed":i.setLineDash(h.map(g=>g*o));break;case"dotted":i.setLineDash([o,o*2]);break;default:i.setLineDash([]);break}const p=o%2===1?.5:0,x=Math.round(p*2);n.forEach(({x:g,y:m,width:y,height:v})=>{y>o*2&&v>o*2?(i.beginPath(),d.call(i,g+p,m+p,y-x,v-x,a),i.closePath(),i.stroke()):u||i.fillRect(g,m,y,v)})}}const M0={name:"rect",checkEventOn:Nr,draw:(i,t,e)=>{ha(i,t,e)}};function ua(i,t){const{size:e=12,paddingLeft:n=0,paddingTop:r=0,paddingRight:s=0,paddingBottom:o=0,weight:l="normal",family:c}=t,{x:a,y:h,text:f,align:d="left",baseline:u="top",width:p,height:x}=i,g=p??n+qe(f,e,l,c)+s,m=x??r+e+o;let y=0;switch(d){case"left":case"start":{y=a;break}case"right":case"end":{y=a-g;break}default:{y=a-g/2;break}}let v=0;switch(u){case"top":case"hanging":{v=h;break}case"bottom":case"ideographic":case"alphabetic":{v=h-m;break}default:{v=h-m/2;break}}return{x:y,y:v,width:g,height:m}}function fa(i,t,e){let n=[];n=n.concat(t);for(const r of n){const{x:s,y:o,width:l,height:c}=ua(r,e);if(i.x>=s&&i.x<=s+l&&i.y>=o&&i.y<=o+c)return!0}return!1}function D0(i,t,e){let n=[];n=n.concat(t);const{show:r=!0,color:s="currentColor",size:o=12,family:l,weight:c,paddingLeft:a=0,paddingTop:h=0,paddingRight:f=0,backgroundColor:d=""}=e;if(!r)return;const u=n.map(p=>ua(p,e));d&&ha(i,u,{...e,color:d}),i.textAlign="left",i.textBaseline="top",i.font=pt(o,c,l),i.fillStyle=s,n.forEach((p,x)=>{const g=u[x];i.fillText(p.text,g.x+a,g.y+h,g.width-a-f)})}const k0={name:"text",checkEventOn:fa,draw:(i,t,e)=>{D0(i,t,e)}};function B0(i,t){const e=i.x-t.x,n=i.y-t.y;return Math.sqrt(e*e+n*n)}function da(i,t){let e=[];e=e.concat(t);for(const n of e)if(Math.abs(B0(i,n)-n.r)<Ae){const{r,startAngle:s,endAngle:o}=n,l=r*Math.cos(s)+n.x,c=r*Math.sin(s)+n.y,a=r*Math.cos(o)+n.x,h=r*Math.sin(o)+n.y;if(i.x<=Math.max(l,a)+Ae&&i.x>=Math.min(l,a)-Ae&&i.y<=Math.max(c,h)+Ae&&i.y>=Math.min(c,h)-Ae)return!0}return!1}function T0(i,t,e){let n=[];n=n.concat(t);const{style:r="solid",size:s=1,color:o="currentColor",dashedValue:l=[2,2],show:c=!0}=e;if(c){switch(i.lineWidth=s,i.strokeStyle=o,r){case"dashed":i.setLineDash(l.map(a=>a*s));break;case"dotted":i.setLineDash([s,s*2]);break;default:i.setLineDash([]);break}n.forEach(({x:a,y:h,r:f,startAngle:d,endAngle:u})=>{i.beginPath(),i.arc(a,h,f,d,u),i.stroke(),i.closePath()})}}const I0={name:"arc",checkEventOn:da,draw:(i,t,e)=>{T0(i,t,e)}};function gs(i,t,e,n,r,s,o){const[l,c,a,h,f,d,u]=n,p=o?t+d:d+r,x=o?e+u:u+s;P0(t,e,l,c,a,h,f,p,x).forEach(m=>{i.bezierCurveTo(m[0],m[1],m[2],m[3],m[4],m[5])})}function P0(i,t,e,n,r,s,o,l,c){const{cx:a,cy:h,startAngle:f,deltaAngle:d}=V0(i,t,e,n,r,s,o,l,c),u=[],p=Math.ceil(Math.abs(d)/(Math.PI/2));for(let x=0;x<p;x++){const g=f+x*d/p,m=f+(x+1)*d/p,y=F0(a,h,e,n,r,g,m);u.push(y)}return u}function V0(i,t,e,n,r,s,o,l,c){const a=r*Math.PI/180,h=(i-l)/2,f=(t-c)/2,d=Math.cos(a)*h+Math.sin(a)*f,u=-Math.sin(a)*h+Math.cos(a)*f,p=d**2/e**2+u**2/n**2;p>1&&(e*=Math.sqrt(p),n*=Math.sqrt(p));const x=s===o?-1:1,g=e**2*n**2-e**2*u**2-n**2*d**2,m=e**2*u**2+n**2*d**2,y=x*Math.sqrt(Math.abs(g/m))*(e*u/n),v=x*Math.sqrt(Math.abs(g/m))*(-n*d/e),_=Math.cos(a)*y-Math.sin(a)*v+(i+l)/2,w=Math.sin(a)*y+Math.cos(a)*v+(t+c)/2,b=Math.atan2((u-v)/n,(d-y)/e);let C=Math.atan2((-u-v)/n,(-d-y)/e)-b;return C<0&&o===1?C+=2*Math.PI:C>0&&o===0&&(C-=2*Math.PI),{cx:_,cy:w,startAngle:b,deltaAngle:C}}function F0(i,t,e,n,r,s,o){const l=Math.sin(o-s)*(Math.sqrt(4+3*Math.tan((o-s)/2)**2)-1)/3,c=Math.cos(r),a=Math.sin(r),h=i+e*Math.cos(s)*c-n*Math.sin(s)*a,f=t+e*Math.cos(s)*a+n*Math.sin(s)*c,d=i+e*Math.cos(o)*c-n*Math.sin(o)*a,u=t+e*Math.cos(o)*a+n*Math.sin(o)*c,p=h+l*(-e*Math.sin(s)*c-n*Math.cos(s)*a),x=f+l*(-e*Math.sin(s)*a+n*Math.cos(s)*c),g=d-l*(-e*Math.sin(o)*c-n*Math.cos(o)*a),m=u-l*(-e*Math.sin(o)*a+n*Math.cos(o)*c);return[p,x,g,m,d,u]}function R0(i,t,e){let n=[];n=n.concat(t);const{lineWidth:r=1,color:s="currentColor",show:o=!0}=e;o&&(i.lineWidth=r,i.strokeStyle=s,i.setLineDash([]),n.forEach(({x:l,y:c,path:a})=>{const h=a.match(/[MLHVCSQTAZ][^MLHVCSQTAZ]*/gi);if(H(h)){const f=l,d=c;i.beginPath(),h.forEach(u=>{let p=0,x=0,g=0,m=0;const y=u[0],v=u.slice(1).trim().split(/[\s,]+/).map(Number);switch(y){case"M":p=v[0]+f,x=v[1]+d,i.moveTo(p,x),g=p,m=x;break;case"m":p+=v[0],x+=v[1],i.moveTo(p,x),g=p,m=x;break;case"L":p=v[0]+f,x=v[1]+d,i.lineTo(p,x);break;case"l":p+=v[0],x+=v[1],i.lineTo(p,x);break;case"H":p=v[0]+f,i.lineTo(p,x);break;case"h":p+=v[0],i.lineTo(p,x);break;case"V":x=v[0]+d,i.lineTo(p,x);break;case"v":x+=v[0],i.lineTo(p,x);break;case"C":i.bezierCurveTo(v[0]+f,v[1]+d,v[2]+f,v[3]+d,v[4]+f,v[5]+d),p=v[4]+f,x=v[5]+d;break;case"c":i.bezierCurveTo(p+v[0],x+v[1],p+v[2],x+v[3],p+v[4],x+v[5]),p+=v[4],x+=v[5];break;case"S":i.bezierCurveTo(p,x,v[0]+f,v[1]+d,v[2]+f,v[3]+d),p=v[2]+f,x=v[3]+d;break;case"s":i.bezierCurveTo(p,x,p+v[0],x+v[1],p+v[2],x+v[3]),p+=v[2],x+=v[3];break;case"Q":i.quadraticCurveTo(v[0]+f,v[1]+d,v[2]+f,v[3]+d),p=v[2]+f,x=v[3]+d;break;case"q":i.quadraticCurveTo(p+v[0],x+v[1],p+v[2],x+v[3]),p+=v[2],x+=v[3];break;case"T":i.quadraticCurveTo(p,x,v[0]+f,v[1]+d),p=v[0]+f,x=v[1]+d;break;case"t":i.quadraticCurveTo(p,x,p+v[0],x+v[1]),p+=v[0],x+=v[1];break;case"A":gs(i,p,x,v,f,d,!1),p=v[5]+f,x=v[6]+d;break;case"a":gs(i,p,x,v,f,d,!0),p+=v[5],x+=v[6];break;case"Z":case"z":i.closePath(),p=g,x=m;break}}),e.style==="fill"?i.fill():i.stroke()}}))}const z0={name:"path",checkEventOn:Nr,draw:(i,t,e)=>{R0(i,t,e)}},pa={},N0=[u0,tc,d0,M0,k0,I0,z0];N0.forEach(i=>{pa[i.name]=Fr.extend(i)});function W0(i){return pa[i]??null}class We extends Vr{constructor(t){super(),this._widget=t}getWidget(){return this._widget}createFigure(t,e){const n=W0(t.name);if(n!==null){const r=new n(t);if(H(e)){for(const s in e)e.hasOwnProperty(s)&&r.registerEvent(s,e[s]);this.addChild(r)}return r}return null}draw(t,...e){this.clear(),this.drawImp(t,e)}checkEventOn(t){return!0}}class xa extends We{drawImp(t){const e=this.getWidget(),n=this.getWidget().getPane(),r=n.getChart(),s=e.getBounding(),o=r.getStyles().grid;if(o.show){t.save(),t.globalCompositeOperation="destination-over";const c=o.horizontal;if(c.show){const u=n.getAxisComponent().getTicks().map(p=>({coordinates:[{x:0,y:p.coord},{x:s.width,y:p.coord}]}));this.createFigure({name:"line",attrs:u,styles:c})?.draw(t)}const h=o.vertical;if(h.show){const u=r.getXAxisPane().getAxisComponent().getTicks().map(p=>({coordinates:[{x:p.coord,y:0},{x:p.coord,y:s.height}]}));this.createFigure({name:"line",attrs:u,styles:h})?.draw(t)}t.restore()}}}class Nn extends We{eachChildren(t){const n=this.getWidget().getPane().getChart().getChartStore(),r=n.getVisibleRangeDataList(),s=n.getBarSpace(),o=r.length;let l=0;for(;l<o;)t(r[l],s,l),++l}}class ga extends Nn{constructor(){super(...arguments),this._boundCandleBarClickEvent=t=>()=>(this.getWidget().getPane().getChart().getChartStore().executeAction("onCandleBarClick",t),!1)}drawImp(t){const e=this.getWidget().getPane(),n=e.getId()===Q.CANDLE,r=e.getChart().getChartStore(),s=this.getCandleBarOptions();if(s!==null){const{type:o,styles:l}=s;let c=0,a=0;if(s.type==="ohlc"){const{gapBar:f}=r.getBarSpace();c=Math.min(Math.max(Math.round(f*.2),1),8),c>2&&c%2===1&&c--,a=Math.floor(c/2)}const h=e.getAxisComponent();this.eachChildren((f,d)=>{const{x:u,data:{current:p,prev:x}}=f;if(H(p)){const{open:g,high:m,low:y,close:v}=p,_=l.compareRule==="current_open"?g:x?.close??v,w=[];v>_?(w[0]=l.upColor,w[1]=l.upBorderColor,w[2]=l.upWickColor):v<_?(w[0]=l.downColor,w[1]=l.downBorderColor,w[2]=l.downWickColor):(w[0]=l.noChangeColor,w[1]=l.noChangeBorderColor,w[2]=l.noChangeWickColor);const b=h.convertToPixel(g),C=h.convertToPixel(v),M=[b,C,h.convertToPixel(m),h.convertToPixel(y)];M.sort((E,I)=>E-I);const T=d.gapBar%2===0?1:0;let S=[];switch(o){case"candle_solid":{S=this._createSolidBar(u,M,d,w,T);break}case"candle_stroke":{S=this._createStrokeBar(u,M,d,w,T);break}case"candle_up_stroke":{v>g?S=this._createStrokeBar(u,M,d,w,T):S=this._createSolidBar(u,M,d,w,T);break}case"candle_down_stroke":{g>v?S=this._createStrokeBar(u,M,d,w,T):S=this._createSolidBar(u,M,d,w,T);break}case"ohlc":{S=[{name:"rect",attrs:[{x:u-a,y:M[0],width:c,height:M[3]-M[0]},{x:u-d.halfGapBar,y:b+c>M[3]?M[3]-c:b,width:d.halfGapBar-a,height:c},{x:u+a,y:C+c>M[3]?M[3]-c:C,width:d.halfGapBar-a,height:c}],styles:{color:w[0]}}];break}}S.forEach(E=>{let I=null;n&&(I={mouseClickEvent:this._boundCandleBarClickEvent(f)}),this.createFigure(E,I??void 0)?.draw(t)})}})}}getCandleBarOptions(){const t=this.getWidget().getPane().getChart().getStyles().candle;return{type:t.type,styles:t.bar}}_createSolidBar(t,e,n,r,s){return[{name:"rect",attrs:{x:t,y:e[0],width:1,height:e[3]-e[0]},styles:{color:r[2]}},{name:"rect",attrs:{x:t-n.halfGapBar,y:e[1],width:n.gapBar+s,height:Math.max(1,e[2]-e[1])},styles:{style:"stroke_fill",color:r[0],borderColor:r[1]}}]}_createStrokeBar(t,e,n,r,s){return[{name:"rect",attrs:[{x:t,y:e[0],width:1,height:e[1]-e[0]},{x:t,y:e[2],width:1,height:e[3]-e[2]}],styles:{color:r[2]}},{name:"rect",attrs:{x:t-n.halfGapBar,y:e[1],width:n.gapBar+s,height:Math.max(1,e[2]-e[1])},styles:{style:"stroke",borderColor:r[1]}}]}}class O0 extends ga{getCandleBarOptions(){const t=this.getWidget().getPane();if(!t.getAxisComponent().isInCandle()){const n=t.getChart().getChartStore(),r=n.getIndicatorsByPaneId(t.getId());for(const s of r)if(s.shouldOhlc&&s.visible){const o=s.styles,l=n.getStyles().indicator,c=Ue(o,"ohlc.compareRule",l.ohlc.compareRule),a=Ue(o,"ohlc.upColor",l.ohlc.upColor),h=Ue(o,"ohlc.downColor",l.ohlc.downColor),f=Ue(o,"ohlc.noChangeColor",l.ohlc.noChangeColor);return{type:"ohlc",styles:{compareRule:c,upColor:a,downColor:h,noChangeColor:f,upBorderColor:a,downBorderColor:h,noChangeBorderColor:f,upWickColor:a,downWickColor:h,noChangeWickColor:f}}}}return null}drawImp(t){super.drawImp(t);const e=this.getWidget(),n=e.getPane(),r=n.getChart(),s=e.getBounding(),o=r.getXAxisPane().getAxisComponent(),l=n.getAxisComponent(),c=r.getChartStore(),a=c.getIndicatorsByPaneId(n.getId()),h=c.getStyles().indicator;t.save(),a.forEach(f=>{if(f.visible){f.zLevel<0?t.globalCompositeOperation="destination-over":t.globalCompositeOperation="source-over";let d=!1;if(f.draw!==null&&(t.save(),d=f.draw({ctx:t,chart:r,indicator:f,bounding:s,xAxis:o,yAxis:l}),t.restore()),!d){const x=f.result,g=[];this.eachChildren((m,y)=>{const{halfGapBar:v}=y,{dataIndex:_,x:w}=m,b=o.convertToPixel(_-1),C=o.convertToPixel(_+1),M=x[_-1]??null,T=x[_]??null,S=x[_+1]??null,E={x:b},I={x:w},k={x:C};f.figures.forEach(({key:P})=>{const B=M?.[P];L(B)&&(E[P]=l.convertToPixel(B));const V=T?.[P];L(V)&&(I[P]=l.convertToPixel(V));const R=S?.[P];L(R)&&(k[P]=l.convertToPixel(R))}),Pr(f,_,h,(P,B,V)=>{if(H(T?.[P.key])){const R=I[P.key];let W=P.attrs?.({data:{prev:M,current:T,next:S},coordinate:{prev:E,current:I,next:k},bounding:s,barSpace:y,xAxis:o,yAxis:l});if(!H(W))switch(P.type){case"circle":{W={x:w,y:R,r:Math.max(1,v)};break}case"rect":case"bar":{const Y=P.baseValue??l.getRange().from,O=l.convertToPixel(Y);let z=Math.abs(O-R);Y!==T?.[P.key]&&(z=Math.max(1,z));let N=0;R>O?N=O:N=R,W={x:w-v,y:N,width:Math.max(1,v*2),height:z};break}case"line":{H(g[V])||(g[V]=[]),L(I[P.key])&&L(k[P.key])&&g[V].push({coordinates:[{x:I.x,y:I[P.key]},{x:k.x,y:k[P.key]}],styles:B});break}}const F=P.type;H(W)&&F!=="line"&&this.createFigure({name:F==="bar"?"rect":F,attrs:W,styles:B})?.draw(t)}})}),g.forEach(m=>{if(m.length>1){const y=[{coordinates:[m[0].coordinates[0],m[0].coordinates[1]],styles:m[0].styles}];for(let v=1;v<m.length;v++){const _=y[y.length-1],w=m[v],b=_.coordinates[_.coordinates.length-1];b.x===w.coordinates[0].x&&b.y===w.coordinates[0].y&&_.styles.style===w.styles.style&&_.styles.color===w.styles.color&&_.styles.size===w.styles.size&&_.styles.smooth===w.styles.smooth&&_.styles.dashedValue?.[0]===w.styles.dashedValue?.[0]&&_.styles.dashedValue?.[1]===w.styles.dashedValue?.[1]?_.coordinates.push(w.coordinates[1]):y.push({coordinates:[w.coordinates[0],w.coordinates[1]],styles:w.styles})}y.forEach(({coordinates:v,styles:_})=>{this.createFigure({name:"line",attrs:{coordinates:v},styles:_})?.draw(t)})}})}const u=f.result,p=c.getBarSpace();f.figures.forEach((x,g)=>{if(x.type==="polygon"&&typeof x.attrs=="function"){const m=u?.length??0,y=m>0?u[0]:null,v=m>0?u[m-1]:null,_=m>0?{x:o.convertToPixel(0)}:{x:0},w=m>0?{x:o.convertToPixel(m-1)}:{x:0},b=x.attrs({data:{prev:null,current:y,next:v},coordinate:{prev:null,current:_,next:w},bounding:s,barSpace:p,xAxis:o,yAxis:l});b&&b.coordinates&&Array.isArray(b.coordinates)&&b.coordinates.length>0&&this.createFigure({name:"polygon",attrs:b,styles:typeof x.styles=="function"?x.styles({data:{prev:null,current:y,next:v},indicator:f,defaultStyles:h}):x.styles})?.draw(t)}})}}),t.restore()}}class ma extends We{drawImp(t){const e=this.getWidget(),n=e.getPane(),r=e.getBounding(),s=e.getPane().getChart().getChartStore(),o=s.getCrosshair(),l=s.getStyles().crosshair;if(se(o.paneId)&&l.show){if(o.paneId===n.getId()){const a=o.y;this._drawLine(t,[{x:0,y:a},{x:r.width,y:a}],l.horizontal)}const c=o.realX;this._drawLine(t,[{x:c,y:0},{x:c,y:r.height}],l.vertical)}}_drawLine(t,e,n){if(n.show){const r=n.line;r.show&&this.createFigure({name:"line",attrs:{coordinates:e},styles:r})?.draw(t)}}}class ya extends We{constructor(t){super(t),this._activeFeatureInfo=null,this._featureClickEvent=(e,n)=>()=>{const r=this.getWidget().getPane();return n.script?r.getChart().getChartStore().executeAction("onScriptTooltipFeatureClick",n):r.getChart().getChartStore().executeAction(e,n),!0},this._featureMouseMoveEvent=e=>()=>(this._activeFeatureInfo=e,!0),this.registerEvent("mouseMoveEvent",e=>(this._activeFeatureInfo=null,!1))}drawImp(t){const e=this.getWidget(),r=e.getPane().getChart().getChartStore(),s=r.getCrosshair();if(H(s.kLineData)){const o=e.getBounding(),{offsetLeft:l,offsetTop:c,offsetRight:a}=r.getStyles().indicator.tooltip;this.drawIndicatorTooltip(t,l,c,o.width-a)}}drawIndicatorTooltip(t,e,n,r){const s=this.getWidget().getPane(),o=s.getChart().getChartStore(),c=o.getStyles().indicator.tooltip;if(this.isDrawTooltip(o.getCrosshair(),c)){const a=o.getIndicatorsByPaneId(s.getId()),h=c.title,f=c.legend;a.forEach(g=>{let m=0;const y={x:e,y:n},{name:v,inputsText:_,legends:w,features:b}=this.getIndicatorTooltipData(g),C=v.length>0,M=w.length>0;if(C||M){const T=this.classifyTooltipFeatures(b);if(m=this.drawStandardTooltipFeatures(t,T[0],y,g,e,m,r),C){let S=v;_.length>0&&(S=`${S}${_}`);const E=h.color;m=this.drawStandardTooltipLegends(t,[{title:{text:"",color:E},value:{text:S,color:E}}],y,e,m,r,h)}m=this.drawStandardTooltipFeatures(t,T[1],y,g,e,m,r),M&&(m=this.drawStandardTooltipLegends(t,w,y,e,m,r,f)),m=this.drawStandardTooltipFeatures(t,T[2],y,g,e,m,r),n=y.y+m}});const u=s.getChart().getScripts?.()||[],p=s.getId();u.filter(g=>p==="candle_pane"?g.position==="main":g.position==="vice").forEach(g=>{if(g.createTooltipDataSource){let m=0;const y={x:e,y:n},{features:v,legends:_}=g.createTooltipDataSource({script:g});let w=_||[];if(g.tooltipTools&&Array.isArray(g.tooltipTools)&&g.tooltipTools.length>0){const T=s.getChart().getChartStore().getCrosshair().dataIndex,S=g.tooltipTools.map(E=>{let I="N/A",k=!1;if(Array.isArray(E.dataSource)&&E.dataSource.length>0){const R=E.dataSource[T??0]||E.dataSource[E.dataSource.length-1];R!=null&&!isNaN(R)&&(I=String(R),k=!0)}else if(!Array.isArray(E.dataSource)){const R=E.dataSource;if(R!=null)if(typeof R=="string"){const W=parseFloat(R);!isNaN(W)&&isFinite(W)?(I=String(W),k=!0):(I=R,k=!0)}else typeof R=="number"&&!isNaN(R)&&isFinite(R)&&(I=String(R),k=!0)}const P=E.style?.color||E.valueColor||"#333",B=E.precision;let V=I;return k&&B!==null&&B!==void 0?V=Number(I).toFixed(B):k&&(V=String(I)),{title:{text:E.label+":",color:P},value:{text:V,color:P}}});w=[...w,...S]}const b=this.classifyTooltipFeatures(v||[]);if(v&&v.length>0){if(m=this.drawStandardTooltipFeatures(t,b[0],y,null,e,m,r,g),g.name){const C=h.color;m=this.drawStandardTooltipLegends(t,[{title:{text:"",color:C},value:{text:g.name,color:C}}],y,e,m,r,h)}m=this.drawStandardTooltipFeatures(t,b[1],y,null,e,m,r,g),w&&w.length>0&&(m=this.drawStandardTooltipLegends(t,w,y,e,m,r,f)),m=this.drawStandardTooltipFeatures(t,b[2],y,null,e,m,r,g),n=y.y+m}}})}return n}drawStandardTooltipFeatures(t,e,n,r,s,o,l,c){if(e.length>0){let a=0,h=0;e.forEach(u=>{const{marginLeft:p=0,marginTop:x=0,marginRight:g=0,marginBottom:m=0,paddingLeft:y=0,paddingTop:v=0,paddingRight:_=0,paddingBottom:w=0,size:b=0,type:C,content:M}=u;let T=0;if(C==="icon_font"){const S=M;t.font=pt(b,"normal",S.family),T=t.measureText(S.code).width}else T=b;a+=p+y+T+_+g,h=Math.max(h,x+v+b+w+m)}),n.x+a>l?(n.x=s,n.y+=o,o=h):o=Math.max(o,h);const d=this.getWidget().getPane().getId();e.forEach(u=>{const{marginLeft:p=0,marginTop:x=0,marginRight:g=0,paddingLeft:m=0,paddingTop:y=0,paddingRight:v=0,paddingBottom:_=0,backgroundColor:w,activeBackgroundColor:b,borderRadius:C,size:M=0,color:T,activeColor:S,type:E,content:I}=u;let k=T,P=w;this._activeFeatureInfo?.paneId===d&&this._activeFeatureInfo.indicator?.id===r?.id&&this._activeFeatureInfo.feature.id===u.id&&(k=S??T,P=b??w);let B="onCandleTooltipFeatureClick";const V={paneId:d,feature:u};H(r)?(B="onIndicatorTooltipFeatureClick",V.indicator=r):c&&(B="onScriptTooltipFeatureClick",V.script=c);const R={mouseClickEvent:this._featureClickEvent(B,V),mouseMoveEvent:this._featureMouseMoveEvent(V)};let W=0;if(E==="icon_font"){const F=I;this.createFigure({name:"text",attrs:{text:F.code,x:n.x+p,y:n.y+x},styles:{paddingLeft:m,paddingTop:y,paddingRight:v,paddingBottom:_,borderRadius:C,size:M,family:F.family,color:k,backgroundColor:P}},R)?.draw(t),W=t.measureText(F.code).width}else{this.createFigure({name:"rect",attrs:{x:n.x+p,y:n.y+x,width:M,height:M},styles:{paddingLeft:m,paddingTop:y,paddingRight:v,paddingBottom:_,color:P}},R)?.draw(t);const F=I;this.createFigure({name:"path",attrs:{path:F.path,x:n.x+p+m,y:n.y+x+y,width:M,height:M},styles:{style:F.style,lineWidth:F.lineWidth,color:k}})?.draw(t),W=M}n.x+=p+m+W+v+g})}return o}drawStandardTooltipLegends(t,e,n,r,s,o,l){if(e.length>0){const{marginLeft:c,marginTop:a,marginRight:h,marginBottom:f,size:d,family:u,weight:p}=l;t.font=pt(d,p,u),e.forEach(x=>{const g=x.title,m=x.value,y=t.measureText(g.text).width,v=t.measureText(m.text).width,_=y+v,w=a+d+f;n.x+c+_+h>o?(n.x=r,n.y+=s,s=w):s=Math.max(s,w),g.text.length>0&&this.createFigure({name:"text",attrs:{x:n.x+c,y:n.y+a,text:g.text},styles:{color:g.color,size:d,family:u,weight:p}})?.draw(t),this.createFigure({name:"text",attrs:{x:n.x+c+y,y:n.y+a,text:m.text},styles:{color:m.color,size:d,family:u,weight:p}})?.draw(t),n.x+=c+_+h})}return s}isDrawTooltip(t,e){const n=e.showRule;return n==="always"||n==="follow_cross"&&se(t.paneId)}getIndicatorTooltipData(t){const e=this.getWidget().getPane().getChart().getChartStore(),n=e.getStyles().indicator,r=n.tooltip,s=r.title;let o="",l="";s.show&&s.showName&&(o=t.shortName);const c={name:o,inputsText:l,legends:[],features:r.features},a=e.getCrosshair().dataIndex,h=t.result,f=e.getInnerFormatter(),d=e.getDecimalFold(),u=e.getThousandsSeparator(),p=[],g=this.getWidget().getBounding();if(t.visible&&g.width>768){const m=h[a]??h[a-1]??{},y=r.legend.defaultValue;Pr(t,a,n,(v,_)=>{if(se(v.title)&&v.title.trim()!==""){const w=_.color;let b=m[v.key];L(b)&&(b=ke(b,t.precision),t.shouldFormatBigNumber&&(b=f.formatBigNumber(b)),b=d.format(u.format(b))),p.push({title:{text:v.title,color:w},value:{text:b??y,color:w}})}}),c.legends=p}if(Ve(t.createTooltipDataSource)){const m=this.getWidget(),y=m.getPane(),v=y.getChart(),{name:_,inputsText:w,legends:b,features:C}=t.createTooltipDataSource({chart:v,indicator:t,crosshair:e.getCrosshair(),bounding:m.getBounding(),xAxis:y.getChart().getXAxisPane().getAxisComponent(),yAxis:y.getAxisComponent()});if(s.show&&(se(_)&&s.showName&&(c.name=_),se(w)&&s.showParams&&(c.inputsText=w)),H(C)&&(c.features=C),H(b)&&t.visible){const M=[],T=n.tooltip.legend.color;b.forEach(S=>{let E={text:"",color:T};tt(S.title)?E=S.title:E.text=S.title;let I={text:"",color:T};tt(S.value)?I=S.value:I.text=S.value,L(Number(I.text))&&(I.text=d.format(u.format(I.text))),M.push({title:E,value:I})}),c.legends=M}}return c}classifyTooltipFeatures(t){const e=[],n=[],r=[];return t.forEach(s=>{switch(s.position){case"left":{e.push(s);break}case"middle":{n.push(s);break}case"right":{r.push(s);break}}}),[e,n,r]}}class Wr extends We{constructor(t){super(t),this._initEvent()}_isMouseInButtonArea(t){const e=this.getWidget(),n=e.getBounding(),r=t.x-(n?.left??0),s=t.y-(n?.top??0),c=e.getPane().getMainWidget()._children||[];for(const a of c)if(a.constructor.name==="CandleTooltipView"){const h=a.getButtonAreas();for(const f of h)if(r>=f.left&&r<=f.right&&s>=f.top&&s<=f.bottom)return!0}return!1}_initEvent(){const t=this.getWidget(),e=t.getPane(),n=e.getId(),r=e.getChart(),s=r.getChartStore();this.registerEvent("mouseMoveEvent",o=>{const l=s.getProgressOverlayInfo();if(l!==null){const c=l.overlay;let a=l.paneId;c.isStart()&&(s.updateProgressOverlayInfo(n),a=n);const h=c.points.length-1;return c.isDrawing()&&a===n&&(c.eventMoveForDrawing(this._coordinateToPoint(c,o)),c.onDrawing?.({chart:r,overlay:c,...o})),this._figureMouseMoveEvent(c,"point",h,{key:`${jt}point_${h}`,type:"circle",attrs:{}})(o)}return s.setHoverOverlayInfo({paneId:n,overlay:null,figureType:"none",figureIndex:-1,figure:null},(c,a)=>this._processOverlayMouseEnterEvent(c,a,o),(c,a)=>this._processOverlayMouseLeaveEvent(c,a,o)),t.setForceCursor(null),!1}).registerEvent("mouseClickEvent",o=>{const l=this.getWidget();if(l.getName()===Z.SCRIPT){const a=l;if(a._isMouseInScriptButtons&&a._isMouseInScriptButtons(o))return!1}const c=s.getProgressOverlayInfo();if(c!==null){const a=c.overlay;let h=c.paneId;a.isStart()&&(s.updateProgressOverlayInfo(n,!0),h=n);const f=a.points.length-1;return a.isDrawing()&&h===n&&(a.eventMoveForDrawing(this._coordinateToPoint(a,o)),a.onDrawing?.({chart:r,overlay:a,...o}),a.nextStep(),a.isDrawing()||(s.progressOverlayComplete(),a.onDrawEnd?.({chart:r,overlay:a,...o}))),this._figureMouseClickEvent(a,"point",f,{key:`${jt}point_${f}`,type:"circle",attrs:{}})(o)}return s.setClickOverlayInfo({paneId:n,overlay:null,figureType:"none",figureIndex:-1,figure:null},(a,h)=>this._processOverlaySelectedEvent(a,h,o),(a,h)=>this._processOverlayDeselectedEvent(a,h,o)),!1}).registerEvent("mouseDoubleClickEvent",o=>{const l=s.getProgressOverlayInfo();if(l!==null){const c=l.overlay,a=l.paneId;c.isDrawing()&&a===n&&(c.forceComplete(),c.isDrawing()||(s.progressOverlayComplete(),c.onDrawEnd?.({chart:r,overlay:c,...o})));const h=c.points.length-1;return this._figureMouseClickEvent(c,"point",h,{key:`${jt}point_${h}`,type:"circle",attrs:{}})(o)}return!1}).registerEvent("mouseRightClickEvent",o=>{const l=s.getProgressOverlayInfo();if(l!==null){const c=l.overlay;if(c.isDrawing()){const a=c.points.length-1;return this._figureMouseRightClickEvent(c,"point",a,{key:`${jt}point_${a}`,type:"circle",attrs:{}})(o)}}return!1}).registerEvent("mouseUpEvent",o=>{const{overlay:l,figure:c}=s.getPressedOverlayInfo();return l!==null&&Je("onPressedMoveEnd",c)&&typeof l.getHasMoved=="function"&&l.getHasMoved()===!0&&l.onPressedMoveEnd?.({chart:r,overlay:l,figure:c??void 0,...o}),s.setPressedOverlayInfo({paneId:n,overlay:null,figureType:"none",figureIndex:-1,figure:null}),!1}).registerEvent("pressedMouseMoveEvent",o=>{const{overlay:l,figureType:c,figureIndex:a,figure:h}=s.getPressedOverlayInfo();if(l!==null&&(l.setHasMoved&&l.setHasMoved(!0),Je("onPressedMoving",h))){if(!l.lock){const f=this._coordinateToPoint(l,o);c==="point"?l.eventPressedPointMove(f,a):l.eventPressedOtherMove(f,this.getWidget().getPane().getChart().getChartStore());let d=!1;l.onPressedMoving?.({chart:r,overlay:l,figure:h??void 0,...o,preventDefault:()=>{d=!0}}),d?this.getWidget().setForceCursor(null):this.getWidget().setForceCursor("pointer")}return!0}return this.getWidget().setForceCursor(null),!1})}_createFigureEvents(t,e,n,r){return t.isDrawing()?null:{mouseMoveEvent:this._figureMouseMoveEvent(t,e,n,r),mouseDownEvent:this._figureMouseDownEvent(t,e,n,r),mouseClickEvent:this._figureMouseClickEvent(t,e,n,r),mouseRightClickEvent:this._figureMouseRightClickEvent(t,e,n,r),mouseDoubleClickEvent:this._figureMouseDoubleClickEvent(t,e,n,r)}}_processOverlayMouseEnterEvent(t,e,n){return Ve(t.onMouseEnter)&&Je("onMouseEnter",e)?(t.onMouseEnter({chart:this.getWidget().getPane().getChart(),overlay:t,figure:e??void 0,...n}),!0):!1}_processOverlayMouseLeaveEvent(t,e,n){return Ve(t.onMouseLeave)&&Je("onMouseLeave",e)?(t.onMouseLeave({chart:this.getWidget().getPane().getChart(),overlay:t,figure:e??void 0,...n}),!0):!1}_processOverlaySelectedEvent(t,e,n){return Je("onSelected",e)?(t.onSelected?.({chart:this.getWidget().getPane().getChart(),overlay:t,figure:e??void 0,...n}),!0):!1}_processOverlayDeselectedEvent(t,e,n){return Je("onDeselected",e)?(t.onDeselected?.({chart:this.getWidget().getPane().getChart(),overlay:t,figure:e??void 0,...n}),!0):!1}_figureMouseMoveEvent(t,e,n,r){return s=>{const o=this.getWidget().getPane(),l=this.getWidget();if(l.getName()===Z.SCRIPT){const a=l;if(a._isMouseInScriptButtons&&a._isMouseInScriptButtons(s))return!1}const c=!t.isDrawing()&&Je("onMouseMove",r);if(c){let a=!1;t.onMouseMove?.({chart:o.getChart(),overlay:t,figure:r,...s,preventDefault:()=>{a=!0}}),a?this.getWidget().setForceCursor(null):this.getWidget().setForceCursor("pointer")}return o.getChart().getChartStore().setHoverOverlayInfo({paneId:o.getId(),overlay:t,figureType:e,figure:r,figureIndex:n},(a,h)=>this._processOverlayMouseEnterEvent(a,h,s),(a,h)=>this._processOverlayMouseLeaveEvent(a,h,s)),c}}_figureMouseDownEvent(t,e,n,r){return s=>{const o=this.getWidget().getPane(),l=o.getId(),c=this.getWidget();if(c.getName()===Z.SCRIPT){const a=c;if(a._isMouseInScriptButtons&&a._isMouseInScriptButtons(s))return!1}return t.setHasMoved&&t.setHasMoved(!1),t.startPressedMove(this._coordinateToPoint(t,s)),Je("onPressedMoveStart",r)?(t.onPressedMoveStart?.({chart:o.getChart(),overlay:t,figure:r,...s}),o.getChart().getChartStore().setPressedOverlayInfo({paneId:l,overlay:t,figureType:e,figureIndex:n,figure:r}),!t.isDrawing()):!1}}_figureMouseClickEvent(t,e,n,r){return s=>{const o=this.getWidget().getPane(),l=o.getId(),c=this.getWidget();if(c.getName()===Z.SCRIPT){const h=c;if(h._isMouseInScriptButtons&&h._isMouseInScriptButtons(s))return!1}const a=!t.isDrawing()&&Je("onClick",r);return a&&t.onClick?.({chart:this.getWidget().getPane().getChart(),overlay:t,figure:r,...s}),o.getChart().getChartStore().setClickOverlayInfo({paneId:l,overlay:t,figureType:e,figureIndex:n,figure:r},(h,f)=>this._processOverlaySelectedEvent(h,f,s),(h,f)=>this._processOverlayDeselectedEvent(h,f,s)),a}}_figureMouseDoubleClickEvent(t,e,n,r){return s=>Je("onDoubleClick",r)?(t.onDoubleClick?.({...s,chart:this.getWidget().getPane().getChart(),figure:r,overlay:t}),!t.isDrawing()):!1}_figureMouseRightClickEvent(t,e,n,r){return s=>{if(Je("onRightClick",r)){let o=!1;return t.onRightClick?.({chart:this.getWidget().getPane().getChart(),overlay:t,figure:r,...s,preventDefault:()=>{o=!0}}),o&&this.getWidget().getPane().getChart().getChartStore().removeOverlay(t),!t.isDrawing()}return!1}}_coordinateToPoint(t,e){const n={},r=this.getWidget().getPane(),s=r.getChart(),o=s.getChartStore();if(this.coordinateToPointTimestampDataIndexFlag()){const c=s.getXAxisPane().getAxisComponent().convertFromPixel(e.x),a=o.dataIndexToTimestamp(c)??void 0;n.timestamp=a,n.dataIndex=c}if(this.coordinateToPointValueFlag()){const c=r.getAxisComponent().convertFromPixel(e.y);n.value=c}return n}coordinateToPointValueFlag(){return!0}coordinateToPointTimestampDataIndexFlag(){return!0}dispatchEvent(t,e){const n=this.getWidget().getPane().getChart().getChartStore(),r=n.isOverlayDrawing();return n.getProgressOverlayInfo(),t==="mouseClickEvent"&&this._isMouseInButtonArea(e)?!1:r?this.onEvent(t,e):super.dispatchEvent(t,e)}drawImp(t){this.getCompleteOverlays().forEach(r=>{r.visible&&this._drawOverlay(t,r)});const n=this.getProgressOverlay();H(n)&&n.visible&&this._drawOverlay(t,n)}_drawOverlay(t,e){const{points:n}=e,r=this.getWidget().getPane(),s=r.getChart(),o=s.getChartStore(),l=r.getAxisComponent(),c=s.getXAxisPane().getAxisComponent(),a=n.map(h=>{let f=null;L(h.timestamp)&&(f=o.timestampToDataIndex(h.timestamp));const d={x:0,y:0};return L(f)&&(d.x=c.convertToPixel(f)),L(h.value)&&(d.y=l?.convertToPixel(h.value)??0),d});if(a.length>0){const h=[].concat(this.getFigures(e,a));this.drawFigures(t,e,h)}this.drawDefaultFigures(t,e,a)}drawFigures(t,e,n){const r=this.getWidget().getPane().getChart().getStyles().overlay;n.forEach((s,o)=>{const{type:l,styles:c,attrs:a}=s;[].concat(a).forEach(f=>{const d=this._createFigureEvents(e,"other",o,s),u={...r[l],...e.styles?.[l],...c};this.createFigure({name:l,attrs:f,styles:u},d??void 0)?.draw(t)})})}getCompleteOverlays(){const t=this.getWidget().getPane();return t.getChart().getChartStore().getOverlaysByPaneId(t.getId())}getProgressOverlay(){const t=this.getWidget().getPane(),e=t.getChart().getChartStore().getProgressOverlayInfo();return H(e)&&e.paneId===t.getId()?e.overlay:null}getFigures(t,e){const n=this.getWidget(),r=n.getPane(),s=r.getChart(),o=r.getAxisComponent(),l=s.getXAxisPane().getAxisComponent(),c=n.getBounding();return t.createPointFigures?.({chart:s,overlay:t,coordinates:e,bounding:c,xAxis:l,yAxis:o})??[]}drawDefaultFigures(t,e,n){if(e.needDefaultPointFigure){const r=this.getWidget().getPane().getChart().getChartStore(),s=r.getHoverOverlayInfo(),o=r.getClickOverlayInfo();if(s.overlay?.id===e.id&&s.figureType!=="none"||o.overlay?.id===e.id&&o.figureType!=="none"){const l=r.getStyles().overlay,c=e.styles,a={...l.point,...c?.point};n.forEach(({x:h,y:f},d)=>{let u=a.radius,p=a.color,x=a.borderColor,g=a.borderSize;s.overlay?.id===e.id&&s.figureType==="point"&&s.figure?.key===`${jt}point_${d}`&&(u=a.activeRadius,p=a.activeColor,x=a.activeBorderColor,g=a.activeBorderSize),this.createFigure({name:"circle",attrs:{x:h,y:f,r:u+g},styles:{color:x}},this._createFigureEvents(e,"point",d,{key:`${jt}point_${d}`,type:"circle",attrs:{x:h,y:f,r:u+g},styles:{color:x}})??void 0)?.draw(t),this.createFigure({name:"circle",attrs:{x:h,y:f,r:u},styles:{color:p}})?.draw(t)})}}}}class va extends We{constructor(t){super(t),this._isRendering=!1,this._lastRenderHash=""}drawImp(t){if(!this._isRendering){this._isRendering=!0;try{const e=this.getWidget(),n=e.getPane(),r=n.getChart().getChartStore(),s=n.getId(),o=r.getScriptsByPaneId(s);if(o.length===0)return;const l=e.getBounding(),c=n.getChart().getXAxisPane().getAxisComponent(),a=n.getAxisComponent();o.forEach((h,f)=>{if(h.visible)try{const d=n.getChart()._ScriptManager,u=d.getScript(h.key);if(u&&u._compiledFunction){t.save(),t.setLineDash([]),t.globalAlpha=1,t.lineWidth=1,t.lineCap="butt",t.lineJoin="miter",t.miterLimit=10,t.strokeStyle="#000000",t.fillStyle="#000000",t.font="12px Arial",t.textAlign="left",t.textBaseline="alphabetic";const p={ctx:t,bounding:l,yAxis:a,xAxis:c,chart:n.getChart(),indicator:h},x=d.createContext(n.getChart().getDataList(),h.key,h.msgCallback,p,u);u._compiledFunction(x),t.restore()}}catch(d){console.error(`脚本 ${h.key} 执行错误:`,d),t.restore()}})}finally{this._isRendering=!1}}}}class _a extends ji{constructor(t,e){super(t,e),this._gridView=new xa(this),this._indicatorView=new O0(this),this._crosshairLineView=new ma(this),this._tooltipView=this.createTooltipView(),this._overlayView=new Wr(this),this._scriptView=new va(this),this.addChild(this._tooltipView),this.addChild(this._overlayView)}getName(){return Z.MAIN}updateMain(t){this.getPane().getOptions().state!=="minimize"&&(this.updateMainContent(t),this._indicatorView.draw(t),this._gridView.draw(t),this._scriptView.draw(t))}createTooltipView(){return new ya(this)}updateMainContent(t){}updateOverlayContent(t){}updateOverlay(t){this.getPane().getOptions().state!=="minimize"&&(this._overlayView.draw(t),this._crosshairLineView.draw(t),this.updateOverlayContent(t)),this._tooltipView.draw(t)}}class H0 extends Nn{constructor(){super(...arguments),this._ripplePoint=this.createFigure({name:"circle",attrs:{x:0,y:0,r:0},styles:{style:"fill"}}),this._animationFrameTime=0,this._animation=new Ni({iterationCount:1/0}).doFrame(t=>{this._animationFrameTime=t;const e=this.getWidget().getPane();e.getChart().updatePane(J.Main,e.getId())})}drawImp(t){const e=this.getWidget(),n=e.getPane(),r=n.getChart(),o=r.getDataList().length-1,l=e.getBounding(),c=n.getAxisComponent(),a=r.getStyles().candle.area,h=[];let f=Number.MAX_SAFE_INTEGER,d=Number.MIN_SAFE_INTEGER,u=null;if(this.eachChildren(x=>{const g=x.x,{current:m}=x.data,y=m?.[a.value];if(L(y)){const v=c.convertToPixel(y);d===Number.MIN_SAFE_INTEGER&&(d=g),h.push({x:g,y:v}),f=Math.min(f,v),x.dataIndex===o&&(u={x:g,y:v})}}),h.length>0){this.createFigure({name:"line",attrs:{coordinates:h},styles:{color:a.lineColor,size:a.lineSize,smooth:a.smooth}})?.draw(t);const x=a.backgroundColor;let g="";if(ze(x)){const m=t.createLinearGradient(0,l.height,0,f);try{x.forEach(({offset:y,color:v})=>{m.addColorStop(y,v)})}catch{}g=m}else g=x;t.fillStyle=g,t.beginPath(),t.moveTo(d,l.height),t.lineTo(h[0].x,h[0].y),na(t,h,a.smooth),t.lineTo(h[h.length-1].x,l.height),t.closePath(),t.fill()}const p=a.point;if(p.show&&H(u)){this.createFigure({name:"circle",attrs:{x:u.x,y:u.y,r:p.radius},styles:{style:"fill",color:p.color}})?.draw(t);let x=p.rippleRadius;p.animation&&(x=p.radius+this._animationFrameTime/p.animationDuration*(p.rippleRadius-p.radius),this._animation.setDuration(p.animationDuration).start()),this._ripplePoint?.setAttrs({x:u.x,y:u.y,r:x}).setStyles({style:"fill",color:p.rippleColor}).draw(t)}else this.stopAnimation()}stopAnimation(){this._animation.stop()}}class $0 extends Nn{constructor(){super(...arguments),this._ripplePoint=this.createFigure({name:"circle",attrs:{x:0,y:0,r:0},styles:{style:"fill"}}),this._animationFrameTime=0,this._animation=new Ni({iterationCount:1/0}).doFrame(t=>{this._animationFrameTime=t;const e=this.getWidget().getPane();e.getChart().updatePane(J.Main,e.getId())})}drawImp(t){const n=this.getWidget().getPane(),r=n.getChart(),o=r.getDataList().length-1,l=n.getAxisComponent(),c=r.getStyles().candle.area,a=[];let h=null;this.eachChildren(d=>{const u=d.x,{current:p}=d.data,x=p?.[c.value];if(L(x)){const g=l.convertToPixel(x);a.push({x:u,y:g}),d.dataIndex===o&&(h={x:u,y:g})}}),a.length>0&&this.createFigure({name:"line",attrs:{coordinates:a},styles:{color:c.lineColor,size:c.lineSize,smooth:c.smooth}})?.draw(t);const f=c.point;if(f.show&&H(h)){this.createFigure({name:"circle",attrs:{x:h.x,y:h.y,r:f.radius},styles:{style:"fill",color:f.color}})?.draw(t);let d=f.rippleRadius;f.animation&&(d=f.radius+this._animationFrameTime/f.animationDuration*(f.rippleRadius-f.radius),this._animation.setDuration(f.animationDuration).start()),this._ripplePoint?.setAttrs({x:h.x,y:h.y,r:d}).setStyles({style:"fill",color:f.rippleColor}).draw(t)}else this.stopAnimation()}stopAnimation(){this._animation.stop()}}const Y0=.18,ms=36;function X0(i,t){if(!i)return i;if(i.startsWith("#")){const e=i.slice(1),n=parseInt(e.length===3?e.split("").map(l=>l+l).join(""):e,16),r=n>>16&255,s=n>>8&255,o=n&255;return`rgba(${r}, ${s}, ${o}, ${t})`}return i.startsWith("rgb")?i.replace(/rgba?\(([^)]+)\)/,(e,n)=>{const r=n.split(",").map(c=>c.trim()),[s,o,l]=r;return`rgba(${s}, ${o}, ${l}, ${t})`}):i}function dn(i){if(!Number.isFinite(i))return"0";const t=Math.abs(i);return t>=1e6?`${(i/1e6).toFixed(1)}M`:t>=1e3?`${(i/1e3).toFixed(1)}K`:`${Math.round(i)}`}function L0(i,t){const e=i.length;if(e<=t)return{rows:i.map((o,l)=>({buyVolume:Number(o.buyVolume??0),sellVolume:Number(o.sellVolume??0),totalVolume:Number(o.buyVolume??0)+Number(o.sellVolume??0),delta:Number(o.delta??(o.buyVolume??0)-(o.sellVolume??0)),startIndex:l,endIndex:l})),groupSize:1};const n=Math.max(1,Math.ceil(e/t)),r=[];for(let s=0;s<e;s+=n){const o=i.slice(s,s+n);let l=0,c=0;o.forEach(a=>{l+=Number(a.buyVolume??0),c+=Number(a.sellVolume??0)}),r.push({buyVolume:l,sellVolume:c,totalVolume:l+c,delta:l-c,startIndex:s,endIndex:s+o.length-1})}return{rows:r,groupSize:n}}class U0 extends Nn{drawImp(t){const e=this.getWidget(),n=e.getPane(),s=n.getChart().getStyles().candle.footprint;if(!s||!s.buyColor&&!s.sellColor)return;const o=n.getAxisComponent(),l=s.padding,c=s.cell,a=s.border,h=s.delta,f=s.vol,d=l.body,u=l.textTop,p=l.textBottom,x=l.textHorizontal,g=c.height,m=c.size,y=a.dividerWidth,v=a.size,_=s.dividerColor,w=s.pocHighlightColor,b=s.buyColor,C=s.sellColor,M=h.show,T=h.size,S=f.show,E=f.color,I=f.size,k=f.family,P=f.weight;this.eachChildren((B,V)=>{const{current:R}=B.data;if(R===null)return;const W=R?.high,F=R?.low,Y=R?.open,O=R?.close;if(!L(W)||!L(F)||!L(Y)||!L(O))return;const z=R?.[s.dataKey];if(!ze(z)||z.length===0)return;const N=[...z].sort((ue,be)=>be.price-ue.price),$=N.reduce((ue,be)=>ue+Number(be.buyVolume??0),0),q=N.reduce((ue,be)=>ue+Number(be.sellVolume??0),0),j=$+q,K=$-q,G=R?.pocPrice,xe=N.findIndex(ue=>Number(ue.price)===Number(G)),de=o.convertToPixel(W),_e=o.convertToPixel(F);let ge=Math.min(de,_e)+d,ee=Math.max(de,_e)-d;if(ee<=ge){const ue=g*N.length;ge=Math.min(de,_e),ee=ge+ue}const ie=Math.max(g,ee-ge),me=Math.max(1,Math.floor(ie/g)),{rows:we,groupSize:ye}=L0(N,me),Me=we.length,le=Math.max(g,ie/Me);let ae;O>Y?ae=!0:O<Y?ae=!1:ae=K>=0;const ce=Math.max(V.gapBar,ms),oe=Math.max(1,ce*Y0),X=Math.min(ce,Math.max(ce-oe,ms)),Fe=Math.max(1,y),Be=B.x-X/2,Re=e.getBounding(),Te=Math.max(Re.top,ge),nt=Math.min(Re.top+Re.height,ee),gt=X0(ae?b:C,.1),mt=ae?b:C,it=o.convertToPixel(Y),Ze=o.convertToPixel(O);let $e=Math.min(it,Ze),Ge=Math.max(it,Ze);$e=Math.max(Te,Math.min(nt,$e)),Ge=Math.min(nt,Math.max(Te,Ge));let rt=Math.max(1,Ge-$e);rt<=0&&($e=Te,Ge=nt,rt=Math.max(1,Ge-$e)),this.createFigure({name:"rect",attrs:{x:Be,y:$e,width:X,height:rt},styles:{style:"stroke_fill",color:gt,borderColor:mt,size:v}})?.draw(t),this.createFigure({name:"line",attrs:{coordinates:[{x:B.x,y:Math.min(de,_e)},{x:B.x,y:Math.max(de,_e)}]},styles:{color:mt,size:1}})?.draw(t),this.createFigure({name:"line",attrs:{coordinates:[{x:B.x,y:Te},{x:B.x,y:nt}]},styles:{color:_,size:y}})?.draw(t);let Yt=-1;xe!==-1&&(Yt=Math.floor(xe/ye));for(let ue=0;ue<Me;ue++){const be=we[ue],Ye=ge+ue*le,an=Ye+le,yt=Math.max(g,an-Ye),Xt=ue===Yt,Bt=Math.max(1,X-v*2),Lt=Be+v;if(Xt&&(this.createFigure({name:"rect",attrs:{x:Lt,y:Ye,width:Bt,height:yt},styles:{style:"fill",color:w}})?.draw(t),this.createFigure({name:"rect",attrs:{x:Lt,y:Ye,width:Bt,height:yt},styles:{style:"stroke",color:w,size:1}})?.draw(t)),yt>0&&m>0){const Ut=Ye+yt/2,Tt=dn(be.buyVolume),fe=dn(be.sellVolume),ve=Math.max(x,v+2),Ke=B.x-Fe/2-ve,ln=B.x+Fe/2+ve;if(Tt){const Xe=this.createFigure({name:"text",attrs:{x:Ke,y:Ut,text:Tt,align:"right",baseline:"middle"},styles:{color:b,size:m}});Xe&&Xe.draw(t)}if(fe){const Xe=this.createFigure({name:"text",attrs:{x:ln,y:Ut,text:fe,align:"left",baseline:"middle"},styles:{color:C,size:m}});Xe&&Xe.draw(t)}}}if(this.createFigure({name:"rect",attrs:{x:Be,y:$e,width:X,height:rt},styles:{style:"stroke",color:mt,size:1}})?.draw(t),M){const ue=K>0?`+${dn(K)}`:`${dn(K)}`,be=K>=0?b:C,Ye=ge-u;this.createFigure({name:"text",attrs:{x:B.x,y:Ye,text:ue,align:"center",baseline:"bottom"},styles:{color:be,size:T}})?.draw(t)}if(S){const ue=nt+p,be=dn(j);this.createFigure({name:"text",attrs:{x:B.x,y:ue,text:be,align:"center",baseline:"top"},styles:{color:E,size:I,family:k,weight:P}})?.draw(t)}})}stopAnimation(){}}function ys(i,t){if(!i)return i;if(i.startsWith("#")){const e=i.slice(1),n=parseInt(e.length===3?e.split("").map(l=>l+l).join(""):e,16),r=n>>16&255,s=n>>8&255,o=n&255;return`rgba(${r}, ${s}, ${o}, ${t})`}return i.startsWith("rgb")?i.replace(/rgba?\(([^)]+)\)/,(e,n)=>{const r=n.split(",").map(c=>c.trim()),[s,o,l]=r;return`rgba(${s}, ${o}, ${l}, ${t})`}):i}function pn(i){if(!Number.isFinite(i))return"0";const t=Math.abs(i);return t>=1e6?`${(i/1e6).toFixed(1)}M`:t>=1e3?`${(i/1e3).toFixed(1)}K`:`${Math.round(i)}`}function q0(i,t){const e=i.length;if(e<=t)return{rows:i.map((o,l)=>{const c=Number(o.price??0);return{buyVolume:Number(o.buyVolume??0),sellVolume:Number(o.sellVolume??0),totalVolume:Number(o.buyVolume??0)+Number(o.sellVolume??0),delta:Number(o.delta??(o.buyVolume??0)-(o.sellVolume??0)),startIndex:l,endIndex:l,startPrice:c,endPrice:c}}),groupSize:1};const n=Math.max(1,Math.ceil(e/t)),r=[];for(let s=0;s<e;s+=n){const o=i.slice(s,s+n);let l=0,c=0,a=-1/0,h=1/0;o.forEach(f=>{l+=Number(f.buyVolume??0),c+=Number(f.sellVolume??0);const d=Number(f.price??0);Number.isFinite(d)&&(d>a&&(a=d),d<h&&(h=d))}),r.push({buyVolume:l,sellVolume:c,totalVolume:l+c,delta:l-c,startIndex:s,endIndex:s+o.length-1,startPrice:Number.isFinite(a)?a:0,endPrice:Number.isFinite(h)?h:0})}return{rows:r,groupSize:n}}class j0 extends Nn{drawImp(t){const e=this.getWidget(),n=e.getPane(),s=n.getChart().getStyles().candle.footprintPeriod;if(!s||!s.buyColor&&!s.sellColor)return;const o=n.getAxisComponent(),l=s.padding,c=s.cell,a=s.leftBar,h=s.histogram,f=s.textOffset,d=s.delta,u=s.vol,p=l.body,x=l.textTop,g=l.textBottom,m=c.height,y=c.text,v=a.width,_=a.gap,w=a.backgroundAlpha;a.borderAlpha;const b=h.minAlpha,C=h.maxAlpha,M=f.gap,T=f.centerOffset,S=f.rightPadding,E=s.buyColor,I=s.sellColor;s.neutralColor;const k=d.show,P=d.size,B=u.show,V=u.color,R=u.size,W=u.family,F=u.weight,Y=y.show,O=y.color,z=y.size,N=y.family,$=y.weight;this.eachChildren((q,j)=>{const{current:K}=q.data;if(K===null)return;const G=K?.high,xe=K?.low,de=K?.open,_e=K?.close;if(!L(G)||!L(xe)||!L(de)||!L(_e))return;const ge=K?.[s.dataKey];if(!ze(ge)||ge.length===0)return;const ee=[...ge].sort((fe,ve)=>ve.price-fe.price),ie=ee.reduce((fe,ve)=>fe+Number(ve.buyVolume??0),0),me=ee.reduce((fe,ve)=>fe+Number(ve.sellVolume??0),0),we=ie+me,ye=ie-me,Me=K?.pocPrice;ee.findIndex(fe=>Number(fe.price)===Number(Me));const le=o.convertToPixel(G),ae=o.convertToPixel(xe);let ce=Math.min(le,ae)+p,oe=Math.max(le,ae)-p;if(oe<=ce){const fe=m*ee.length;ce=Math.min(le,ae),oe=ce+fe}const X=Math.max(m,oe-ce),Fe=Math.max(1,Math.floor(X/m)),{rows:Be,groupSize:Re}=q0(ee,Fe),Te=Be.length,nt=Math.max(m,X/Te),gt=e.getBounding();Math.max(gt.top,ce);const mt=Math.min(gt.top+gt.height,oe),Ze=_e>=de?E:I,$e=o.convertToPixel(de),Ge=o.convertToPixel(_e),rt=Math.min($e,Ge),Yt=Math.max($e,Ge),ue=Math.max(j.gapBar,v+_+M+S+24),be=q.x-ue/2,Ye=be,yt=Ye+v+_,Xt=Math.max(12,ue-v-_-M-S),Bt=Be.reduce((fe,ve)=>Math.max(fe,ve.totalVolume),0),Lt=Number(K?.pocVolume??Bt),Ut=Math.max(Lt,Bt,1),Tt=Math.max(1,Yt-rt);this.createFigure({name:"rect",attrs:{x:Ye,y:rt,width:Math.max(2,v),height:Tt},styles:{style:"fill",color:ys(Ze,w)}})?.draw(t);for(let fe=0;fe<Te;fe++){const ve=Be[fe],Ke=ce+fe*nt,ln=Ke+nt,Xe=Math.max(m,ln-Ke-1),Ie=ve.totalVolume/Ut,Qe=Math.min(Math.max(Ie,0),1),cn=Math.max(2,Xt*Qe),Ji=b+(C-b)*Qe;let Cl=ys(Ze,Ji);if(cn>0&&this.createFigure({name:"rect",attrs:{x:yt,y:Ke,width:cn,height:Xe},styles:{style:"fill",color:Cl}})?.draw(t),Y&&Xe>0&&z>0&&m>=z){const Al=Ke+Xe/2,Sl=pn(ve.buyVolume),El=pn(ve.sellVolume),Ml=`${Sl}|${El}`,Dl=be+ue/2+T;this.createFigure({name:"text",attrs:{x:Dl,y:Al,text:Ml,align:"center",baseline:"middle"},styles:{color:O,size:z,family:N,weight:$}})?.draw(t)}}if(k){const fe=ye>0?`+${pn(ye)}`:`${pn(ye)}`,ve=ye>=0?E:I,Ke=ce-x;this.createFigure({name:"text",attrs:{x:q.x,y:Ke,text:fe,align:"center",baseline:"bottom"},styles:{color:ve,size:P}})?.draw(t)}if(B){const fe=mt+g,ve=pn(we);this.createFigure({name:"text",attrs:{x:q.x,y:fe,text:ve,align:"center",baseline:"top"},styles:{color:V,size:R,family:W,weight:F}})?.draw(t)}})}stopAnimation(){}}class Z0 extends We{drawImp(t){const n=this.getWidget().getPane(),r=n.getChart().getChartStore(),s=r.getStyles().candle.priceMark,o=s.high,l=s.low;if(s.show&&(o.show||l.show)){const c=r.getVisibleRangeHighLowPrice(),a=r.getSymbol()?.pricePrecision??2,h=n.getAxisComponent(),{price:f,x:d}=c[0],{price:u,x:p}=c[1],x=h.convertToPixel(f),g=h.convertToPixel(u),m=r.getDecimalFold(),y=r.getThousandsSeparator();o.show&&f!==Number.MIN_SAFE_INTEGER&&this._drawMark(t,m.format(y.format(ke(f,a))),{x:d,y:x},x<g?[-2,-5]:[2,5],o),l.show&&u!==Number.MAX_SAFE_INTEGER&&this._drawMark(t,m.format(y.format(ke(u,a))),{x:p,y:g},x<g?[2,5]:[-2,-5],l)}}_drawMark(t,e,n,r,s){const o=n.x,l=n.y+r[0];this.createFigure({name:"line",attrs:{coordinates:[{x:o-2,y:l+r[0]},{x:o,y:l},{x:o+2,y:l+r[0]}]},styles:{color:s.color}})?.draw(t);let c=0,a=0,h="left";const{width:f}=this.getWidget().getBounding();o>f/2?(c=o-5,a=c-s.textOffset,h="right"):(c=o+5,h="left",a=c+s.textOffset);const d=l+r[1];this.createFigure({name:"line",attrs:{coordinates:[{x:o,y:l},{x:o,y:d},{x:c,y:d}]},styles:{color:s.color}})?.draw(t),this.createFigure({name:"text",attrs:{x:a,y:d,text:e,align:h,baseline:"middle"},styles:{color:s.color,size:s.textSize,family:s.textFamily,weight:s.textWeight}})?.draw(t)}}class G0 extends We{drawImp(t){const e=this.getWidget(),n=e.getPane(),r=e.getBounding(),s=n.getChart().getChartStore(),o=s.getStyles().candle.priceMark,l=o.last,c=l.line;if(o.show&&l.show&&c.show){const a=n.getAxisComponent(),h=s.getDataList(),f=h[h.length-1];if(H(f)){const{close:d,open:u}=f,p=l.compareRule==="current_open"?u:h[h.length-2]?.close??d,x=a.convertToNicePixel(d);let g="";d>p?g=l.upColor:d<p?g=l.downColor:g=l.noChangeColor,this.createFigure({name:"line",attrs:{coordinates:[{x:0,y:x},{x:r.width,y:x}]},styles:{style:c.style,color:g,size:c.size,dashedValue:c.dashedValue}})?.draw(t)}}}}const K0={second:"HH:mm:ss",minute:"HH:mm",hour:"MM-DD HH:mm",day:"YYYY-MM-DD",week:"YYYY-MM-DD",month:"YYYY-MM",year:"YYYY"},wa={second:"HH:mm:ss",minute:"YYYY-MM-DD HH:mm",hour:"YYYY-MM-DD HH:mm",day:"YYYY-MM-DD",week:"YYYY-MM-DD",month:"YYYY-MM",year:"YYYY"},Q0={time:"时间：",open:"开：",high:"高：",low:"低：",close:"收：",volume:"成交量：",turnover:"成交额：",change:"涨幅：",second:"秒",minute:"分",hour:"小时",day:"天",week:"周",month:"月",year:"年"},J0={time:"Time: ",open:"Open: ",high:"High: ",low:"Low: ",close:"Close: ",volume:"Volume: ",turnover:"Turnover: ",change:"Change: ",second:"S",minute:"m",hour:"H",day:"D",week:"W",month:"M",year:"Y"},eh={"zh-CN":Q0,"en-US":J0};function vs(i,t){return eh[t][i]??i}class th extends ya{constructor(){super(...arguments),this._isStatusBarCollapsed=!1,this._isCollapseBtnHovered=!1,this._buttonAreas=[]}getButtonAreas(){return this._buttonAreas}clearButtonAreas(){this._buttonAreas=[]}drawImp(t){this.clearButtonAreas();const e=this.getWidget(),n=e.getPane().getChart().getChartStore(),r=n.getCrosshair(),s=n.getStyles(),l=n.getIndicatorsByPaneId(e.getPane().getId()).length>0,c=e.getPane().getChart();e.getPane().getId();const f=(c.getScripts?.()||[]).filter(x=>x.position==="main").length>0,d=s.candle,u=d.tooltip,p=(l||f)&&u.showRule==="always"&&u.showType==="standard";if(H(r.kLineData)){const x=e.getBounding(),g=s.indicator;if(d.tooltip.showType==="rect"&&g.tooltip.showType==="rect"){const m=this.isDrawTooltip(r,d.tooltip),y=!this._isStatusBarCollapsed&&this.isDrawTooltip(r,g.tooltip);this._drawRectTooltip(t,m,y,d.tooltip.offsetTop)}else if(d.tooltip.showType==="standard"&&g.tooltip.showType==="standard"){const{offsetLeft:m,offsetTop:y,offsetRight:v}=d.tooltip,_=x.width-v,w=this._drawCandleStandardTooltip(t,m,y,_);let b=w;this._isStatusBarCollapsed||(b=this.drawIndicatorTooltip(t,m,w,_)),p&&this._drawCloseBtn(t,0,b,this.getWidget().getBounding().width)}else if(d.tooltip.showType==="rect"&&g.tooltip.showType==="standard"){const{offsetLeft:m,offsetTop:y,offsetRight:v}=d.tooltip,_=x.width-v,w=this._isStatusBarCollapsed?y:this.drawIndicatorTooltip(t,m,y,_),b=this.isDrawTooltip(r,d.tooltip);this._drawRectTooltip(t,b,!1,w)}else{const{offsetLeft:m,offsetTop:y,offsetRight:v}=d.tooltip,_=x.width-v,w=this._drawCandleStandardTooltip(t,m,y,_),b=!this._isStatusBarCollapsed&&this.isDrawTooltip(r,g.tooltip);this._drawRectTooltip(t,!1,b,w)}}if(p){const y=r.realX??-1,v=r.y??-1;!(y>=10&&y<=26&&v>=4&&v<=20)&&this._isCollapseBtnHovered&&(this._isCollapseBtnHovered=!1,this.getWidget().update&&this.getWidget().update())}if(this._buttonAreas.length>0){let x=1/0,g=1/0,m=-1/0,y=-1/0;for(const v of this._buttonAreas)x=Math.min(x,v.left),g=Math.min(g,v.top),m=Math.max(m,v.right),y=Math.max(y,v.bottom);this._buttonAreas=[{left:x,top:g,right:m,bottom:y,type:"all"}]}}_drawCandleStandardTooltip(t,e,n,r){const s=this.getWidget().getPane().getChart().getChartStore(),l=s.getStyles().candle.tooltip,c=l.legend;let a=0;const h={x:e,y:n},f=s.getCrosshair();if(this.isDrawTooltip(f,l)){const d=l.title;if(d.show){const{type:g="",span:m=""}=s.getPeriod()??{},y=es(d.template,{...s.getSymbol(),period:`${m}${vs(g,s.getLocale())}`}),v=d.color,_=this.drawStandardTooltipLegends(t,[{title:{text:"",color:v},value:{text:y,color:v}}],{x:e,y:n},e,0,r,d);h.y=h.y+_}let u=!0;try{u=c.show!==!1}catch{}const p=this._getCandleTooltipLegends(),x=this.classifyTooltipFeatures(l.features);a=this.drawStandardTooltipFeatures(t,x[0],h,null,e,a,r),a=this.drawStandardTooltipFeatures(t,x[1],h,null,e,a,r),u&&p.length>0&&(a=this.drawStandardTooltipLegends(t,p,h,e,a,r,c)),a=this.drawStandardTooltipFeatures(t,x[2],h,null,e,a,r)}return h.y+a}_drawRectTooltip(t,e,n,r){const s=this.getWidget(),o=s.getPane(),l=o.getChart().getChartStore(),c=l.getStyles(),a=c.candle,h=c.indicator,f=a.tooltip,d=h.tooltip;if(e||n){const u=this._getCandleTooltipLegends(),{offsetLeft:p,offsetTop:x,offsetRight:g,offsetBottom:m}=f,{marginLeft:y,marginRight:v,marginTop:_,marginBottom:w,size:b,weight:C,family:M}=f.legend,{position:T,paddingLeft:S,paddingRight:E,paddingTop:I,paddingBottom:k,offsetLeft:P,offsetRight:B,offsetTop:V,offsetBottom:R,borderSize:W,borderRadius:F,borderColor:Y,color:O}=f.rect;let z=0,N=0,$=0;e&&(t.font=pt(b,C,M),u.forEach(ee=>{const ie=ee.title,me=ee.value,we=`${ie.text}${me.text}`,ye=t.measureText(we).width+y+v;z=Math.max(z,ye)}),$+=(w+_+b)*u.length);const{marginLeft:q,marginRight:j,marginTop:K,marginBottom:G,size:xe,weight:de,family:_e}=d.legend,ge=[];if(n){const ee=l.getIndicatorsByPaneId(o.getId());t.font=pt(xe,de,_e),ee.forEach(ie=>{const me=this.getIndicatorTooltipData(ie).legends;ge.push(me),me.forEach(we=>{const ye=we.title,Me=we.value,le=`${ye.text}${Me.text}`,ae=t.measureText(le).width+q+j;z=Math.max(z,ae),$+=K+G+xe})})}if(N+=z,N!==0&&$!==0){const ee=l.getCrosshair(),ie=s.getBounding(),me=o.getYAxisWidget().getBounding();N+=W*2+S+E,$+=W*2+I+k;const we=ie.width/2,ye=T==="pointer"&&ee.paneId===Q.CANDLE,Me=(ee.realX??0)>we;let le=0;if(ye){const X=ee.realX;Me?le=X-B-N:le=X+P}else{const X=this.getWidget().getPane().getAxisComponent();Me?(le=P+p,X.inside&&X.position==="left"&&(le+=me.width)):(le=ie.width-B-N-g,X.inside&&X.position==="right"&&(le-=me.width))}let ae=r+V;ye&&(ae=ee.y-$/2,ae+$>ie.height-R-m&&(ae=ie.height-R-$-m),ae<r+V&&(ae=r+V+x)),this.createFigure({name:"rect",attrs:{x:le,y:ae,width:N,height:$},styles:{style:"stroke_fill",color:O,borderColor:Y,borderSize:W,borderRadius:F}})?.draw(t);const ce=le+W+S+y;let oe=ae+W+I;if(e&&u.forEach(X=>{oe+=_;const Fe=X.title;this.createFigure({name:"text",attrs:{x:ce,y:oe,text:Fe.text},styles:{color:Fe.color,size:b,family:M,weight:C}})?.draw(t);const Be=X.value;this.createFigure({name:"text",attrs:{x:le+N-W-v-E,y:oe,text:Be.text,align:"right"},styles:{color:Be.color,size:b,family:M,weight:C}})?.draw(t),oe+=b+w}),n){const X=le+W+S+q;ge.forEach(Fe=>{Fe.forEach(Be=>{oe+=K;const Re=Be.title,Te=Be.value;this.createFigure({name:"text",attrs:{x:X,y:oe,text:Re.text},styles:{color:Re.color,size:xe,family:_e,weight:de}})?.draw(t),this.createFigure({name:"text",attrs:{x:le+N-W-j-E,y:oe,text:Te.text,align:"right"},styles:{color:Te.color,size:xe,family:_e,weight:de}})?.draw(t),oe+=xe+G})})}}}}_getCandleTooltipLegends(){const t=this.getWidget().getPane().getChart().getChartStore(),e=t.getStyles().candle,n=t.getDataList(),r=t.getInnerFormatter(),s=t.getDecimalFold(),o=t.getThousandsSeparator(),l=t.getLocale(),{pricePrecision:c=2,volumePrecision:a=0}=t.getSymbol()??{},h=t.getPeriod(),f=t.getCrosshair().dataIndex??0,d=e.tooltip,{color:u,defaultValue:p,template:x}=d.legend,g=n[f-1]??null,m=n[f];let y;e.bar?.compareRule==="current_open"?y=m.open:y=g?.close??m.close;const v=m.close-y,_={...m,time:r.formatDate(m.timestamp,wa[h?.type??"day"],"tooltip"),open:s.format(o.format(ke(m.open,c))),high:s.format(o.format(ke(m.high,c))),low:s.format(o.format(ke(m.low,c))),close:s.format(o.format(ke(m.close,c))),volume:s.format(o.format(r.formatBigNumber(ke(m.volume??p,a)))),turnover:s.format(o.format(ke(m.turnover??p,c))),change:y===0?p:`${o.format(ke(v/y*100))}%`};return(Ve(x)?x({prev:g,current:m,next:n[f+1]??null},e):x).map(({title:b,value:C})=>{let M={text:"",color:u};tt(b)?M={...b}:M.text=b,M.text=vs(M.text,l);let T={text:p,color:u};return tt(C)?T={...C}:T.text=C,H(/{change}/.exec(T.text))?T.color=v===0?e.priceMark.last.noChangeColor:v>0?e.priceMark.last.upColor:e.priceMark.last.downColor:(H(/{close}/.exec(T.text))||H(/{open}/.exec(T.text))||H(/{high}/.exec(T.text))||H(/{low}/.exec(T.text)))&&(T.color=v===0?u:v>0?e.priceMark.last.upColor:e.priceMark.last.downColor),T.text=es(T.text,_),{title:M,value:T}})}_drawCloseBtn(t,e,n,r){const l=e+10,c=n+4,a=4;return this._buttonAreas.push({left:l,top:c,right:l+24,bottom:c+14,type:"collapse"}),t.save(),t.translate(.5,.5),t.beginPath(),t.moveTo(l,c+a),t.arcTo(l,c,l+24,c,a),t.arcTo(l+24,c,l+24,c+14,a),t.arcTo(l+24,c+14,l,c+14,a),t.arcTo(l,c+14,l,c,a),t.closePath(),t.fillStyle=this._isCollapseBtnHovered?"rgba(57, 109, 253, 0.2)":"rgba(57, 109, 253,0.1)",t.fill(),t.restore(),t.save(),t.translate(.5,.5),t.beginPath(),t.moveTo(l,c+a),t.arcTo(l,c,l+24,c,a),t.arcTo(l+24,c,l+24,c+14,a),t.arcTo(l+24,c+14,l,c+14,a),t.arcTo(l,c+14,l,c,a),t.closePath(),t.setLineDash([]),t.lineWidth=1,t.strokeStyle="rgb(32, 159, 243)",t.stroke(),t.restore(),this.createFigure({name:"text",attrs:{x:l+24/2,y:c+14/2,text:this._isStatusBarCollapsed?"∨":"∧",align:"center",baseline:"middle"},styles:{color:this._isCollapseBtnHovered?"rgba(49, 129, 250, 0.7)":"rgba(49, 129, 250,1)",size:8,cursor:"pointer"}})?.draw(t),this.createFigure({name:"rect",attrs:{x:l,y:c,width:24,height:14},styles:{color:"rgba(0,0,0,0)",borderColor:"rgba(128,128,128,0)",borderSize:1}},{mouseMoveEvent:()=>(this._isCollapseBtnHovered||(this._isCollapseBtnHovered=!0,this.getWidget().update&&this.getWidget().update()),!0),mouseLeaveEvent:()=>(this._isCollapseBtnHovered&&(this._isCollapseBtnHovered=!1,this.getWidget().update&&this.getWidget().update()),!0),mouseClickEvent:()=>(this._isStatusBarCollapsed=!this._isStatusBarCollapsed,this.getWidget().update&&this.getWidget().update(),!0)})?.draw(t),22}drawStandardTooltipFeatures(t,e,n,r,s,o,l,c){const a=super.drawStandardTooltipFeatures(t,e,n,r,s,o,l,c);this.getWidget().getPane().getId();let f=1/0,d=1/0,u=-1/0,p=-1/0;return e.forEach((x,g)=>{const{marginLeft:m=0,marginTop:y=0,marginRight:v=0,marginBottom:_=0,paddingLeft:w=0,paddingTop:b=0,paddingRight:C=0,paddingBottom:M=0,size:T=0,type:S,content:E}=x;let I=0;if(S==="icon_font"){const R=E;t.font=pt(T,"normal",R.family),I=t.measureText(R.code).width}else I=T;const k=n.x+m,P=n.y+y,B=m+w+I+C+v,V=y+b+T+M+_;f=Math.min(f,k),d=Math.min(d,P),u=Math.max(u,k+B),p=Math.max(p,P+V)}),e.length>0&&this._buttonAreas.push({left:f,top:d,right:u,bottom:p,type:r?"indicator":c?"script":"feature"}),a}}class nh extends We{constructor(t){super(t),this._activeFeatureInfo=null,this._featureClickEvent=e=>()=>(this.getWidget().getPane().getChart().getChartStore().executeAction("onCrosshairFeatureClick",e),!0),this._featureMouseMoveEvent=e=>()=>(this._activeFeatureInfo=e,this.getWidget().setForceCursor("pointer"),!0),this.registerEvent("mouseMoveEvent",e=>(this._activeFeatureInfo=null,this.getWidget().setForceCursor(null),!1))}drawImp(t){const e=this.getWidget(),n=e.getPane(),r=e.getPane().getChart().getChartStore(),s=r.getCrosshair(),o=this.getWidget(),l=o.getPane().getAxisComponent();if(se(s.paneId)&&s.paneId===n.getId()&&l.isInCandle()){const c=r.getStyles().crosshair,a=c.horizontal.features;if(c.show&&c.horizontal.show&&a.length>0){const h=l.position==="right",f=o.getBounding();let d=0;const u=c.horizontal.text;if(l.inside&&u.show){const g=l.convertFromPixel(s.y),m=l.getRange();let y=l.displayValueToText(l.realValueToDisplayValue(l.valueToRealValue(g,{range:m}),{range:m}),r.getSymbol()?.pricePrecision??2);y=r.getDecimalFold().format(r.getThousandsSeparator().format(y)),d=u.paddingLeft+qe(y,u.size,u.weight,u.family)+u.paddingRight}let p=d;h&&(p=f.width-d);const x=s.y;a.forEach(g=>{const{marginLeft:m=0,marginTop:y=0,marginRight:v=0,paddingLeft:_=0,paddingTop:w=0,paddingRight:b=0,paddingBottom:C=0,color:M,activeColor:T,backgroundColor:S,activeBackgroundColor:E,borderRadius:I,size:k=0,type:P,content:B}=g;let V=k;if(P==="icon_font"){const Y=B;V=_+qe(Y.code,k,"normal",Y.family)+b}h?p-=V+v:p+=m;let R=M,W=S;this._activeFeatureInfo?.feature.id===g.id&&(R=T??M,W=E??S);const F={mouseClickEvent:this._featureClickEvent({crosshair:s,feature:g}),mouseMoveEvent:this._featureMouseMoveEvent({crosshair:s,feature:g})};if(P==="icon_font"){const Y=B;this.createFigure({name:"text",attrs:{text:Y.code,x:p,y:x+y,baseline:"middle"},styles:{paddingLeft:_,paddingTop:w,paddingRight:b,paddingBottom:C,borderRadius:I,size:k,family:Y.family,color:R,backgroundColor:W}},F)?.draw(t)}else{this.createFigure({name:"rect",attrs:{x:p,y:x+y-k/2,width:k,height:k},styles:{paddingLeft:_,paddingTop:w,paddingRight:b,paddingBottom:C,color:W}},F)?.draw(t);const Y=B;this.createFigure({name:"path",attrs:{path:Y.path,x:p,y:x+y+w-k/2,width:k,height:k},styles:{style:Y.style,lineWidth:Y.lineWidth,color:R}})?.draw(t)}h?p-=m:p+=V+v})}}}}let D=class{static formatNumber(t,e=2,n=!1){if(isNaN(t))return"0";const r=t.toFixed(e);if(!n)return r;const s=r.split(".");return s[0]=s[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),s.join(".")}static formatPercent(t,e=2){return`${(t*100).toFixed(e)}%`}static formatPrice(t,e=2){return t.toFixed(e)}static toFloat(t,e=2){return parseFloat(t.toFixed(e))}static toNumber(t){const e=String(t),n=/^-?(\d)\.?(\d*)e-(\d+)$/i;if(!n.test(e))return Number(t);const r=e.match(n);if(!r)return Number(t);const[,s,o="",l]=r,c=s+o,a=parseInt(l),h=e.startsWith("-"),f="0."+"0".repeat(a-1)+c;return parseFloat((h?"-":"")+f)}static mod(t,e){return t%e}static average(t){return t.length===0?0:t.reduce((e,n)=>e+n,0)/t.length}static sum(t){return t.reduce((e,n)=>e+n,0)}static unique(t){return[...new Set(t)]}static sort(t,e=!0){return e?[...t].sort((n,r)=>n-r):[...t].sort((n,r)=>r-n)}static getValue(t,e,n=null){return t[e]!==void 0?t[e]:n}static isValidNumber(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}static isEmpty(t){return t==null||t===""}static isValid(t){return!(t==null||typeof t=="number"&&isNaN(t)||typeof t=="string"&&t.trim()===""||typeof t=="object"&&Object.keys(t).length===0)}static random(t=0,e=1){return Math.random()*(e-t)+t}static randomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}static clamp(t,e,n){return Math.min(Math.max(t,e),n)}static lerp(t,e,n){return t+(e-t)*n}static toRadians(t){return t*(Math.PI/180)}static toDegrees(t){return t*(180/Math.PI)}static distance(t,e,n,r){return Math.sqrt(Math.pow(n-t,2)+Math.pow(r-e,2))}static formatDate(t,e="YYYY-MM-DD"){const n=new Date(t),r=n.getFullYear(),s=String(n.getMonth()+1).padStart(2,"0"),o=String(n.getDate()).padStart(2,"0"),l=String(n.getHours()).padStart(2,"0"),c=String(n.getMinutes()).padStart(2,"0"),a=String(n.getSeconds()).padStart(2,"0");return e.replace("YYYY",String(r)).replace("MM",s).replace("DD",o).replace("HH",l).replace("mm",c).replace("ss",a)}static now(){return Date.now()}static deepClone(t){if(t===null||typeof t!="object")return t;if(t instanceof Date)return new Date(t.getTime());if(t instanceof Array)return t.map(e=>this.deepClone(e));if(typeof t=="object"){const e={};for(const n in t)t.hasOwnProperty(n)&&(e[n]=this.deepClone(t[n]));return e}return t}static merge(t,e){const n={...t};for(const r in e)e.hasOwnProperty(r)&&(typeof e[r]=="object"&&e[r]!==null&&!Array.isArray(e[r])?n[r]=this.merge(n[r]||{},e[r]):n[r]=e[r]);return n}static colorToRgb(t){if(!t||typeof t!="string")return null;const e=t.match(/^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/);if(e){const r=e[1],s=r.length===3?parseInt(r[0]+r[0],16):parseInt(r.substring(0,2),16),o=r.length===3?parseInt(r[1]+r[1],16):parseInt(r.substring(2,4),16),l=r.length===3?parseInt(r[2]+r[2],16):parseInt(r.substring(4,6),16);return{r:s,g:o,b:l}}const n=t.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)$/);if(n)return{r:parseInt(n[1]),g:parseInt(n[2]),b:parseInt(n[3])};try{const s=document.createElement("canvas").getContext("2d");if(!s)return null;s.fillStyle=t;const l=s.fillStyle.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*[\d.]+)?\)$/);if(l)return{r:parseInt(l[1]),g:parseInt(l[2]),b:parseInt(l[3])}}catch(r){console.warn("Failed to parse color:",t,r)}return null}static colorToRgba(t,e=1){if(!t||typeof t!="string")return"rgba(0,0,0,0)";const n=Math.max(0,Math.min(1,e)),r=this.colorToRgb(t);return r?`rgba(${r.r},${r.g},${r.b},${n})`:null}};function ba(i,t,e){const{ctx:n,bounding:r,yAxis:s,xAxis:o,script:l}=i;if(!n||!t||!e)return;const c=f=>typeof e=="function"?e(f)||{}:e||{};let a=-1,h=null;t.forEach((f,d)=>{if(d>0){let u=t[d-1],x=c({value:f,index:d,prev:u,prevValid:h!==null?h:void 0});if(!x||x.show===!1)return;const g=x.continuous===!0;if(D.isValid(u)&&D.isValid(f)){const m=o.convertToPixel(d-1),y=s.convertToPixel(u),v=o.convertToPixel(d),_=s.convertToPixel(f);if(Array.isArray(x.color)){const w=x.color;if(w.length>=2){const b=n.createLinearGradient(m,y,v,_);w.forEach((C,M)=>{const T=M/(w.length-1);b.addColorStop(T,C)}),n.strokeStyle=b}else n.strokeStyle=w[0]||"#000"}else n.strokeStyle=x.color||"#000";n.lineWidth=x.size||1,n.setLineDash([]),x.style==="dashed"?n.setLineDash([5,5]):x.style==="dotted"&&n.setLineDash([2,2]),n.beginPath(),n.moveTo(m,y),n.lineTo(v,_),n.stroke(),a=d,h=f}else if(g&&D.isValid(f)&&a>=0){const m=o.convertToPixel(a),y=s.convertToPixel(h),v=o.convertToPixel(d),_=s.convertToPixel(f);if(Array.isArray(x.color)){const w=x.color;if(w.length>=2){const b=n.createLinearGradient(m,y,v,_);w.forEach((C,M)=>{const T=M/(w.length-1);b.addColorStop(T,C)}),n.strokeStyle=b}else n.strokeStyle=w[0]||"#000"}else n.strokeStyle=x.color||"#000";n.lineWidth=x.size||1,n.setLineDash([]),x.style==="dashed"?n.setLineDash([5,5]):x.style==="dotted"&&n.setLineDash([2,2]),n.beginPath(),n.moveTo(m,y),n.lineTo(v,_),n.stroke(),a=d,h=f}else D.isValid(f)&&(a=d,h=f)}})}function Ca(i,t,e,n){const{ctx:r,bounding:s,yAxis:o,xAxis:l,script:c}=i;if(!r||!t||!n)return;const a=p=>typeof n=="function"?n(p)||{}:n||{},h=r.imageSmoothingEnabled;if(r.imageSmoothingEnabled=!1,!Array.isArray(t)){console.warn("D.bar: 第一个参数必须是数组",t);return}const f=l?._range;if(!f)return;const d=Math.max(1,Math.floor(s.width/(f.to-f.from)*.8)),u=o?.getRange();if(u){for(let p=f.from;p<f.to&&p<t.length;p++){const x=t[p];if(!D.isValid(x))continue;let g;if(typeof e=="number")g=e;else if(Array.isArray(e))g=e[p%e.length]??0;else if(typeof e=="string")switch(e.toLowerCase()){case"top":g=u.max;break;case"bottom":g=u.min;break;case"center":g=(u.max+u.min)/2;break;default:console.warn("D.bar: 无效的基线字符串，支持: top/bottom/center",e),g=0}else g=0;const m={value:x,index:p,prev:p>0?t[p-1]:void 0},y=a(m);if(!y||y.show===!1)continue;const v=l.convertToPixel(p),_=o.convertToPixel(g),w=o.convertToPixel(x),b=Math.min(_,w),C=Math.max(_,w),M=Math.round(v),T=Math.round(b),S=Math.round(C),E=Math.max(1,Math.round(d)),I=Math.floor(M-E/2),k=I+E,P=Math.floor(T),B=Math.floor(S);let V="#000",R="fill",W=1,F="solid";if(y&&(y.color!==void 0&&(V=y.color),y.full!==void 0&&(R=y.full),y.size!==void 0&&(W=y.size),y.style!==void 0&&(F=y.style)),R==="fill"){if(Array.isArray(V)){const j=V;if(j.length>=2){const K=r.createLinearGradient(0,P,0,B);j.forEach((G,xe)=>{const de=xe/(j.length-1);K.addColorStop(de,G)}),r.fillStyle=K}else r.fillStyle=j[0]||"#000"}else r.fillStyle=V;const Y=Math.floor(I),O=Math.floor(P),z=Math.ceil(k),N=Math.ceil(B),$=z-Y,q=N-O;$>0&&q>0&&r.fillRect(Y,O,$,q)}else R==="stroke"&&(r.strokeStyle=V,r.lineWidth=W,F==="dashed"?r.setLineDash([5,5]):F==="dotted"?r.setLineDash([2,2]):r.setLineDash([]),r.strokeRect(I+.5,P+.5,k-I-1,B-P-1))}r.setLineDash([]),r.imageSmoothingEnabled=h}}function Aa(i,t,e,n){const{ctx:r,bounding:s,yAxis:o,xAxis:l,script:c}=i;if(!r||!t||!e)return;const a=d=>typeof e=="function"?e(d)||{}:e||{},h=d=>{if(n)return typeof n=="function"?n(d)||{}:n||{}},f=oh(l);if(f)for(let d=f.from;d<f.to&&d<t.length;d++){const u=t[d];if(!D.isValid(u)||typeof u=="object"&&u!==null&&(u.val1!==void 0||u.val2!==void 0)&&u.val1===void 0&&u.val2===void 0)continue;const p={value:u,index:d,prev:d>0?t[d-1]:void 0};let x=a(p);if(x?.show===!1)continue;let g=h(p);const m=sh(u,d,x,i);ih(r,m,x,g,i,u)}}function ih(i,t,e,n,r,s){const{bounding:o}=r;let l="";if(e.text&&String(e.text).length>0?l=String(e.text):typeof s=="object"&&s!==null&&s.text!==void 0&&s.text!==null&&String(s.text).length>0&&(l=String(s.text)),!l)return;const c=e.color||"#333333",a=e.size||12,h='Arial, "Segoe UI Emoji", "Apple Color Emoji", "Noto Color Emoji"',f=e.bold?"bold":"normal",d=e.italic?"italic":"normal",u=e.align||"left",p=e.angle||0;i.save(),p!==0&&(i.translate(t.x,t.y),i.rotate(p*Math.PI/180),i.translate(-t.x,-t.y)),i.font=`${d} ${f} ${a}px ${h}`,i.textAlign=u,i.textBaseline="middle";const g=i.measureText(l).width,m=a;if(n&&n.show!==!1&&rh(i,t,g,m,n,e),Array.isArray(c)){const y=c;if(y.length>=2){const v=i.createLinearGradient(t.x-g/2,t.y-m/2,t.x+g/2,t.y+m/2);y.forEach((_,w)=>{const b=w/(y.length-1);v.addColorStop(b,_)}),i.fillStyle=v}else i.fillStyle=y[0]}else i.fillStyle=c;i.fillText(l,t.x,t.y),i.restore()}function rh(i,t,e,n,r,s){const o=r.padding||6,l=e+o,c=n+o;let a,h=t.y-c/2-1;s.align==="center"?a=t.x-l/2:s.align==="right"?a=t.x-l:a=t.x;const f=r.color||"#FFFFFF",d=r.full||"fill",u=r.size||1,p=r.style||"solid",x=r.radius||0;if(p==="dashed"?i.setLineDash([5,5]):p==="dotted"?i.setLineDash([2,2]):i.setLineDash([]),d==="fill"){if(Array.isArray(f)){const g=f;if(g.length>=2){const m=i.createLinearGradient(a,h,a,h+c);g.forEach((y,v)=>{const _=v/(g.length-1);m.addColorStop(_,y)}),i.fillStyle=m}else i.fillStyle=g[0]}else i.fillStyle=f;x>0?(i.beginPath(),i.roundRect(a,h,l,c,x),i.fill()):i.fillRect(a,h,l,c)}else{if(Array.isArray(f)){const g=f;if(g.length>=2){const m=i.createLinearGradient(a,h,a,h+c);g.forEach((y,v)=>{const _=v/(g.length-1);m.addColorStop(_,y)}),i.strokeStyle=m}else i.strokeStyle=g[0]}else i.strokeStyle=f;i.lineWidth=u,x>0?(i.beginPath(),i.roundRect(a,h,l,c,x),i.stroke()):i.strokeRect(a,h,l,c)}}function sh(i,t,e,n){const{yAxis:r,xAxis:s,bounding:o,script:l}=n;let c=s.convertToPixel(t),a=0;const h=e.size||12;let f=i;if(typeof i=="object"&&i!==null&&(i.val1!==void 0||i.val2!==void 0?f=i.val1!==void 0?i.val1:i.val2:i.value!==void 0&&(f=i.value)),typeof e.position=="number")e.position>=0?a=o.top+e.position:a=o.height+e.position-h*1.5;else switch(e.position){case"value":a=r.convertToPixel(f);break;case"high":case"low":case"open":case"close":const d=n.dataList;if(d&&t<d.length&&d[t]){const g=d[t][e.position];a=r.convertToPixel(g)}break;case"highUp":const u=n.dataList;if(u&&t<u.length&&u[t]){const g=u[t].high;a=r.convertToPixel(g)-h*1.5}break;case"lowDown":const p=n.dataList;if(p&&t<p.length&&p[t]){const g=p[t].low;a=r.convertToPixel(g)+h*1.5}break;case"top":a=o.top+h/2;break;case"bottom":a=o.height-h*1.5;break;case"center":a=(o.top+o.height)/2;break;default:a=r.convertToPixel(f)}return c+=e.x||0,a+=e.y||0,{x:c,y:a}}function oh(i){return i&&i._range?{from:i._range.from,to:i._range.to}:null}function Sa(i,t,e,n){const{ctx:r,xAxis:s,yAxis:o,bounding:l,dataList:c}=i;if(!r||!t||!e||!Array.isArray(t)||!Array.isArray(e))return;const a=f=>typeof n=="function"?n(f)||{}:n||{},h=lh(s);if(h)try{r.save();for(let f=h.from;f<h.to-1&&f<t.length-1;f++){const d=t[f],u=t[f+1],p=e[f],x=e[f+1];if(d===null||u===null||p===null||x===null||!(D.isValid(d)&&D.isValid(u)&&D.isValid(p)&&D.isValid(x)))continue;const g={value:d,value2:p,index:f+1,prev:f>0?t[f-1]:void 0,prev2:f>0?e[f-1]:void 0},m=a(g);if(m.show===!1)continue;const y=s.convertToPixel(f),v=s.convertToPixel(f+1);let _,w,b,C;const M=T=>typeof T=="string"?ah(T,l)/l.height:T;if(_=o.convertToPixel(M(d)),w=o.convertToPixel(M(u)),b=o.convertToPixel(M(p)),C=o.convertToPixel(M(x)),m.color)if(Array.isArray(m.color)){const T=m.color;if(T.length>=2){const S=r.createLinearGradient(0,_,0,b);T.forEach((E,I)=>{const k=I/(T.length-1);S.addColorStop(k,E)}),r.fillStyle=S}else r.fillStyle=T[0]}else r.fillStyle=m.color;else r.fillStyle="rgba(255, 150, 0, 0.3)";m.alpha&&(r.globalAlpha=m.alpha),!(y===null||v===null||_===null||w===null||b===null||C===null||isNaN(y)||isNaN(v)||isNaN(_)||isNaN(w)||isNaN(b)||isNaN(C))&&(r.beginPath(),r.moveTo(y,_),r.lineTo(v,w),r.lineTo(v,C),r.lineTo(y,b),r.closePath(),r.fill())}}catch(f){console.error("outputArea error:",f)}finally{r&&r.restore()}}function ah(i,t){const e=String(i);if(e==="top")return 0;if(e==="center")return t.height/2;if(e==="bottom")return t.height;if(e.endsWith("px")){const n=parseFloat(e.slice(0,-2));return n>=0?n:t.height+n}if(e.endsWith("%")){const n=parseFloat(e.slice(0,-1))/100;return t.height*n}return 0}function lh(i){return i&&i._range?{from:i._range.from,to:i._range.to}:null}function Ea(i,t,e){const{ctx:n,bounding:r,yAxis:s,xAxis:o,script:l}=i;if(!n||!t||!e)return;const c=h=>typeof e=="function"?e(h)||{}:e||{},a=hh(o);if(a)for(let h=a.from;h<a.to&&h<t.length;h++){const f=t[h];if(!D.isValid(f))continue;if(typeof f=="object"&&f!==null){if(f.val1!==void 0||f.val2!==void 0){if(f.val1===void 0&&f.val2===void 0)continue}else if(Object.keys(f).length===0)continue}else if(typeof f=="number"&&!D.isValid(f))continue;const d={value:f,index:h,prev:h>0?t[h-1]:void 0};let u=c(d);if(u?.show===!1)continue;const p=ch(f,h,u,i),x=u.icon||u.type||"circle",g=ca[x];if(g){const m={...u};if(m.style||(m.style=u.full||"fill"),Array.isArray(m.color)){const y=m.color;if(y.length>=2){const v=n.createRadialGradient(p.x,p.y,0,p.x,p.y,m.size||10);y.forEach((_,w)=>{const b=w/(y.length-1);v.addColorStop(b,_)}),m.color=v}else m.color=y[0]||"#000"}m.style==="stroke"&&(m.borderColor=m.color),g(n,p,m)}}}function ch(i,t,e,n){const{yAxis:r,xAxis:s,bounding:o,script:l}=n;let c=s.convertToPixel(t),a=0;const h=e.size||5;let f=i;switch(typeof i=="object"&&i!==null&&(i.val1!==void 0||i.val2!==void 0)&&(f=i.val1!==void 0?i.val1:i.val2),e.position){case"value":a=r.convertToPixel(f);break;case"high":case"low":case"open":case"close":const d=n.dataList;if(d&&t<d.length&&d[t]){const g=d[t][e.position];a=r.convertToPixel(g)}break;case"highUp":const u=n.dataList;if(u&&t<u.length&&u[t]){const g=u[t].high,m=e.size||12;a=r.convertToPixel(g)-m*1.5}break;case"lowDown":const p=n.dataList;if(p&&t<p.length&&p[t]){const g=p[t].low,m=e.size||12;a=r.convertToPixel(g)+m*1.5}break;case"top":a=o.top+h/2;break;case"bottom":a=o.height-h*1.5;break;case"center":a=(o.top+o.height)/2;break;default:a=r.convertToPixel(f)}return c+=e.x||0,a+=e.y||0,{x:c,y:a}}function hh(i){return i&&i._range?{from:i._range.from,to:i._range.to}:null}function uh(i,t,e,n){if(!t||e===null||e===void 0||!i||n&&typeof n=="object"&&(n.show===!1||n.value&&n.value.show===!1||n.defaultValue&&n.defaultValue.show===!1))return;if(!Array.isArray(e)){let o;e==null||typeof e=="number"&&(isNaN(e)||!isFinite(e))?o="N/A":o=String(e);let l=null;try{if(i.precision!==void 0&&i.precision!==null){if(typeof i.precision=="number")l=i.precision;else if(i.precision==="price"){const a=i.chart;a&&a._chartStore&&a._chartStore._symbol?l=a._chartStore._symbol.pricePrecision??2:l=2}else if(i.precision==="volume"){const a=i.chart;a&&a._chartStore&&a._chartStore._symbol?l=a._chartStore._symbol.volumePrecision??2:l=2}}}catch{}const c={label:t,dataSource:o,style:n,precision:l};i.tooltipTools||(i.tooltipTools=[]),i.tooltipTools.push(c);return}let r=null;try{if(i.precision!==void 0&&i.precision!==null){if(typeof i.precision=="number")r=i.precision;else if(i.precision==="price"){const o=i.chart;o&&o._chartStore&&o._chartStore._symbol?r=o._chartStore._symbol.pricePrecision??2:r=2}else if(i.precision==="volume"){const o=i.chart;o&&o._chartStore&&o._chartStore._symbol?r=o._chartStore._symbol.volumePrecision??2:r=2}}}catch{}i.tooltipTools||(i.tooltipTools=[]);const s={label:t,dataSource:e,style:n,precision:r};i.tooltipTools.push(s)}function Ma(i,t,e){const{ctx:n,bounding:r,yAxis:s,xAxis:o}=i;if(!n||!t||t.length===0)return;const l=h=>typeof e=="function"?e(h)||{}:e||{},c=o?._range;if(!c){console.warn("outputCandle: xAxis._range 无效",o?._range);return}const a=Math.max(1,Math.floor(r.width/(c.to-c.from)*.8));for(let h=c.from;h<c.to&&h<t.length;h++){const f=t[h];if(!f||f.open===void 0||f.close===void 0)continue;const d={value:f,index:h,prev:h>0?t[h-1]:void 0},u=l(d);if(u.show===!1)continue;const p=u.color||"#00FF00",x=u.full||"fill",g=u.size||1,m=f.open,y=f.close,v=f.high,_=f.low,w=p,b=o.convertToPixel(h),C=s.convertToPixel(m),M=s.convertToPixel(y),T=v!==void 0?s.convertToPixel(v):null,S=_!==void 0?s.convertToPixel(_):null;if(b===null||C===null||M===null)continue;const E=Math.min(C,M),I=Math.max(C,M),k=I-E,P=Math.max(1,k),B=Math.round(b),V=Math.round(E),R=Math.round(E+P),W=Math.max(1,Math.round(a)),F=Math.floor(B-W/2),Y=F+W;if(n.setLineDash([]),x==="fill"){if(Array.isArray(w)){const N=w;if(N.length>=2){const $=n.createLinearGradient(0,V,0,R);N.forEach((q,j)=>{const K=j/(N.length-1);$.addColorStop(K,q)}),n.fillStyle=$}else n.fillStyle=N[0]||"#00FF00"}else n.fillStyle=w;const O=Math.max(1,Y-F+1),z=Math.max(1,R-V);n.fillRect(F,V,O,z)}else{if(Array.isArray(w)){const N=w;if(N.length>=2){const $=n.createLinearGradient(0,V,0,R);N.forEach((q,j)=>{const K=j/(N.length-1);$.addColorStop(K,q)}),n.strokeStyle=$}else n.strokeStyle=N[0]||"#00FF00"}else n.strokeStyle=w;n.lineWidth=g;const O=Math.max(1,Y-F+1),z=Math.max(1,R-V);n.strokeRect(F,V,O,z)}if(T!==null&&T<I){if(Array.isArray(w)){const O=w;if(O.length>=2){const z=n.createLinearGradient(0,R,0,Math.round(T));O.forEach((N,$)=>{const q=$/(O.length-1);z.addColorStop(q,N)}),n.strokeStyle=z}else n.strokeStyle=O[0]||"#00FF00"}else n.strokeStyle=w;n.lineWidth=g,n.setLineDash([]),n.beginPath(),x==="fill"?(n.moveTo(B,R),n.lineTo(B,Math.round(T))):(n.moveTo(B,V-g),n.lineTo(B,Math.round(T))),n.stroke()}if(S!==null&&S>E){if(Array.isArray(w)){const O=w;if(O.length>=2){const z=n.createLinearGradient(0,V,0,Math.round(S));O.forEach((N,$)=>{const q=$/(O.length-1);z.addColorStop(q,N)}),n.strokeStyle=z}else n.strokeStyle=O[0]||"#00FF00"}else n.strokeStyle=w;n.lineWidth=g,n.setLineDash([]),n.beginPath(),x==="fill"?(n.moveTo(B,V),n.lineTo(B,Math.round(S))):(n.moveTo(B,R+g),n.lineTo(B,Math.round(S))),n.stroke()}}}function Da(i,t,e){const{ctx:n,bounding:r,yAxis:s,xAxis:o}=i;if(!n||!t||t.length===0)return;const l=o?._range;if(!l){console.warn("outputRect: xAxis._range 无效",o?._range);return}const c=a=>typeof e=="function"?e(a)||{}:e||{};for(let a=0;a<t.length;a++){const h=t[a];if(h){if(!Array.isArray(h)){if(!h||typeof h!="object"||!h.hasOwnProperty("start")||!h.hasOwnProperty("end")||!h.hasOwnProperty("startIndex")||!h.hasOwnProperty("endIndex")||h.endIndex<l.from||h.startIndex>l.to)continue;const f=a>0?t[a-1]:void 0,d=f&&!Array.isArray(f)?f:void 0;_s(n,h,a,o,s,c,d);continue}for(const f of h){if(!f||typeof f!="object"||!f.hasOwnProperty("start")||!f.hasOwnProperty("end")||!f.hasOwnProperty("startIndex")||!f.hasOwnProperty("endIndex")||f.endIndex<l.from||f.startIndex>l.to)continue;const d=a>0?t[a-1]:void 0,u=d&&!Array.isArray(d)?d:void 0;_s(n,f,a,o,s,c,u)}}}}function _s(i,t,e,n,r,s,o){const l=n.convertToPixel(t.startIndex),c=n.convertToPixel(t.endIndex),a=r.convertToPixel(t.start),h=r.convertToPixel(t.end);if(l===null||c===null||a===null||h===null)return;const d=s({value:t,index:e,prev:o});if(d.show===!1)return;const u=d.color||"#00FF00",p=d.full||"fill",x=d.size||1,g=d.style||"solid",m=Math.round(Math.min(l,c)),y=Math.round(Math.max(l,c)),v=Math.round(Math.min(a,h)),_=Math.round(Math.max(a,h)),w=y-m,b=_-v;if(!(w<=0||b<=0))if(g==="dashed"?i.setLineDash([5,5]):g==="dotted"?i.setLineDash([2,2]):i.setLineDash([]),p==="fill"){if(Array.isArray(u)){const C=u;if(C.length>=2){const M=i.createLinearGradient(0,v,0,_);C.forEach((T,S)=>{const E=S/(C.length-1);M.addColorStop(E,T)}),i.fillStyle=M}else i.fillStyle=C[0]||"#00FF00"}else i.fillStyle=u;i.fillRect(m,v,w,b)}else{if(Array.isArray(u)){const C=u;if(C.length>=2){const M=i.createLinearGradient(0,v,0,_);C.forEach((T,S)=>{const E=S/(C.length-1);M.addColorStop(E,T)}),i.strokeStyle=M}else i.strokeStyle=C[0]||"#00FF00"}else i.strokeStyle=u;i.lineWidth=x,i.strokeRect(m,v,w,b)}}class Dt{constructor(t,e,n,r,s){this.ctx=t,this.bounding=e,this.xAxis=n,this.yAxis=r,this.dataList=s}convertX(t){if(typeof t=="number")return t>=0?t:this.bounding.width+t;const e=String(t);if(e==="left")return 0;if(e==="center")return this.bounding.width/2;if(e==="right")return this.bounding.width;if(e.endsWith("px")){const n=parseFloat(e.slice(0,-2));return n>=0?n:this.bounding.width+n}if(e.endsWith("%")){const n=parseFloat(e.slice(0,-1))/100;return this.bounding.width*n}if(e.startsWith("index:")){const n=e.substring(6);if(n==="end"){const s=this.dataList.length-1;return s>=0?this.xAxis.convertToPixel(s):0}const r=parseInt(n);if(!isNaN(r)){const s=r<0?this.dataList.length+r:r;if(s>=0&&s<this.dataList.length)return this.xAxis.convertToPixel(s);{const o=this.dataList.length-1;if(o>=0)return this.xAxis.convertToPixel(o)}}}return 0}convertY(t){if(typeof t=="number")return this.yAxis.convertToPixel(t);const e=String(t);if(e==="top")return 0;if(e==="center")return this.bounding.height/2;if(e==="bottom")return this.bounding.height;if(e.endsWith("px")){const n=parseFloat(e.slice(0,-2));return n>=0?n:this.bounding.height+n}if(e.endsWith("%")){const n=parseFloat(e.slice(0,-1))/100;return this.bounding.height*n}if(["high","low","open","close","hl2","oc2","hlc3","ohl3","ohlc4"].includes(e)){const n=this.dataList[this.dataList.length-1];if(n&&typeof n[e]=="number")return this.yAxis.convertToPixel(n[e])}if(e.startsWith("index:")){const n=e.substring(6);if(n==="end"){const s=this.dataList.length-1;if(s>=0){const o=this.dataList[s];if(o&&typeof o.close=="number")return this.yAxis.convertToPixel(o.close)}return this.bounding.height}const r=parseInt(n);if(!isNaN(r)){const s=r<0?this.dataList.length+r:r;if(s>=0&&s<this.dataList.length){const o=this.dataList[s];if(o&&typeof o.close=="number")return this.yAxis.convertToPixel(o.close)}}}return 0}convertSize(t){if(typeof t=="number")return t;const e=String(t);if(e.endsWith("px"))return parseFloat(e.slice(0,-2));if(e.endsWith("%")){const n=parseFloat(e.slice(0,-1))/100;return this.bounding.width*n}return parseFloat(e)||0}}function fh(i,t,e,n,r){const{ctx:s,bounding:o,xAxis:l,yAxis:c,dataList:a}=i;if(!s||!o||e.show===!1)return;const h=new Dt(s,o,l,c,a);(Array.isArray(t)?t:[t]).forEach(d=>{const u=h.convertY(d),p=n!==void 0?h.convertX(n):0,x=r!==void 0?h.convertX(r):o.width;if(e.color)if(Array.isArray(e.color)){const v=e.color;if(v.length>=2){const _=s.createLinearGradient(p,u,x,u);v.forEach((w,b)=>{const C=b/(v.length-1);_.addColorStop(C,w)}),s.strokeStyle=_}else s.strokeStyle=v[0]}else s.strokeStyle=e.color;let g=e.size||1,m=0,y=0;if(g%2===1&&(m=.5,y=.5),s.lineWidth=g,e.style)switch(e.style){case"dashed":s.setLineDash([5*g,5*g]);break;case"dotted":s.setLineDash([2*g,2*g]);break;default:s.setLineDash([])}s.beginPath(),s.moveTo(p+m,u+y),s.lineTo(x+m,u+y),s.stroke()})}function dh(i,t,e,n,r){const{ctx:s,bounding:o,xAxis:l,yAxis:c,dataList:a}=i;if(!s||!o||e.show===!1)return;const h=new Dt(s,o,l,c,a);(Array.isArray(t)?t:[t]).forEach(d=>{const u=h.convertX(d),p=n!==void 0?h.convertY(n):0,x=r!==void 0?h.convertY(r):o.height;if(e.color)if(Array.isArray(e.color)){const v=e.color;if(v.length>=2){const _=s.createLinearGradient(u,p,u,x);v.forEach((w,b)=>{const C=b/(v.length-1);_.addColorStop(C,w)}),s.strokeStyle=_}else s.strokeStyle=v[0]}else s.strokeStyle=e.color;let g=e.size||1,m=0,y=0;if(g%2===1&&(m=.5,y=.5),s.lineWidth=g,e.style)switch(e.style){case"dashed":s.setLineDash([5*g,5*g]);break;case"dotted":s.setLineDash([2*g,2*g]);break;default:s.setLineDash([])}s.beginPath(),s.moveTo(u+m,p+y),s.lineTo(u+m,x+y),s.stroke()})}function ph(i,t,e){const{ctx:n,bounding:r,xAxis:s,yAxis:o,dataList:l}=i;if(!n||!r||e.show===!1)return;const c=new Dt(n,r,s,o,l);(Array.isArray(t)?t:[t]).forEach(h=>{const f=c.convertX(h.x1),d=c.convertY(h.y1),u=c.convertX(h.x2),p=c.convertY(h.y2);if(e.color)if(Array.isArray(e.color)){const y=e.color;if(y.length>=2){const v=n.createLinearGradient(f,d,u,p);y.forEach((_,w)=>{const b=w/(y.length-1);v.addColorStop(b,_)}),n.strokeStyle=v}else n.strokeStyle=y[0]}else n.strokeStyle=e.color;let x=e.size||1,g=0,m=0;if(x%2===1&&(g=.5,m=.5),n.lineWidth=x,e.style)switch(e.style){case"dashed":n.setLineDash([5*x,5*x]);break;case"dotted":n.setLineDash([2*x,2*x]);break;default:n.setLineDash([])}n.beginPath(),n.moveTo(f+g,d+m),n.lineTo(u+g,p+m),n.stroke()})}function xh(i,t,e){const{ctx:n,bounding:r,xAxis:s,yAxis:o,dataList:l}=i;if(!n||!r||e.show===!1)return;const c=new Dt(n,r,s,o,l);(Array.isArray(t)&&t.length>0&&typeof t[0]=="object"&&"x"in t[0]?[t]:t).forEach(h=>{if(h.length<3){console.warn("sarea: 至少需要3个点才能绘制多边形");return}const f=h.map(d=>({x:c.convertX(d.x),y:c.convertY(d.y)}));n.beginPath(),n.moveTo(f[0].x,f[0].y);for(let d=1;d<f.length;d++)n.lineTo(f[d].x,f[d].y);if(n.closePath(),e.color&&e.color!=="transparent"){if(Array.isArray(e.color)){const d=e.color;if(d.length>=2){const u=Math.min(...f.map(g=>g.y)),p=Math.max(...f.map(g=>g.y)),x=n.createLinearGradient(0,u,0,p);d.forEach((g,m)=>{const y=m/(d.length-1);x.addColorStop(y,g)}),n.fillStyle=x}else n.fillStyle=d[0]}else n.fillStyle=e.color;n.fill()}if(e.border)if(n.strokeStyle=e.border,n.lineWidth=e.size||1,n.setLineDash([]),e.style==="dashed"?n.setLineDash([5,5]):e.style==="dotted"&&n.setLineDash([2,2]),(e.size||1)%2===1){n.save(),n.translate(.5,.5),n.beginPath(),n.moveTo(f[0].x,f[0].y);for(let u=1;u<f.length;u++)n.lineTo(f[u].x,f[u].y);n.closePath(),n.stroke(),n.restore()}else n.stroke()})}function gh(i,t,e){const{ctx:n,bounding:r,xAxis:s,yAxis:o,dataList:l}=i;if(!n||!r)return;const c=f=>typeof e=="function"?e(f)||{}:e||{},a=new Dt(n,r,s,o,l),h=Array.isArray(t)?t:[t];h.forEach((f,d)=>{const u=a.convertX(f.x1),p=a.convertY(f.y1),x=a.convertX(f.x2),g=a.convertY(f.y2),m=Math.min(u,x),y=Math.max(u,x),v=Math.min(p,g),_=Math.max(p,g),w={value:f,index:d,prev:d>0?h[d-1]:void 0},b=c(w);if(b.show!==!1){if(b.color&&b.color!=="transparent"){if(Array.isArray(b.color)){const C=b.color;if(C.length>=2){const M=n.createLinearGradient(0,p,0,g);C.forEach((T,S)=>{const E=S/(C.length-1);M.addColorStop(E,T)}),n.fillStyle=M}else n.fillStyle=C[0]}else n.fillStyle=b.color;n.fillRect(m,v,y-m,_-v)}if(b.border){n.strokeStyle=b.border,n.lineWidth=b.size||1,n.setLineDash([]),b.style==="dashed"?n.setLineDash([5,5]):b.style==="dotted"&&n.setLineDash([2,2]);const C=b.size||1;let M=0,T=0;C%2===1&&(M=.5,T=.5),n.strokeRect(m+M,v+T,y-m,_-v)}}})}function mh(i,t,e){const{ctx:n,bounding:r,xAxis:s,yAxis:o,dataList:l}=i;if(!n||!r||e.show===!1)return;const c=new Dt(n,r,s,o,l);(Array.isArray(t)?t:[t]).forEach(h=>{if(!h||typeof h!="object")return;let f=c.convertX(h.x),d=c.convertY(h.y);e.x!==void 0&&(f+=Number(e.x)),e.y!==void 0&&(d+=Number(e.y));const u=e.icon??"circle",p=yh(u),x=ca[p];if(typeof x!="function")return;const g=vh(e),m=g.size||5,y=String(h.x),v=String(h.y);y==="right"||y.endsWith("%")&&parseFloat(y)>=100?f-=m/2:(y==="left"||y==="0"||y==="0%")&&(f+=m/2),v==="bottom"||v.endsWith("%")&&parseFloat(v)>=100?d-=m/2:(v==="top"||v==="0"||v==="0%")&&(d+=m/2),x(n,{x:f,y:d},g)})}function yh(i){if(!i)return"circle";const t=String(i).toLowerCase().replace(/[^a-z]/g,"");return{arrowup:"arrowUp",arrowdown:"arrowDown",arrowleft:"arrowLeft",arrowright:"arrowRight",arrow:"arrowUp",triangle:"triangle",triangleup:"triangleUp",triangledown:"triangleDown",triangleleft:"triangleLeft",triangleright:"triangleRight",circle:"circle",square:"square",diamond:"diamond",star:"star",cross:"cross",x:"x",flag:"flag",heart:"heart",check:"check"}[t]||"circle"}function vh(i){const t={},e=i.full||"fill";if(t.size=i.size??5,t.show=i.show!==!1,Array.isArray(i.color)){const n=i.color;if(n.length>=2){const r=(s,o,l)=>{const c=s.createRadialGradient(o,l,0,o,l,t.size||5);return n.forEach((a,h)=>{const f=h/(n.length-1);c.addColorStop(f,a)}),c};e==="fill"?t.color=r:e==="stroke"?(t.borderColor=r,t.borderSize=1):t.color=r}else{const r=n[0]||"#000";e==="fill"?t.color=r:e==="stroke"?(t.borderColor=r,t.borderSize=1):t.color=r}}else e==="fill"?t.color=i.color:e==="stroke"?(t.borderColor=i.color,t.borderSize=1):t.color=i.color;return t}function _h(i,t,e){const{ctx:n,bounding:r,xAxis:s,yAxis:o,dataList:l}=i;if(!n||!r||e.show===!1)return;const c=new Dt(n,r,s,o,l);(Array.isArray(t)?t:[t]).forEach(h=>{const f=c.convertX(h.x1),d=c.convertY(h.y1),u=c.convertX(h.x2),p=c.convertY(h.y2),x=(f+u)/2,g=(d+p)/2,y=Math.sqrt(Math.pow(u-f,2)+Math.pow(p-d,2))/2;if(n.beginPath(),n.arc(x,g,y,0,2*Math.PI),e.color&&e.color!=="transparent"){if(Array.isArray(e.color)){const v=e.color;if(v.length>=2){const _=n.createRadialGradient(x,g,0,x,g,y);v.forEach((w,b)=>{const C=b/(v.length-1);_.addColorStop(C,w)}),n.fillStyle=_}else n.fillStyle=v[0]}else n.fillStyle=e.color;n.fill()}e.border&&(n.strokeStyle=e.border,n.lineWidth=e.size||1,n.setLineDash([]),e.style==="dashed"?n.setLineDash([5,5]):e.style==="dotted"&&n.setLineDash([2,2]),(e.size||1)%2===1?(n.save(),n.translate(.5,.5),n.beginPath(),n.arc(x,g,y,0,2*Math.PI),n.stroke(),n.restore()):n.stroke())})}function wh(i,t,e,n){const{ctx:r,bounding:s,xAxis:o,yAxis:l,dataList:c}=i;if(!r||!s||e.show===!1)return;const a=new Dt(r,s,o,l,c);(Array.isArray(t)?t:[t]).forEach(f=>{let d=a.convertX(f.x),u=a.convertY(f.y);e.x!==void 0&&(d+=Number(e.x)),e.y!==void 0&&(u+=Number(e.y));let p="";if(e.text&&String(e.text).length>0?p=String(e.text):f.text!==void 0&&f.text!==null&&String(f.text).length>0&&(p=String(f.text)),!p)return;const x=e.size||12,g="Arial, sans-serif",m=e.bold?"bold":"normal",y=e.italic?"italic":"normal";r.font=`${y} ${m} ${x}px ${g}`,r.textAlign=e.align||"left",r.textBaseline="middle";const _=r.measureText(p).width,w=x,b=n||{},C=b.padding||e.padding||4,M=String(f.x),T=String(f.y);M==="right"||M.endsWith("%")&&parseFloat(M)>=100?r.textAlign==="left"?d-=_+C*2:r.textAlign==="center"&&(d-=(_+C*2)/2):(M==="left"||M==="0"||M==="0%")&&(r.textAlign==="right"?d+=_+C*2:r.textAlign==="center"&&(d+=(_+C*2)/2)),T==="bottom"||T.endsWith("%")&&parseFloat(T)>=100?u-=w/2+C:(T==="top"||T==="0"||T==="0%")&&(u+=w/2+C);const S=d-(r.textAlign==="center"?_/2:r.textAlign==="right"?_:0),E=u-w/2,I=_+C*2,k=w+C*2,P=b.color||e.background,B=b.radius||0;if(b.show!==!1){if(P&&P!=="transparent"){if(Array.isArray(P)){const F=P;if(F.length>=2){const Y=r.createLinearGradient(S,E,S,E+k);F.forEach((O,z)=>{const N=z/(F.length-1);Y.addColorStop(N,O)}),r.fillStyle=Y}else r.fillStyle=F[0]}else r.fillStyle=P;B>0?(r.beginPath(),r.roundRect(S,E,I,k,B),r.fill()):r.fillRect(S,E,I,k)}}if(e.color)if(Array.isArray(e.color)){const F=e.color;if(F.length>=2){const Y=r.createLinearGradient(S,E,S,E+k);F.forEach((O,z)=>{const N=z/(F.length-1);Y.addColorStop(N,O)}),r.fillStyle=Y}else r.fillStyle=F[0]}else r.fillStyle=e.color;else r.fillStyle="#333333";const V=S+I/2,R=E+k/2,W=r.textAlign;r.textAlign="center",r.fillText(p,V,R),r.textAlign=W})}function ws(i){const{script:t,xAxis:e,dataList:n}=i;let r=1/0,s=-1/0,o=!1;const l=()=>{t.position==="vice"&&(o||(o=!0,Promise.resolve().then(()=>{o=!1,i.chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})})))};function c(){return e&&e._range?{from:e._range.from,to:e._range.to}:null}function a(u){if(t.position!=="vice")return;const p=c();Array.isArray(u)?u.forEach((m,y)=>{p&&(y<p.from||y>=p.to)||D.isValid(m)&&(r=Math.min(r,m),s=Math.max(s,m))}):D.isValid(u)?(r=Math.min(r,u),s=Math.max(s,u)):u&&typeof u=="object"&&Object.values(u).forEach(m=>{D.isValid(m)&&(r=Math.min(r,m),s=Math.max(s,m))});let x=null,g=null;t._default?.min!==void 0?x=t._default.min:r!==1/0&&(x=r),t._default?.max!==void 0?g=t._default.max:s!==-1/0&&(g=s),x!==null&&(t.minValue=x),g!==null&&(t.maxValue=g),l()}function h(u,p,x,g,m,y,v){if(t.position==="vice"){const _=i.chart.getDrawPaneById(t.paneId);if(_){_._mdDrawData||(_._mdDrawData=[]);const w={type:u,data:p,styles:x,dataList:i.dataList,scriptId:t.id};g&&(w.labelStyles=g),y&&(w.data2=y),v&&(w.baseline=v),_._mdDrawData.push(w)}}}let f=!1;function d(){t.position==="vice"&&i.chart.getDrawPaneById("candle_pane")&&(f||(f=!0,(window.requestAnimationFrame||(x=>setTimeout(x,16)))(()=>{f=!1,i.chart.requestOverlayUpdateOnce("candle_pane")})))}return{line:(u,p)=>{a(u),ba(i,u,p)},maindraw:{line:(u,p)=>{t.position==="vice"&&(h("line",u,p),d())},shape:(u,p)=>{t.position==="vice"&&(h("shape",u,p),d())},label:(u,p,x)=>{t.position==="vice"&&(h("label",u,p,x),d())},rect:(u,p)=>{t.position==="vice"&&(h("rect",u,p),d())},area:(u,p,x)=>{t.position==="vice"&&(h("area",u,x,void 0,void 0,p),d())},bar:(u,p,x)=>{t.position==="vice"&&(h("bar",u,x,void 0,void 0,void 0,p),d())},candle:(u,p)=>{t.position==="vice"&&(h("candle",u,p),d())}},bar:(u,p,x)=>{a(u),Ca(i,u,p,x)},label:(u,p,x)=>{Aa(i,u,p,x)},area:(u,p,x)=>{a(u),a(p),Sa(i,u,p,x)},shape:(u,p)=>{Ea(i,u,p)},candle:(u,p)=>{Ma(i,u,p)},rect:(u,p)=>{Da(i,u,p)},hline:(u,p,x,g)=>{fh(i,u,p||{},x,g)},vline:(u,p,x,g)=>{dh(i,u,p||{},x,g)},sline:(u,p)=>{ph(i,u,p||{})},sarea:(u,p)=>{function x(y){return{x:y[0],y:y[1]}}function g(y){return y&&typeof y=="object"&&"x"in y&&"y"in y}let m=[];if(Array.isArray(u)){const y=u;if(y.length===0)m=[];else if(Array.isArray(y[0]))y.length>0&&Array.isArray(y[0])&&y[0].length>0&&g(y[0][0])?m=y:m=[y.map(x)];else if(g(y[0]))m=[y];else{const v=[];for(let _=0;_<y.length;_+=2){const w=y[_],b=y[_+1];if(w===void 0||b===void 0)break;v.push({x:w,y:b})}m=v.length?[v]:[]}}else g(u)?m=[]:m=[];m=m.filter(y=>Array.isArray(y)&&y.length>=3),m.length>0&&xh(i,m,p||{})},srect:(u,p)=>{gh(i,u,p||{})},sshape:(u,p,x)=>{let g,m;function y(v){if(Array.isArray(v)){const _=v;if(_.length===0)return[];if(typeof _[0]=="object"&&!Array.isArray(_[0])&&("x"in _[0]||"y"in _[0]))return _;if(Array.isArray(_[0]))return _.map(b=>({x:b[0],y:b[1]}));const w=[];for(let b=0;b<_.length;b+=2){const C=_[b],M=_[b+1];if(C===void 0||M===void 0)break;w.push({x:C,y:M})}return w}return v&&typeof v=="object"&&("x"in v||"y"in v)?[v]:[]}Array.isArray(u)?(g=y(u),m=p||{}):u&&typeof u=="object"&&("x"in u||"y"in u)?(g=y(u),m=p||{}):(g=[{x:u,y:p}],m=x||{}),mh(i,g,m)},scircle:(u,p)=>{_h(i,u,p||{})},slabel:(u,p,x)=>{wh(i,u,p||{},x)},MD:{line:(p,x)=>{t.position==="vice"&&(h("line",p,x),d())},shape:(p,x)=>{t.position==="vice"&&(h("shape",p,x),d())},label:(p,x,g)=>{t.position==="vice"&&(h("label",p,x,g),d())},candle:(p,x)=>{t.position==="vice"&&(h("candle",p,x),d())}}}}function bh(i){const{msgCallback:t,scriptId:e,script:n}=i;function r(c){if(c===null||typeof c!="object")return String(c);const a=Object.keys(c).sort(),h={};for(const f of a)h[f]=r(c[f]);return JSON.stringify(h)}function s(c){return typeof c=="string"?c:c&&typeof c=="object"?c.type?String(c.type):c.name?String(c.name):c.action?String(c.action):c.reason?String(c.reason):r(c):String(c)}function o(){const c="__signalLastBarByTag__";return n[c]||(n[c]=new Map),n[c]}function l(c){if(c==null)return null;if(Array.isArray(c)){const a=c.length-1;if(a>=0){const h=c[a];return h??null}return null}return c}return{tools:(c,a,h)=>{uh(n,c,a,h);try{if(n){Array.isArray(n.tools)||(n.tools=[]);const f=n.precision??h?.precision,d=Array.isArray(a)?a[a.length-1]:a,u=Array.isArray(a)?a.length-1:null;n.tools.push({name:c,data:a,style:h,precision:f,latest:d,lastIndex:u})}}catch{}},print:c=>{t&&t(e,"print",c)},sys:c=>{t&&t(e,"sys",c)},error:c=>{t&&t(e,"error",c)},warn:c=>{t&&t(e,"warn",c)},signal:(c,a,h)=>{const f=l(c);if(f!=null){let d="";typeof a=="function"?d=a(f):typeof a=="string"&&typeof h=="function"?d=h(f):a!==void 0?d=a:d=f;const u=n.chart._chartStore._dataList[n.chart._chartStore._dataList.length-1].timestamp,p=`signal:${s(d)}`,x=o();if(x.get(p)===u)return;if(x.set(p,u),x.size>100){const y=x.keys().next().value;x.delete(y)}const m={name:n?.name,id:n.id,symbol:n.chart._chartStore._symbol.symbol,period:n.chart._chartStore._period.name,timestamp:u,msg:d};t&&t(e,"signal",m)}},orderOpen:(c,a)=>{let h=!1;if(Array.isArray(c)){const g=l(c);h=g!=null}else typeof c=="object"&&c!==null?h=!0:typeof c=="boolean"&&(h=c===!0);if(!h||!a||!a.type||!a.num||a.type!=="buy"&&a.type!=="sell"||typeof a.num!="number"||a.num<=0)return;const f=n.chart._chartStore._dataList[n.chart._chartStore._dataList.length-1].timestamp,d=`orderOpen:${s(a.msg||"")}`,u=o();if(u.get(d)===f)return;if(u.set(d,f),u.size>100){const g=u.keys().next().value;u.delete(g)}const x={name:n?.name,id:n.id,symbol:n.chart._chartStore._symbol.symbol,period:n.chart._chartStore._period.name,timestamp:f,type:a.type,num:a.num,price:a.price||(Array.isArray(c)?l(c):null),stoploss:a.stoploss,takeprofit:a.takeprofit,msg:a.msg};t&&t(e,"orderOpen",x)},orderClose:c=>{if(!c||!c.id)return;const a=Date.now(),h=`orderClose:${s(c.id)}_`,f=o();let d=null,u=null;for(const[p,x]of f.entries())if(p.startsWith(h)){d=p,u=x;break}if(d){if(u&&a-u>=1e3){f.delete(d);const p=`${h}${a}`;if(f.set(p,a),f.size>100){const g=f.keys().next().value;f.delete(g)}const x={name:n?.name,id:n.id,symbol:n.chart._chartStore._symbol.symbol,period:n.chart._chartStore._period.name,timestamp:a,orderId:c.id,num:c.num,price:c.price,msg:c.msg};t&&t(e,"orderClose",x)}}else{const p=`${h}${a}`;if(f.set(p,a),f.size>100){const g=f.keys().next().value;f.delete(g)}const x={name:n?.name,id:n.id,symbol:n.chart._chartStore._symbol.symbol,period:n.chart._chartStore._period.name,timestamp:a,orderId:c.id,num:c.num,price:c.price,msg:c.msg};t&&t(e,"orderClose",x)}},orderUpdate:c=>{if(!c||!c.id||c.price===void 0&&c.stoploss===void 0&&c.takeprofit===void 0)return;const a=`${c.id}_${c.price||""}_${c.stoploss||""}_${c.takeprofit||""}`,h=`orderUpdate:${s(a)}`,f=o(),d=f.get(h),u=n.chart._chartStore._dataList[n.chart._chartStore._dataList.length-1].timestamp;if(d!==u){if(f.set(h,u),f.size>100){const x=f.keys().next().value;f.delete(x)}const p={name:n?.name,id:n.id,symbol:n.chart._chartStore._symbol.symbol,period:n.chart._chartStore._period.name,timestamp:u,orderId:c.id,price:c.price,stoploss:c.stoploss,takeprofit:c.takeprofit,msg:c.msg};t&&t(e,"orderUpdate",p)}}}}class Ch extends _a{constructor(t,e){super(t,e),this._candleBarView=new ga(this),this._candleAreaView=new H0(this),this._candlePriceLineView=new $0(this),this._candleFootprintView=new U0(this),this._candleFootprintPeriodView=new j0(this),this._candleHighLowPriceView=new Z0(this),this._candleLastPriceLineView=new G0(this),this._crosshairFeatureView=new nh(this),this.addChild(this._candleBarView),this.addChild(this._candleFootprintView),this.addChild(this._candleFootprintPeriodView),this.addChild(this._crosshairFeatureView)}updateMainContent(t){const n=this.getPane().getChart().getStyles().candle.type;n==="area"?(this._candleAreaView.draw(t),this._candlePriceLineView.stopAnimation(),this._candleFootprintView.stopAnimation(),this._candleFootprintPeriodView.stopAnimation()):n==="price_line"?(this._candleAreaView.stopAnimation(),this._candlePriceLineView.draw(t),this._candleFootprintView.stopAnimation(),this._candleFootprintPeriodView.stopAnimation()):n==="footprint"?(this._candleAreaView.stopAnimation(),this._candlePriceLineView.stopAnimation(),this._candleFootprintView.draw(t),this._candleFootprintPeriodView.stopAnimation()):n==="footprint_period"?(this._candleAreaView.stopAnimation(),this._candlePriceLineView.stopAnimation(),this._candleFootprintView.stopAnimation(),this._candleFootprintPeriodView.draw(t)):(this._candleBarView.draw(t),this._candleHighLowPriceView.draw(t),this._candleAreaView.stopAnimation(),this._candlePriceLineView.stopAnimation(),this._candleFootprintView.stopAnimation(),this._candleFootprintPeriodView.stopAnimation()),this._candleLastPriceLineView.draw(t),(this.getPane().getChart().watermarkList||[]).forEach((o,l)=>{if(o.img&&o.img.complete){const{position:c=9,offsetX:a=0,offsetY:h=0,width:f,height:d,opacity:u=.15,grayscale:p=!1,rotate:x=0}=o,g=f||o.img.width,m=d||o.img.height,y=t.canvas.width,v=t.canvas.height,_=cx(c,y,v,g,m),w=_.x+a,b=_.y+h;t.save(),t.globalAlpha=u;const C=x*Math.PI/180;if(t.translate(w+g/2,b+m/2),t.rotate(C),p){const M=document.createElement("canvas");M.width=g,M.height=m;const T=M.getContext("2d");T.drawImage(o.img,0,0,g,m);const S=T.getImageData(0,0,g,m);for(let E=0;E<S.data.length;E+=4){const I=.299*S.data[E]+.587*S.data[E+1]+.114*S.data[E+2];S.data[E]=S.data[E+1]=S.data[E+2]=I}T.putImageData(S,0,0),t.drawImage(M,-g/2,-m/2,g,m)}else t.drawImage(o.img,-g/2,-m/2,g,m);t.restore()}})}updateOverlayContent(t){this._crosshairFeatureView.draw(t);const e=this.getPane().getChart(),n=e.getDrawPanes(),r=[];if(n.forEach(s=>{if(s.getId()!=="candle_pane"){const o=s._mdDrawData;o&&o.length>0&&r.push(...o)}}),r&&r.length>0){const s={ctx:t,bounding:this.getBounding(),yAxis:this.getPane().getAxisComponent(),xAxis:e.getXAxisPane()?.getAxisComponent(),chart:e,script:{position:"main"}};r.forEach(o=>{const l={...s,dataList:o.dataList};switch(o.type){case"line":ba(l,o.data,o.styles);break;case"shape":Ea(l,o.data,o.styles);break;case"label":Aa(l,o.data,o.labelStyles,o.backgroundStyles);break;case"rect":Da(l,o.data,o.styles);break;case"area":Sa(l,o.data,o.data2,o.styles);break;case"bar":Ca(l,o.data,o.baseline,o.styles);break;case"candle":Ma(l,o.data,o.styles);break}})}}createTooltipView(){return new th(this)}}class ka extends We{drawImp(t,e){const n=this.getWidget(),r=n.getPane(),s=n.getBounding(),o=r.getAxisComponent(),l=this.getAxisStyles(r.getChart().getStyles());if(l.show&&(l.axisLine.show&&this.createFigure({name:"line",attrs:this.createAxisLine(s,l),styles:l.axisLine})?.draw(t),!e[0])){const c=o.getTicks();if(l.tickLine.show&&this.createTickLines(c,s,l).forEach(h=>{this.createFigure({name:"line",attrs:h,styles:l.tickLine})?.draw(t)}),l.tickText.show){const a=this.createTickTexts(c,s,l);this.createFigure({name:"text",attrs:a,styles:l.tickText})?.draw(t)}}}}class Ah extends ka{getAxisStyles(t){return t.yAxis}createAxisLine(t,e){const n=this.getWidget().getPane().getAxisComponent(),r=e.axisLine.size;let s=0;return n.isFromZero()?s=0:s=t.width-r,{coordinates:[{x:s,y:0},{x:s,y:t.height}]}}createTickLines(t,e,n){const r=this.getWidget().getPane().getAxisComponent(),s=n.axisLine,o=n.tickLine;let l=0,c=0;return r.isFromZero()?(l=0,s.show&&(l+=s.size),c=l+o.length):(l=e.width,s.show&&(l-=s.size),c=l-o.length),t.map(a=>({coordinates:[{x:l,y:a.coord},{x:c,y:a.coord}]}))}createTickTexts(t,e,n){const r=this.getWidget().getPane().getAxisComponent(),s=n.axisLine,o=n.tickLine,l=n.tickText;let c=0;r.isFromZero()?(c=l.marginStart,s.show&&(c+=s.size),o.show&&(c+=o.length)):(c=e.width-l.marginEnd,s.show&&(c-=s.size),o.show&&(c-=o.length));const a=this.getWidget().getPane().getAxisComponent().isFromZero()?"left":"right";return t.map(h=>({x:c,y:h.coord,text:h.text,align:a,baseline:"middle"}))}}class Sh extends We{constructor(){super(...arguments),this._countdownTimer=null}calculateRemainingTime(t,e){const s=this.getWidget().getPane().getChart().getChartStore(),{type:o,span:l}=e,c=Date.now();let a=0;switch(o){case"second":a=l*1e3;break;case"minute":a=l*60*1e3;break;case"hour":a=l*60*60*1e3;break;case"day":a=l*24*60*60*1e3;break;case"week":a=l*7*24*60*60*1e3;break;case"month":a=l*30*24*60*60*1e3;break;default:return""}let h;if(o==="day"||o==="week"||o==="month"){const g=new Date(t),m=new Date(g);switch(o){case"day":const y=s.getTimezone(),v=new Date(c),w=new Intl.DateTimeFormat("en-CA",{timeZone:y,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).formatToParts(v),b=parseInt(w.find(X=>X.type==="year")?.value||"0"),C=parseInt(w.find(X=>X.type==="month")?.value||"0")-1,M=parseInt(w.find(X=>X.type==="day")?.value||"0"),T=parseInt(w.find(X=>X.type==="hour")?.value||"0"),S=parseInt(w.find(X=>X.type==="minute")?.value||"0"),E=parseInt(w.find(X=>X.type==="second")?.value||"0"),I=new Date(b,C,M,T,S,E),P=new Date(b,C,M+1,0,0,0).getTime()-I.getTime();m.setTime(c+P);break;case"week":const B=s.getTimezone(),V=new Date(c),W=new Intl.DateTimeFormat("en-CA",{timeZone:B,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",weekday:"short",hour12:!1}).formatToParts(V),F=parseInt(W.find(X=>X.type==="year")?.value||"0"),Y=parseInt(W.find(X=>X.type==="month")?.value||"0")-1,O=parseInt(W.find(X=>X.type==="day")?.value||"0"),z=parseInt(W.find(X=>X.type==="hour")?.value||"0"),N=parseInt(W.find(X=>X.type==="minute")?.value||"0"),$=parseInt(W.find(X=>X.type==="second")?.value||"0"),q=new Date(F,Y,O,z,N,$),j=q.getDay(),K=j===0?1:8-j,xe=new Date(F,Y,O+K,0,0,0).getTime()-q.getTime();m.setTime(c+xe);break;case"month":const de=s.getTimezone(),_e=new Date(c),ee=new Intl.DateTimeFormat("en-CA",{timeZone:de,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).formatToParts(_e),ie=parseInt(ee.find(X=>X.type==="year")?.value||"0"),me=parseInt(ee.find(X=>X.type==="month")?.value||"0")-1,we=parseInt(ee.find(X=>X.type==="day")?.value||"0"),ye=parseInt(ee.find(X=>X.type==="hour")?.value||"0"),Me=parseInt(ee.find(X=>X.type==="minute")?.value||"0"),le=parseInt(ee.find(X=>X.type==="second")?.value||"0"),ae=new Date(ie,me,we,ye,Me,le),oe=new Date(ie,me+1,1,0,0,0).getTime()-ae.getTime();m.setTime(c+oe);break}h=m.getTime()}else h=t+a;const f=h-c;if(f<=0)return"0:00:00";const d=Math.floor(f/(3600*1e3)),u=Math.floor(f%(3600*1e3)/(60*1e3)),p=Math.floor(f%(60*1e3)/1e3),x=(g,m,y)=>{const v=(g>=10,g.toString()),_=m.toString().padStart(2,"0"),w=y.toString().padStart(2,"0");return`${v}:${_}:${w}`};if(o==="second"||o==="minute"||o==="hour"||o==="day")return x(d,u,p);{const g=Math.floor(f/864e5),m=Math.floor(f%(1440*60*1e3)/(3600*1e3)),y=Math.floor(f%(3600*1e3)/(60*1e3)),v=Math.floor(f%(60*1e3)/1e3);if(g>0){const _=m%24;return`${g}d ${x(_,y,v)}`}else return x(d,u,p)}}startCountdownTimer(){this._countdownTimer!==null&&clearInterval(this._countdownTimer),this._countdownTimer=window.setInterval(()=>{const e=this.getWidget().getPane(),n=e.getYAxisWidget();n?n.update(J.Main):e.getChart().updatePane(J.Main,e.getId())},1e3)}drawImp(t){const e=this.getWidget(),n=e.getPane(),r=e.getBounding(),s=n.getChart().getChartStore();s.getPeriod()&&this._countdownTimer===null&&this.startCountdownTimer();const l=s.getStyles().candle.priceMark,c=l.last,a=c.text;if(l.show&&c.show&&a.show){const h=s.getSymbol()?.pricePrecision??2,f=n.getAxisComponent(),d=s.getDataList(),u=d[d.length-1];if(H(u)){const{close:p,open:x}=u,g=c.compareRule==="current_open"?x:d[d.length-2]?.close??p,m=f.convertToNicePixel(p);let y="";p>g?y=c.upColor:p<g?y=c.downColor:y=c.noChangeColor;let v=0,_="left";f.isFromZero()?(v=0,_="left"):(v=r.width,_="right");const w=[],b=f.getRange();let C=f.displayValueToText(f.realValueToDisplayValue(f.valueToRealValue(p,{range:b}),{range:b}),h);C=s.getDecimalFold().format(s.getThousandsSeparator().format(C));const{paddingLeft:M,paddingRight:T,paddingTop:S,paddingBottom:E,size:I,family:k,weight:P}=a;let B=M+qe(C,I,P,k)+T;const V=S+I+E;w.push({name:"text",attrs:{x:v,y:m,width:B,height:V,text:C,align:_,baseline:"middle"},styles:{...a,backgroundColor:y}});const R=s.getInnerFormatter().formatExtendText,W=I/2;let F=m-W-S,Y=m+W+E;c.extendTexts.forEach((z,N)=>{const $=R({type:"last_price",data:u,index:N});if($.length>0&&z.show){const q=z.size/2;let j=0;z.position==="above_price"?(F-=z.paddingBottom+q,j=F,F-=q+z.paddingTop):(Y+=z.paddingTop+q,j=Y,Y+=q+z.paddingBottom),B=Math.max(B,z.paddingLeft+qe($,z.size,z.weight,z.family)+z.paddingRight),w.push({name:"text",attrs:{x:v,y:j,width:B,height:z.paddingTop+z.size+z.paddingBottom,text:$,align:_,baseline:"middle"},styles:{...z,backgroundColor:y}})}});const O=s.getPeriod();if(O){const z=this.calculateRemainingTime(u.timestamp,O);if(z){const N={size:Math.max(12,I),family:k,weight:"normal",color:"#ffffff",paddingLeft:M,paddingRight:T,paddingTop:3,paddingBottom:3,show:!0,style:"fill",borderStyle:"solid",borderDashedValue:[],borderSize:0,borderColor:"transparent",borderRadius:3,backgroundColor:"#409EFF"},$=z,q=N.size/2;Y+=N.paddingTop+q;const j=Y;Y+=q+N.paddingBottom;const K=N.paddingLeft+qe($,N.size,N.weight,N.family)+N.paddingRight;B=Math.max(B,K),w.push({name:"text",attrs:{x:v,y:j,width:K,height:N.paddingTop+N.size+N.paddingBottom,text:$,align:_,baseline:"middle"},styles:N})}}w.forEach(z=>{z.attrs.width=B,this.createFigure(z)?.draw(t)})}}}}class Eh extends We{drawImp(t){const e=this.getWidget(),n=e.getPane(),r=e.getBounding(),s=n.getChart().getChartStore(),o=s.getStyles().indicator,l=o.lastValueMark,c=l.text;if(l.show){const a=n.getAxisComponent(),h=a.getRange(),d=s.getDataList().length-1,u=s.getIndicatorsByPaneId(n.getId()),p=s.getInnerFormatter(),x=s.getDecimalFold(),g=s.getThousandsSeparator();u.forEach(m=>{const y=m.result,v=y[d]??y[d-1]??{};if(H(v)&&m.visible){const _=m.precision;Pr(m,d,o,(w,b)=>{const C=v[w.key];if(L(C)){const M=a.convertToNicePixel(C);let T=a.displayValueToText(a.realValueToDisplayValue(a.valueToRealValue(C,{range:h}),{range:h}),_);m.shouldFormatBigNumber&&(T=p.formatBigNumber(T)),T=x.format(g.format(T));let S=0,E="left";a.isFromZero()?(S=0,E="left"):(S=r.width,E="right"),this.createFigure({name:"text",attrs:{x:S,y:M,text:T,align:E,baseline:"middle"},styles:{...c,backgroundColor:b.color}})?.draw(t)}})}})}}}class Ba extends Wr{coordinateToPointTimestampDataIndexFlag(){return!1}drawDefaultFigures(t,e,n){this.drawFigures(t,e,this.getDefaultFigures(e,n))}getDefaultFigures(t,e){const n=this.getWidget(),r=n.getPane(),s=r.getChart().getChartStore(),o=s.getClickOverlayInfo(),l=[];if(t.needDefaultYAxisFigure&&t.id===o.overlay?.id&&o.paneId===r.getId()){const c=r.getAxisComponent(),a=n.getBounding();let h=Number.MAX_SAFE_INTEGER,f=Number.MIN_SAFE_INTEGER;const d=c.isFromZero();let u="left",p=0;d?(u="left",p=0):(u="right",p=a.width);const x=s.getDecimalFold(),g=s.getThousandsSeparator();e.forEach((m,y)=>{const v=t.points[y];if(L(v.value)){h=Math.min(h,m.y),f=Math.max(f,m.y);const _=x.format(g.format(ke(v.value,s.getSymbol()?.pricePrecision??2)));l.push({type:"text",attrs:{x:p,y:m.y,text:_,align:u,baseline:"middle"},ignoreEvent:!0})}}),e.length>1&&l.unshift({type:"rect",attrs:{x:0,y:h,width:a.width,height:f-h},ignoreEvent:!0})}return l}getFigures(t,e){const n=this.getWidget(),r=n.getPane(),s=r.getChart(),o=r.getAxisComponent(),l=s.getXAxisPane().getAxisComponent(),c=n.getBounding();return t.createYAxisFigures?.({chart:s,overlay:t,coordinates:e,bounding:c,xAxis:l,yAxis:o})??[]}}class Ta extends We{drawImp(t){const e=this.getWidget(),n=e.getPane(),r=e.getPane().getChart().getChartStore(),s=r.getCrosshair();if(se(s.paneId)&&this.compare(s,n.getId())){const o=r.getStyles().crosshair;if(o.show){const l=this.getDirectionStyles(o),c=l.text;if(l.show&&c.show){const a=e.getBounding(),h=n.getAxisComponent(),f=this.getText(s,r,h);t.font=pt(c.size,c.weight,c.family),this.createFigure({name:"text",attrs:this.getTextAttrs(f,t.measureText(f).width,s,a,h,c),styles:c})?.draw(t)}}}}compare(t,e){return t.paneId===e}getDirectionStyles(t){return t.horizontal}getText(t,e,n){const r=n;let s;typeof t.y=="number"?s=r.convertFromPixel(t.y):s=n.convertFromPixel(0);let o=0,l=!1;r.isInCandle()?o=e.getSymbol()?.pricePrecision??2:(e.getIndicatorsByPaneId(t.paneId).forEach(d=>{o=Math.max(d.precision,o),l||=d.shouldFormatBigNumber}),e.getScriptsByPaneId(t.paneId).forEach(d=>{if(d.precision!==null&&d.precision!==void 0){if(typeof d.precision=="number")o=Math.max(o,d.precision);else if(d.precision==="price"){const u=e.getSymbol()?.pricePrecision??2;o=Math.max(o,u)}else if(d.precision==="volume"){const u=e.getSymbol()?.volumePrecision??2;o=Math.max(o,u)}}}));const c=r.getRange();let a=r.displayValueToText(r.realValueToDisplayValue(r.valueToRealValue(s,{range:c}),{range:c}),o);return l&&(a=e.getInnerFormatter().formatBigNumber(a)),e.getDecimalFold().format(e.getThousandsSeparator().format(a))}getTextAttrs(t,e,n,r,s,o){const l=s;let c=0,a="left";return l.isFromZero()?(c=0,a="left"):(c=r.width,a="right"),{x:c,y:n.y,text:t,align:a,baseline:"middle"}}}class Ia extends ji{constructor(t,e){super(t,e),this._yAxisView=new Ah(this),this._candleLastPriceLabelView=new Sh(this),this._indicatorLastValueView=new Eh(this),this._overlayYAxisView=new Ba(this),this._crosshairHorizontalLabelView=new Ta(this),this.setCursor("ns-resize"),this.addChild(this._overlayYAxisView)}getName(){return Z.Y_AXIS}updateMain(t){const e=this.getPane().getOptions().state==="minimize";this._yAxisView.draw(t,e),e||(this.getPane().getAxisComponent().isInCandle()&&this._candleLastPriceLabelView.draw(t),this._indicatorLastValueView.draw(t))}updateOverlay(t){this.getPane().getOptions().state!=="minimize"&&(this._overlayYAxisView.draw(t),this._crosshairHorizontalLabelView.draw(t))}}function bs(){return{from:0,to:0,range:0,realFrom:0,realTo:0,realRange:0,displayFrom:0,displayTo:0,displayRange:0}}class Pa{constructor(t){this.scrollZoomEnabled=!0,this._range=bs(),this._prevRange=bs(),this._ticks=[],this._autoCalcTickFlag=!0,this._parent=t}getParent(){return this._parent}buildTicks(t){return this._autoCalcTickFlag&&(this._range=this.createRangeImp()),this._prevRange.from!==this._range.from||this._prevRange.to!==this._range.to||t?(this._prevRange=this._range,this._ticks=this.createTicksImp(),!0):!1}getTicks(){return this._ticks}setRange(t){this._autoCalcTickFlag=!1,this._range=t}getRange(){return this._range}setAutoCalcTickFlag(t){this._autoCalcTickFlag=t}getAutoCalcTickFlag(){return this._autoCalcTickFlag}}const Ln=8;class Pt extends Pa{constructor(t,e){super(t),this.reverse=!1,this.inside=!1,this.position="right",this.gap={top:.05,bottom:.03},this.createRange=n=>n.defaultRange,this.minSpan=n=>It(-n),this.valueToRealValue=n=>n,this.realValueToDisplayValue=n=>n,this.displayValueToRealValue=n=>n,this.realValueToValue=n=>n,this.displayValueToText=(n,r)=>ke(n,r),this.override(e)}override(t){const{name:e,gap:n,...r}=t;se(this.name)||(this.name=e),Se(this.gap,n),Se(this,r)}createRangeImp(){const t=this.getParent(),e=t.getChart(),n=e.getChartStore(),r=t.getId();let s=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,l=!1,c=Number.MAX_SAFE_INTEGER,a=Number.MIN_SAFE_INTEGER,h=Number.MAX_SAFE_INTEGER;const f=n.getIndicatorsByPaneId(r);f.forEach(B=>{l||=B.shouldOhlc,h=Math.min(h,B.precision),L(B.minValue)&&(c=Math.min(c,B.minValue)),L(B.maxValue)&&(a=Math.max(a,B.maxValue))}),n.getScriptsByPaneId(r).forEach(B=>{if(B._default?.min!==void 0&&B._default?.min!==null?c=Math.min(c,B._default.min):L(B.minValue)&&(c=Math.min(c,B.minValue)),B._default?.max!==void 0&&B._default?.max!==null?a=Math.max(a,B._default.max):L(B.maxValue)&&(a=Math.max(a,B.maxValue)),B.precision!==null&&B.precision!==void 0){if(typeof B.precision=="number")h=Math.min(h,B.precision);else if(B.precision==="price"){const V=n.getSymbol()?.pricePrecision??2;h=Math.min(h,V)}else if(B.precision==="volume"){const V=n.getSymbol()?.volumePrecision??2;h=Math.min(h,V)}}});let u=4;const p=this.isInCandle();if(p){const B=n.getSymbol()?.pricePrecision??2;h!==Number.MAX_SAFE_INTEGER?u=Math.min(h,B):u=B}else h!==Number.MAX_SAFE_INTEGER&&(u=h);if(c!==Number.MAX_SAFE_INTEGER&&a!==Number.MIN_SAFE_INTEGER)s=c,o=a;else{const B=n.getVisibleRangeDataList(),V=e.getStyles().candle,R=V.type==="area"||V.type==="price_line",W=V.area.value,F=p&&!R||!p&&l;B.forEach(Y=>{const O=Y.dataIndex,z=Y.data.current;if(H(z)&&(F&&(s=Math.min(s,z.low),o=Math.max(o,z.high)),p&&R)){const N=z[W];L(N)&&(s=Math.min(s,N),o=Math.max(o,N))}f.forEach(({result:N,figures:$})=>{const q=N[O]??{};$.forEach(j=>{if(j.affectAxis===!1)return;const K=q[j.key];L(K)&&(s=Math.min(s,K),o=Math.max(o,K))})})})}const x=o-s,g={from:s,to:o,range:x,realFrom:s,realTo:o,realRange:x,displayFrom:s,displayTo:o,displayRange:x},m=this.createRange({chart:e,paneId:r,defaultRange:g});let y=m.realFrom,v=m.realTo,_=m.realRange;const w=this.minSpan(u);if(y===v||_<w){const B=c===y,V=a===v,R=Ln/2;y=B?y:V?y-Ln*w:y-R*w,v=V?v:B?v+Ln*w:v+R*w}const b=this.getBounding().height,{top:C,bottom:M}=this.gap;let T=C;T>=1&&(T=T/b);let S=M;S>=1&&(S=S/b),_=v-y,y=y-_*S,v=v+_*T;const E=this.realValueToValue(y,{range:m}),I=this.realValueToValue(v,{range:m}),k=this.realValueToDisplayValue(y,{range:m}),P=this.realValueToDisplayValue(v,{range:m});return{from:E,to:I,range:I-E,realFrom:y,realTo:v,realRange:v-y,displayFrom:k,displayTo:P,displayRange:P-k}}isInCandle(){return this.getParent().getId()===Q.CANDLE}isFromZero(){return this.position==="left"&&this.inside||this.position==="right"&&!this.inside}createTicksImp(){const t=this.getRange(),{displayFrom:e,displayTo:n,displayRange:r}=t,s=[];if(r>=0){const _=zl(r/Ln),w=Nl(_),b=rs(Math.ceil(e/_)*_,w),C=rs(Math.floor(n/_)*_,w);let M=0,T=b;if(_!==0)for(;T<=C;){const S=T.toFixed(w);s[M]={text:S,coord:0,value:S},++M,T+=_}}const o=this.getParent(),l=o.getYAxisWidget()?.getBounding().height??0,c=o.getChart().getChartStore(),a=[],h=c.getIndicatorsByPaneId(o.getId()),f=c.getScriptsByPaneId(o.getId()),d=c.getStyles();let u=0,p=!1;this.isInCandle()?u=c.getSymbol()?.pricePrecision??2:(h.forEach(_=>{u=Math.max(u,_.precision),p||=_.shouldFormatBigNumber}),f.forEach(_=>{if(_.precision!==null&&_.precision!==void 0){if(typeof _.precision=="number")u=Math.max(u,_.precision);else if(_.precision==="price"){const w=c.getSymbol()?.pricePrecision??2;u=Math.max(u,w)}else if(_.precision==="volume"){const w=c.getSymbol()?.volumePrecision??2;u=Math.max(u,w)}}}));const x=c.getInnerFormatter(),g=c.getThousandsSeparator(),m=c.getDecimalFold(),y=d.xAxis.tickText.size;let v=NaN;return s.forEach(({value:_})=>{let w=this.displayValueToText(+_,u);const b=this.convertToPixel(this.realValueToValue(this.displayValueToRealValue(+_,{range:t}),{range:t}));p&&(w=x.formatBigNumber(_)),w=m.format(g.format(w));const C=L(v);b>y&&b<l-y&&(C&&Math.abs(v-b)>y*2||!C)&&(a.push({text:w,coord:b,value:_}),v=b)}),Ve(this.createTicks)?this.createTicks({range:this.getRange(),bounding:this.getBounding(),defaultTicks:a}):a}getAutoSize(){const t=this.getParent(),n=t.getChart().getChartStore(),r=n.getStyles(),s=r.yAxis,o=s.size;if(o!=="auto")return o;let l=0;if(s.show&&(s.axisLine.show&&(l+=s.axisLine.size),s.tickLine.show&&(l+=s.tickLine.length),s.tickText.show)){let p=0;this.getTicks().forEach(x=>{p=Math.max(p,qe(x.text,s.tickText.size,s.tickText.weight,s.tickText.family))}),l+=s.tickText.marginStart+s.tickText.marginEnd+p}const c=r.candle.priceMark,a=c.show&&c.last.show&&c.last.text.show;let h=0;const f=r.crosshair,d=f.show&&f.horizontal.show&&f.horizontal.text.show;let u=0;if(a||d){const p=n.getSymbol()?.pricePrecision??2,x=this.getRange().displayTo;if(a){const g=n.getDataList(),m=g[g.length-1];if(H(m)){const{paddingLeft:y,paddingRight:v,size:_,family:w,weight:b}=c.last.text;h=y+qe(ke(m.close,p),_,b,w)+v;const C=n.getInnerFormatter().formatExtendText;c.last.extendTexts.forEach((M,T)=>{const S=C({type:"last_price",data:m,index:T});S.length>0&&M.show&&(h=Math.max(h,M.paddingLeft+qe(S,M.size,M.weight,M.family)+M.paddingRight))})}}if(d){const g=n.getIndicatorsByPaneId(t.getId());let m=0,y=!1;g.forEach(w=>{m=Math.max(w.precision,m),y||=w.shouldFormatBigNumber});let v=2;if(this.isInCandle()){const w=r.indicator.lastValueMark;w.show&&w.text.show?v=Math.max(m,p):v=p}else v=m;let _=ke(x,v);y&&(_=n.getInnerFormatter().formatBigNumber(_)),_=n.getDecimalFold().format(_),u+=f.horizontal.text.paddingLeft+f.horizontal.text.paddingRight+f.horizontal.text.borderSize*2+qe(_,f.horizontal.text.size,f.horizontal.text.weight,f.horizontal.text.family)}}return Math.max(l,h,u)}getBounding(){return this.getParent().getYAxisWidget().getBounding()}convertFromPixel(t){const e=this.getBounding().height,n=this.getRange(),{realFrom:r,realRange:s}=n,l=(this.reverse?t/e:1-t/e)*s+r;return this.realValueToValue(l,{range:n})}convertToPixel(t){const e=this.getRange(),n=this.valueToRealValue(t,{range:e}),r=this.getParent().getYAxisWidget()?.getBounding().height??0,{realFrom:s,realRange:o}=e,l=(n-s)/o;return this.reverse?Math.round(l*r):Math.round((1-l)*r)}convertToNicePixel(t){const e=this.getParent().getYAxisWidget()?.getBounding().height??0,n=this.convertToPixel(t);return Math.round(Math.max(e*.05,Math.min(n,e*.98)))}static extend(t){class e extends Pt{constructor(r){super(r,t)}}return e}}const Mh={name:"normal"},Dh={name:"percentage",minSpan:()=>Math.pow(10,-2),displayValueToText:i=>`${ke(i,2)}%`,valueToRealValue:(i,{range:t})=>(i-t.from)/t.range*t.realRange+t.realFrom,realValueToValue:(i,{range:t})=>(i-t.realFrom)/t.realRange*t.range+t.from,createRange:({chart:i,defaultRange:t})=>{const e=i.getDataList(),n=i.getVisibleRange(),r=e[n.from];if(H(r)){const{from:s,to:o,range:l}=t,c=(t.from-r.close)/r.close*100,a=(t.to-r.close)/r.close*100,h=a-c;return{from:s,to:o,range:l,realFrom:c,realTo:a,realRange:h,displayFrom:c,displayTo:a,displayRange:h}}return t}},kh={name:"logarithm",minSpan:i=>.05*It(-i),valueToRealValue:i=>i<0?-ut(Math.abs(i)):ut(i),realValueToDisplayValue:i=>i<0?-It(Math.abs(i)):It(i),displayValueToRealValue:i=>i<0?-ut(Math.abs(i)):ut(i),realValueToValue:i=>i<0?-It(Math.abs(i)):It(i),createRange:({defaultRange:i})=>{const{from:t,to:e,range:n}=i,r=t<0?-ut(Math.abs(t)):ut(t),s=e<0?-ut(Math.abs(e)):ut(e);return{from:t,to:e,range:n,realFrom:r,realTo:s,realRange:s-r,displayFrom:t,displayTo:e,displayRange:n}}},Bh={name:"script",gap:{top:0,bottom:0},createRange:({defaultRange:i})=>i},Cs={normal:Pt.extend(Mh),percentage:Pt.extend(Dh),logarithm:Pt.extend(kh),script:Pt.extend(Bh)};function Va(i){return Cs[i]??Cs.normal}class Fa{constructor(t,e){this._bounding=zi(),this._originalBounding=zi(),this._visible=!0,this._chart=t,this._id=e,this._container=xt("div",{width:"100%",margin:"0",padding:"0",position:"relative",overflow:"hidden",boxSizing:"border-box"})}getContainer(){return this._container}setVisible(t){this._visible!==t&&(this._container.style.display=t?"block":"none",this._visible=t)}getVisible(){return this._visible}getId(){return this._id}getChart(){return this._chart}getBounding(){return this._bounding}setOriginalBounding(t){Se(this._originalBounding,t)}getOriginalBounding(){return this._originalBounding}update(t){this._bounding.height!==this._container.clientHeight&&(this._container.style.height=`${this._bounding.height}px`),this.updateImp(t??J.Drawer,this._container,this._bounding)}destroy(){this._container.parentNode&&this._container.parentNode.removeChild(this._container)}}class Or extends Fa{constructor(t,e,n){super(t,e),this._yAxisWidget=null,this._options={id:"",minHeight:Qn,dragEnabled:!0,order:0,height:vr,state:"normal",axis:{name:"normal",scrollZoomEnabled:!0}};const r=this.getContainer();this._mainWidget=this.createMainWidget(r),this._yAxisWidget=this.createYAxisWidget(r),this.setOptions(n)}setOptions(t){const e=this.getId();if(e===Q.CANDLE||e===Q.X_AXIS){const o=t.axis?.name;(!H(this._axis)||H(o)&&this._options.axis.name!==o)&&(this._axis=this.createAxisComponent(o??"normal"))}else H(this._axis)||(this._axis=this.createAxisComponent("normal"));this._axis instanceof Pt&&this._axis.setAutoCalcTickFlag(!0),Se(this._options,t);const n={...this._options.axis};n.minSpan&&typeof n.minSpan=="function"&&(n.minSpan=n.minSpan),n.createRange&&typeof n.createRange=="function"&&(n.createRange=n.createRange),this._axis.override({...n,name:t.axis?.name??"normal"});let r=null,s="default";return this.getId()===Q.X_AXIS?(r=this.getMainWidget().getContainer(),s="ew-resize"):(r=this.getYAxisWidget().getContainer(),s="ns-resize"),t.axis?.scrollZoomEnabled??!0?r.style.cursor=s:r.style.cursor="default",this}getOptions(){return this._options}getAxisComponent(){return this._axis}setBounding(t,e,n,r){Se(this.getBounding(),t);const s={};H(t.height)&&(s.height=t.height),H(t.top)&&(s.top=t.top),this._mainWidget.setBounding(s);const o=H(e);return o&&this._mainWidget.setBounding(e),H(this._yAxisWidget)&&(this._yAxisWidget.setBounding(s),this._axis.position==="left"?H(n)&&this._yAxisWidget.setBounding({...n,left:0}):H(r)&&(this._yAxisWidget.setBounding(r),o&&this._yAxisWidget.setBounding({left:(e.left??0)+(e.width??0)+(e.right??0)-(r.width??0)}))),this}getMainWidget(){return this._mainWidget}getYAxisWidget(){return this._yAxisWidget}updateImp(t){this._mainWidget.update(t),this._yAxisWidget?.update(t)}destroy(){this._mainWidget.destroy(),this._yAxisWidget?.destroy(),super.destroy()}getImage(t){const{width:e,height:n}=this.getBounding(),r=xt("canvas",{width:`${e}px`,height:`${n}px`,boxSizing:"border-box"}),s=r.getContext("2d"),o=Ct(r);r.width=e*o,r.height=n*o,s.scale(o,o);const l=this._mainWidget.getBounding();if(s.drawImage(this._mainWidget.getImage(t),l.left,0,l.width,l.height),this._yAxisWidget!==null){const c=this._yAxisWidget.getBounding();s.drawImage(this._yAxisWidget.getImage(t),c.left,0,c.width,c.height)}return r}createYAxisWidget(t){return null}}class Ra extends Or{createAxisComponent(t){const e=Va(t??"default");return new e(this)}createMainWidget(t){return new _a(t,this)}createYAxisWidget(t){return new Ia(t,this)}}class Th extends Ra{createMainWidget(t){return new Ch(t,this)}}class Ih extends We{constructor(t){super(t),this._activeFeatureInfo=null,this._featureClickEvent=(e,n)=>()=>{const r=this.getWidget().getPane();return n.script?r.getChart().getChartStore().executeAction("onScriptTooltipFeatureClick",n):r.getChart().getChartStore().executeAction(e,n),!0},this._featureMouseMoveEvent=e=>()=>(this._activeFeatureInfo=e,!0),this.registerEvent("mouseMoveEvent",e=>(this._isMouseInScriptButtons(e)||(this._activeFeatureInfo=null),!1)),this.registerEvent("mouseClickEvent",e=>!!this._isMouseInScriptButtons(e))}getName(){return Z.SCRIPT}_isMouseInScriptButtons(t){const e=this.getWidget(),n=e.getPane(),r=n.getChart().getChartStore(),s=r.getCrosshair();if(!H(s.kLineData))return!1;const o=e.getBounding(),l=r.getScriptsByPaneId(n.getId()),{offsetLeft:c,offsetTop:a,offsetRight:h}=r.getStyles().indicator.tooltip;let f=a;const d=c;o.width-h;for(const u of l){const p=this.getScriptTooltipData(u),{features:x}=p,g=p.name.length>0,m=p.legends.length>0,y=p.features.length>0;if(g||m||y){const v=this.classifyTooltipFeatures(p.features),_={x:d,y:f};if(v[0].length>0){const w={x:_.x,y:_.y};if(this._checkFeaturesInCoordinate(t,v[0],w,u,o))return!0;_.x=w.x}if(v[1].length>0){const w={x:_.x,y:_.y};if(this._checkFeaturesInCoordinate(t,v[1],w,u,o))return!0;_.x=w.x}if(v[2].length>0){const w={x:_.x,y:_.y};if(this._checkFeaturesInCoordinate(t,v[2],w,u,o))return!0;_.x=w.x}f+=20}}return!1}_checkFeaturesInCoordinate(t,e,n,r,s){for(const o of e){const{marginLeft:l=0,marginTop:c=0,marginRight:a=0,paddingLeft:h=0,paddingTop:f=0,paddingRight:d=0,paddingBottom:u=0,size:p=10}=o,x=s.left+n.x+l,g=s.top+n.y+c,m=p,y=p;if(t.x>=x&&t.x<=x+m&&t.y>=g&&t.y<=g+y)return this._activeFeatureInfo={paneId:this.getWidget().getPane().getId(),script:r,feature:o},!0;n.x+=l+h+p+d+a}return!1}checkEventOn(t){const s=this.getWidget().getPane().getChart().getChartStore().getCrosshair();return H(s.kLineData)?this._isMouseInScriptButtons(t):!1}drawImp(t){const e=this.getWidget(),r=e.getPane().getChart().getChartStore(),s=r.getCrosshair();if(H(s.kLineData)){const o=e.getBounding(),{offsetLeft:l,offsetTop:c,offsetRight:a}=r.getStyles().indicator.tooltip;this.drawScriptTooltip(t,l,c,o.width-a)}}drawScriptTooltip(t,e,n,r){const s=this.getWidget().getPane(),o=s.getChart().getChartStore(),c=o.getStyles().indicator.tooltip;if(this.isDrawTooltip(o.getCrosshair(),c)){const a=o.getScriptsByPaneId(s.getId()),h=c.title,f=c.legend;return a.forEach(d=>{let u=0;const p={x:e,y:n},x=this.getScriptTooltipData(d),g=x.name.length>0,m=x.legends.length>0,y=x.features.length>0;if(g||m||y){const v=this.classifyTooltipFeatures(x.features);if(u=this.drawStandardTooltipFeatures(t,v[0],p,d,e,u,r),g){const _=h.color;u=this.drawStandardTooltipLegends(t,[{title:{text:"",color:_},value:{text:x.name,color:_}}],p,e,u,r,h)}u=this.drawStandardTooltipFeatures(t,v[1],p,d,e,u,r),m&&d.visible&&(u=this.drawStandardTooltipLegends(t,x.legends,p,e,u,r,f)),u=this.drawStandardTooltipFeatures(t,v[2],p,d,e,u,r),n=p.y+u}}),n}return 0}drawStandardTooltipFeatures(t,e,n,r,s,o,l){if(e.length===0)return 0;const a=this.getWidget().getPane().getId();return e.forEach(h=>{const{marginLeft:f=0,marginTop:d=0,marginRight:u=0,paddingLeft:p=0,paddingTop:x=0,paddingRight:g=0,paddingBottom:m=0,backgroundColor:y,activeBackgroundColor:v,borderRadius:_,size:w=10,color:b,activeColor:C,type:M,content:T}=h;let S=b,E=y;this._activeFeatureInfo?.paneId===a&&this._activeFeatureInfo.script?.key===r?.key&&this._activeFeatureInfo.feature.id===h.id&&(S=C??b,E=v??y);const I={paneId:a,script:r||void 0,feature:h},k={mouseClickEvent:this._featureClickEvent("onScriptTooltipFeatureClick",I),mouseMoveEvent:this._featureMouseMoveEvent(I)};let P=0;if(M==="icon_font"){const B=T;this.createFigure({name:"rect",attrs:{x:n.x+f,y:n.y+d,width:w,height:w},styles:{paddingLeft:p,paddingTop:x,paddingRight:g,paddingBottom:m,borderRadius:_,backgroundColor:E}},k)?.draw(t),t.save(),t.font=`${w}px ${B.family}`,t.fillStyle=S,t.textAlign="center",t.textBaseline="middle",t.fillText(B.code,n.x+f+w/2,n.y+d+w/2),t.restore(),P=w}else this.createFigure({name:"rect",attrs:{x:n.x+f,y:n.y+d,width:w,height:w},styles:{paddingLeft:p,paddingTop:x,paddingRight:g,paddingBottom:m,borderRadius:_,color:S,backgroundColor:E}},k)?.draw(t),P=w;n.x+=f+p+P+g+u}),20}drawStandardTooltipFeature(t,e,n,r,s,o,l,c,a){const{x:h,y:f}=n,{content:d}=e,u=f-1;if(a&&this.createFigure({name:"rect",attrs:{x:h,y:u,width:s,height:o},styles:{backgroundColor:"transparent"}},a)?.draw(t),d&&"path"in d){t.save(),t.translate(h+c,u+c),t.scale(l/16,l/16);const p=new Path2D(d.path);t.fillStyle=e.color,t.fill(p),t.restore()}else d&&"code"in d&&(t.save(),t.translate(h+c,u+c),t.scale(l/16,l/16),t.fillStyle=e.color,t.font=`${l}px iconfont`,t.textAlign="center",t.textBaseline="middle",t.fillText(d.code,l/2,l/2),t.restore())}drawStandardTooltipLegends(t,e,n,r,s,o,l){if(e.length>0){const{marginLeft:c,marginTop:a,marginRight:h,marginBottom:f,size:d,family:u,weight:p}=l;t.font=pt(d,p,u),e.forEach(x=>{const g=x.title,m=x.value,y=t.measureText(g.text).width,v=t.measureText(m.text).width,_=y+v,w=a+d+f;n.x+c+_+h>o?(n.x=r,n.y+=s,s=w):s=Math.max(s,w),g.text.length>0&&this.createFigure({name:"text",attrs:{x:n.x+c,y:n.y+a,text:g.text},styles:{color:g.color,size:d,family:u,weight:p}})?.draw(t),this.createFigure({name:"text",attrs:{x:n.x+c+y,y:n.y+a,text:m.text},styles:{color:m.color,size:d,family:u,weight:p}})?.draw(t),n.x+=c+_+h})}return s}isDrawTooltip(t,e){const n=e.showRule;return n==="always"||n==="follow_cross"&&se(t.paneId)}getScriptTooltipData(t){let e;if(t.createTooltipDataSource){const n=t.createTooltipDataSource({script:t});e={name:n.name||t.name||"Script",inputsText:n.inputsText||"",legends:n.legends||[],features:n.features||[]}}else e={name:t.name||"Script",inputsText:"",legends:[],features:[]};if(t.tooltipTools&&Array.isArray(t.tooltipTools)&&t.tooltipTools.length>0){const s=this.getWidget().getPane().getChart().getChartStore().getCrosshair().dataIndex,o=t.tooltipTools.map(l=>{let c="N/A",a=!1;if(Array.isArray(l.dataSource)&&l.dataSource.length>0){const u=l.dataSource[s??0]||l.dataSource[l.dataSource.length-1];u!=null&&!isNaN(u)&&(c=String(u),a=!0)}else if(!Array.isArray(l.dataSource)){const u=l.dataSource;if(u!=null)if(typeof u=="string"){const p=parseFloat(u);!isNaN(p)&&isFinite(p)?(c=String(p),a=!0):(c=u,a=!0)}else typeof u=="number"&&!isNaN(u)&&isFinite(u)&&(c=String(u),a=!0)}const h=l.style?.color||l.valueColor||"#333",f=l.precision;let d=c;return a&&f!==null&&f!==void 0?d=Number(c).toFixed(f):a&&(d=String(c)),{title:{text:l.label+":",color:h},value:{text:d,color:h}}});e.legends=[...e.legends,...o]}return e}classifyTooltipFeatures(t){const e=[],n=[],r=[];return t.forEach(s=>{const{position:o}=s;switch(o){case"left":{e.push(s);break}case"right":{r.push(s);break}default:{n.push(s);break}}}),[e,n,r]}}const Xi=class Xi extends ji{constructor(t,e){super(t,e),this._gridView=new xa(this),this._scriptView=new va(this),this._crosshairLineView=new ma(this),this._tooltipView=this.createTooltipView(),this._overlayView=new Wr(this),this.instanceId=++Xi.instanceCount,this.addChild(this._overlayView),this.addChild(this._tooltipView)}getName(){return Z.SCRIPT}updateMain(t){this.getPane().getOptions().state!=="minimize"&&(this.updateMainContent(t),this._scriptView.draw(t),this._gridView.draw(t))}createTooltipView(){return new Ih(this)}updateMainContent(t){this.getPane().getChart(),this.getPane().getId()}updateOverlayContent(t){}updateOverlay(t){this.getPane().getOptions().state!=="minimize"&&(this._overlayView.draw(t),this._crosshairLineView.draw(t),this.updateOverlayContent(t)),this._tooltipView.draw(t)}checkEventOn(t){return this._isMouseInScriptButtons(t)}dispatchEvent(t,e){const n=this._children||[];for(const r of n)if(r.dispatchEvent&&r.dispatchEvent(t,e))return!0;return!1}_isMouseInScriptButtons(t){const e=this.getPane(),n=e.getChart().getChartStore(),r=n.getCrosshair();if(!H(r.kLineData))return!1;const s=n.getScriptsByPaneId(e.getId());if(s.length===0)return!1;const o=this.getBounding();for(const l of s){const c=this._tooltipView.getScriptTooltipData(l),{features:a}=c;let h={x:0,y:0};for(const f of a){const{marginLeft:d=0,marginTop:u=0,marginRight:p=0,paddingLeft:x=0,paddingTop:g=0,paddingRight:m=0,paddingBottom:y=0,size:v=10}=f,_=o.left+h.x+d,w=o.top+h.y+u,b=v,C=v;if(t.x>=_&&t.x<=_+b&&t.y>=w&&t.y<=w+C)return!0;h.x+=d+x+v+m+p}}return!1}};Xi.instanceCount=0;let wr=Xi;class Ph extends Or{createAxisComponent(t){const e=Va(t??"default");return new e(this)}createMainWidget(t){return new wr(t,this)}createYAxisWidget(t){return new Ia(t,this)}}class Vh extends ka{getAxisStyles(t){return t.xAxis}createAxisLine(t){return{coordinates:[{x:0,y:0},{x:t.width,y:0}]}}createTickLines(t,e,n){const r=n.tickLine,s=n.axisLine.size;return t.map(o=>({coordinates:[{x:o.coord,y:0},{x:o.coord,y:s+r.length}]}))}createTickTexts(t,e,n){const r=n.tickText,s=n.axisLine.size,o=n.tickLine.length;return t.map(l=>({x:l.coord,y:s+o+r.marginStart,text:l.text,align:"center",baseline:"top"}))}}class Fh extends Ba{coordinateToPointTimestampDataIndexFlag(){return!0}coordinateToPointValueFlag(){return!1}getCompleteOverlays(){return this.getWidget().getPane().getChart().getChartStore().getOverlaysByPaneId()}getProgressOverlay(){return this.getWidget().getPane().getChart().getChartStore().getProgressOverlayInfo()?.overlay??null}getDefaultFigures(t,e){const n=[],r=this.getWidget(),o=r.getPane().getChart().getChartStore(),l=o.getClickOverlayInfo();if(t.needDefaultXAxisFigure&&t.id===l.overlay?.id){let c=Number.MAX_SAFE_INTEGER,a=Number.MIN_SAFE_INTEGER;e.forEach((h,f)=>{c=Math.min(c,h.x),a=Math.max(a,h.x);const d=t.points[f];if(L(d.timestamp)){const u=o.getInnerFormatter().formatDate(d.timestamp,"YYYY-MM-DD HH:mm","crosshair");n.push({type:"text",attrs:{x:h.x,y:0,text:u,align:"center"},ignoreEvent:!0})}}),e.length>1&&n.unshift({type:"rect",attrs:{x:c,y:0,width:a-c,height:r.getBounding().height},ignoreEvent:!0})}return n}getFigures(t,e){const n=this.getWidget(),r=n.getPane(),s=r.getChart(),o=r.getAxisComponent(),l=s.getXAxisPane().getAxisComponent(),c=n.getBounding();return t.createXAxisFigures?.({chart:s,overlay:t,coordinates:e,bounding:c,xAxis:l,yAxis:o})??[]}}class Rh extends Ta{compare(t){return H(t.timestamp)}getDirectionStyles(t){return t.vertical}getText(t,e){const n=t.timestamp;return e.getInnerFormatter().formatDate(n,wa[e.getPeriod()?.type??"day"],"crosshair")}getTextAttrs(t,e,n,r,s,o){const l=n.realX;let c=0,a="center";l-e/2-o.paddingLeft<0?(c=0,a="left"):l+e/2+o.paddingRight>r.width?(c=r.width,a="right"):c=l;const h=o.size+(o.paddingTop??0)+(o.paddingBottom??0),d=r.height-h-4;return{x:c,y:d,text:t,align:a,baseline:"top"}}}class zh extends ji{constructor(t,e){super(t,e),this._xAxisView=new Vh(this),this._overlayXAxisView=new Fh(this),this._crosshairVerticalLabelView=new Rh(this),this.setCursor("ew-resize"),this.addChild(this._overlayXAxisView)}getName(){return Z.X_AXIS}updateMain(t){this._xAxisView.draw(t)}updateOverlay(t){this._overlayXAxisView.draw(t),this._crosshairVerticalLabelView.draw(t)}}class Hr extends Pa{constructor(t,e){super(t),this.override(e)}override(t){const{name:e,scrollZoomEnabled:n,createTicks:r}=t;se(this.name)||(this.name=e),this.scrollZoomEnabled=n??this.scrollZoomEnabled,this.createTicks=r??this.createTicks}createRangeImp(){const e=this.getParent().getChart().getChartStore().getVisibleRange(),{realFrom:n,realTo:r}=e,s=n,o=r,l=r-n+1;return{from:s,to:o,range:l,realFrom:s,realTo:o,realRange:l,displayFrom:s,displayTo:o,displayRange:l}}createTicksImp(){const{realFrom:t,realTo:e,from:n}=this.getRange(),r=this.getParent().getChart().getChartStore(),s=r.getInnerFormatter().formatDate,o=r.getPeriod(),l=[],c=r.getBarSpace().bar,a=r.getStyles().xAxis.tickText,h=Math.max(qe("YYYY-MM-DD HH:mm:ss",a.size,a.weight,a.family),this.getBounding().width/8);let f=Math.ceil(h/c);f%2!==0&&(f+=1);const d=Math.max(0,Math.floor(t/f)*f);for(let u=d;u<e;u+=f)if(u>=n){const p=r.dataIndexToTimestamp(u);L(p)&&l.push({coord:this.convertToPixel(u),value:p,text:s(p,K0[o?.type??"day"],"xAxis")})}return Ve(this.createTicks)?this.createTicks({range:this.getRange(),bounding:this.getBounding(),defaultTicks:l}):l}getAutoSize(){const t=this.getParent().getChart().getStyles(),e=t.xAxis,n=e.size;if(n!=="auto")return n;const r=t.crosshair;let s=0;e.show&&(e.axisLine.show&&(s+=e.axisLine.size),e.tickLine.show&&(s+=e.tickLine.length),e.tickText.show&&(s+=e.tickText.marginStart+e.tickText.marginEnd+e.tickText.size));let o=0;return r.show&&r.vertical.show&&r.vertical.text.show&&(o+=r.vertical.text.paddingTop+r.vertical.text.paddingBottom+r.vertical.text.borderSize*2+r.vertical.text.size),Math.max(s,o)}getBounding(){return this.getParent().getMainWidget().getBounding()}convertTimestampFromPixel(t){const e=this.getParent().getChart().getChartStore(),n=e.coordinateToDataIndex(t);return e.dataIndexToTimestamp(n)}convertTimestampToPixel(t){const e=this.getParent().getChart().getChartStore(),n=e.timestampToDataIndex(t);return e.dataIndexToCoordinate(n)}convertFromPixel(t){return this.getParent().getChart().getChartStore().coordinateToDataIndex(t)}convertToPixel(t){return this.getParent().getChart().getChartStore().dataIndexToCoordinate(t)}static extend(t){class e extends Hr{constructor(r){super(r,t)}}return e}}const Nh={name:"normal"},As={normal:Hr.extend(Nh)};function Wh(i){return As[i]??As.normal}class Oh extends Or{createAxisComponent(t){const e=Wh(t);return new e(this)}createMainWidget(t){return new zh(t,this)}}function Hh(i,t){let e=0;return function(){const n=Date.now();n-e>t&&(i.apply(this,arguments),e=n)}}class $h extends oa{constructor(t,e){super(t,e),this._dragFlag=!1,this._dragStartY=0,this._topPaneHeight=0,this._bottomPaneHeight=0,this._topPane=null,this._bottomPane=null,this._pressedMouseMoveEvent=Hh(this._pressedTouchMouseMoveEvent,20),this.registerEvent("touchStartEvent",this._mouseDownEvent.bind(this)).registerEvent("touchMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("touchEndEvent",this._mouseUpEvent.bind(this)).registerEvent("mouseDownEvent",this._mouseDownEvent.bind(this)).registerEvent("mouseUpEvent",this._mouseUpEvent.bind(this)).registerEvent("pressedMouseMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("mouseEnterEvent",this._mouseEnterEvent.bind(this)).registerEvent("mouseLeaveEvent",this._mouseLeaveEvent.bind(this))}getName(){return Z.SEPARATOR}_mouseDownEvent(t){this._dragFlag=!0,this._dragStartY=t.pageY;const e=this.getPane(),n=e.getChart();this._topPane=e.getTopPane(),this._bottomPane=e.getBottomPane();const r=n.getDrawPanes();if(this._topPane.getOptions().state==="minimize"){const s=r.findIndex(o=>o.getId()===this._topPane?.getId());for(let o=s-1;o>-1;o--){const l=r[o];if(l.getOptions().state!=="minimize"){this._topPane=l;break}}}if(this._bottomPane.getOptions().state==="minimize"){const s=r.findIndex(o=>o.getId()===this._bottomPane?.getId());for(let o=s+1;o<r.length;o++){const l=r[o];if(l.getOptions().state!=="minimize"){this._bottomPane=l;break}}}return this._topPaneHeight=this._topPane.getBounding().height,this._bottomPaneHeight=this._bottomPane.getBounding().height,!0}_mouseUpEvent(){return this._dragFlag=!1,this._topPane=null,this._bottomPane=null,this._topPaneHeight=0,this._bottomPaneHeight=0,this._mouseLeaveEvent()}_pressedTouchMouseMoveEvent(t){const e=t.pageY-this._dragStartY,n=e<0;if(H(this._topPane)&&H(this._bottomPane)){const r=this._bottomPane.getOptions();if(this._topPane.getOptions().state!=="minimize"&&r.state!=="minimize"&&r.dragEnabled){let s=null,o=null,l=0,c=0;n?(s=this._topPane,o=this._bottomPane,l=this._topPaneHeight,c=this._bottomPaneHeight):(s=this._bottomPane,o=this._topPane,l=this._bottomPaneHeight,c=this._topPaneHeight);const a=s.getOptions().minHeight;if(l>a){const h=Math.max(l-Math.abs(e),a),f=l-h;s.setBounding({height:h}),o.setBounding({height:c+f});const d=this.getPane(),u=d.getChart();u.getChartStore().executeAction("onPaneDrag",{paneId:d.getId()}),u.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}}}return!0}_mouseEnterEvent(){const t=this.getPane();if(t.getBottomPane().getOptions().dragEnabled){const r=t.getChart().getStyles().separator;return this.getContainer().style.background=r.activeBackgroundColor,!0}return!1}_mouseLeaveEvent(){return this._dragFlag?!1:(this.getContainer().style.background="transparent",!0)}createContainer(){return xt("div",{width:"100%",height:`${_n}px`,margin:"0",padding:"0",position:"absolute",top:"-3px",zIndex:"20",boxSizing:"border-box",cursor:"ns-resize"})}updateImp(t,e,n){if(n===J.All||n===J.Separator){const r=this.getPane().getChart().getStyles().separator;t.style.top=`${-Math.floor((_n-r.size)/2)}px`,t.style.height=`${_n}px`}}}class Yh extends Fa{constructor(t,e,n,r){super(t,e),this.getContainer().style.overflow="",this._topPane=n,this._bottomPane=r,this._separatorWidget=new $h(this.getContainer(),this)}setBounding(t){return Se(this.getBounding(),t),this}getTopPane(){return this._topPane}setTopPane(t){return this._topPane=t,this}getBottomPane(){return this._bottomPane}setBottomPane(t){return this._bottomPane=t,this}getWidget(){return this._separatorWidget}getImage(t){const{width:e,height:n}=this.getBounding(),r=this.getChart().getStyles().separator,s=xt("canvas",{width:`${e}px`,height:`${n}px`,boxSizing:"border-box"}),o=s.getContext("2d"),l=Ct(s);return s.width=e*l,s.height=n*l,o.scale(l,l),o.fillStyle=r.color,o.fillRect(0,0,e,n),s}updateImp(t,e,n){if(t===J.All||t===J.Separator){const r=this.getChart().getStyles().separator;e.style.backgroundColor=r.color,e.style.height=`${n.height}px`,e.style.marginLeft=`${n.left}px`,e.style.width=`${n.width}px`,this._separatorWidget.update(t)}}}function Ss(){return typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes("firefox")}function ir(){return typeof window>"u"?!1:/iPhone|iPad|iPod|iOS/.test(window.navigator.userAgent)}const Un={ResetClick:500,LongTap:500,PreventFiresTouchEvents:500},Zt={CancelClick:5,CancelTap:5,DoubleClick:5,DoubleTap:30},xn={Left:0,Middle:1,Right:2},Xh=10;class Lh{constructor(t,e,n){this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartCoordinate=null,this._touchMoveStartCoordinate=null,this._touchMoveExceededManhattanDistance=!1,this._cancelClick=!1,this._cancelTap=!1,this._unsubscribeOutsideMouseEvents=null,this._unsubscribeOutsideTouchEvents=null,this._unsubscribeMobileSafariEvents=null,this._unsubscribeMousemove=null,this._unsubscribeMouseWheel=null,this._unsubscribeContextMenu=null,this._unsubscribeRootMouseEvents=null,this._unsubscribeRootTouchEvents=null,this._startPinchMiddleCoordinate=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventTouchDragProcess=!1,this._mousePressed=!1,this._lastTouchEventTimeStamp=0,this._activeTouchId=null,this._acceptMouseLeave=!ir(),this._onFirefoxOutsideMouseUp=r=>{this._mouseUpHandler(r)},this._onMobileSafariDoubleClick=r=>{if(this._firesTouchEvents(r)){if(++this._tapCount,this._tapTimeoutId!==null&&this._tapCount>1){const{manhattanDistance:s}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(r),this._tapCoordinate);s<Zt.DoubleTap&&!this._cancelTap&&this._processEvent(this._makeCompatEvent(r),this._handler.doubleTapEvent),this._resetTapTimeout()}}else if(++this._clickCount,this._clickTimeoutId!==null&&this._clickCount>1){const{manhattanDistance:s}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(r),this._clickCoordinate);s<Zt.DoubleClick&&!this._cancelClick&&this._processEvent(this._makeCompatEvent(r),this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}},this._target=t,this._handler=e,this._options=n,this._init()}destroy(){this._unsubscribeOutsideMouseEvents!==null&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),this._unsubscribeOutsideTouchEvents!==null&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),this._unsubscribeMousemove!==null&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),this._unsubscribeMouseWheel!==null&&(this._unsubscribeMouseWheel(),this._unsubscribeMouseWheel=null),this._unsubscribeContextMenu!==null&&(this._unsubscribeContextMenu(),this._unsubscribeContextMenu=null),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),this._unsubscribeMobileSafariEvents!==null&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()}_mouseEnterHandler(t){this._unsubscribeMousemove?.(),this._unsubscribeContextMenu?.();const e=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=()=>{this._target.removeEventListener("mousemove",e)},this._target.addEventListener("mousemove",e);const n=this._contextMenuHandler.bind(this);this._unsubscribeContextMenu=()=>{this._target.removeEventListener("contextmenu",n)},this._target.addEventListener("contextmenu",n,{passive:!1}),!this._firesTouchEvents(t)&&(this._processEvent(this._makeCompatEvent(t),this._handler.mouseEnterEvent),this._acceptMouseLeave=!0)}_resetClickTimeout(){this._clickTimeoutId!==null&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_resetTapTimeout(){this._tapTimeoutId!==null&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_mouseMoveHandler(t){this._mousePressed||this._touchMoveStartCoordinate!==null||this._firesTouchEvents(t)||(this._processEvent(this._makeCompatEvent(t),this._handler.mouseMoveEvent),this._acceptMouseLeave=!0)}_mouseWheelHandler(t){const e=this._target.getBoundingClientRect(),n=t.clientX,r=t.clientY;if(n<e.left||n>e.right||r<e.top||r>e.bottom)return;const s=t.target,o=t.currentTarget,l=s&&this._target.contains(s),c=o===this._target;if(!(!l&&!c))if(t.stopImmediatePropagation(),this._preventDefault(t),Math.abs(t.deltaX)>Math.abs(t.deltaY)){if(!H(this._handler.mouseWheelHortEvent)||Math.abs(t.deltaX)===0)return;this._handler.mouseWheelHortEvent(this._makeCompatEvent(t),-t.deltaX)}else{if(!H(this._handler.mouseWheelVertEvent))return;let a=-(t.deltaY/100);if(a===0)return;switch(t.deltaMode){case t.DOM_DELTA_PAGE:{a*=120;break}case t.DOM_DELTA_LINE:{a*=32;break}}if(a!==0){const h=Math.sign(a)*Math.min(1,Math.abs(a));this._handler.mouseWheelVertEvent(this._makeCompatEvent(t),h)}}}_contextMenuHandler(t){this._preventDefault(t)}_touchMoveHandler(t){const e=this._touchWithId(t.changedTouches,this._activeTouchId);if(e===null||(this._lastTouchEventTimeStamp=this._eventTimeStamp(t),this._startPinchMiddleCoordinate!==null)||this._preventTouchDragProcess)return;this._pinchPrevented=!0;const n=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._touchMoveStartCoordinate),{xOffset:r,yOffset:s,manhattanDistance:o}=n;if(!(!this._touchMoveExceededManhattanDistance&&o<Zt.CancelTap)){if(!this._touchMoveExceededManhattanDistance){const l=r*.5,c=s>=l&&!this._options.treatVertDragAsPageScroll(),a=l>s&&!this._options.treatHorzDragAsPageScroll();!c&&!a&&(this._preventTouchDragProcess=!0),this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}this._preventTouchDragProcess||this._processEvent(this._makeCompatEvent(t,e),this._handler.touchMoveEvent)}}_mouseMoveWithDownHandler(t){if(t.button!==xn.Left)return;const e=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._mouseMoveStartCoordinate),{manhattanDistance:n}=e;n>=Zt.CancelClick&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick&&this._processEvent(this._makeCompatEvent(t),this._handler.pressedMouseMoveEvent)}_mouseTouchMoveWithDownInfo(t,e){const n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y),s=n+r;return{xOffset:n,yOffset:r,manhattanDistance:s}}_touchEndHandler(t){let e=this._touchWithId(t.changedTouches,this._activeTouchId);if(e===null&&t.touches.length===0&&(e=t.changedTouches[0]),e===null)return;this._activeTouchId=null,this._lastTouchEventTimeStamp=this._eventTimeStamp(t),this._clearLongTapTimeout(),this._touchMoveStartCoordinate=null,this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);const n=this._makeCompatEvent(t,e);if(this._processEvent(n,this._handler.touchEndEvent),++this._tapCount,this._tapTimeoutId!==null&&this._tapCount>1){const{manhattanDistance:r}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._tapCoordinate);r<Zt.DoubleTap&&!this._cancelTap&&this._processEvent(n,this._handler.doubleTapEvent),this._resetTapTimeout()}else this._cancelTap||(this._processEvent(n,this._handler.tapEvent),H(this._handler.tapEvent)&&this._preventDefault(t));this._tapCount===0&&this._preventDefault(t),t.touches.length===0&&this._longTapActive&&(this._longTapActive=!1,this._preventDefault(t))}_mouseUpHandler(t){if(t.button!==xn.Left)return;const e=this._makeCompatEvent(t);if(this._mouseMoveStartCoordinate=null,this._mousePressed=!1,this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),Ss()&&this._target.ownerDocument.documentElement.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp),!this._firesTouchEvents(t))if(this._processEvent(e,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId!==null&&this._clickCount>1){const{manhattanDistance:n}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._clickCoordinate);n<Zt.DoubleClick&&!this._cancelClick&&this._processEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}else this._cancelClick||this._processEvent(e,this._handler.mouseClickEvent)}_clearLongTapTimeout(){this._longTapTimeoutId!==null&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}_touchStartHandler(t){if(this._activeTouchId!==null)return;const e=t.changedTouches[0];this._activeTouchId=e.identifier,this._lastTouchEventTimeStamp=this._eventTimeStamp(t);const n=this._target.ownerDocument.documentElement;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartCoordinate=this._getCoordinate(e),this._unsubscribeRootTouchEvents!==null&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);{const r=this._touchMoveHandler.bind(this),s=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=()=>{n.removeEventListener("touchmove",r),n.removeEventListener("touchend",s)},n.addEventListener("touchmove",r,{passive:!1}),n.addEventListener("touchend",s,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),Un.LongTap)}this._processEvent(this._makeCompatEvent(t,e),this._handler.touchStartEvent),this._tapTimeoutId===null&&(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),Un.ResetClick),this._tapCoordinate=this._getCoordinate(e))}_mouseDownHandler(t){if(t.button===xn.Right){this._preventDefault(t),this._processEvent(this._makeCompatEvent(t),this._handler.mouseRightClickEvent);return}if(t.button!==xn.Left)return;const e=this._target.ownerDocument.documentElement;Ss()&&e.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartCoordinate=this._getCoordinate(t),this._unsubscribeRootMouseEvents!==null&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);{const n=this._mouseMoveWithDownHandler.bind(this),r=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=()=>{e.removeEventListener("mousemove",n),e.removeEventListener("mouseup",r)},e.addEventListener("mousemove",n),e.addEventListener("mouseup",r)}this._mousePressed=!0,!this._firesTouchEvents(t)&&(this._processEvent(this._makeCompatEvent(t),this._handler.mouseDownEvent),this._clickTimeoutId===null&&(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),Un.ResetClick),this._clickCoordinate=this._getCoordinate(t)))}_init(){this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this));const t=this._mouseWheelHandler.bind(this);this._unsubscribeMouseWheel=()=>{this._target.removeEventListener("wheel",t,{passive:!1})},this._target.addEventListener("wheel",t,{passive:!1}),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));{const e=this._target.ownerDocument,n=r=>{this._handler.mouseDownOutsideEvent!=null&&(r.composed&&this._target.contains(r.composedPath()[0])||r.target!==null&&this._target.contains(r.target)||this._handler.mouseDownOutsideEvent({x:0,y:0,pageX:0,pageY:0}))};this._unsubscribeOutsideTouchEvents=()=>{e.removeEventListener("touchstart",n)},this._unsubscribeOutsideMouseEvents=()=>{e.removeEventListener("mousedown",n)},e.addEventListener("mousedown",n),e.addEventListener("touchstart",n,{passive:!0})}ir()&&(this._unsubscribeMobileSafariEvents=()=>{this._target.removeEventListener("dblclick",this._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick)),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._touchStartHandler.bind(this),{passive:!0}),this._target.addEventListener("mousedown",e=>{if(e.button===xn.Middle)return e.preventDefault(),!1}),this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",()=>{},{passive:!1})}_initPinch(){!H(this._handler.pinchStartEvent)&&!H(this._handler.pinchEvent)&&!H(this._handler.pinchEndEvent)||(this._target.addEventListener("touchstart",t=>{this._checkPinchState(t.touches)},{passive:!0}),this._target.addEventListener("touchmove",t=>{if(!(t.touches.length!==2||this._startPinchMiddleCoordinate===null)&&H(this._handler.pinchEvent)){const n=this._getTouchDistance(t.touches[0],t.touches[1])/this._startPinchDistance;this._handler.pinchEvent({...this._startPinchMiddleCoordinate,pageX:0,pageY:0},n),this._preventDefault(t)}},{passive:!1}),this._target.addEventListener("touchend",t=>{this._checkPinchState(t.touches)}))}_checkPinchState(t){t.length===1&&(this._pinchPrevented=!1),t.length!==2||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(t)}_startPinch(t){const e=this._target.getBoundingClientRect();this._startPinchMiddleCoordinate={x:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,y:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this._startPinchDistance=this._getTouchDistance(t[0],t[1]),H(this._handler.pinchStartEvent)&&this._handler.pinchStartEvent({x:0,y:0,pageX:0,pageY:0}),this._clearLongTapTimeout()}_stopPinch(){this._startPinchMiddleCoordinate!==null&&(this._startPinchMiddleCoordinate=null,H(this._handler.pinchEndEvent)&&this._handler.pinchEndEvent({x:0,y:0,pageX:0,pageY:0}))}_mouseLeaveHandler(t){this._unsubscribeMousemove?.(),this._unsubscribeContextMenu?.(),!this._firesTouchEvents(t)&&this._acceptMouseLeave&&(this._processEvent(this._makeCompatEvent(t),this._handler.mouseLeaveEvent),this._acceptMouseLeave=!ir())}_longTapHandler(t){const e=this._touchWithId(t.touches,this._activeTouchId);e!==null&&(this._processEvent(this._makeCompatEvent(t,e),this._handler.longTapEvent),this._cancelTap=!0,this._longTapActive=!0)}_firesTouchEvents(t){return H(t.sourceCapabilities?.firesTouchEvents)?t.sourceCapabilities.firesTouchEvents:this._eventTimeStamp(t)<this._lastTouchEventTimeStamp+Un.PreventFiresTouchEvents}_processEvent(t,e){e?.call(this._handler,t)}_makeCompatEvent(t,e){const n=e??t,r=this._target.getBoundingClientRect();return{x:n.clientX-r.left,y:n.clientY-r.top,pageX:n.pageX,pageY:n.pageY,isTouch:!t.type.startsWith("mouse")&&t.type!=="contextmenu"&&t.type!=="click"&&t.type!=="wheel",preventDefault:()=>{t.type!=="touchstart"&&this._preventDefault(t)}}}_getTouchDistance(t,e){const n=t.clientX-e.clientX,r=t.clientY-e.clientY;return Math.sqrt(n*n+r*r)}_preventDefault(t){t.cancelable&&t.preventDefault()}_getCoordinate(t){return{x:t.pageX,y:t.pageY}}_eventTimeStamp(t){return t.timeStamp??performance.now()}_touchWithId(t,e){for(let n=0;n<t.length;++n)if(t[n].identifier===e)return t[n];return null}}class Uh{constructor(t,e){this._flingStartTime=new Date().getTime(),this._flingScrollRequestId=null,this._startScrollCoordinate=null,this._touchCoordinate=null,this._touchCancelCrosshair=!1,this._touchZoomed=!1,this._pinchScale=1,this._mouseDownWidget=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._mouseMoveTriggerWidgetInfo={pane:null,widget:null},this._boundKeyBoardDownEvent=n=>{if(n.shiftKey)switch(n.code){case"Equal":{this._chart.getChartStore().zoom(.5);break}case"Minus":{this._chart.getChartStore().zoom(-.5);break}case"ArrowLeft":{const r=this._chart.getChartStore();r.startScroll(),r.scroll(-3*r.getBarSpace().bar);break}case"ArrowRight":{const r=this._chart.getChartStore();r.startScroll(),r.scroll(3*r.getBarSpace().bar);break}}},this._container=t,this._chart=e,this._event=new Lh(t,this,{treatVertDragAsPageScroll:()=>!1,treatHorzDragAsPageScroll:()=>!1}),t.addEventListener("keydown",this._boundKeyBoardDownEvent)}pinchStartEvent(){return this._touchZoomed=!0,this._pinchScale=1,!0}pinchEvent(t,e){const{pane:n,widget:r}=this._findWidgetByEvent(t);if(n?.getId()!==Q.X_AXIS&&r?.getName()===Z.MAIN){const s=this._makeWidgetEvent(t,r),o=(e-this._pinchScale)*5;return this._pinchScale=e,this._chart.getChartStore().zoom(o,{x:s.x,y:s.y}),!0}return!1}mouseWheelHortEvent(t,e){const n=this._chart.getChartStore();return n.startScroll(),n.scroll(e),!0}mouseWheelVertEvent(t,e){const{widget:n}=this._findWidgetByEvent(t),r=this._makeWidgetEvent(t,n),s=n?.getName();return s===Z.MAIN||s===Z.SCRIPT?(this._chart.getChartStore().zoom(e,{x:r.x,y:r.y}),!0):!1}mouseDownEvent(t){const{pane:e,widget:n}=this._findWidgetByEvent(t);if(this._mouseDownWidget=n,n!==null){const r=this._makeWidgetEvent(t,n);switch(n.getName()){case Z.SEPARATOR:return n.dispatchEvent("mouseDownEvent",r);case Z.MAIN:case Z.SCRIPT:{const o=e.getAxisComponent();if(!o.getAutoCalcTickFlag()){const l=o.getRange();this._prevYAxisRange={...l}}return this._startScrollCoordinate={x:r.x,y:r.y},this._chart.getChartStore().startScroll(),n.dispatchEvent("mouseDownEvent",r)}case Z.X_AXIS:return this._processXAxisScrollStartEvent(n,r);case Z.Y_AXIS:return this._processYAxisScaleStartEvent(n,r)}}return!1}mouseMoveEvent(t){const{pane:e,widget:n}=this._findWidgetByEvent(t),r=this._makeWidgetEvent(t,n);if((this._mouseMoveTriggerWidgetInfo.pane?.getId()!==e?.getId()||this._mouseMoveTriggerWidgetInfo.widget?.getName()!==n?.getName())&&(n?.dispatchEvent("mouseEnterEvent",r),this._mouseMoveTriggerWidgetInfo.widget?.dispatchEvent("mouseLeaveEvent",r),this._mouseMoveTriggerWidgetInfo={pane:e,widget:n}),n!==null)switch(n.getName()){case Z.MAIN:case Z.SCRIPT:{const o=n.dispatchEvent("mouseMoveEvent",r);let l={x:r.x,y:r.y,paneId:e?.getId()};return o?(n.getForceCursor()!=="pointer"&&(l=void 0),n.setCursor("pointer")):n.setCursor("crosshair"),this._chart.getChartStore().setCrosshair(l),o}case Z.SEPARATOR:case Z.X_AXIS:case Z.Y_AXIS:{const o=n.dispatchEvent("mouseMoveEvent",r);return this._chart.getChartStore().setCrosshair(),o}}return!1}pressedMouseMoveEvent(t){if(this._mouseDownWidget!==null&&this._mouseDownWidget.getName()===Z.SEPARATOR)return this._mouseDownWidget.dispatchEvent("pressedMouseMoveEvent",t);const{pane:e,widget:n}=this._findWidgetByEvent(t);if(n!==null&&this._mouseDownWidget?.getPane().getId()===e?.getId()&&this._mouseDownWidget?.getName()===n.getName()){const r=this._makeWidgetEvent(t,n);switch(n.getName()){case Z.MAIN:case Z.SCRIPT:{let o;const l=n.dispatchEvent("pressedMouseMoveEvent",r);return l||this._processMainScrollingEvent(n,r),(!l||n.getForceCursor()==="pointer")&&(o={x:r.x,y:r.y,paneId:e?.getId()}),this._chart.getChartStore().setCrosshair(o,{forceInvalidate:!0}),l}case Z.X_AXIS:return this._processXAxisScrollingEvent(n,r);case Z.Y_AXIS:return this._processYAxisScalingEvent(n,r)}}return!1}mouseUpEvent(t){const{widget:e}=this._findWidgetByEvent(t);let n=!1;if(e!==null){const r=this._makeWidgetEvent(t,e);switch(e.getName()){case Z.MAIN:case Z.SCRIPT:case Z.SEPARATOR:case Z.X_AXIS:case Z.Y_AXIS:{n=e.dispatchEvent("mouseUpEvent",r);break}}n&&this._chart.updatePane(J.Overlay)}return this._mouseDownWidget=null,this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,n}mouseClickEvent(t){const{widget:e}=this._findWidgetByEvent(t);if(H(e)){const n=this._makeWidgetEvent(t,e);switch(e.getName()){case Z.SCRIPT:return e.dispatchEvent("mouseClickEvent",n);case Z.MAIN:case Z.SEPARATOR:case Z.X_AXIS:case Z.Y_AXIS:return e.dispatchEvent("mouseClickEvent",n)}}return!1}mouseRightClickEvent(t){const{widget:e}=this._findWidgetByEvent(t);let n=!1;if(e!==null){const r=this._makeWidgetEvent(t,e);switch(e.getName()){case Z.MAIN:case Z.X_AXIS:case Z.Y_AXIS:{n=e.dispatchEvent("mouseRightClickEvent",r);break}}n&&this._chart.updatePane(J.Overlay)}return!1}mouseDoubleClickEvent(t){const{pane:e,widget:n}=this._findWidgetByEvent(t);if(n!==null)switch(n.getName()){case Z.MAIN:{const s=this._makeWidgetEvent(t,n);return n.dispatchEvent("mouseDoubleClickEvent",s)}case Z.Y_AXIS:{const s=e.getAxisComponent();if(!s.getAutoCalcTickFlag())return s.setAutoCalcTickFlag(!0),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0}),!0;break}}return!1}mouseLeaveEvent(){return this._chart.getChartStore().setCrosshair(),!0}touchStartEvent(t){const{pane:e,widget:n}=this._findWidgetByEvent(t);if(n!==null){const r=this._makeWidgetEvent(t,n);switch(r.preventDefault?.(),n.getName()){case Z.MAIN:{const o=this._chart.getChartStore();if(n.dispatchEvent("mouseDownEvent",r))return this._touchCancelCrosshair=!0,this._touchCoordinate=null,o.setCrosshair(void 0,{notInvalidate:!0}),this._chart.updatePane(J.Overlay),!0;this._flingScrollRequestId!==null&&(ts(this._flingScrollRequestId),this._flingScrollRequestId=null),this._flingStartTime=new Date().getTime();const l=e.getAxisComponent();if(!l.getAutoCalcTickFlag()){const c=l.getRange();this._prevYAxisRange={...c}}if(this._startScrollCoordinate={x:r.x,y:r.y},o.startScroll(),this._touchZoomed=!1,this._touchCoordinate!==null){const c=r.x-this._touchCoordinate.x,a=r.y-this._touchCoordinate.y;Math.sqrt(c*c+a*a)<Xh?(this._touchCoordinate={x:r.x,y:r.y},o.setCrosshair({x:r.x,y:r.y,paneId:e?.getId()})):(this._touchCoordinate=null,this._touchCancelCrosshair=!0,o.setCrosshair())}return!0}case Z.X_AXIS:return this._processXAxisScrollStartEvent(n,r);case Z.Y_AXIS:return this._processYAxisScaleStartEvent(n,r)}}return!1}touchMoveEvent(t){const{pane:e,widget:n}=this._findWidgetByEvent(t);if(n!==null){const r=this._makeWidgetEvent(t,n);r.preventDefault?.();const s=n.getName(),o=this._chart.getChartStore();switch(s){case Z.MAIN:return n.dispatchEvent("pressedMouseMoveEvent",r)?(o.setCrosshair(void 0,{notInvalidate:!0}),this._chart.updatePane(J.Overlay),!0):(this._touchCoordinate!==null?o.setCrosshair({x:r.x,y:r.y,paneId:e?.getId()}):this._processMainScrollingEvent(n,r),!0);case Z.X_AXIS:return this._processXAxisScrollingEvent(n,r);case Z.Y_AXIS:return this._processYAxisScalingEvent(n,r)}}return!1}touchEndEvent(t){const{widget:e}=this._findWidgetByEvent(t);if(e!==null){const n=this._makeWidgetEvent(t,e);switch(e.getName()){case Z.MAIN:{if(e.dispatchEvent("mouseUpEvent",n),this._startScrollCoordinate!==null){const s=new Date().getTime()-this._flingStartTime;let l=(n.x-this._startScrollCoordinate.x)/(s>0?s:1)*20;if(s<200&&Math.abs(l)>0){const c=this._chart.getChartStore(),a=()=>{this._flingScrollRequestId=ot(()=>{c.startScroll(),c.scroll(l),l=l*(1-.025),Math.abs(l)<1?this._flingScrollRequestId!==null&&(ts(this._flingScrollRequestId),this._flingScrollRequestId=null):a()})};a()}}return!0}case Z.X_AXIS:case Z.Y_AXIS:e.dispatchEvent("mouseUpEvent",n)&&this._chart.updatePane(J.Overlay)}this._startScrollCoordinate=null,this._prevYAxisRange=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0}return!1}tapEvent(t){const{pane:e,widget:n}=this._findWidgetByEvent(t);let r=!1;if(n!==null){const s=this._makeWidgetEvent(t,n),o=n.dispatchEvent("mouseClickEvent",s);if(n.getName()===Z.MAIN){const l=this._makeWidgetEvent(t,n),c=this._chart.getChartStore();o?(this._touchCancelCrosshair=!0,this._touchCoordinate=null,c.setCrosshair(void 0,{notInvalidate:!0}),r=!0):(!this._touchCancelCrosshair&&!this._touchZoomed&&(this._touchCoordinate={x:l.x,y:l.y},c.setCrosshair({x:l.x,y:l.y,paneId:e?.getId()},{notInvalidate:!0}),r=!0),this._touchCancelCrosshair=!1)}(r||o)&&this._chart.updatePane(J.Overlay)}return r}doubleTapEvent(t){return this.mouseDoubleClickEvent(t)}longTapEvent(t){const{pane:e,widget:n}=this._findWidgetByEvent(t);if(n!==null&&n.getName()===Z.MAIN){const r=this._makeWidgetEvent(t,n);return this._touchCoordinate={x:r.x,y:r.y},this._chart.getChartStore().setCrosshair({x:r.x,y:r.y,paneId:e?.getId()}),!0}return!1}_processMainScrollingEvent(t,e){if(this._startScrollCoordinate!==null){const n=t.getPane().getAxisComponent();if(this._prevYAxisRange!==null&&!n.getAutoCalcTickFlag()&&n.scrollZoomEnabled){const{from:s,to:o,range:l}=this._prevYAxisRange;let c=0;n.reverse?c=this._startScrollCoordinate.y-e.y:c=e.y-this._startScrollCoordinate.y;const a=t.getBounding(),h=c/a.height,f=l*h,d=s+f,u=o+f,p=n.valueToRealValue(d,{range:this._prevYAxisRange}),x=n.valueToRealValue(u,{range:this._prevYAxisRange}),g=n.realValueToDisplayValue(p,{range:this._prevYAxisRange}),m=n.realValueToDisplayValue(x,{range:this._prevYAxisRange});n.setRange({from:d,to:u,range:u-d,realFrom:p,realTo:x,realRange:x-p,displayFrom:g,displayTo:m,displayRange:m-g})}const r=e.x-this._startScrollCoordinate.x;this._chart.getChartStore().scroll(r)}}_processXAxisScrollStartEvent(t,e){const n=t.dispatchEvent("mouseDownEvent",e);return n&&this._chart.updatePane(J.Overlay),this._xAxisStartScaleCoordinate={x:e.x,y:e.y},this._xAxisStartScaleDistance=e.pageX,n}_processXAxisScrollingEvent(t,e){const n=t.dispatchEvent("pressedMouseMoveEvent",e);if(n)this._chart.updatePane(J.Overlay);else if(t.getPane().getAxisComponent().scrollZoomEnabled&&this._xAxisStartScaleDistance!==0){const s=this._xAxisStartScaleDistance/e.pageX;if(Number.isFinite(s)){const o=(s-this._xAxisScale)*10;this._xAxisScale=s,this._chart.getChartStore().zoom(o,this._xAxisStartScaleCoordinate??void 0)}}return n}_processYAxisScaleStartEvent(t,e){const n=t.dispatchEvent("mouseDownEvent",e);n&&this._chart.updatePane(J.Overlay);const r=t.getPane().getAxisComponent().getRange();return this._prevYAxisRange={...r},this._yAxisStartScaleDistance=e.pageY,n}_processYAxisScalingEvent(t,e){const n=t.dispatchEvent("pressedMouseMoveEvent",e);if(n)this._chart.updatePane(J.Overlay);else{const r=t.getPane().getAxisComponent();if(this._prevYAxisRange!==null&&r.scrollZoomEnabled&&this._yAxisStartScaleDistance!==0){const{from:s,to:o,range:l}=this._prevYAxisRange,c=e.pageY/this._yAxisStartScaleDistance,a=l*c,h=(a-l)/2,f=s-h,d=o+h,u=r.valueToRealValue(f,{range:this._prevYAxisRange}),p=r.valueToRealValue(d,{range:this._prevYAxisRange}),x=r.realValueToDisplayValue(u,{range:this._prevYAxisRange}),g=r.realValueToDisplayValue(p,{range:this._prevYAxisRange});r.setRange({from:f,to:d,range:a,realFrom:u,realTo:p,realRange:p-u,displayFrom:x,displayTo:g,displayRange:g-x}),this._chart.layout({measureWidth:!0,update:!0,buildYAxisTick:!0})}}return n}_findWidgetByEvent(t){const{x:e,y:n}=t,r=this._chart.getSeparatorPanes(),s=this._chart.getStyles().separator.size;for(const a of r){const h=a[1],f=h.getBounding(),d=f.top-Math.round((_n-s)/2);if(e>=f.left&&e<=f.left+f.width&&n>=d&&n<=d+_n)return{pane:h,widget:h.getWidget()}}const o=this._chart.getDrawPanes();let l=null;for(const a of o){const h=a.getBounding();if(e>=h.left&&e<=h.left+h.width&&n>=h.top&&n<=h.top+h.height){l=a;break}}let c=null;if(l!==null){const a=l.getMainWidget(),h=a.getBounding();if(e>=h.left&&e<=h.left+h.width&&n>=h.top&&n<=h.top+h.height&&(c=a),!H(c)){const f=l.getYAxisWidget();if(f!==null){const d=f.getBounding();e>=d.left&&e<=d.left+d.width&&n>=d.top&&n<=d.top+d.height&&(c=f)}}}return{pane:l,widget:c}}_makeWidgetEvent(t,e){const n=e?.getBounding()??null;return{...t,x:t.x-(n?.left??0),y:t.y-(n?.top??0)}}destroy(){this._container.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._event.destroy()}}var Jn={exports:{}};function qh(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ei={exports:{}};const jh={},Zh=Object.freeze(Object.defineProperty({__proto__:null,default:jh},Symbol.toStringTag,{value:"Module"})),Gh=kl(Zh);var Kh=ei.exports,Es;function ne(){return Es||(Es=1,(function(i,t){(function(e,n){i.exports=n()})(Kh,function(){var e=e||(function(n,r){var s;if(typeof window<"u"&&window.crypto&&(s=window.crypto),typeof self<"u"&&self.crypto&&(s=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(s=globalThis.crypto),!s&&typeof window<"u"&&window.msCrypto&&(s=window.msCrypto),!s&&typeof tr<"u"&&tr.crypto&&(s=tr.crypto),!s&&typeof qh=="function")try{s=Gh}catch{}var o=function(){if(s){if(typeof s.getRandomValues=="function")try{return s.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof s.randomBytes=="function")try{return s.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},l=Object.create||(function(){function y(){}return function(v){var _;return y.prototype=v,_=new y,y.prototype=null,_}})(),c={},a=c.lib={},h=a.Base=(function(){return{extend:function(y){var v=l(this);return y&&v.mixIn(y),(!v.hasOwnProperty("init")||this.init===v.init)&&(v.init=function(){v.$super.init.apply(this,arguments)}),v.init.prototype=v,v.$super=this,v},create:function(){var y=this.extend();return y.init.apply(y,arguments),y},init:function(){},mixIn:function(y){for(var v in y)y.hasOwnProperty(v)&&(this[v]=y[v]);y.hasOwnProperty("toString")&&(this.toString=y.toString)},clone:function(){return this.init.prototype.extend(this)}}})(),f=a.WordArray=h.extend({init:function(y,v){y=this.words=y||[],v!=r?this.sigBytes=v:this.sigBytes=y.length*4},toString:function(y){return(y||u).stringify(this)},concat:function(y){var v=this.words,_=y.words,w=this.sigBytes,b=y.sigBytes;if(this.clamp(),w%4)for(var C=0;C<b;C++){var M=_[C>>>2]>>>24-C%4*8&255;v[w+C>>>2]|=M<<24-(w+C)%4*8}else for(var T=0;T<b;T+=4)v[w+T>>>2]=_[T>>>2];return this.sigBytes+=b,this},clamp:function(){var y=this.words,v=this.sigBytes;y[v>>>2]&=4294967295<<32-v%4*8,y.length=n.ceil(v/4)},clone:function(){var y=h.clone.call(this);return y.words=this.words.slice(0),y},random:function(y){for(var v=[],_=0;_<y;_+=4)v.push(o());return new f.init(v,y)}}),d=c.enc={},u=d.Hex={stringify:function(y){for(var v=y.words,_=y.sigBytes,w=[],b=0;b<_;b++){var C=v[b>>>2]>>>24-b%4*8&255;w.push((C>>>4).toString(16)),w.push((C&15).toString(16))}return w.join("")},parse:function(y){for(var v=y.length,_=[],w=0;w<v;w+=2)_[w>>>3]|=parseInt(y.substr(w,2),16)<<24-w%8*4;return new f.init(_,v/2)}},p=d.Latin1={stringify:function(y){for(var v=y.words,_=y.sigBytes,w=[],b=0;b<_;b++){var C=v[b>>>2]>>>24-b%4*8&255;w.push(String.fromCharCode(C))}return w.join("")},parse:function(y){for(var v=y.length,_=[],w=0;w<v;w++)_[w>>>2]|=(y.charCodeAt(w)&255)<<24-w%4*8;return new f.init(_,v)}},x=d.Utf8={stringify:function(y){try{return decodeURIComponent(escape(p.stringify(y)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(y){return p.parse(unescape(encodeURIComponent(y)))}},g=a.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(y){typeof y=="string"&&(y=x.parse(y)),this._data.concat(y),this._nDataBytes+=y.sigBytes},_process:function(y){var v,_=this._data,w=_.words,b=_.sigBytes,C=this.blockSize,M=C*4,T=b/M;y?T=n.ceil(T):T=n.max((T|0)-this._minBufferSize,0);var S=T*C,E=n.min(S*4,b);if(S){for(var I=0;I<S;I+=C)this._doProcessBlock(w,I);v=w.splice(0,S),_.sigBytes-=E}return new f.init(v,E)},clone:function(){var y=h.clone.call(this);return y._data=this._data.clone(),y},_minBufferSize:0});a.Hasher=g.extend({cfg:h.extend(),init:function(y){this.cfg=this.cfg.extend(y),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(y){return this._append(y),this._process(),this},finalize:function(y){y&&this._append(y);var v=this._doFinalize();return v},blockSize:16,_createHelper:function(y){return function(v,_){return new y.init(_).finalize(v)}},_createHmacHelper:function(y){return function(v,_){return new m.HMAC.init(y,_).finalize(v)}}});var m=c.algo={};return c})(Math);return e})})(ei)),ei.exports}var ti={exports:{}},Qh=ti.exports,Ms;function Zi(){return Ms||(Ms=1,(function(i,t){(function(e,n){i.exports=n(ne())})(Qh,function(e){return(function(n){var r=e,s=r.lib,o=s.Base,l=s.WordArray,c=r.x64={};c.Word=o.extend({init:function(a,h){this.high=a,this.low=h}}),c.WordArray=o.extend({init:function(a,h){a=this.words=a||[],h!=n?this.sigBytes=h:this.sigBytes=a.length*8},toX32:function(){for(var a=this.words,h=a.length,f=[],d=0;d<h;d++){var u=a[d];f.push(u.high),f.push(u.low)}return l.create(f,this.sigBytes)},clone:function(){for(var a=o.clone.call(this),h=a.words=this.words.slice(0),f=h.length,d=0;d<f;d++)h[d]=h[d].clone();return a}})})(),e})})(ti)),ti.exports}var ni={exports:{}},Jh=ni.exports,Ds;function eu(){return Ds||(Ds=1,(function(i,t){(function(e,n){i.exports=n(ne())})(Jh,function(e){return(function(){if(typeof ArrayBuffer=="function"){var n=e,r=n.lib,s=r.WordArray,o=s.init,l=s.init=function(c){if(c instanceof ArrayBuffer&&(c=new Uint8Array(c)),(c instanceof Int8Array||typeof Uint8ClampedArray<"u"&&c instanceof Uint8ClampedArray||c instanceof Int16Array||c instanceof Uint16Array||c instanceof Int32Array||c instanceof Uint32Array||c instanceof Float32Array||c instanceof Float64Array)&&(c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength)),c instanceof Uint8Array){for(var a=c.byteLength,h=[],f=0;f<a;f++)h[f>>>2]|=c[f]<<24-f%4*8;o.call(this,h,a)}else o.apply(this,arguments)};l.prototype=s}})(),e.lib.WordArray})})(ni)),ni.exports}var ii={exports:{}},tu=ii.exports,ks;function nu(){return ks||(ks=1,(function(i,t){(function(e,n){i.exports=n(ne())})(tu,function(e){return(function(){var n=e,r=n.lib,s=r.WordArray,o=n.enc;o.Utf16=o.Utf16BE={stringify:function(c){for(var a=c.words,h=c.sigBytes,f=[],d=0;d<h;d+=2){var u=a[d>>>2]>>>16-d%4*8&65535;f.push(String.fromCharCode(u))}return f.join("")},parse:function(c){for(var a=c.length,h=[],f=0;f<a;f++)h[f>>>1]|=c.charCodeAt(f)<<16-f%2*16;return s.create(h,a*2)}},o.Utf16LE={stringify:function(c){for(var a=c.words,h=c.sigBytes,f=[],d=0;d<h;d+=2){var u=l(a[d>>>2]>>>16-d%4*8&65535);f.push(String.fromCharCode(u))}return f.join("")},parse:function(c){for(var a=c.length,h=[],f=0;f<a;f++)h[f>>>1]|=l(c.charCodeAt(f)<<16-f%2*16);return s.create(h,a*2)}};function l(c){return c<<8&4278255360|c>>>8&16711935}})(),e.enc.Utf16})})(ii)),ii.exports}var ri={exports:{}},iu=ri.exports,Bs;function Ot(){return Bs||(Bs=1,(function(i,t){(function(e,n){i.exports=n(ne())})(iu,function(e){return(function(){var n=e,r=n.lib,s=r.WordArray,o=n.enc;o.Base64={stringify:function(c){var a=c.words,h=c.sigBytes,f=this._map;c.clamp();for(var d=[],u=0;u<h;u+=3)for(var p=a[u>>>2]>>>24-u%4*8&255,x=a[u+1>>>2]>>>24-(u+1)%4*8&255,g=a[u+2>>>2]>>>24-(u+2)%4*8&255,m=p<<16|x<<8|g,y=0;y<4&&u+y*.75<h;y++)d.push(f.charAt(m>>>6*(3-y)&63));var v=f.charAt(64);if(v)for(;d.length%4;)d.push(v);return d.join("")},parse:function(c){var a=c.length,h=this._map,f=this._reverseMap;if(!f){f=this._reverseMap=[];for(var d=0;d<h.length;d++)f[h.charCodeAt(d)]=d}var u=h.charAt(64);if(u){var p=c.indexOf(u);p!==-1&&(a=p)}return l(c,a,f)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function l(c,a,h){for(var f=[],d=0,u=0;u<a;u++)if(u%4){var p=h[c.charCodeAt(u-1)]<<u%4*2,x=h[c.charCodeAt(u)]>>>6-u%4*2,g=p|x;f[d>>>2]|=g<<24-d%4*8,d++}return s.create(f,d)}})(),e.enc.Base64})})(ri)),ri.exports}var si={exports:{}},ru=si.exports,Ts;function su(){return Ts||(Ts=1,(function(i,t){(function(e,n){i.exports=n(ne())})(ru,function(e){return(function(){var n=e,r=n.lib,s=r.WordArray,o=n.enc;o.Base64url={stringify:function(c,a){a===void 0&&(a=!0);var h=c.words,f=c.sigBytes,d=a?this._safe_map:this._map;c.clamp();for(var u=[],p=0;p<f;p+=3)for(var x=h[p>>>2]>>>24-p%4*8&255,g=h[p+1>>>2]>>>24-(p+1)%4*8&255,m=h[p+2>>>2]>>>24-(p+2)%4*8&255,y=x<<16|g<<8|m,v=0;v<4&&p+v*.75<f;v++)u.push(d.charAt(y>>>6*(3-v)&63));var _=d.charAt(64);if(_)for(;u.length%4;)u.push(_);return u.join("")},parse:function(c,a){a===void 0&&(a=!0);var h=c.length,f=a?this._safe_map:this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var u=0;u<f.length;u++)d[f.charCodeAt(u)]=u}var p=f.charAt(64);if(p){var x=c.indexOf(p);x!==-1&&(h=x)}return l(c,h,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function l(c,a,h){for(var f=[],d=0,u=0;u<a;u++)if(u%4){var p=h[c.charCodeAt(u-1)]<<u%4*2,x=h[c.charCodeAt(u)]>>>6-u%4*2,g=p|x;f[d>>>2]|=g<<24-d%4*8,d++}return s.create(f,d)}})(),e.enc.Base64url})})(si)),si.exports}var oi={exports:{}},ou=oi.exports,Is;function Ht(){return Is||(Is=1,(function(i,t){(function(e,n){i.exports=n(ne())})(ou,function(e){return(function(n){var r=e,s=r.lib,o=s.WordArray,l=s.Hasher,c=r.algo,a=[];(function(){for(var x=0;x<64;x++)a[x]=n.abs(n.sin(x+1))*4294967296|0})();var h=c.MD5=l.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(x,g){for(var m=0;m<16;m++){var y=g+m,v=x[y];x[y]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360}var _=this._hash.words,w=x[g+0],b=x[g+1],C=x[g+2],M=x[g+3],T=x[g+4],S=x[g+5],E=x[g+6],I=x[g+7],k=x[g+8],P=x[g+9],B=x[g+10],V=x[g+11],R=x[g+12],W=x[g+13],F=x[g+14],Y=x[g+15],O=_[0],z=_[1],N=_[2],$=_[3];O=f(O,z,N,$,w,7,a[0]),$=f($,O,z,N,b,12,a[1]),N=f(N,$,O,z,C,17,a[2]),z=f(z,N,$,O,M,22,a[3]),O=f(O,z,N,$,T,7,a[4]),$=f($,O,z,N,S,12,a[5]),N=f(N,$,O,z,E,17,a[6]),z=f(z,N,$,O,I,22,a[7]),O=f(O,z,N,$,k,7,a[8]),$=f($,O,z,N,P,12,a[9]),N=f(N,$,O,z,B,17,a[10]),z=f(z,N,$,O,V,22,a[11]),O=f(O,z,N,$,R,7,a[12]),$=f($,O,z,N,W,12,a[13]),N=f(N,$,O,z,F,17,a[14]),z=f(z,N,$,O,Y,22,a[15]),O=d(O,z,N,$,b,5,a[16]),$=d($,O,z,N,E,9,a[17]),N=d(N,$,O,z,V,14,a[18]),z=d(z,N,$,O,w,20,a[19]),O=d(O,z,N,$,S,5,a[20]),$=d($,O,z,N,B,9,a[21]),N=d(N,$,O,z,Y,14,a[22]),z=d(z,N,$,O,T,20,a[23]),O=d(O,z,N,$,P,5,a[24]),$=d($,O,z,N,F,9,a[25]),N=d(N,$,O,z,M,14,a[26]),z=d(z,N,$,O,k,20,a[27]),O=d(O,z,N,$,W,5,a[28]),$=d($,O,z,N,C,9,a[29]),N=d(N,$,O,z,I,14,a[30]),z=d(z,N,$,O,R,20,a[31]),O=u(O,z,N,$,S,4,a[32]),$=u($,O,z,N,k,11,a[33]),N=u(N,$,O,z,V,16,a[34]),z=u(z,N,$,O,F,23,a[35]),O=u(O,z,N,$,b,4,a[36]),$=u($,O,z,N,T,11,a[37]),N=u(N,$,O,z,I,16,a[38]),z=u(z,N,$,O,B,23,a[39]),O=u(O,z,N,$,W,4,a[40]),$=u($,O,z,N,w,11,a[41]),N=u(N,$,O,z,M,16,a[42]),z=u(z,N,$,O,E,23,a[43]),O=u(O,z,N,$,P,4,a[44]),$=u($,O,z,N,R,11,a[45]),N=u(N,$,O,z,Y,16,a[46]),z=u(z,N,$,O,C,23,a[47]),O=p(O,z,N,$,w,6,a[48]),$=p($,O,z,N,I,10,a[49]),N=p(N,$,O,z,F,15,a[50]),z=p(z,N,$,O,S,21,a[51]),O=p(O,z,N,$,R,6,a[52]),$=p($,O,z,N,M,10,a[53]),N=p(N,$,O,z,B,15,a[54]),z=p(z,N,$,O,b,21,a[55]),O=p(O,z,N,$,k,6,a[56]),$=p($,O,z,N,Y,10,a[57]),N=p(N,$,O,z,E,15,a[58]),z=p(z,N,$,O,W,21,a[59]),O=p(O,z,N,$,T,6,a[60]),$=p($,O,z,N,V,10,a[61]),N=p(N,$,O,z,C,15,a[62]),z=p(z,N,$,O,P,21,a[63]),_[0]=_[0]+O|0,_[1]=_[1]+z|0,_[2]=_[2]+N|0,_[3]=_[3]+$|0},_doFinalize:function(){var x=this._data,g=x.words,m=this._nDataBytes*8,y=x.sigBytes*8;g[y>>>5]|=128<<24-y%32;var v=n.floor(m/4294967296),_=m;g[(y+64>>>9<<4)+15]=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,g[(y+64>>>9<<4)+14]=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,x.sigBytes=(g.length+1)*4,this._process();for(var w=this._hash,b=w.words,C=0;C<4;C++){var M=b[C];b[C]=(M<<8|M>>>24)&16711935|(M<<24|M>>>8)&4278255360}return w},clone:function(){var x=l.clone.call(this);return x._hash=this._hash.clone(),x}});function f(x,g,m,y,v,_,w){var b=x+(g&m|~g&y)+v+w;return(b<<_|b>>>32-_)+g}function d(x,g,m,y,v,_,w){var b=x+(g&y|m&~y)+v+w;return(b<<_|b>>>32-_)+g}function u(x,g,m,y,v,_,w){var b=x+(g^m^y)+v+w;return(b<<_|b>>>32-_)+g}function p(x,g,m,y,v,_,w){var b=x+(m^(g|~y))+v+w;return(b<<_|b>>>32-_)+g}r.MD5=l._createHelper(h),r.HmacMD5=l._createHmacHelper(h)})(Math),e.MD5})})(oi)),oi.exports}var ai={exports:{}},au=ai.exports,Ps;function za(){return Ps||(Ps=1,(function(i,t){(function(e,n){i.exports=n(ne())})(au,function(e){return(function(){var n=e,r=n.lib,s=r.WordArray,o=r.Hasher,l=n.algo,c=[],a=l.SHA1=o.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(h,f){for(var d=this._hash.words,u=d[0],p=d[1],x=d[2],g=d[3],m=d[4],y=0;y<80;y++){if(y<16)c[y]=h[f+y]|0;else{var v=c[y-3]^c[y-8]^c[y-14]^c[y-16];c[y]=v<<1|v>>>31}var _=(u<<5|u>>>27)+m+c[y];y<20?_+=(p&x|~p&g)+1518500249:y<40?_+=(p^x^g)+1859775393:y<60?_+=(p&x|p&g|x&g)-1894007588:_+=(p^x^g)-899497514,m=g,g=x,x=p<<30|p>>>2,p=u,u=_}d[0]=d[0]+u|0,d[1]=d[1]+p|0,d[2]=d[2]+x|0,d[3]=d[3]+g|0,d[4]=d[4]+m|0},_doFinalize:function(){var h=this._data,f=h.words,d=this._nDataBytes*8,u=h.sigBytes*8;return f[u>>>5]|=128<<24-u%32,f[(u+64>>>9<<4)+14]=Math.floor(d/4294967296),f[(u+64>>>9<<4)+15]=d,h.sigBytes=f.length*4,this._process(),this._hash},clone:function(){var h=o.clone.call(this);return h._hash=this._hash.clone(),h}});n.SHA1=o._createHelper(a),n.HmacSHA1=o._createHmacHelper(a)})(),e.SHA1})})(ai)),ai.exports}var li={exports:{}},lu=li.exports,Vs;function $r(){return Vs||(Vs=1,(function(i,t){(function(e,n){i.exports=n(ne())})(lu,function(e){return(function(n){var r=e,s=r.lib,o=s.WordArray,l=s.Hasher,c=r.algo,a=[],h=[];(function(){function u(m){for(var y=n.sqrt(m),v=2;v<=y;v++)if(!(m%v))return!1;return!0}function p(m){return(m-(m|0))*4294967296|0}for(var x=2,g=0;g<64;)u(x)&&(g<8&&(a[g]=p(n.pow(x,1/2))),h[g]=p(n.pow(x,1/3)),g++),x++})();var f=[],d=c.SHA256=l.extend({_doReset:function(){this._hash=new o.init(a.slice(0))},_doProcessBlock:function(u,p){for(var x=this._hash.words,g=x[0],m=x[1],y=x[2],v=x[3],_=x[4],w=x[5],b=x[6],C=x[7],M=0;M<64;M++){if(M<16)f[M]=u[p+M]|0;else{var T=f[M-15],S=(T<<25|T>>>7)^(T<<14|T>>>18)^T>>>3,E=f[M-2],I=(E<<15|E>>>17)^(E<<13|E>>>19)^E>>>10;f[M]=S+f[M-7]+I+f[M-16]}var k=_&w^~_&b,P=g&m^g&y^m&y,B=(g<<30|g>>>2)^(g<<19|g>>>13)^(g<<10|g>>>22),V=(_<<26|_>>>6)^(_<<21|_>>>11)^(_<<7|_>>>25),R=C+V+k+h[M]+f[M],W=B+P;C=b,b=w,w=_,_=v+R|0,v=y,y=m,m=g,g=R+W|0}x[0]=x[0]+g|0,x[1]=x[1]+m|0,x[2]=x[2]+y|0,x[3]=x[3]+v|0,x[4]=x[4]+_|0,x[5]=x[5]+w|0,x[6]=x[6]+b|0,x[7]=x[7]+C|0},_doFinalize:function(){var u=this._data,p=u.words,x=this._nDataBytes*8,g=u.sigBytes*8;return p[g>>>5]|=128<<24-g%32,p[(g+64>>>9<<4)+14]=n.floor(x/4294967296),p[(g+64>>>9<<4)+15]=x,u.sigBytes=p.length*4,this._process(),this._hash},clone:function(){var u=l.clone.call(this);return u._hash=this._hash.clone(),u}});r.SHA256=l._createHelper(d),r.HmacSHA256=l._createHmacHelper(d)})(Math),e.SHA256})})(li)),li.exports}var ci={exports:{}},cu=ci.exports,Fs;function hu(){return Fs||(Fs=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),$r())})(cu,function(e){return(function(){var n=e,r=n.lib,s=r.WordArray,o=n.algo,l=o.SHA256,c=o.SHA224=l.extend({_doReset:function(){this._hash=new s.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var a=l._doFinalize.call(this);return a.sigBytes-=4,a}});n.SHA224=l._createHelper(c),n.HmacSHA224=l._createHmacHelper(c)})(),e.SHA224})})(ci)),ci.exports}var hi={exports:{}},uu=hi.exports,Rs;function Na(){return Rs||(Rs=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Zi())})(uu,function(e){return(function(){var n=e,r=n.lib,s=r.Hasher,o=n.x64,l=o.Word,c=o.WordArray,a=n.algo;function h(){return l.create.apply(l,arguments)}var f=[h(1116352408,3609767458),h(1899447441,602891725),h(3049323471,3964484399),h(3921009573,2173295548),h(961987163,4081628472),h(1508970993,3053834265),h(2453635748,2937671579),h(2870763221,3664609560),h(3624381080,2734883394),h(310598401,1164996542),h(607225278,1323610764),h(1426881987,3590304994),h(1925078388,4068182383),h(2162078206,991336113),h(2614888103,633803317),h(3248222580,3479774868),h(3835390401,2666613458),h(4022224774,944711139),h(264347078,2341262773),h(604807628,2007800933),h(770255983,1495990901),h(1249150122,1856431235),h(1555081692,3175218132),h(1996064986,2198950837),h(2554220882,3999719339),h(2821834349,766784016),h(2952996808,2566594879),h(3210313671,3203337956),h(3336571891,1034457026),h(3584528711,2466948901),h(113926993,3758326383),h(338241895,168717936),h(666307205,1188179964),h(773529912,1546045734),h(1294757372,1522805485),h(1396182291,2643833823),h(1695183700,2343527390),h(1986661051,1014477480),h(2177026350,1206759142),h(2456956037,344077627),h(2730485921,1290863460),h(2820302411,3158454273),h(3259730800,3505952657),h(3345764771,106217008),h(3516065817,3606008344),h(3600352804,1432725776),h(4094571909,1467031594),h(275423344,851169720),h(430227734,3100823752),h(506948616,1363258195),h(659060556,3750685593),h(883997877,3785050280),h(958139571,3318307427),h(1322822218,3812723403),h(1537002063,2003034995),h(1747873779,3602036899),h(1955562222,1575990012),h(2024104815,1125592928),h(2227730452,2716904306),h(2361852424,442776044),h(2428436474,593698344),h(2756734187,3733110249),h(3204031479,2999351573),h(3329325298,3815920427),h(3391569614,3928383900),h(3515267271,566280711),h(3940187606,3454069534),h(4118630271,4000239992),h(116418474,1914138554),h(174292421,2731055270),h(289380356,3203993006),h(460393269,320620315),h(685471733,587496836),h(852142971,1086792851),h(1017036298,365543100),h(1126000580,2618297676),h(1288033470,3409855158),h(1501505948,4234509866),h(1607167915,987167468),h(1816402316,1246189591)],d=[];(function(){for(var p=0;p<80;p++)d[p]=h()})();var u=a.SHA512=s.extend({_doReset:function(){this._hash=new c.init([new l.init(1779033703,4089235720),new l.init(3144134277,2227873595),new l.init(1013904242,4271175723),new l.init(2773480762,1595750129),new l.init(1359893119,2917565137),new l.init(2600822924,725511199),new l.init(528734635,4215389547),new l.init(1541459225,327033209)])},_doProcessBlock:function(p,x){for(var g=this._hash.words,m=g[0],y=g[1],v=g[2],_=g[3],w=g[4],b=g[5],C=g[6],M=g[7],T=m.high,S=m.low,E=y.high,I=y.low,k=v.high,P=v.low,B=_.high,V=_.low,R=w.high,W=w.low,F=b.high,Y=b.low,O=C.high,z=C.low,N=M.high,$=M.low,q=T,j=S,K=E,G=I,xe=k,de=P,_e=B,ge=V,ee=R,ie=W,me=F,we=Y,ye=O,Me=z,le=N,ae=$,ce=0;ce<80;ce++){var oe,X,Fe=d[ce];if(ce<16)X=Fe.high=p[x+ce*2]|0,oe=Fe.low=p[x+ce*2+1]|0;else{var Be=d[ce-15],Re=Be.high,Te=Be.low,nt=(Re>>>1|Te<<31)^(Re>>>8|Te<<24)^Re>>>7,gt=(Te>>>1|Re<<31)^(Te>>>8|Re<<24)^(Te>>>7|Re<<25),mt=d[ce-2],it=mt.high,Ze=mt.low,$e=(it>>>19|Ze<<13)^(it<<3|Ze>>>29)^it>>>6,Ge=(Ze>>>19|it<<13)^(Ze<<3|it>>>29)^(Ze>>>6|it<<26),rt=d[ce-7],Yt=rt.high,ue=rt.low,be=d[ce-16],Ye=be.high,an=be.low;oe=gt+ue,X=nt+Yt+(oe>>>0<gt>>>0?1:0),oe=oe+Ge,X=X+$e+(oe>>>0<Ge>>>0?1:0),oe=oe+an,X=X+Ye+(oe>>>0<an>>>0?1:0),Fe.high=X,Fe.low=oe}var yt=ee&me^~ee&ye,Xt=ie&we^~ie&Me,Bt=q&K^q&xe^K&xe,Lt=j&G^j&de^G&de,Ut=(q>>>28|j<<4)^(q<<30|j>>>2)^(q<<25|j>>>7),Tt=(j>>>28|q<<4)^(j<<30|q>>>2)^(j<<25|q>>>7),fe=(ee>>>14|ie<<18)^(ee>>>18|ie<<14)^(ee<<23|ie>>>9),ve=(ie>>>14|ee<<18)^(ie>>>18|ee<<14)^(ie<<23|ee>>>9),Ke=f[ce],ln=Ke.high,Xe=Ke.low,Ie=ae+ve,Qe=le+fe+(Ie>>>0<ae>>>0?1:0),Ie=Ie+Xt,Qe=Qe+yt+(Ie>>>0<Xt>>>0?1:0),Ie=Ie+Xe,Qe=Qe+ln+(Ie>>>0<Xe>>>0?1:0),Ie=Ie+oe,Qe=Qe+X+(Ie>>>0<oe>>>0?1:0),cn=Tt+Lt,Ji=Ut+Bt+(cn>>>0<Tt>>>0?1:0);le=ye,ae=Me,ye=me,Me=we,me=ee,we=ie,ie=ge+Ie|0,ee=_e+Qe+(ie>>>0<ge>>>0?1:0)|0,_e=xe,ge=de,xe=K,de=G,K=q,G=j,j=Ie+cn|0,q=Qe+Ji+(j>>>0<Ie>>>0?1:0)|0}S=m.low=S+j,m.high=T+q+(S>>>0<j>>>0?1:0),I=y.low=I+G,y.high=E+K+(I>>>0<G>>>0?1:0),P=v.low=P+de,v.high=k+xe+(P>>>0<de>>>0?1:0),V=_.low=V+ge,_.high=B+_e+(V>>>0<ge>>>0?1:0),W=w.low=W+ie,w.high=R+ee+(W>>>0<ie>>>0?1:0),Y=b.low=Y+we,b.high=F+me+(Y>>>0<we>>>0?1:0),z=C.low=z+Me,C.high=O+ye+(z>>>0<Me>>>0?1:0),$=M.low=$+ae,M.high=N+le+($>>>0<ae>>>0?1:0)},_doFinalize:function(){var p=this._data,x=p.words,g=this._nDataBytes*8,m=p.sigBytes*8;x[m>>>5]|=128<<24-m%32,x[(m+128>>>10<<5)+30]=Math.floor(g/4294967296),x[(m+128>>>10<<5)+31]=g,p.sigBytes=x.length*4,this._process();var y=this._hash.toX32();return y},clone:function(){var p=s.clone.call(this);return p._hash=this._hash.clone(),p},blockSize:1024/32});n.SHA512=s._createHelper(u),n.HmacSHA512=s._createHmacHelper(u)})(),e.SHA512})})(hi)),hi.exports}var ui={exports:{}},fu=ui.exports,zs;function du(){return zs||(zs=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Zi(),Na())})(fu,function(e){return(function(){var n=e,r=n.x64,s=r.Word,o=r.WordArray,l=n.algo,c=l.SHA512,a=l.SHA384=c.extend({_doReset:function(){this._hash=new o.init([new s.init(3418070365,3238371032),new s.init(1654270250,914150663),new s.init(2438529370,812702999),new s.init(355462360,4144912697),new s.init(1731405415,4290775857),new s.init(2394180231,1750603025),new s.init(3675008525,1694076839),new s.init(1203062813,3204075428)])},_doFinalize:function(){var h=c._doFinalize.call(this);return h.sigBytes-=16,h}});n.SHA384=c._createHelper(a),n.HmacSHA384=c._createHmacHelper(a)})(),e.SHA384})})(ui)),ui.exports}var fi={exports:{}},pu=fi.exports,Ns;function xu(){return Ns||(Ns=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Zi())})(pu,function(e){return(function(n){var r=e,s=r.lib,o=s.WordArray,l=s.Hasher,c=r.x64,a=c.Word,h=r.algo,f=[],d=[],u=[];(function(){for(var g=1,m=0,y=0;y<24;y++){f[g+5*m]=(y+1)*(y+2)/2%64;var v=m%5,_=(2*g+3*m)%5;g=v,m=_}for(var g=0;g<5;g++)for(var m=0;m<5;m++)d[g+5*m]=m+(2*g+3*m)%5*5;for(var w=1,b=0;b<24;b++){for(var C=0,M=0,T=0;T<7;T++){if(w&1){var S=(1<<T)-1;S<32?M^=1<<S:C^=1<<S-32}w&128?w=w<<1^113:w<<=1}u[b]=a.create(C,M)}})();var p=[];(function(){for(var g=0;g<25;g++)p[g]=a.create()})();var x=h.SHA3=l.extend({cfg:l.cfg.extend({outputLength:512}),_doReset:function(){for(var g=this._state=[],m=0;m<25;m++)g[m]=new a.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(g,m){for(var y=this._state,v=this.blockSize/2,_=0;_<v;_++){var w=g[m+2*_],b=g[m+2*_+1];w=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360,b=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360;var C=y[_];C.high^=b,C.low^=w}for(var M=0;M<24;M++){for(var T=0;T<5;T++){for(var S=0,E=0,I=0;I<5;I++){var C=y[T+5*I];S^=C.high,E^=C.low}var k=p[T];k.high=S,k.low=E}for(var T=0;T<5;T++)for(var P=p[(T+4)%5],B=p[(T+1)%5],V=B.high,R=B.low,S=P.high^(V<<1|R>>>31),E=P.low^(R<<1|V>>>31),I=0;I<5;I++){var C=y[T+5*I];C.high^=S,C.low^=E}for(var W=1;W<25;W++){var S,E,C=y[W],F=C.high,Y=C.low,O=f[W];O<32?(S=F<<O|Y>>>32-O,E=Y<<O|F>>>32-O):(S=Y<<O-32|F>>>64-O,E=F<<O-32|Y>>>64-O);var z=p[d[W]];z.high=S,z.low=E}var N=p[0],$=y[0];N.high=$.high,N.low=$.low;for(var T=0;T<5;T++)for(var I=0;I<5;I++){var W=T+5*I,C=y[W],q=p[W],j=p[(T+1)%5+5*I],K=p[(T+2)%5+5*I];C.high=q.high^~j.high&K.high,C.low=q.low^~j.low&K.low}var C=y[0],G=u[M];C.high^=G.high,C.low^=G.low}},_doFinalize:function(){var g=this._data,m=g.words;this._nDataBytes*8;var y=g.sigBytes*8,v=this.blockSize*32;m[y>>>5]|=1<<24-y%32,m[(n.ceil((y+1)/v)*v>>>5)-1]|=128,g.sigBytes=m.length*4,this._process();for(var _=this._state,w=this.cfg.outputLength/8,b=w/8,C=[],M=0;M<b;M++){var T=_[M],S=T.high,E=T.low;S=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360,E=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360,C.push(E),C.push(S)}return new o.init(C,w)},clone:function(){for(var g=l.clone.call(this),m=g._state=this._state.slice(0),y=0;y<25;y++)m[y]=m[y].clone();return g}});r.SHA3=l._createHelper(x),r.HmacSHA3=l._createHmacHelper(x)})(Math),e.SHA3})})(fi)),fi.exports}var di={exports:{}},gu=di.exports,Ws;function mu(){return Ws||(Ws=1,(function(i,t){(function(e,n){i.exports=n(ne())})(gu,function(e){return(function(n){var r=e,s=r.lib,o=s.WordArray,l=s.Hasher,c=r.algo,a=o.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),h=o.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),f=o.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),d=o.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),u=o.create([0,1518500249,1859775393,2400959708,2840853838]),p=o.create([1352829926,1548603684,1836072691,2053994217,0]),x=c.RIPEMD160=l.extend({_doReset:function(){this._hash=o.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(b,C){for(var M=0;M<16;M++){var T=C+M,S=b[T];b[T]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360}var E=this._hash.words,I=u.words,k=p.words,P=a.words,B=h.words,V=f.words,R=d.words,W,F,Y,O,z,N,$,q,j,K;N=W=E[0],$=F=E[1],q=Y=E[2],j=O=E[3],K=z=E[4];for(var G,M=0;M<80;M+=1)G=W+b[C+P[M]]|0,M<16?G+=g(F,Y,O)+I[0]:M<32?G+=m(F,Y,O)+I[1]:M<48?G+=y(F,Y,O)+I[2]:M<64?G+=v(F,Y,O)+I[3]:G+=_(F,Y,O)+I[4],G=G|0,G=w(G,V[M]),G=G+z|0,W=z,z=O,O=w(Y,10),Y=F,F=G,G=N+b[C+B[M]]|0,M<16?G+=_($,q,j)+k[0]:M<32?G+=v($,q,j)+k[1]:M<48?G+=y($,q,j)+k[2]:M<64?G+=m($,q,j)+k[3]:G+=g($,q,j)+k[4],G=G|0,G=w(G,R[M]),G=G+K|0,N=K,K=j,j=w(q,10),q=$,$=G;G=E[1]+Y+j|0,E[1]=E[2]+O+K|0,E[2]=E[3]+z+N|0,E[3]=E[4]+W+$|0,E[4]=E[0]+F+q|0,E[0]=G},_doFinalize:function(){var b=this._data,C=b.words,M=this._nDataBytes*8,T=b.sigBytes*8;C[T>>>5]|=128<<24-T%32,C[(T+64>>>9<<4)+14]=(M<<8|M>>>24)&16711935|(M<<24|M>>>8)&4278255360,b.sigBytes=(C.length+1)*4,this._process();for(var S=this._hash,E=S.words,I=0;I<5;I++){var k=E[I];E[I]=(k<<8|k>>>24)&16711935|(k<<24|k>>>8)&4278255360}return S},clone:function(){var b=l.clone.call(this);return b._hash=this._hash.clone(),b}});function g(b,C,M){return b^C^M}function m(b,C,M){return b&C|~b&M}function y(b,C,M){return(b|~C)^M}function v(b,C,M){return b&M|C&~M}function _(b,C,M){return b^(C|~M)}function w(b,C){return b<<C|b>>>32-C}r.RIPEMD160=l._createHelper(x),r.HmacRIPEMD160=l._createHmacHelper(x)})(),e.RIPEMD160})})(di)),di.exports}var pi={exports:{}},yu=pi.exports,Os;function Yr(){return Os||(Os=1,(function(i,t){(function(e,n){i.exports=n(ne())})(yu,function(e){(function(){var n=e,r=n.lib,s=r.Base,o=n.enc,l=o.Utf8,c=n.algo;c.HMAC=s.extend({init:function(a,h){a=this._hasher=new a.init,typeof h=="string"&&(h=l.parse(h));var f=a.blockSize,d=f*4;h.sigBytes>d&&(h=a.finalize(h)),h.clamp();for(var u=this._oKey=h.clone(),p=this._iKey=h.clone(),x=u.words,g=p.words,m=0;m<f;m++)x[m]^=1549556828,g[m]^=909522486;u.sigBytes=p.sigBytes=d,this.reset()},reset:function(){var a=this._hasher;a.reset(),a.update(this._iKey)},update:function(a){return this._hasher.update(a),this},finalize:function(a){var h=this._hasher,f=h.finalize(a);h.reset();var d=h.finalize(this._oKey.clone().concat(f));return d}})})()})})(pi)),pi.exports}var xi={exports:{}},vu=xi.exports,Hs;function _u(){return Hs||(Hs=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),$r(),Yr())})(vu,function(e){return(function(){var n=e,r=n.lib,s=r.Base,o=r.WordArray,l=n.algo,c=l.SHA256,a=l.HMAC,h=l.PBKDF2=s.extend({cfg:s.extend({keySize:128/32,hasher:c,iterations:25e4}),init:function(f){this.cfg=this.cfg.extend(f)},compute:function(f,d){for(var u=this.cfg,p=a.create(u.hasher,f),x=o.create(),g=o.create([1]),m=x.words,y=g.words,v=u.keySize,_=u.iterations;m.length<v;){var w=p.update(d).finalize(g);p.reset();for(var b=w.words,C=b.length,M=w,T=1;T<_;T++){M=p.finalize(M),p.reset();for(var S=M.words,E=0;E<C;E++)b[E]^=S[E]}x.concat(w),y[0]++}return x.sigBytes=v*4,x}});n.PBKDF2=function(f,d,u){return h.create(u).compute(f,d)}})(),e.PBKDF2})})(xi)),xi.exports}var gi={exports:{}},wu=gi.exports,$s;function kt(){return $s||($s=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),za(),Yr())})(wu,function(e){return(function(){var n=e,r=n.lib,s=r.Base,o=r.WordArray,l=n.algo,c=l.MD5,a=l.EvpKDF=s.extend({cfg:s.extend({keySize:128/32,hasher:c,iterations:1}),init:function(h){this.cfg=this.cfg.extend(h)},compute:function(h,f){for(var d,u=this.cfg,p=u.hasher.create(),x=o.create(),g=x.words,m=u.keySize,y=u.iterations;g.length<m;){d&&p.update(d),d=p.update(h).finalize(f),p.reset();for(var v=1;v<y;v++)d=p.finalize(d),p.reset();x.concat(d)}return x.sigBytes=m*4,x}});n.EvpKDF=function(h,f,d){return a.create(d).compute(h,f)}})(),e.EvpKDF})})(gi)),gi.exports}var mi={exports:{}},bu=mi.exports,Ys;function Ee(){return Ys||(Ys=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),kt())})(bu,function(e){e.lib.Cipher||(function(n){var r=e,s=r.lib,o=s.Base,l=s.WordArray,c=s.BufferedBlockAlgorithm,a=r.enc;a.Utf8;var h=a.Base64,f=r.algo,d=f.EvpKDF,u=s.Cipher=c.extend({cfg:o.extend(),createEncryptor:function(S,E){return this.create(this._ENC_XFORM_MODE,S,E)},createDecryptor:function(S,E){return this.create(this._DEC_XFORM_MODE,S,E)},init:function(S,E,I){this.cfg=this.cfg.extend(I),this._xformMode=S,this._key=E,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(S){return this._append(S),this._process()},finalize:function(S){S&&this._append(S);var E=this._doFinalize();return E},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:(function(){function S(E){return typeof E=="string"?T:b}return function(E){return{encrypt:function(I,k,P){return S(k).encrypt(E,I,k,P)},decrypt:function(I,k,P){return S(k).decrypt(E,I,k,P)}}}})()});s.StreamCipher=u.extend({_doFinalize:function(){var S=this._process(!0);return S},blockSize:1});var p=r.mode={},x=s.BlockCipherMode=o.extend({createEncryptor:function(S,E){return this.Encryptor.create(S,E)},createDecryptor:function(S,E){return this.Decryptor.create(S,E)},init:function(S,E){this._cipher=S,this._iv=E}}),g=p.CBC=(function(){var S=x.extend();S.Encryptor=S.extend({processBlock:function(I,k){var P=this._cipher,B=P.blockSize;E.call(this,I,k,B),P.encryptBlock(I,k),this._prevBlock=I.slice(k,k+B)}}),S.Decryptor=S.extend({processBlock:function(I,k){var P=this._cipher,B=P.blockSize,V=I.slice(k,k+B);P.decryptBlock(I,k),E.call(this,I,k,B),this._prevBlock=V}});function E(I,k,P){var B,V=this._iv;V?(B=V,this._iv=n):B=this._prevBlock;for(var R=0;R<P;R++)I[k+R]^=B[R]}return S})(),m=r.pad={},y=m.Pkcs7={pad:function(S,E){for(var I=E*4,k=I-S.sigBytes%I,P=k<<24|k<<16|k<<8|k,B=[],V=0;V<k;V+=4)B.push(P);var R=l.create(B,k);S.concat(R)},unpad:function(S){var E=S.words[S.sigBytes-1>>>2]&255;S.sigBytes-=E}};s.BlockCipher=u.extend({cfg:u.cfg.extend({mode:g,padding:y}),reset:function(){var S;u.reset.call(this);var E=this.cfg,I=E.iv,k=E.mode;this._xformMode==this._ENC_XFORM_MODE?S=k.createEncryptor:(S=k.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==S?this._mode.init(this,I&&I.words):(this._mode=S.call(k,this,I&&I.words),this._mode.__creator=S)},_doProcessBlock:function(S,E){this._mode.processBlock(S,E)},_doFinalize:function(){var S,E=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(E.pad(this._data,this.blockSize),S=this._process(!0)):(S=this._process(!0),E.unpad(S)),S},blockSize:128/32});var v=s.CipherParams=o.extend({init:function(S){this.mixIn(S)},toString:function(S){return(S||this.formatter).stringify(this)}}),_=r.format={},w=_.OpenSSL={stringify:function(S){var E,I=S.ciphertext,k=S.salt;return k?E=l.create([1398893684,1701076831]).concat(k).concat(I):E=I,E.toString(h)},parse:function(S){var E,I=h.parse(S),k=I.words;return k[0]==1398893684&&k[1]==1701076831&&(E=l.create(k.slice(2,4)),k.splice(0,4),I.sigBytes-=16),v.create({ciphertext:I,salt:E})}},b=s.SerializableCipher=o.extend({cfg:o.extend({format:w}),encrypt:function(S,E,I,k){k=this.cfg.extend(k);var P=S.createEncryptor(I,k),B=P.finalize(E),V=P.cfg;return v.create({ciphertext:B,key:I,iv:V.iv,algorithm:S,mode:V.mode,padding:V.padding,blockSize:S.blockSize,formatter:k.format})},decrypt:function(S,E,I,k){k=this.cfg.extend(k),E=this._parse(E,k.format);var P=S.createDecryptor(I,k).finalize(E.ciphertext);return P},_parse:function(S,E){return typeof S=="string"?E.parse(S,this):S}}),C=r.kdf={},M=C.OpenSSL={execute:function(S,E,I,k,P){if(k||(k=l.random(64/8)),P)var B=d.create({keySize:E+I,hasher:P}).compute(S,k);else var B=d.create({keySize:E+I}).compute(S,k);var V=l.create(B.words.slice(E),I*4);return B.sigBytes=E*4,v.create({key:B,iv:V,salt:k})}},T=s.PasswordBasedCipher=b.extend({cfg:b.cfg.extend({kdf:M}),encrypt:function(S,E,I,k){k=this.cfg.extend(k);var P=k.kdf.execute(I,S.keySize,S.ivSize,k.salt,k.hasher);k.iv=P.iv;var B=b.encrypt.call(this,S,E,P.key,k);return B.mixIn(P),B},decrypt:function(S,E,I,k){k=this.cfg.extend(k),E=this._parse(E,k.format);var P=k.kdf.execute(I,S.keySize,S.ivSize,E.salt,k.hasher);k.iv=P.iv;var B=b.decrypt.call(this,S,E,P.key,k);return B}})})()})})(mi)),mi.exports}var yi={exports:{}},Cu=yi.exports,Xs;function Au(){return Xs||(Xs=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Ee())})(Cu,function(e){return e.mode.CFB=(function(){var n=e.lib.BlockCipherMode.extend();n.Encryptor=n.extend({processBlock:function(s,o){var l=this._cipher,c=l.blockSize;r.call(this,s,o,c,l),this._prevBlock=s.slice(o,o+c)}}),n.Decryptor=n.extend({processBlock:function(s,o){var l=this._cipher,c=l.blockSize,a=s.slice(o,o+c);r.call(this,s,o,c,l),this._prevBlock=a}});function r(s,o,l,c){var a,h=this._iv;h?(a=h.slice(0),this._iv=void 0):a=this._prevBlock,c.encryptBlock(a,0);for(var f=0;f<l;f++)s[o+f]^=a[f]}return n})(),e.mode.CFB})})(yi)),yi.exports}var vi={exports:{}},Su=vi.exports,Ls;function Eu(){return Ls||(Ls=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Ee())})(Su,function(e){return e.mode.CTR=(function(){var n=e.lib.BlockCipherMode.extend(),r=n.Encryptor=n.extend({processBlock:function(s,o){var l=this._cipher,c=l.blockSize,a=this._iv,h=this._counter;a&&(h=this._counter=a.slice(0),this._iv=void 0);var f=h.slice(0);l.encryptBlock(f,0),h[c-1]=h[c-1]+1|0;for(var d=0;d<c;d++)s[o+d]^=f[d]}});return n.Decryptor=r,n})(),e.mode.CTR})})(vi)),vi.exports}var _i={exports:{}},Mu=_i.exports,Us;function Du(){return Us||(Us=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Ee())})(Mu,function(e){return e.mode.CTRGladman=(function(){var n=e.lib.BlockCipherMode.extend();function r(l){if((l>>24&255)===255){var c=l>>16&255,a=l>>8&255,h=l&255;c===255?(c=0,a===255?(a=0,h===255?h=0:++h):++a):++c,l=0,l+=c<<16,l+=a<<8,l+=h}else l+=1<<24;return l}function s(l){return(l[0]=r(l[0]))===0&&(l[1]=r(l[1])),l}var o=n.Encryptor=n.extend({processBlock:function(l,c){var a=this._cipher,h=a.blockSize,f=this._iv,d=this._counter;f&&(d=this._counter=f.slice(0),this._iv=void 0),s(d);var u=d.slice(0);a.encryptBlock(u,0);for(var p=0;p<h;p++)l[c+p]^=u[p]}});return n.Decryptor=o,n})(),e.mode.CTRGladman})})(_i)),_i.exports}var wi={exports:{}},ku=wi.exports,qs;function Bu(){return qs||(qs=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Ee())})(ku,function(e){return e.mode.OFB=(function(){var n=e.lib.BlockCipherMode.extend(),r=n.Encryptor=n.extend({processBlock:function(s,o){var l=this._cipher,c=l.blockSize,a=this._iv,h=this._keystream;a&&(h=this._keystream=a.slice(0),this._iv=void 0),l.encryptBlock(h,0);for(var f=0;f<c;f++)s[o+f]^=h[f]}});return n.Decryptor=r,n})(),e.mode.OFB})})(wi)),wi.exports}var bi={exports:{}},Tu=bi.exports,js;function Iu(){return js||(js=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Ee())})(Tu,function(e){return e.mode.ECB=(function(){var n=e.lib.BlockCipherMode.extend();return n.Encryptor=n.extend({processBlock:function(r,s){this._cipher.encryptBlock(r,s)}}),n.Decryptor=n.extend({processBlock:function(r,s){this._cipher.decryptBlock(r,s)}}),n})(),e.mode.ECB})})(bi)),bi.exports}var Ci={exports:{}},Pu=Ci.exports,Zs;function Vu(){return Zs||(Zs=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Ee())})(Pu,function(e){return e.pad.AnsiX923={pad:function(n,r){var s=n.sigBytes,o=r*4,l=o-s%o,c=s+l-1;n.clamp(),n.words[c>>>2]|=l<<24-c%4*8,n.sigBytes+=l},unpad:function(n){var r=n.words[n.sigBytes-1>>>2]&255;n.sigBytes-=r}},e.pad.Ansix923})})(Ci)),Ci.exports}var Ai={exports:{}},Fu=Ai.exports,Gs;function Ru(){return Gs||(Gs=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Ee())})(Fu,function(e){return e.pad.Iso10126={pad:function(n,r){var s=r*4,o=s-n.sigBytes%s;n.concat(e.lib.WordArray.random(o-1)).concat(e.lib.WordArray.create([o<<24],1))},unpad:function(n){var r=n.words[n.sigBytes-1>>>2]&255;n.sigBytes-=r}},e.pad.Iso10126})})(Ai)),Ai.exports}var Si={exports:{}},zu=Si.exports,Ks;function Nu(){return Ks||(Ks=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Ee())})(zu,function(e){return e.pad.Iso97971={pad:function(n,r){n.concat(e.lib.WordArray.create([2147483648],1)),e.pad.ZeroPadding.pad(n,r)},unpad:function(n){e.pad.ZeroPadding.unpad(n),n.sigBytes--}},e.pad.Iso97971})})(Si)),Si.exports}var Ei={exports:{}},Wu=Ei.exports,Qs;function Ou(){return Qs||(Qs=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Ee())})(Wu,function(e){return e.pad.ZeroPadding={pad:function(n,r){var s=r*4;n.clamp(),n.sigBytes+=s-(n.sigBytes%s||s)},unpad:function(n){for(var r=n.words,s=n.sigBytes-1,s=n.sigBytes-1;s>=0;s--)if(r[s>>>2]>>>24-s%4*8&255){n.sigBytes=s+1;break}}},e.pad.ZeroPadding})})(Ei)),Ei.exports}var Mi={exports:{}},Hu=Mi.exports,Js;function $u(){return Js||(Js=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Ee())})(Hu,function(e){return e.pad.NoPadding={pad:function(){},unpad:function(){}},e.pad.NoPadding})})(Mi)),Mi.exports}var Di={exports:{}},Yu=Di.exports,eo;function Xu(){return eo||(eo=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Ee())})(Yu,function(e){return(function(n){var r=e,s=r.lib,o=s.CipherParams,l=r.enc,c=l.Hex,a=r.format;a.Hex={stringify:function(h){return h.ciphertext.toString(c)},parse:function(h){var f=c.parse(h);return o.create({ciphertext:f})}}})(),e.format.Hex})})(Di)),Di.exports}var ki={exports:{}},Lu=ki.exports,to;function Uu(){return to||(to=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Ot(),Ht(),kt(),Ee())})(Lu,function(e){return(function(){var n=e,r=n.lib,s=r.BlockCipher,o=n.algo,l=[],c=[],a=[],h=[],f=[],d=[],u=[],p=[],x=[],g=[];(function(){for(var v=[],_=0;_<256;_++)_<128?v[_]=_<<1:v[_]=_<<1^283;for(var w=0,b=0,_=0;_<256;_++){var C=b^b<<1^b<<2^b<<3^b<<4;C=C>>>8^C&255^99,l[w]=C,c[C]=w;var M=v[w],T=v[M],S=v[T],E=v[C]*257^C*16843008;a[w]=E<<24|E>>>8,h[w]=E<<16|E>>>16,f[w]=E<<8|E>>>24,d[w]=E;var E=S*16843009^T*65537^M*257^w*16843008;u[C]=E<<24|E>>>8,p[C]=E<<16|E>>>16,x[C]=E<<8|E>>>24,g[C]=E,w?(w=M^v[v[v[S^M]]],b^=v[v[b]]):w=b=1}})();var m=[0,1,2,4,8,16,32,64,128,27,54],y=o.AES=s.extend({_doReset:function(){var v;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var _=this._keyPriorReset=this._key,w=_.words,b=_.sigBytes/4,C=this._nRounds=b+6,M=(C+1)*4,T=this._keySchedule=[],S=0;S<M;S++)S<b?T[S]=w[S]:(v=T[S-1],S%b?b>6&&S%b==4&&(v=l[v>>>24]<<24|l[v>>>16&255]<<16|l[v>>>8&255]<<8|l[v&255]):(v=v<<8|v>>>24,v=l[v>>>24]<<24|l[v>>>16&255]<<16|l[v>>>8&255]<<8|l[v&255],v^=m[S/b|0]<<24),T[S]=T[S-b]^v);for(var E=this._invKeySchedule=[],I=0;I<M;I++){var S=M-I;if(I%4)var v=T[S];else var v=T[S-4];I<4||S<=4?E[I]=v:E[I]=u[l[v>>>24]]^p[l[v>>>16&255]]^x[l[v>>>8&255]]^g[l[v&255]]}}},encryptBlock:function(v,_){this._doCryptBlock(v,_,this._keySchedule,a,h,f,d,l)},decryptBlock:function(v,_){var w=v[_+1];v[_+1]=v[_+3],v[_+3]=w,this._doCryptBlock(v,_,this._invKeySchedule,u,p,x,g,c);var w=v[_+1];v[_+1]=v[_+3],v[_+3]=w},_doCryptBlock:function(v,_,w,b,C,M,T,S){for(var E=this._nRounds,I=v[_]^w[0],k=v[_+1]^w[1],P=v[_+2]^w[2],B=v[_+3]^w[3],V=4,R=1;R<E;R++){var W=b[I>>>24]^C[k>>>16&255]^M[P>>>8&255]^T[B&255]^w[V++],F=b[k>>>24]^C[P>>>16&255]^M[B>>>8&255]^T[I&255]^w[V++],Y=b[P>>>24]^C[B>>>16&255]^M[I>>>8&255]^T[k&255]^w[V++],O=b[B>>>24]^C[I>>>16&255]^M[k>>>8&255]^T[P&255]^w[V++];I=W,k=F,P=Y,B=O}var W=(S[I>>>24]<<24|S[k>>>16&255]<<16|S[P>>>8&255]<<8|S[B&255])^w[V++],F=(S[k>>>24]<<24|S[P>>>16&255]<<16|S[B>>>8&255]<<8|S[I&255])^w[V++],Y=(S[P>>>24]<<24|S[B>>>16&255]<<16|S[I>>>8&255]<<8|S[k&255])^w[V++],O=(S[B>>>24]<<24|S[I>>>16&255]<<16|S[k>>>8&255]<<8|S[P&255])^w[V++];v[_]=W,v[_+1]=F,v[_+2]=Y,v[_+3]=O},keySize:256/32});n.AES=s._createHelper(y)})(),e.AES})})(ki)),ki.exports}var Bi={exports:{}},qu=Bi.exports,no;function ju(){return no||(no=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Ot(),Ht(),kt(),Ee())})(qu,function(e){return(function(){var n=e,r=n.lib,s=r.WordArray,o=r.BlockCipher,l=n.algo,c=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],a=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],h=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],f=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],d=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],u=l.DES=o.extend({_doReset:function(){for(var m=this._key,y=m.words,v=[],_=0;_<56;_++){var w=c[_]-1;v[_]=y[w>>>5]>>>31-w%32&1}for(var b=this._subKeys=[],C=0;C<16;C++){for(var M=b[C]=[],T=h[C],_=0;_<24;_++)M[_/6|0]|=v[(a[_]-1+T)%28]<<31-_%6,M[4+(_/6|0)]|=v[28+(a[_+24]-1+T)%28]<<31-_%6;M[0]=M[0]<<1|M[0]>>>31;for(var _=1;_<7;_++)M[_]=M[_]>>>(_-1)*4+3;M[7]=M[7]<<5|M[7]>>>27}for(var S=this._invSubKeys=[],_=0;_<16;_++)S[_]=b[15-_]},encryptBlock:function(m,y){this._doCryptBlock(m,y,this._subKeys)},decryptBlock:function(m,y){this._doCryptBlock(m,y,this._invSubKeys)},_doCryptBlock:function(m,y,v){this._lBlock=m[y],this._rBlock=m[y+1],p.call(this,4,252645135),p.call(this,16,65535),x.call(this,2,858993459),x.call(this,8,16711935),p.call(this,1,1431655765);for(var _=0;_<16;_++){for(var w=v[_],b=this._lBlock,C=this._rBlock,M=0,T=0;T<8;T++)M|=f[T][((C^w[T])&d[T])>>>0];this._lBlock=C,this._rBlock=b^M}var S=this._lBlock;this._lBlock=this._rBlock,this._rBlock=S,p.call(this,1,1431655765),x.call(this,8,16711935),x.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),m[y]=this._lBlock,m[y+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function p(m,y){var v=(this._lBlock>>>m^this._rBlock)&y;this._rBlock^=v,this._lBlock^=v<<m}function x(m,y){var v=(this._rBlock>>>m^this._lBlock)&y;this._lBlock^=v,this._rBlock^=v<<m}n.DES=o._createHelper(u);var g=l.TripleDES=o.extend({_doReset:function(){var m=this._key,y=m.words;if(y.length!==2&&y.length!==4&&y.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var v=y.slice(0,2),_=y.length<4?y.slice(0,2):y.slice(2,4),w=y.length<6?y.slice(0,2):y.slice(4,6);this._des1=u.createEncryptor(s.create(v)),this._des2=u.createEncryptor(s.create(_)),this._des3=u.createEncryptor(s.create(w))},encryptBlock:function(m,y){this._des1.encryptBlock(m,y),this._des2.decryptBlock(m,y),this._des3.encryptBlock(m,y)},decryptBlock:function(m,y){this._des3.decryptBlock(m,y),this._des2.encryptBlock(m,y),this._des1.decryptBlock(m,y)},keySize:192/32,ivSize:64/32,blockSize:64/32});n.TripleDES=o._createHelper(g)})(),e.TripleDES})})(Bi)),Bi.exports}var Ti={exports:{}},Zu=Ti.exports,io;function Gu(){return io||(io=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Ot(),Ht(),kt(),Ee())})(Zu,function(e){return(function(){var n=e,r=n.lib,s=r.StreamCipher,o=n.algo,l=o.RC4=s.extend({_doReset:function(){for(var h=this._key,f=h.words,d=h.sigBytes,u=this._S=[],p=0;p<256;p++)u[p]=p;for(var p=0,x=0;p<256;p++){var g=p%d,m=f[g>>>2]>>>24-g%4*8&255;x=(x+u[p]+m)%256;var y=u[p];u[p]=u[x],u[x]=y}this._i=this._j=0},_doProcessBlock:function(h,f){h[f]^=c.call(this)},keySize:256/32,ivSize:0});function c(){for(var h=this._S,f=this._i,d=this._j,u=0,p=0;p<4;p++){f=(f+1)%256,d=(d+h[f])%256;var x=h[f];h[f]=h[d],h[d]=x,u|=h[(h[f]+h[d])%256]<<24-p*8}return this._i=f,this._j=d,u}n.RC4=s._createHelper(l);var a=o.RC4Drop=l.extend({cfg:l.cfg.extend({drop:192}),_doReset:function(){l._doReset.call(this);for(var h=this.cfg.drop;h>0;h--)c.call(this)}});n.RC4Drop=s._createHelper(a)})(),e.RC4})})(Ti)),Ti.exports}var Ii={exports:{}},Ku=Ii.exports,ro;function Qu(){return ro||(ro=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Ot(),Ht(),kt(),Ee())})(Ku,function(e){return(function(){var n=e,r=n.lib,s=r.StreamCipher,o=n.algo,l=[],c=[],a=[],h=o.Rabbit=s.extend({_doReset:function(){for(var d=this._key.words,u=this.cfg.iv,p=0;p<4;p++)d[p]=(d[p]<<8|d[p]>>>24)&16711935|(d[p]<<24|d[p]>>>8)&4278255360;var x=this._X=[d[0],d[3]<<16|d[2]>>>16,d[1],d[0]<<16|d[3]>>>16,d[2],d[1]<<16|d[0]>>>16,d[3],d[2]<<16|d[1]>>>16],g=this._C=[d[2]<<16|d[2]>>>16,d[0]&4294901760|d[1]&65535,d[3]<<16|d[3]>>>16,d[1]&4294901760|d[2]&65535,d[0]<<16|d[0]>>>16,d[2]&4294901760|d[3]&65535,d[1]<<16|d[1]>>>16,d[3]&4294901760|d[0]&65535];this._b=0;for(var p=0;p<4;p++)f.call(this);for(var p=0;p<8;p++)g[p]^=x[p+4&7];if(u){var m=u.words,y=m[0],v=m[1],_=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,w=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,b=_>>>16|w&4294901760,C=w<<16|_&65535;g[0]^=_,g[1]^=b,g[2]^=w,g[3]^=C,g[4]^=_,g[5]^=b,g[6]^=w,g[7]^=C;for(var p=0;p<4;p++)f.call(this)}},_doProcessBlock:function(d,u){var p=this._X;f.call(this),l[0]=p[0]^p[5]>>>16^p[3]<<16,l[1]=p[2]^p[7]>>>16^p[5]<<16,l[2]=p[4]^p[1]>>>16^p[7]<<16,l[3]=p[6]^p[3]>>>16^p[1]<<16;for(var x=0;x<4;x++)l[x]=(l[x]<<8|l[x]>>>24)&16711935|(l[x]<<24|l[x]>>>8)&4278255360,d[u+x]^=l[x]},blockSize:128/32,ivSize:64/32});function f(){for(var d=this._X,u=this._C,p=0;p<8;p++)c[p]=u[p];u[0]=u[0]+1295307597+this._b|0,u[1]=u[1]+3545052371+(u[0]>>>0<c[0]>>>0?1:0)|0,u[2]=u[2]+886263092+(u[1]>>>0<c[1]>>>0?1:0)|0,u[3]=u[3]+1295307597+(u[2]>>>0<c[2]>>>0?1:0)|0,u[4]=u[4]+3545052371+(u[3]>>>0<c[3]>>>0?1:0)|0,u[5]=u[5]+886263092+(u[4]>>>0<c[4]>>>0?1:0)|0,u[6]=u[6]+1295307597+(u[5]>>>0<c[5]>>>0?1:0)|0,u[7]=u[7]+3545052371+(u[6]>>>0<c[6]>>>0?1:0)|0,this._b=u[7]>>>0<c[7]>>>0?1:0;for(var p=0;p<8;p++){var x=d[p]+u[p],g=x&65535,m=x>>>16,y=((g*g>>>17)+g*m>>>15)+m*m,v=((x&4294901760)*x|0)+((x&65535)*x|0);a[p]=y^v}d[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,d[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,d[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,d[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,d[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,d[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,d[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,d[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}n.Rabbit=s._createHelper(h)})(),e.Rabbit})})(Ii)),Ii.exports}var Pi={exports:{}},Ju=Pi.exports,so;function ef(){return so||(so=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Ot(),Ht(),kt(),Ee())})(Ju,function(e){return(function(){var n=e,r=n.lib,s=r.StreamCipher,o=n.algo,l=[],c=[],a=[],h=o.RabbitLegacy=s.extend({_doReset:function(){var d=this._key.words,u=this.cfg.iv,p=this._X=[d[0],d[3]<<16|d[2]>>>16,d[1],d[0]<<16|d[3]>>>16,d[2],d[1]<<16|d[0]>>>16,d[3],d[2]<<16|d[1]>>>16],x=this._C=[d[2]<<16|d[2]>>>16,d[0]&4294901760|d[1]&65535,d[3]<<16|d[3]>>>16,d[1]&4294901760|d[2]&65535,d[0]<<16|d[0]>>>16,d[2]&4294901760|d[3]&65535,d[1]<<16|d[1]>>>16,d[3]&4294901760|d[0]&65535];this._b=0;for(var g=0;g<4;g++)f.call(this);for(var g=0;g<8;g++)x[g]^=p[g+4&7];if(u){var m=u.words,y=m[0],v=m[1],_=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,w=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,b=_>>>16|w&4294901760,C=w<<16|_&65535;x[0]^=_,x[1]^=b,x[2]^=w,x[3]^=C,x[4]^=_,x[5]^=b,x[6]^=w,x[7]^=C;for(var g=0;g<4;g++)f.call(this)}},_doProcessBlock:function(d,u){var p=this._X;f.call(this),l[0]=p[0]^p[5]>>>16^p[3]<<16,l[1]=p[2]^p[7]>>>16^p[5]<<16,l[2]=p[4]^p[1]>>>16^p[7]<<16,l[3]=p[6]^p[3]>>>16^p[1]<<16;for(var x=0;x<4;x++)l[x]=(l[x]<<8|l[x]>>>24)&16711935|(l[x]<<24|l[x]>>>8)&4278255360,d[u+x]^=l[x]},blockSize:128/32,ivSize:64/32});function f(){for(var d=this._X,u=this._C,p=0;p<8;p++)c[p]=u[p];u[0]=u[0]+1295307597+this._b|0,u[1]=u[1]+3545052371+(u[0]>>>0<c[0]>>>0?1:0)|0,u[2]=u[2]+886263092+(u[1]>>>0<c[1]>>>0?1:0)|0,u[3]=u[3]+1295307597+(u[2]>>>0<c[2]>>>0?1:0)|0,u[4]=u[4]+3545052371+(u[3]>>>0<c[3]>>>0?1:0)|0,u[5]=u[5]+886263092+(u[4]>>>0<c[4]>>>0?1:0)|0,u[6]=u[6]+1295307597+(u[5]>>>0<c[5]>>>0?1:0)|0,u[7]=u[7]+3545052371+(u[6]>>>0<c[6]>>>0?1:0)|0,this._b=u[7]>>>0<c[7]>>>0?1:0;for(var p=0;p<8;p++){var x=d[p]+u[p],g=x&65535,m=x>>>16,y=((g*g>>>17)+g*m>>>15)+m*m,v=((x&4294901760)*x|0)+((x&65535)*x|0);a[p]=y^v}d[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,d[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,d[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,d[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,d[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,d[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,d[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,d[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}n.RabbitLegacy=s._createHelper(h)})(),e.RabbitLegacy})})(Pi)),Pi.exports}var Vi={exports:{}},tf=Vi.exports,oo;function nf(){return oo||(oo=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Ot(),Ht(),kt(),Ee())})(tf,function(e){return(function(){var n=e,r=n.lib,s=r.BlockCipher,o=n.algo;const l=16,c=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],a=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var h={pbox:[],sbox:[]};function f(g,m){let y=m>>24&255,v=m>>16&255,_=m>>8&255,w=m&255,b=g.sbox[0][y]+g.sbox[1][v];return b=b^g.sbox[2][_],b=b+g.sbox[3][w],b}function d(g,m,y){let v=m,_=y,w;for(let b=0;b<l;++b)v=v^g.pbox[b],_=f(g,v)^_,w=v,v=_,_=w;return w=v,v=_,_=w,_=_^g.pbox[l],v=v^g.pbox[l+1],{left:v,right:_}}function u(g,m,y){let v=m,_=y,w;for(let b=l+1;b>1;--b)v=v^g.pbox[b],_=f(g,v)^_,w=v,v=_,_=w;return w=v,v=_,_=w,_=_^g.pbox[1],v=v^g.pbox[0],{left:v,right:_}}function p(g,m,y){for(let C=0;C<4;C++){g.sbox[C]=[];for(let M=0;M<256;M++)g.sbox[C][M]=a[C][M]}let v=0;for(let C=0;C<l+2;C++)g.pbox[C]=c[C]^m[v],v++,v>=y&&(v=0);let _=0,w=0,b=0;for(let C=0;C<l+2;C+=2)b=d(g,_,w),_=b.left,w=b.right,g.pbox[C]=_,g.pbox[C+1]=w;for(let C=0;C<4;C++)for(let M=0;M<256;M+=2)b=d(g,_,w),_=b.left,w=b.right,g.sbox[C][M]=_,g.sbox[C][M+1]=w;return!0}var x=o.Blowfish=s.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var g=this._keyPriorReset=this._key,m=g.words,y=g.sigBytes/4;p(h,m,y)}},encryptBlock:function(g,m){var y=d(h,g[m],g[m+1]);g[m]=y.left,g[m+1]=y.right},decryptBlock:function(g,m){var y=u(h,g[m],g[m+1]);g[m]=y.left,g[m+1]=y.right},blockSize:64/32,keySize:128/32,ivSize:64/32});n.Blowfish=s._createHelper(x)})(),e.Blowfish})})(Vi)),Vi.exports}var rf=Jn.exports,ao;function sf(){return ao||(ao=1,(function(i,t){(function(e,n,r){i.exports=n(ne(),Zi(),eu(),nu(),Ot(),su(),Ht(),za(),$r(),hu(),Na(),du(),xu(),mu(),Yr(),_u(),kt(),Ee(),Au(),Eu(),Du(),Bu(),Iu(),Vu(),Ru(),Nu(),Ou(),$u(),Xu(),Uu(),ju(),Gu(),Qu(),ef(),nf())})(rf,function(e){return e})})(Jn)),Jn.exports}var of=sf();const lo=Bl(of);const af=4,co=0,ho=1,lf=2;function rn(i){let t=i.length;for(;--t>=0;)i[t]=0}const cf=0,Wa=1,hf=2,uf=3,ff=258,Xr=29,Wn=256,En=Wn+1+Xr,en=30,Lr=19,Oa=2*En+1,Vt=15,rr=16,df=7,Ur=256,Ha=16,$a=17,Ya=18,br=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Fi=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),pf=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Xa=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),xf=512,ft=new Array((En+2)*2);rn(ft);const wn=new Array(en*2);rn(wn);const Mn=new Array(xf);rn(Mn);const Dn=new Array(ff-uf+1);rn(Dn);const qr=new Array(Xr);rn(qr);const Wi=new Array(en);rn(Wi);function sr(i,t,e,n,r){this.static_tree=i,this.extra_bits=t,this.extra_base=e,this.elems=n,this.max_length=r,this.has_stree=i&&i.length}let La,Ua,qa;function or(i,t){this.dyn_tree=i,this.max_code=0,this.stat_desc=t}const ja=i=>i<256?Mn[i]:Mn[256+(i>>>7)],kn=(i,t)=>{i.pending_buf[i.pending++]=t&255,i.pending_buf[i.pending++]=t>>>8&255},Ne=(i,t,e)=>{i.bi_valid>rr-e?(i.bi_buf|=t<<i.bi_valid&65535,kn(i,i.bi_buf),i.bi_buf=t>>rr-i.bi_valid,i.bi_valid+=e-rr):(i.bi_buf|=t<<i.bi_valid&65535,i.bi_valid+=e)},at=(i,t,e)=>{Ne(i,e[t*2],e[t*2+1])},Za=(i,t)=>{let e=0;do e|=i&1,i>>>=1,e<<=1;while(--t>0);return e>>>1},gf=i=>{i.bi_valid===16?(kn(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=i.bi_buf&255,i.bi_buf>>=8,i.bi_valid-=8)},mf=(i,t)=>{const e=t.dyn_tree,n=t.max_code,r=t.stat_desc.static_tree,s=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,c=t.stat_desc.max_length;let a,h,f,d,u,p,x=0;for(d=0;d<=Vt;d++)i.bl_count[d]=0;for(e[i.heap[i.heap_max]*2+1]=0,a=i.heap_max+1;a<Oa;a++)h=i.heap[a],d=e[e[h*2+1]*2+1]+1,d>c&&(d=c,x++),e[h*2+1]=d,!(h>n)&&(i.bl_count[d]++,u=0,h>=l&&(u=o[h-l]),p=e[h*2],i.opt_len+=p*(d+u),s&&(i.static_len+=p*(r[h*2+1]+u)));if(x!==0){do{for(d=c-1;i.bl_count[d]===0;)d--;i.bl_count[d]--,i.bl_count[d+1]+=2,i.bl_count[c]--,x-=2}while(x>0);for(d=c;d!==0;d--)for(h=i.bl_count[d];h!==0;)f=i.heap[--a],!(f>n)&&(e[f*2+1]!==d&&(i.opt_len+=(d-e[f*2+1])*e[f*2],e[f*2+1]=d),h--)}},Ga=(i,t,e)=>{const n=new Array(Vt+1);let r=0,s,o;for(s=1;s<=Vt;s++)r=r+e[s-1]<<1,n[s]=r;for(o=0;o<=t;o++){let l=i[o*2+1];l!==0&&(i[o*2]=Za(n[l]++,l))}},yf=()=>{let i,t,e,n,r;const s=new Array(Vt+1);for(e=0,n=0;n<Xr-1;n++)for(qr[n]=e,i=0;i<1<<br[n];i++)Dn[e++]=n;for(Dn[e-1]=n,r=0,n=0;n<16;n++)for(Wi[n]=r,i=0;i<1<<Fi[n];i++)Mn[r++]=n;for(r>>=7;n<en;n++)for(Wi[n]=r<<7,i=0;i<1<<Fi[n]-7;i++)Mn[256+r++]=n;for(t=0;t<=Vt;t++)s[t]=0;for(i=0;i<=143;)ft[i*2+1]=8,i++,s[8]++;for(;i<=255;)ft[i*2+1]=9,i++,s[9]++;for(;i<=279;)ft[i*2+1]=7,i++,s[7]++;for(;i<=287;)ft[i*2+1]=8,i++,s[8]++;for(Ga(ft,En+1,s),i=0;i<en;i++)wn[i*2+1]=5,wn[i*2]=Za(i,5);La=new sr(ft,br,Wn+1,En,Vt),Ua=new sr(wn,Fi,0,en,Vt),qa=new sr(new Array(0),pf,0,Lr,df)},Ka=i=>{let t;for(t=0;t<En;t++)i.dyn_ltree[t*2]=0;for(t=0;t<en;t++)i.dyn_dtree[t*2]=0;for(t=0;t<Lr;t++)i.bl_tree[t*2]=0;i.dyn_ltree[Ur*2]=1,i.opt_len=i.static_len=0,i.sym_next=i.matches=0},Qa=i=>{i.bi_valid>8?kn(i,i.bi_buf):i.bi_valid>0&&(i.pending_buf[i.pending++]=i.bi_buf),i.bi_buf=0,i.bi_valid=0},uo=(i,t,e,n)=>{const r=t*2,s=e*2;return i[r]<i[s]||i[r]===i[s]&&n[t]<=n[e]},ar=(i,t,e)=>{const n=i.heap[e];let r=e<<1;for(;r<=i.heap_len&&(r<i.heap_len&&uo(t,i.heap[r+1],i.heap[r],i.depth)&&r++,!uo(t,n,i.heap[r],i.depth));)i.heap[e]=i.heap[r],e=r,r<<=1;i.heap[e]=n},fo=(i,t,e)=>{let n,r,s=0,o,l;if(i.sym_next!==0)do n=i.pending_buf[i.sym_buf+s++]&255,n+=(i.pending_buf[i.sym_buf+s++]&255)<<8,r=i.pending_buf[i.sym_buf+s++],n===0?at(i,r,t):(o=Dn[r],at(i,o+Wn+1,t),l=br[o],l!==0&&(r-=qr[o],Ne(i,r,l)),n--,o=ja(n),at(i,o,e),l=Fi[o],l!==0&&(n-=Wi[o],Ne(i,n,l)));while(s<i.sym_next);at(i,Ur,t)},Cr=(i,t)=>{const e=t.dyn_tree,n=t.stat_desc.static_tree,r=t.stat_desc.has_stree,s=t.stat_desc.elems;let o,l,c=-1,a;for(i.heap_len=0,i.heap_max=Oa,o=0;o<s;o++)e[o*2]!==0?(i.heap[++i.heap_len]=c=o,i.depth[o]=0):e[o*2+1]=0;for(;i.heap_len<2;)a=i.heap[++i.heap_len]=c<2?++c:0,e[a*2]=1,i.depth[a]=0,i.opt_len--,r&&(i.static_len-=n[a*2+1]);for(t.max_code=c,o=i.heap_len>>1;o>=1;o--)ar(i,e,o);a=s;do o=i.heap[1],i.heap[1]=i.heap[i.heap_len--],ar(i,e,1),l=i.heap[1],i.heap[--i.heap_max]=o,i.heap[--i.heap_max]=l,e[a*2]=e[o*2]+e[l*2],i.depth[a]=(i.depth[o]>=i.depth[l]?i.depth[o]:i.depth[l])+1,e[o*2+1]=e[l*2+1]=a,i.heap[1]=a++,ar(i,e,1);while(i.heap_len>=2);i.heap[--i.heap_max]=i.heap[1],mf(i,t),Ga(e,c,i.bl_count)},po=(i,t,e)=>{let n,r=-1,s,o=t[1],l=0,c=7,a=4;for(o===0&&(c=138,a=3),t[(e+1)*2+1]=65535,n=0;n<=e;n++)s=o,o=t[(n+1)*2+1],!(++l<c&&s===o)&&(l<a?i.bl_tree[s*2]+=l:s!==0?(s!==r&&i.bl_tree[s*2]++,i.bl_tree[Ha*2]++):l<=10?i.bl_tree[$a*2]++:i.bl_tree[Ya*2]++,l=0,r=s,o===0?(c=138,a=3):s===o?(c=6,a=3):(c=7,a=4))},xo=(i,t,e)=>{let n,r=-1,s,o=t[1],l=0,c=7,a=4;for(o===0&&(c=138,a=3),n=0;n<=e;n++)if(s=o,o=t[(n+1)*2+1],!(++l<c&&s===o)){if(l<a)do at(i,s,i.bl_tree);while(--l!==0);else s!==0?(s!==r&&(at(i,s,i.bl_tree),l--),at(i,Ha,i.bl_tree),Ne(i,l-3,2)):l<=10?(at(i,$a,i.bl_tree),Ne(i,l-3,3)):(at(i,Ya,i.bl_tree),Ne(i,l-11,7));l=0,r=s,o===0?(c=138,a=3):s===o?(c=6,a=3):(c=7,a=4)}},vf=i=>{let t;for(po(i,i.dyn_ltree,i.l_desc.max_code),po(i,i.dyn_dtree,i.d_desc.max_code),Cr(i,i.bl_desc),t=Lr-1;t>=3&&i.bl_tree[Xa[t]*2+1]===0;t--);return i.opt_len+=3*(t+1)+5+5+4,t},_f=(i,t,e,n)=>{let r;for(Ne(i,t-257,5),Ne(i,e-1,5),Ne(i,n-4,4),r=0;r<n;r++)Ne(i,i.bl_tree[Xa[r]*2+1],3);xo(i,i.dyn_ltree,t-1),xo(i,i.dyn_dtree,e-1)},wf=i=>{let t=4093624447,e;for(e=0;e<=31;e++,t>>>=1)if(t&1&&i.dyn_ltree[e*2]!==0)return co;if(i.dyn_ltree[18]!==0||i.dyn_ltree[20]!==0||i.dyn_ltree[26]!==0)return ho;for(e=32;e<Wn;e++)if(i.dyn_ltree[e*2]!==0)return ho;return co};let go=!1;const bf=i=>{go||(yf(),go=!0),i.l_desc=new or(i.dyn_ltree,La),i.d_desc=new or(i.dyn_dtree,Ua),i.bl_desc=new or(i.bl_tree,qa),i.bi_buf=0,i.bi_valid=0,Ka(i)},Ja=(i,t,e,n)=>{Ne(i,(cf<<1)+(n?1:0),3),Qa(i),kn(i,e),kn(i,~e),e&&i.pending_buf.set(i.window.subarray(t,t+e),i.pending),i.pending+=e},Cf=i=>{Ne(i,Wa<<1,3),at(i,Ur,ft),gf(i)},Af=(i,t,e,n)=>{let r,s,o=0;i.level>0?(i.strm.data_type===lf&&(i.strm.data_type=wf(i)),Cr(i,i.l_desc),Cr(i,i.d_desc),o=vf(i),r=i.opt_len+3+7>>>3,s=i.static_len+3+7>>>3,s<=r&&(r=s)):r=s=e+5,e+4<=r&&t!==-1?Ja(i,t,e,n):i.strategy===af||s===r?(Ne(i,(Wa<<1)+(n?1:0),3),fo(i,ft,wn)):(Ne(i,(hf<<1)+(n?1:0),3),_f(i,i.l_desc.max_code+1,i.d_desc.max_code+1,o+1),fo(i,i.dyn_ltree,i.dyn_dtree)),Ka(i),n&&Qa(i)},Sf=(i,t,e)=>(i.pending_buf[i.sym_buf+i.sym_next++]=t,i.pending_buf[i.sym_buf+i.sym_next++]=t>>8,i.pending_buf[i.sym_buf+i.sym_next++]=e,t===0?i.dyn_ltree[e*2]++:(i.matches++,t--,i.dyn_ltree[(Dn[e]+Wn+1)*2]++,i.dyn_dtree[ja(t)*2]++),i.sym_next===i.sym_end);var Ef=bf,Mf=Ja,Df=Af,kf=Sf,Bf=Cf,Tf={_tr_init:Ef,_tr_stored_block:Mf,_tr_flush_block:Df,_tr_tally:kf,_tr_align:Bf};const If=(i,t,e,n)=>{let r=i&65535|0,s=i>>>16&65535|0,o=0;for(;e!==0;){o=e>2e3?2e3:e,e-=o;do r=r+t[n++]|0,s=s+r|0;while(--o);r%=65521,s%=65521}return r|s<<16|0};var Bn=If;const Pf=()=>{let i,t=[];for(var e=0;e<256;e++){i=e;for(var n=0;n<8;n++)i=i&1?3988292384^i>>>1:i>>>1;t[e]=i}return t},Vf=new Uint32Array(Pf()),Ff=(i,t,e,n)=>{const r=Vf,s=n+e;i^=-1;for(let o=n;o<s;o++)i=i>>>8^r[(i^t[o])&255];return i^-1};var Ce=Ff,zt={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},On={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Rf,_tr_stored_block:Ar,_tr_flush_block:zf,_tr_tally:St,_tr_align:Nf}=Tf,{Z_NO_FLUSH:Et,Z_PARTIAL_FLUSH:Wf,Z_FULL_FLUSH:Of,Z_FINISH:Le,Z_BLOCK:mo,Z_OK:De,Z_STREAM_END:yo,Z_STREAM_ERROR:lt,Z_DATA_ERROR:Hf,Z_BUF_ERROR:lr,Z_DEFAULT_COMPRESSION:$f,Z_FILTERED:Yf,Z_HUFFMAN_ONLY:qn,Z_RLE:Xf,Z_FIXED:Lf,Z_DEFAULT_STRATEGY:Uf,Z_UNKNOWN:qf,Z_DEFLATED:Gi}=On,jf=9,Zf=15,Gf=8,Kf=29,Qf=256,Sr=Qf+1+Kf,Jf=30,ed=19,td=2*Sr+1,nd=15,te=3,bt=258,ct=bt+te+1,id=32,tn=42,jr=57,Er=69,Mr=73,Dr=91,kr=103,Ft=113,mn=666,Pe=1,sn=2,Nt=3,on=4,rd=3,Rt=(i,t)=>(i.msg=zt[t],t),vo=i=>i*2-(i>4?9:0),wt=i=>{let t=i.length;for(;--t>=0;)i[t]=0},sd=i=>{let t,e,n,r=i.w_size;t=i.hash_size,n=t;do e=i.head[--n],i.head[n]=e>=r?e-r:0;while(--t);t=r,n=t;do e=i.prev[--n],i.prev[n]=e>=r?e-r:0;while(--t)};let od=(i,t,e)=>(t<<i.hash_shift^e)&i.hash_mask,Mt=od;const Oe=i=>{const t=i.state;let e=t.pending;e>i.avail_out&&(e=i.avail_out),e!==0&&(i.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+e),i.next_out),i.next_out+=e,t.pending_out+=e,i.total_out+=e,i.avail_out-=e,t.pending-=e,t.pending===0&&(t.pending_out=0))},He=(i,t)=>{zf(i,i.block_start>=0?i.block_start:-1,i.strstart-i.block_start,t),i.block_start=i.strstart,Oe(i.strm)},re=(i,t)=>{i.pending_buf[i.pending++]=t},gn=(i,t)=>{i.pending_buf[i.pending++]=t>>>8&255,i.pending_buf[i.pending++]=t&255},Br=(i,t,e,n)=>{let r=i.avail_in;return r>n&&(r=n),r===0?0:(i.avail_in-=r,t.set(i.input.subarray(i.next_in,i.next_in+r),e),i.state.wrap===1?i.adler=Bn(i.adler,t,r,e):i.state.wrap===2&&(i.adler=Ce(i.adler,t,r,e)),i.next_in+=r,i.total_in+=r,r)},el=(i,t)=>{let e=i.max_chain_length,n=i.strstart,r,s,o=i.prev_length,l=i.nice_match;const c=i.strstart>i.w_size-ct?i.strstart-(i.w_size-ct):0,a=i.window,h=i.w_mask,f=i.prev,d=i.strstart+bt;let u=a[n+o-1],p=a[n+o];i.prev_length>=i.good_match&&(e>>=2),l>i.lookahead&&(l=i.lookahead);do if(r=t,!(a[r+o]!==p||a[r+o-1]!==u||a[r]!==a[n]||a[++r]!==a[n+1])){n+=2,r++;do;while(a[++n]===a[++r]&&a[++n]===a[++r]&&a[++n]===a[++r]&&a[++n]===a[++r]&&a[++n]===a[++r]&&a[++n]===a[++r]&&a[++n]===a[++r]&&a[++n]===a[++r]&&n<d);if(s=bt-(d-n),n=d-bt,s>o){if(i.match_start=t,o=s,s>=l)break;u=a[n+o-1],p=a[n+o]}}while((t=f[t&h])>c&&--e!==0);return o<=i.lookahead?o:i.lookahead},nn=i=>{const t=i.w_size;let e,n,r;do{if(n=i.window_size-i.lookahead-i.strstart,i.strstart>=t+(t-ct)&&(i.window.set(i.window.subarray(t,t+t-n),0),i.match_start-=t,i.strstart-=t,i.block_start-=t,i.insert>i.strstart&&(i.insert=i.strstart),sd(i),n+=t),i.strm.avail_in===0)break;if(e=Br(i.strm,i.window,i.strstart+i.lookahead,n),i.lookahead+=e,i.lookahead+i.insert>=te)for(r=i.strstart-i.insert,i.ins_h=i.window[r],i.ins_h=Mt(i,i.ins_h,i.window[r+1]);i.insert&&(i.ins_h=Mt(i,i.ins_h,i.window[r+te-1]),i.prev[r&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=r,r++,i.insert--,!(i.lookahead+i.insert<te)););}while(i.lookahead<ct&&i.strm.avail_in!==0)},tl=(i,t)=>{let e=i.pending_buf_size-5>i.w_size?i.w_size:i.pending_buf_size-5,n,r,s,o=0,l=i.strm.avail_in;do{if(n=65535,s=i.bi_valid+42>>3,i.strm.avail_out<s||(s=i.strm.avail_out-s,r=i.strstart-i.block_start,n>r+i.strm.avail_in&&(n=r+i.strm.avail_in),n>s&&(n=s),n<e&&(n===0&&t!==Le||t===Et||n!==r+i.strm.avail_in)))break;o=t===Le&&n===r+i.strm.avail_in?1:0,Ar(i,0,0,o),i.pending_buf[i.pending-4]=n,i.pending_buf[i.pending-3]=n>>8,i.pending_buf[i.pending-2]=~n,i.pending_buf[i.pending-1]=~n>>8,Oe(i.strm),r&&(r>n&&(r=n),i.strm.output.set(i.window.subarray(i.block_start,i.block_start+r),i.strm.next_out),i.strm.next_out+=r,i.strm.avail_out-=r,i.strm.total_out+=r,i.block_start+=r,n-=r),n&&(Br(i.strm,i.strm.output,i.strm.next_out,n),i.strm.next_out+=n,i.strm.avail_out-=n,i.strm.total_out+=n)}while(o===0);return l-=i.strm.avail_in,l&&(l>=i.w_size?(i.matches=2,i.window.set(i.strm.input.subarray(i.strm.next_in-i.w_size,i.strm.next_in),0),i.strstart=i.w_size,i.insert=i.strstart):(i.window_size-i.strstart<=l&&(i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,i.insert>i.strstart&&(i.insert=i.strstart)),i.window.set(i.strm.input.subarray(i.strm.next_in-l,i.strm.next_in),i.strstart),i.strstart+=l,i.insert+=l>i.w_size-i.insert?i.w_size-i.insert:l),i.block_start=i.strstart),i.high_water<i.strstart&&(i.high_water=i.strstart),o?on:t!==Et&&t!==Le&&i.strm.avail_in===0&&i.strstart===i.block_start?sn:(s=i.window_size-i.strstart,i.strm.avail_in>s&&i.block_start>=i.w_size&&(i.block_start-=i.w_size,i.strstart-=i.w_size,i.window.set(i.window.subarray(i.w_size,i.w_size+i.strstart),0),i.matches<2&&i.matches++,s+=i.w_size,i.insert>i.strstart&&(i.insert=i.strstart)),s>i.strm.avail_in&&(s=i.strm.avail_in),s&&(Br(i.strm,i.window,i.strstart,s),i.strstart+=s,i.insert+=s>i.w_size-i.insert?i.w_size-i.insert:s),i.high_water<i.strstart&&(i.high_water=i.strstart),s=i.bi_valid+42>>3,s=i.pending_buf_size-s>65535?65535:i.pending_buf_size-s,e=s>i.w_size?i.w_size:s,r=i.strstart-i.block_start,(r>=e||(r||t===Le)&&t!==Et&&i.strm.avail_in===0&&r<=s)&&(n=r>s?s:r,o=t===Le&&i.strm.avail_in===0&&n===r?1:0,Ar(i,i.block_start,n,o),i.block_start+=n,Oe(i.strm)),o?Nt:Pe)},cr=(i,t)=>{let e,n;for(;;){if(i.lookahead<ct){if(nn(i),i.lookahead<ct&&t===Et)return Pe;if(i.lookahead===0)break}if(e=0,i.lookahead>=te&&(i.ins_h=Mt(i,i.ins_h,i.window[i.strstart+te-1]),e=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),e!==0&&i.strstart-e<=i.w_size-ct&&(i.match_length=el(i,e)),i.match_length>=te)if(n=St(i,i.strstart-i.match_start,i.match_length-te),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=te){i.match_length--;do i.strstart++,i.ins_h=Mt(i,i.ins_h,i.window[i.strstart+te-1]),e=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart;while(--i.match_length!==0);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=Mt(i,i.ins_h,i.window[i.strstart+1]);else n=St(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(n&&(He(i,!1),i.strm.avail_out===0))return Pe}return i.insert=i.strstart<te-1?i.strstart:te-1,t===Le?(He(i,!0),i.strm.avail_out===0?Nt:on):i.sym_next&&(He(i,!1),i.strm.avail_out===0)?Pe:sn},Gt=(i,t)=>{let e,n,r;for(;;){if(i.lookahead<ct){if(nn(i),i.lookahead<ct&&t===Et)return Pe;if(i.lookahead===0)break}if(e=0,i.lookahead>=te&&(i.ins_h=Mt(i,i.ins_h,i.window[i.strstart+te-1]),e=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=te-1,e!==0&&i.prev_length<i.max_lazy_match&&i.strstart-e<=i.w_size-ct&&(i.match_length=el(i,e),i.match_length<=5&&(i.strategy===Yf||i.match_length===te&&i.strstart-i.match_start>4096)&&(i.match_length=te-1)),i.prev_length>=te&&i.match_length<=i.prev_length){r=i.strstart+i.lookahead-te,n=St(i,i.strstart-1-i.prev_match,i.prev_length-te),i.lookahead-=i.prev_length-1,i.prev_length-=2;do++i.strstart<=r&&(i.ins_h=Mt(i,i.ins_h,i.window[i.strstart+te-1]),e=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart);while(--i.prev_length!==0);if(i.match_available=0,i.match_length=te-1,i.strstart++,n&&(He(i,!1),i.strm.avail_out===0))return Pe}else if(i.match_available){if(n=St(i,0,i.window[i.strstart-1]),n&&He(i,!1),i.strstart++,i.lookahead--,i.strm.avail_out===0)return Pe}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(n=St(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<te-1?i.strstart:te-1,t===Le?(He(i,!0),i.strm.avail_out===0?Nt:on):i.sym_next&&(He(i,!1),i.strm.avail_out===0)?Pe:sn},ad=(i,t)=>{let e,n,r,s;const o=i.window;for(;;){if(i.lookahead<=bt){if(nn(i),i.lookahead<=bt&&t===Et)return Pe;if(i.lookahead===0)break}if(i.match_length=0,i.lookahead>=te&&i.strstart>0&&(r=i.strstart-1,n=o[r],n===o[++r]&&n===o[++r]&&n===o[++r])){s=i.strstart+bt;do;while(n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&n===o[++r]&&r<s);i.match_length=bt-(s-r),i.match_length>i.lookahead&&(i.match_length=i.lookahead)}if(i.match_length>=te?(e=St(i,1,i.match_length-te),i.lookahead-=i.match_length,i.strstart+=i.match_length,i.match_length=0):(e=St(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++),e&&(He(i,!1),i.strm.avail_out===0))return Pe}return i.insert=0,t===Le?(He(i,!0),i.strm.avail_out===0?Nt:on):i.sym_next&&(He(i,!1),i.strm.avail_out===0)?Pe:sn},ld=(i,t)=>{let e;for(;;){if(i.lookahead===0&&(nn(i),i.lookahead===0)){if(t===Et)return Pe;break}if(i.match_length=0,e=St(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++,e&&(He(i,!1),i.strm.avail_out===0))return Pe}return i.insert=0,t===Le?(He(i,!0),i.strm.avail_out===0?Nt:on):i.sym_next&&(He(i,!1),i.strm.avail_out===0)?Pe:sn};function st(i,t,e,n,r){this.good_length=i,this.max_lazy=t,this.nice_length=e,this.max_chain=n,this.func=r}const yn=[new st(0,0,0,0,tl),new st(4,4,8,4,cr),new st(4,5,16,8,cr),new st(4,6,32,32,cr),new st(4,4,16,16,Gt),new st(8,16,32,32,Gt),new st(8,16,128,128,Gt),new st(8,32,128,256,Gt),new st(32,128,258,1024,Gt),new st(32,258,258,4096,Gt)],cd=i=>{i.window_size=2*i.w_size,wt(i.head),i.max_lazy_match=yn[i.level].max_lazy,i.good_match=yn[i.level].good_length,i.nice_match=yn[i.level].nice_length,i.max_chain_length=yn[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=te-1,i.match_available=0,i.ins_h=0};function hd(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Gi,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(td*2),this.dyn_dtree=new Uint16Array((2*Jf+1)*2),this.bl_tree=new Uint16Array((2*ed+1)*2),wt(this.dyn_ltree),wt(this.dyn_dtree),wt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(nd+1),this.heap=new Uint16Array(2*Sr+1),wt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Sr+1),wt(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Hn=i=>{if(!i)return 1;const t=i.state;return!t||t.strm!==i||t.status!==tn&&t.status!==jr&&t.status!==Er&&t.status!==Mr&&t.status!==Dr&&t.status!==kr&&t.status!==Ft&&t.status!==mn?1:0},nl=i=>{if(Hn(i))return Rt(i,lt);i.total_in=i.total_out=0,i.data_type=qf;const t=i.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?jr:t.wrap?tn:Ft,i.adler=t.wrap===2?0:1,t.last_flush=-2,Rf(t),De},il=i=>{const t=nl(i);return t===De&&cd(i.state),t},ud=(i,t)=>Hn(i)||i.state.wrap!==2?lt:(i.state.gzhead=t,De),rl=(i,t,e,n,r,s)=>{if(!i)return lt;let o=1;if(t===$f&&(t=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),r<1||r>jf||e!==Gi||n<8||n>15||t<0||t>9||s<0||s>Lf||n===8&&o!==1)return Rt(i,lt);n===8&&(n=9);const l=new hd;return i.state=l,l.strm=i,l.status=tn,l.wrap=o,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+te-1)/te),l.window=new Uint8Array(l.w_size*2),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=l.lit_bufsize*4,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=(l.lit_bufsize-1)*3,l.level=t,l.strategy=s,l.method=e,il(i)},fd=(i,t)=>rl(i,t,Gi,Zf,Gf,Uf),dd=(i,t)=>{if(Hn(i)||t>mo||t<0)return i?Rt(i,lt):lt;const e=i.state;if(!i.output||i.avail_in!==0&&!i.input||e.status===mn&&t!==Le)return Rt(i,i.avail_out===0?lr:lt);const n=e.last_flush;if(e.last_flush=t,e.pending!==0){if(Oe(i),i.avail_out===0)return e.last_flush=-1,De}else if(i.avail_in===0&&vo(t)<=vo(n)&&t!==Le)return Rt(i,lr);if(e.status===mn&&i.avail_in!==0)return Rt(i,lr);if(e.status===tn&&e.wrap===0&&(e.status=Ft),e.status===tn){let r=Gi+(e.w_bits-8<<4)<<8,s=-1;if(e.strategy>=qn||e.level<2?s=0:e.level<6?s=1:e.level===6?s=2:s=3,r|=s<<6,e.strstart!==0&&(r|=id),r+=31-r%31,gn(e,r),e.strstart!==0&&(gn(e,i.adler>>>16),gn(e,i.adler&65535)),i.adler=1,e.status=Ft,Oe(i),e.pending!==0)return e.last_flush=-1,De}if(e.status===jr){if(i.adler=0,re(e,31),re(e,139),re(e,8),e.gzhead)re(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),re(e,e.gzhead.time&255),re(e,e.gzhead.time>>8&255),re(e,e.gzhead.time>>16&255),re(e,e.gzhead.time>>24&255),re(e,e.level===9?2:e.strategy>=qn||e.level<2?4:0),re(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(re(e,e.gzhead.extra.length&255),re(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(i.adler=Ce(i.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=Er;else if(re(e,0),re(e,0),re(e,0),re(e,0),re(e,0),re(e,e.level===9?2:e.strategy>=qn||e.level<2?4:0),re(e,rd),e.status=Ft,Oe(i),e.pending!==0)return e.last_flush=-1,De}if(e.status===Er){if(e.gzhead.extra){let r=e.pending,s=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+s>e.pending_buf_size;){let l=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+l),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>r&&(i.adler=Ce(i.adler,e.pending_buf,e.pending-r,r)),e.gzindex+=l,Oe(i),e.pending!==0)return e.last_flush=-1,De;r=0,s-=l}let o=new Uint8Array(e.gzhead.extra);e.pending_buf.set(o.subarray(e.gzindex,e.gzindex+s),e.pending),e.pending+=s,e.gzhead.hcrc&&e.pending>r&&(i.adler=Ce(i.adler,e.pending_buf,e.pending-r,r)),e.gzindex=0}e.status=Mr}if(e.status===Mr){if(e.gzhead.name){let r=e.pending,s;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>r&&(i.adler=Ce(i.adler,e.pending_buf,e.pending-r,r)),Oe(i),e.pending!==0)return e.last_flush=-1,De;r=0}e.gzindex<e.gzhead.name.length?s=e.gzhead.name.charCodeAt(e.gzindex++)&255:s=0,re(e,s)}while(s!==0);e.gzhead.hcrc&&e.pending>r&&(i.adler=Ce(i.adler,e.pending_buf,e.pending-r,r)),e.gzindex=0}e.status=Dr}if(e.status===Dr){if(e.gzhead.comment){let r=e.pending,s;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>r&&(i.adler=Ce(i.adler,e.pending_buf,e.pending-r,r)),Oe(i),e.pending!==0)return e.last_flush=-1,De;r=0}e.gzindex<e.gzhead.comment.length?s=e.gzhead.comment.charCodeAt(e.gzindex++)&255:s=0,re(e,s)}while(s!==0);e.gzhead.hcrc&&e.pending>r&&(i.adler=Ce(i.adler,e.pending_buf,e.pending-r,r))}e.status=kr}if(e.status===kr){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(Oe(i),e.pending!==0))return e.last_flush=-1,De;re(e,i.adler&255),re(e,i.adler>>8&255),i.adler=0}if(e.status=Ft,Oe(i),e.pending!==0)return e.last_flush=-1,De}if(i.avail_in!==0||e.lookahead!==0||t!==Et&&e.status!==mn){let r=e.level===0?tl(e,t):e.strategy===qn?ld(e,t):e.strategy===Xf?ad(e,t):yn[e.level].func(e,t);if((r===Nt||r===on)&&(e.status=mn),r===Pe||r===Nt)return i.avail_out===0&&(e.last_flush=-1),De;if(r===sn&&(t===Wf?Nf(e):t!==mo&&(Ar(e,0,0,!1),t===Of&&(wt(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),Oe(i),i.avail_out===0))return e.last_flush=-1,De}return t!==Le?De:e.wrap<=0?yo:(e.wrap===2?(re(e,i.adler&255),re(e,i.adler>>8&255),re(e,i.adler>>16&255),re(e,i.adler>>24&255),re(e,i.total_in&255),re(e,i.total_in>>8&255),re(e,i.total_in>>16&255),re(e,i.total_in>>24&255)):(gn(e,i.adler>>>16),gn(e,i.adler&65535)),Oe(i),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?De:yo)},pd=i=>{if(Hn(i))return lt;const t=i.state.status;return i.state=null,t===Ft?Rt(i,Hf):De},xd=(i,t)=>{let e=t.length;if(Hn(i))return lt;const n=i.state,r=n.wrap;if(r===2||r===1&&n.status!==tn||n.lookahead)return lt;if(r===1&&(i.adler=Bn(i.adler,t,e,0)),n.wrap=0,e>=n.w_size){r===0&&(wt(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(t.subarray(e-n.w_size,e),0),t=c,e=n.w_size}const s=i.avail_in,o=i.next_in,l=i.input;for(i.avail_in=e,i.next_in=0,i.input=t,nn(n);n.lookahead>=te;){let c=n.strstart,a=n.lookahead-(te-1);do n.ins_h=Mt(n,n.ins_h,n.window[c+te-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--a);n.strstart=c,n.lookahead=te-1,nn(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=te-1,n.match_available=0,i.next_in=o,i.input=l,i.avail_in=s,n.wrap=r,De};var gd=fd,md=rl,yd=il,vd=nl,_d=ud,wd=dd,bd=pd,Cd=xd,Ad="pako deflate (from Nodeca project)",bn={deflateInit:gd,deflateInit2:md,deflateReset:yd,deflateResetKeep:vd,deflateSetHeader:_d,deflate:wd,deflateEnd:bd,deflateSetDictionary:Cd,deflateInfo:Ad};const Sd=(i,t)=>Object.prototype.hasOwnProperty.call(i,t);var Ed=function(i){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const n in e)Sd(e,n)&&(i[n]=e[n])}}return i},Md=i=>{let t=0;for(let n=0,r=i.length;n<r;n++)t+=i[n].length;const e=new Uint8Array(t);for(let n=0,r=0,s=i.length;n<s;n++){let o=i[n];e.set(o,r),r+=o.length}return e},Ki={assign:Ed,flattenChunks:Md};let sl=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{sl=!1}const Tn=new Uint8Array(256);for(let i=0;i<256;i++)Tn[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;Tn[254]=Tn[254]=1;var Dd=i=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(i);let t,e,n,r,s,o=i.length,l=0;for(r=0;r<o;r++)e=i.charCodeAt(r),(e&64512)===55296&&r+1<o&&(n=i.charCodeAt(r+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),r++)),l+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(l),s=0,r=0;s<l;r++)e=i.charCodeAt(r),(e&64512)===55296&&r+1<o&&(n=i.charCodeAt(r+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),r++)),e<128?t[s++]=e:e<2048?(t[s++]=192|e>>>6,t[s++]=128|e&63):e<65536?(t[s++]=224|e>>>12,t[s++]=128|e>>>6&63,t[s++]=128|e&63):(t[s++]=240|e>>>18,t[s++]=128|e>>>12&63,t[s++]=128|e>>>6&63,t[s++]=128|e&63);return t};const kd=(i,t)=>{if(t<65534&&i.subarray&&sl)return String.fromCharCode.apply(null,i.length===t?i:i.subarray(0,t));let e="";for(let n=0;n<t;n++)e+=String.fromCharCode(i[n]);return e};var Bd=(i,t)=>{const e=t||i.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(i.subarray(0,t));let n,r;const s=new Array(e*2);for(r=0,n=0;n<e;){let o=i[n++];if(o<128){s[r++]=o;continue}let l=Tn[o];if(l>4){s[r++]=65533,n+=l-1;continue}for(o&=l===2?31:l===3?15:7;l>1&&n<e;)o=o<<6|i[n++]&63,l--;if(l>1){s[r++]=65533;continue}o<65536?s[r++]=o:(o-=65536,s[r++]=55296|o>>10&1023,s[r++]=56320|o&1023)}return kd(s,r)},Td=(i,t)=>{t=t||i.length,t>i.length&&(t=i.length);let e=t-1;for(;e>=0&&(i[e]&192)===128;)e--;return e<0||e===0?t:e+Tn[i[e]]>t?e:t},In={string2buf:Dd,buf2string:Bd,utf8border:Td};function Id(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var ol=Id;const al=Object.prototype.toString,{Z_NO_FLUSH:Pd,Z_SYNC_FLUSH:Vd,Z_FULL_FLUSH:Fd,Z_FINISH:Rd,Z_OK:Oi,Z_STREAM_END:zd,Z_DEFAULT_COMPRESSION:Nd,Z_DEFAULT_STRATEGY:Wd,Z_DEFLATED:Od}=On;function $n(i){this.options=Ki.assign({level:Nd,method:Od,chunkSize:16384,windowBits:15,memLevel:8,strategy:Wd},i||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ol,this.strm.avail_out=0;let e=bn.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==Oi)throw new Error(zt[e]);if(t.header&&bn.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(typeof t.dictionary=="string"?n=In.string2buf(t.dictionary):al.call(t.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(t.dictionary):n=t.dictionary,e=bn.deflateSetDictionary(this.strm,n),e!==Oi)throw new Error(zt[e]);this._dict_set=!0}}$n.prototype.push=function(i,t){const e=this.strm,n=this.options.chunkSize;let r,s;if(this.ended)return!1;for(t===~~t?s=t:s=t===!0?Rd:Pd,typeof i=="string"?e.input=In.string2buf(i):al.call(i)==="[object ArrayBuffer]"?e.input=new Uint8Array(i):e.input=i,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),(s===Vd||s===Fd)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(r=bn.deflate(e,s),r===zd)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),r=bn.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Oi;if(e.avail_out===0){this.onData(e.output);continue}if(s>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};$n.prototype.onData=function(i){this.chunks.push(i)};$n.prototype.onEnd=function(i){i===Oi&&(this.result=Ki.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function Zr(i,t){const e=new $n(t);if(e.push(i,!0),e.err)throw e.msg||zt[e.err];return e.result}function Hd(i,t){return t=t||{},t.raw=!0,Zr(i,t)}function $d(i,t){return t=t||{},t.gzip=!0,Zr(i,t)}var Yd=$n,Xd=Zr,Ld=Hd,Ud=$d,qd={Deflate:Yd,deflate:Xd,deflateRaw:Ld,gzip:Ud};const jn=16209,jd=16191;var Zd=function(t,e){let n,r,s,o,l,c,a,h,f,d,u,p,x,g,m,y,v,_,w,b,C,M,T,S;const E=t.state;n=t.next_in,T=t.input,r=n+(t.avail_in-5),s=t.next_out,S=t.output,o=s-(e-t.avail_out),l=s+(t.avail_out-257),c=E.dmax,a=E.wsize,h=E.whave,f=E.wnext,d=E.window,u=E.hold,p=E.bits,x=E.lencode,g=E.distcode,m=(1<<E.lenbits)-1,y=(1<<E.distbits)-1;e:do{p<15&&(u+=T[n++]<<p,p+=8,u+=T[n++]<<p,p+=8),v=x[u&m];t:for(;;){if(_=v>>>24,u>>>=_,p-=_,_=v>>>16&255,_===0)S[s++]=v&65535;else if(_&16){w=v&65535,_&=15,_&&(p<_&&(u+=T[n++]<<p,p+=8),w+=u&(1<<_)-1,u>>>=_,p-=_),p<15&&(u+=T[n++]<<p,p+=8,u+=T[n++]<<p,p+=8),v=g[u&y];n:for(;;){if(_=v>>>24,u>>>=_,p-=_,_=v>>>16&255,_&16){if(b=v&65535,_&=15,p<_&&(u+=T[n++]<<p,p+=8,p<_&&(u+=T[n++]<<p,p+=8)),b+=u&(1<<_)-1,b>c){t.msg="invalid distance too far back",E.mode=jn;break e}if(u>>>=_,p-=_,_=s-o,b>_){if(_=b-_,_>h&&E.sane){t.msg="invalid distance too far back",E.mode=jn;break e}if(C=0,M=d,f===0){if(C+=a-_,_<w){w-=_;do S[s++]=d[C++];while(--_);C=s-b,M=S}}else if(f<_){if(C+=a+f-_,_-=f,_<w){w-=_;do S[s++]=d[C++];while(--_);if(C=0,f<w){_=f,w-=_;do S[s++]=d[C++];while(--_);C=s-b,M=S}}}else if(C+=f-_,_<w){w-=_;do S[s++]=d[C++];while(--_);C=s-b,M=S}for(;w>2;)S[s++]=M[C++],S[s++]=M[C++],S[s++]=M[C++],w-=3;w&&(S[s++]=M[C++],w>1&&(S[s++]=M[C++]))}else{C=s-b;do S[s++]=S[C++],S[s++]=S[C++],S[s++]=S[C++],w-=3;while(w>2);w&&(S[s++]=S[C++],w>1&&(S[s++]=S[C++]))}}else if((_&64)===0){v=g[(v&65535)+(u&(1<<_)-1)];continue n}else{t.msg="invalid distance code",E.mode=jn;break e}break}}else if((_&64)===0){v=x[(v&65535)+(u&(1<<_)-1)];continue t}else if(_&32){E.mode=jd;break e}else{t.msg="invalid literal/length code",E.mode=jn;break e}break}}while(n<r&&s<l);w=p>>3,n-=w,p-=w<<3,u&=(1<<p)-1,t.next_in=n,t.next_out=s,t.avail_in=n<r?5+(r-n):5-(n-r),t.avail_out=s<l?257+(l-s):257-(s-l),E.hold=u,E.bits=p};const Kt=15,_o=852,wo=592,bo=0,hr=1,Co=2,Gd=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Kd=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Qd=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Jd=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),ep=(i,t,e,n,r,s,o,l)=>{const c=l.bits;let a=0,h=0,f=0,d=0,u=0,p=0,x=0,g=0,m=0,y=0,v,_,w,b,C,M=null,T;const S=new Uint16Array(Kt+1),E=new Uint16Array(Kt+1);let I=null,k,P,B;for(a=0;a<=Kt;a++)S[a]=0;for(h=0;h<n;h++)S[t[e+h]]++;for(u=c,d=Kt;d>=1&&S[d]===0;d--);if(u>d&&(u=d),d===0)return r[s++]=1<<24|64<<16|0,r[s++]=1<<24|64<<16|0,l.bits=1,0;for(f=1;f<d&&S[f]===0;f++);for(u<f&&(u=f),g=1,a=1;a<=Kt;a++)if(g<<=1,g-=S[a],g<0)return-1;if(g>0&&(i===bo||d!==1))return-1;for(E[1]=0,a=1;a<Kt;a++)E[a+1]=E[a]+S[a];for(h=0;h<n;h++)t[e+h]!==0&&(o[E[t[e+h]]++]=h);if(i===bo?(M=I=o,T=20):i===hr?(M=Gd,I=Kd,T=257):(M=Qd,I=Jd,T=0),y=0,h=0,a=f,C=s,p=u,x=0,w=-1,m=1<<u,b=m-1,i===hr&&m>_o||i===Co&&m>wo)return 1;for(;;){k=a-x,o[h]+1<T?(P=0,B=o[h]):o[h]>=T?(P=I[o[h]-T],B=M[o[h]-T]):(P=96,B=0),v=1<<a-x,_=1<<p,f=_;do _-=v,r[C+(y>>x)+_]=k<<24|P<<16|B|0;while(_!==0);for(v=1<<a-1;y&v;)v>>=1;if(v!==0?(y&=v-1,y+=v):y=0,h++,--S[a]===0){if(a===d)break;a=t[e+o[h]]}if(a>u&&(y&b)!==w){for(x===0&&(x=u),C+=f,p=a-x,g=1<<p;p+x<d&&(g-=S[p+x],!(g<=0));)p++,g<<=1;if(m+=1<<p,i===hr&&m>_o||i===Co&&m>wo)return 1;w=y&b,r[w]=u<<24|p<<16|C-s|0}}return y!==0&&(r[C+y]=a-x<<24|64<<16|0),l.bits=u,0};var Cn=ep;const tp=0,ll=1,cl=2,{Z_FINISH:Ao,Z_BLOCK:np,Z_TREES:Zn,Z_OK:Wt,Z_STREAM_END:ip,Z_NEED_DICT:rp,Z_STREAM_ERROR:je,Z_DATA_ERROR:hl,Z_MEM_ERROR:ul,Z_BUF_ERROR:sp,Z_DEFLATED:So}=On,Qi=16180,Eo=16181,Mo=16182,Do=16183,ko=16184,Bo=16185,To=16186,Io=16187,Po=16188,Vo=16189,Hi=16190,ht=16191,ur=16192,Fo=16193,fr=16194,Ro=16195,zo=16196,No=16197,Wo=16198,Gn=16199,Kn=16200,Oo=16201,Ho=16202,$o=16203,Yo=16204,Xo=16205,dr=16206,Lo=16207,Uo=16208,pe=16209,fl=16210,dl=16211,op=852,ap=592,lp=15,cp=lp,qo=i=>(i>>>24&255)+(i>>>8&65280)+((i&65280)<<8)+((i&255)<<24);function hp(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const $t=i=>{if(!i)return 1;const t=i.state;return!t||t.strm!==i||t.mode<Qi||t.mode>dl?1:0},pl=i=>{if($t(i))return je;const t=i.state;return i.total_in=i.total_out=t.total=0,i.msg="",t.wrap&&(i.adler=t.wrap&1),t.mode=Qi,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(op),t.distcode=t.distdyn=new Int32Array(ap),t.sane=1,t.back=-1,Wt},xl=i=>{if($t(i))return je;const t=i.state;return t.wsize=0,t.whave=0,t.wnext=0,pl(i)},gl=(i,t)=>{let e;if($t(i))return je;const n=i.state;return t<0?(e=0,t=-t):(e=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?je:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=e,n.wbits=t,xl(i))},ml=(i,t)=>{if(!i)return je;const e=new hp;i.state=e,e.strm=i,e.window=null,e.mode=Qi;const n=gl(i,t);return n!==Wt&&(i.state=null),n},up=i=>ml(i,cp);let jo=!0,pr,xr;const fp=i=>{if(jo){pr=new Int32Array(512),xr=new Int32Array(32);let t=0;for(;t<144;)i.lens[t++]=8;for(;t<256;)i.lens[t++]=9;for(;t<280;)i.lens[t++]=7;for(;t<288;)i.lens[t++]=8;for(Cn(ll,i.lens,0,288,pr,0,i.work,{bits:9}),t=0;t<32;)i.lens[t++]=5;Cn(cl,i.lens,0,32,xr,0,i.work,{bits:5}),jo=!1}i.lencode=pr,i.lenbits=9,i.distcode=xr,i.distbits=5},yl=(i,t,e,n)=>{let r;const s=i.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(t.subarray(e-s.wsize,e),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>n&&(r=n),s.window.set(t.subarray(e-n,e-n+r),s.wnext),n-=r,n?(s.window.set(t.subarray(e-n,e),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0},dp=(i,t)=>{let e,n,r,s,o,l,c,a,h,f,d,u,p,x,g=0,m,y,v,_,w,b,C,M;const T=new Uint8Array(4);let S,E;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if($t(i)||!i.output||!i.input&&i.avail_in!==0)return je;e=i.state,e.mode===ht&&(e.mode=ur),o=i.next_out,r=i.output,c=i.avail_out,s=i.next_in,n=i.input,l=i.avail_in,a=e.hold,h=e.bits,f=l,d=c,M=Wt;e:for(;;)switch(e.mode){case Qi:if(e.wrap===0){e.mode=ur;break}for(;h<16;){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}if(e.wrap&2&&a===35615){e.wbits===0&&(e.wbits=15),e.check=0,T[0]=a&255,T[1]=a>>>8&255,e.check=Ce(e.check,T,2,0),a=0,h=0,e.mode=Eo;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((a&255)<<8)+(a>>8))%31){i.msg="incorrect header check",e.mode=pe;break}if((a&15)!==So){i.msg="unknown compression method",e.mode=pe;break}if(a>>>=4,h-=4,C=(a&15)+8,e.wbits===0&&(e.wbits=C),C>15||C>e.wbits){i.msg="invalid window size",e.mode=pe;break}e.dmax=1<<e.wbits,e.flags=0,i.adler=e.check=1,e.mode=a&512?Vo:ht,a=0,h=0;break;case Eo:for(;h<16;){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}if(e.flags=a,(e.flags&255)!==So){i.msg="unknown compression method",e.mode=pe;break}if(e.flags&57344){i.msg="unknown header flags set",e.mode=pe;break}e.head&&(e.head.text=a>>8&1),e.flags&512&&e.wrap&4&&(T[0]=a&255,T[1]=a>>>8&255,e.check=Ce(e.check,T,2,0)),a=0,h=0,e.mode=Mo;case Mo:for(;h<32;){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}e.head&&(e.head.time=a),e.flags&512&&e.wrap&4&&(T[0]=a&255,T[1]=a>>>8&255,T[2]=a>>>16&255,T[3]=a>>>24&255,e.check=Ce(e.check,T,4,0)),a=0,h=0,e.mode=Do;case Do:for(;h<16;){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}e.head&&(e.head.xflags=a&255,e.head.os=a>>8),e.flags&512&&e.wrap&4&&(T[0]=a&255,T[1]=a>>>8&255,e.check=Ce(e.check,T,2,0)),a=0,h=0,e.mode=ko;case ko:if(e.flags&1024){for(;h<16;){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}e.length=a,e.head&&(e.head.extra_len=a),e.flags&512&&e.wrap&4&&(T[0]=a&255,T[1]=a>>>8&255,e.check=Ce(e.check,T,2,0)),a=0,h=0}else e.head&&(e.head.extra=null);e.mode=Bo;case Bo:if(e.flags&1024&&(u=e.length,u>l&&(u=l),u&&(e.head&&(C=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(n.subarray(s,s+u),C)),e.flags&512&&e.wrap&4&&(e.check=Ce(e.check,n,u,s)),l-=u,s+=u,e.length-=u),e.length))break e;e.length=0,e.mode=To;case To:if(e.flags&2048){if(l===0)break e;u=0;do C=n[s+u++],e.head&&C&&e.length<65536&&(e.head.name+=String.fromCharCode(C));while(C&&u<l);if(e.flags&512&&e.wrap&4&&(e.check=Ce(e.check,n,u,s)),l-=u,s+=u,C)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=Io;case Io:if(e.flags&4096){if(l===0)break e;u=0;do C=n[s+u++],e.head&&C&&e.length<65536&&(e.head.comment+=String.fromCharCode(C));while(C&&u<l);if(e.flags&512&&e.wrap&4&&(e.check=Ce(e.check,n,u,s)),l-=u,s+=u,C)break e}else e.head&&(e.head.comment=null);e.mode=Po;case Po:if(e.flags&512){for(;h<16;){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}if(e.wrap&4&&a!==(e.check&65535)){i.msg="header crc mismatch",e.mode=pe;break}a=0,h=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),i.adler=e.check=0,e.mode=ht;break;case Vo:for(;h<32;){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}i.adler=e.check=qo(a),a=0,h=0,e.mode=Hi;case Hi:if(e.havedict===0)return i.next_out=o,i.avail_out=c,i.next_in=s,i.avail_in=l,e.hold=a,e.bits=h,rp;i.adler=e.check=1,e.mode=ht;case ht:if(t===np||t===Zn)break e;case ur:if(e.last){a>>>=h&7,h-=h&7,e.mode=dr;break}for(;h<3;){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}switch(e.last=a&1,a>>>=1,h-=1,a&3){case 0:e.mode=Fo;break;case 1:if(fp(e),e.mode=Gn,t===Zn){a>>>=2,h-=2;break e}break;case 2:e.mode=zo;break;case 3:i.msg="invalid block type",e.mode=pe}a>>>=2,h-=2;break;case Fo:for(a>>>=h&7,h-=h&7;h<32;){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}if((a&65535)!==(a>>>16^65535)){i.msg="invalid stored block lengths",e.mode=pe;break}if(e.length=a&65535,a=0,h=0,e.mode=fr,t===Zn)break e;case fr:e.mode=Ro;case Ro:if(u=e.length,u){if(u>l&&(u=l),u>c&&(u=c),u===0)break e;r.set(n.subarray(s,s+u),o),l-=u,s+=u,c-=u,o+=u,e.length-=u;break}e.mode=ht;break;case zo:for(;h<14;){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}if(e.nlen=(a&31)+257,a>>>=5,h-=5,e.ndist=(a&31)+1,a>>>=5,h-=5,e.ncode=(a&15)+4,a>>>=4,h-=4,e.nlen>286||e.ndist>30){i.msg="too many length or distance symbols",e.mode=pe;break}e.have=0,e.mode=No;case No:for(;e.have<e.ncode;){for(;h<3;){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}e.lens[I[e.have++]]=a&7,a>>>=3,h-=3}for(;e.have<19;)e.lens[I[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,S={bits:e.lenbits},M=Cn(tp,e.lens,0,19,e.lencode,0,e.work,S),e.lenbits=S.bits,M){i.msg="invalid code lengths set",e.mode=pe;break}e.have=0,e.mode=Wo;case Wo:for(;e.have<e.nlen+e.ndist;){for(;g=e.lencode[a&(1<<e.lenbits)-1],m=g>>>24,y=g>>>16&255,v=g&65535,!(m<=h);){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}if(v<16)a>>>=m,h-=m,e.lens[e.have++]=v;else{if(v===16){for(E=m+2;h<E;){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}if(a>>>=m,h-=m,e.have===0){i.msg="invalid bit length repeat",e.mode=pe;break}C=e.lens[e.have-1],u=3+(a&3),a>>>=2,h-=2}else if(v===17){for(E=m+3;h<E;){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}a>>>=m,h-=m,C=0,u=3+(a&7),a>>>=3,h-=3}else{for(E=m+7;h<E;){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}a>>>=m,h-=m,C=0,u=11+(a&127),a>>>=7,h-=7}if(e.have+u>e.nlen+e.ndist){i.msg="invalid bit length repeat",e.mode=pe;break}for(;u--;)e.lens[e.have++]=C}}if(e.mode===pe)break;if(e.lens[256]===0){i.msg="invalid code -- missing end-of-block",e.mode=pe;break}if(e.lenbits=9,S={bits:e.lenbits},M=Cn(ll,e.lens,0,e.nlen,e.lencode,0,e.work,S),e.lenbits=S.bits,M){i.msg="invalid literal/lengths set",e.mode=pe;break}if(e.distbits=6,e.distcode=e.distdyn,S={bits:e.distbits},M=Cn(cl,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,S),e.distbits=S.bits,M){i.msg="invalid distances set",e.mode=pe;break}if(e.mode=Gn,t===Zn)break e;case Gn:e.mode=Kn;case Kn:if(l>=6&&c>=258){i.next_out=o,i.avail_out=c,i.next_in=s,i.avail_in=l,e.hold=a,e.bits=h,Zd(i,d),o=i.next_out,r=i.output,c=i.avail_out,s=i.next_in,n=i.input,l=i.avail_in,a=e.hold,h=e.bits,e.mode===ht&&(e.back=-1);break}for(e.back=0;g=e.lencode[a&(1<<e.lenbits)-1],m=g>>>24,y=g>>>16&255,v=g&65535,!(m<=h);){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}if(y&&(y&240)===0){for(_=m,w=y,b=v;g=e.lencode[b+((a&(1<<_+w)-1)>>_)],m=g>>>24,y=g>>>16&255,v=g&65535,!(_+m<=h);){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}a>>>=_,h-=_,e.back+=_}if(a>>>=m,h-=m,e.back+=m,e.length=v,y===0){e.mode=Xo;break}if(y&32){e.back=-1,e.mode=ht;break}if(y&64){i.msg="invalid literal/length code",e.mode=pe;break}e.extra=y&15,e.mode=Oo;case Oo:if(e.extra){for(E=e.extra;h<E;){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}e.length+=a&(1<<e.extra)-1,a>>>=e.extra,h-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=Ho;case Ho:for(;g=e.distcode[a&(1<<e.distbits)-1],m=g>>>24,y=g>>>16&255,v=g&65535,!(m<=h);){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}if((y&240)===0){for(_=m,w=y,b=v;g=e.distcode[b+((a&(1<<_+w)-1)>>_)],m=g>>>24,y=g>>>16&255,v=g&65535,!(_+m<=h);){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}a>>>=_,h-=_,e.back+=_}if(a>>>=m,h-=m,e.back+=m,y&64){i.msg="invalid distance code",e.mode=pe;break}e.offset=v,e.extra=y&15,e.mode=$o;case $o:if(e.extra){for(E=e.extra;h<E;){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}e.offset+=a&(1<<e.extra)-1,a>>>=e.extra,h-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){i.msg="invalid distance too far back",e.mode=pe;break}e.mode=Yo;case Yo:if(c===0)break e;if(u=d-c,e.offset>u){if(u=e.offset-u,u>e.whave&&e.sane){i.msg="invalid distance too far back",e.mode=pe;break}u>e.wnext?(u-=e.wnext,p=e.wsize-u):p=e.wnext-u,u>e.length&&(u=e.length),x=e.window}else x=r,p=o-e.offset,u=e.length;u>c&&(u=c),c-=u,e.length-=u;do r[o++]=x[p++];while(--u);e.length===0&&(e.mode=Kn);break;case Xo:if(c===0)break e;r[o++]=e.length,c--,e.mode=Kn;break;case dr:if(e.wrap){for(;h<32;){if(l===0)break e;l--,a|=n[s++]<<h,h+=8}if(d-=c,i.total_out+=d,e.total+=d,e.wrap&4&&d&&(i.adler=e.check=e.flags?Ce(e.check,r,d,o-d):Bn(e.check,r,d,o-d)),d=c,e.wrap&4&&(e.flags?a:qo(a))!==e.check){i.msg="incorrect data check",e.mode=pe;break}a=0,h=0}e.mode=Lo;case Lo:if(e.wrap&&e.flags){for(;h<32;){if(l===0)break e;l--,a+=n[s++]<<h,h+=8}if(e.wrap&4&&a!==(e.total&4294967295)){i.msg="incorrect length check",e.mode=pe;break}a=0,h=0}e.mode=Uo;case Uo:M=ip;break e;case pe:M=hl;break e;case fl:return ul;case dl:default:return je}return i.next_out=o,i.avail_out=c,i.next_in=s,i.avail_in=l,e.hold=a,e.bits=h,(e.wsize||d!==i.avail_out&&e.mode<pe&&(e.mode<dr||t!==Ao))&&yl(i,i.output,i.next_out,d-i.avail_out),f-=i.avail_in,d-=i.avail_out,i.total_in+=f,i.total_out+=d,e.total+=d,e.wrap&4&&d&&(i.adler=e.check=e.flags?Ce(e.check,r,d,i.next_out-d):Bn(e.check,r,d,i.next_out-d)),i.data_type=e.bits+(e.last?64:0)+(e.mode===ht?128:0)+(e.mode===Gn||e.mode===fr?256:0),(f===0&&d===0||t===Ao)&&M===Wt&&(M=sp),M},pp=i=>{if($t(i))return je;let t=i.state;return t.window&&(t.window=null),i.state=null,Wt},xp=(i,t)=>{if($t(i))return je;const e=i.state;return(e.wrap&2)===0?je:(e.head=t,t.done=!1,Wt)},gp=(i,t)=>{const e=t.length;let n,r,s;return $t(i)||(n=i.state,n.wrap!==0&&n.mode!==Hi)?je:n.mode===Hi&&(r=1,r=Bn(r,t,e,0),r!==n.check)?hl:(s=yl(i,t,e,e),s?(n.mode=fl,ul):(n.havedict=1,Wt))};var mp=xl,yp=gl,vp=pl,_p=up,wp=ml,bp=dp,Cp=pp,Ap=xp,Sp=gp,Ep="pako inflate (from Nodeca project)",dt={inflateReset:mp,inflateReset2:yp,inflateResetKeep:vp,inflateInit:_p,inflateInit2:wp,inflate:bp,inflateEnd:Cp,inflateGetHeader:Ap,inflateSetDictionary:Sp,inflateInfo:Ep};function Mp(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Dp=Mp;const vl=Object.prototype.toString,{Z_NO_FLUSH:kp,Z_FINISH:Bp,Z_OK:Pn,Z_STREAM_END:gr,Z_NEED_DICT:mr,Z_STREAM_ERROR:Tp,Z_DATA_ERROR:Zo,Z_MEM_ERROR:Ip}=On;function Yn(i){this.options=Ki.assign({chunkSize:1024*64,windowBits:15,to:""},i||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(i&&i.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ol,this.strm.avail_out=0;let e=dt.inflateInit2(this.strm,t.windowBits);if(e!==Pn)throw new Error(zt[e]);if(this.header=new Dp,dt.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=In.string2buf(t.dictionary):vl.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=dt.inflateSetDictionary(this.strm,t.dictionary),e!==Pn)))throw new Error(zt[e])}Yn.prototype.push=function(i,t){const e=this.strm,n=this.options.chunkSize,r=this.options.dictionary;let s,o,l;if(this.ended)return!1;for(t===~~t?o=t:o=t===!0?Bp:kp,vl.call(i)==="[object ArrayBuffer]"?e.input=new Uint8Array(i):e.input=i,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),s=dt.inflate(e,o),s===mr&&r&&(s=dt.inflateSetDictionary(e,r),s===Pn?s=dt.inflate(e,o):s===Zo&&(s=mr));e.avail_in>0&&s===gr&&e.state.wrap>0&&i[e.next_in]!==0;)dt.inflateReset(e),s=dt.inflate(e,o);switch(s){case Tp:case Zo:case mr:case Ip:return this.onEnd(s),this.ended=!0,!1}if(l=e.avail_out,e.next_out&&(e.avail_out===0||s===gr))if(this.options.to==="string"){let c=In.utf8border(e.output,e.next_out),a=e.next_out-c,h=In.buf2string(e.output,c);e.next_out=a,e.avail_out=n-a,a&&e.output.set(e.output.subarray(c,c+a),0),this.onData(h)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(s===Pn&&l===0)){if(s===gr)return s=dt.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};Yn.prototype.onData=function(i){this.chunks.push(i)};Yn.prototype.onEnd=function(i){i===Pn&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Ki.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg};function Gr(i,t){const e=new Yn(t);if(e.push(i),e.err)throw e.msg||zt[e.err];return e.result}function Pp(i,t){return t=t||{},t.raw=!0,Gr(i,t)}var Vp=Yn,Fp=Gr,Rp=Pp,zp=Gr,Np={Inflate:Vp,inflate:Fp,inflateRaw:Rp,ungzip:zp};const{Deflate:Wp,deflate:Op,deflateRaw:Hp,gzip:$p}=qd,{Inflate:Yp,inflate:Xp,inflateRaw:Lp,ungzip:Up}=Np;var qp=Wp,jp=Op,Zp=Hp,Gp=$p,Kp=Yp,Qp=Xp,Jp=Lp,ex=Up,tx=On,nx={Deflate:qp,deflate:jp,deflateRaw:Zp,gzip:Gp,Inflate:Kp,inflate:Qp,inflateRaw:Jp,ungzip:ex,constants:tx};const _l={open:"open",high:"high",low:"low",close:"close",volume:"volume",hl2:"hl2",oc2:"oc2",hlc3:"hlc3",ohl3:"ohl3",ohlc4:"ohlc4"},ix={"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","4h":"4h","1d":"1d","1w":"1w","1M":"1M"},Kr=new Set(["var","let","const","function","class","if","else","for","while","do","switch","case","default","break","continue","return","try","catch","finally","throw","new","delete","typeof","instanceof","this","super","extends","import","export","from","as","default","with","arguments","eval","implements","interface","package","private","protected","public","static","yield","async","await","true","false","null","undefined","window","global","globalThis","self"]),Qr=new Set(["F","Formula","I","S","O","input","style","output","SOURCE","POSITION","LINESTYLE","SHAPE","CHART_TYPE","SIGNAL_TYPE","TIMEFRAME","MATH","COLORS","dataList","params","styles","console","i","SMA","EMA","RSI","MA","MACD","BOLL","KDJ","plot","name","desc","version","author","position"]),wl=new Set(["number","string","boolean","object","array","date","regexp","Math","Number","String","Boolean","Array","Object","Date","RegExp","Error","TypeError","ReferenceError","SyntaxError","RangeError","JSON","Promise","Symbol","Proxy","Reflect","data","result","value","index","length","size","count","item","element","node","event","target","source"]),Jr=new Set(["open","high","low","close","volume","price","sma","ema","rsi","macd","boll","kdj","stoch","williams","cci","momentum","roc","atr","adx","obv","sar","buy","sell","long","short","signal","trend","support","resistance","breakout","crossover","crossunder","chart","candle","bar","line","area","histogram"]),Tr=new Set([...Kr,...Qr,...wl,...Jr]);class Ir{static isKeyword(t){return Tr.has(t.toLowerCase())}static isJSKeyword(t){return Kr.has(t.toLowerCase())}static isScriptKeyword(t){return Qr.has(t)}static isTechnicalKeyword(t){return Jr.has(t.toLowerCase())}static validateVariableName(t){return!t||t.trim()===""?{isValid:!1,error:"变量名不能为空"}:(t=t.trim(),/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(t)?this.isJSKeyword(t)?{isValid:!1,error:`"${t}" 是 JavaScript 保留字，不能用作变量名`,suggestion:`建议使用: ${t}Value, my${t.charAt(0).toUpperCase()+t.slice(1)}, ${t}_`}:this.isScriptKeyword(t)?{isValid:!1,error:`"${t}" 是脚本系统保留字，不能用作变量名`,suggestion:`建议使用: ${t}Value, user${t.charAt(0).toUpperCase()+t.slice(1)}, ${t}_`}:this.isTechnicalKeyword(t)?{isValid:!0,error:`提示: "${t}" 是技术分析常用术语，建议使用更具体的名称`,suggestion:`建议使用: ${t}Period, ${t}Value, custom${t.charAt(0).toUpperCase()+t.slice(1)}`}:{isValid:!0}:{isValid:!1,error:"变量名只能包含字母、数字和下划线，且不能以数字开头"})}static getAllKeywords(){return Array.from(Tr)}static getSuggestions(t){const e=[];if(t){const n=t.trim(),r=n.charAt(0).toUpperCase()+n.slice(1);e.push(`${n}Value`,`${n}Param`,`${n}_`,`my${r}`,`user${r}`,`custom${r}`,`${n}Setting`,`${n}Config`)}return e.filter(n=>this.validateVariableName(n).isValid)}}Array.from(Kr),Array.from(Qr),Array.from(wl),Array.from(Jr),Array.from(Tr);class Vn{static parse(t,e,n){const r={info:{name:"",position:"main"},inputs:[],styles:[],httpCalls:[],script:t,main:"",errors:[]};try{r.info=this.parseMetadata(t),r.inputs=this.parseInputs(t,r.errors),r.styles=this.parseStyles(t,r.errors),e&&this.applyPresetValues(r.inputs,e),n&&this.applyPresetValues(r.styles,n),r.httpCalls=this.parseHttpCalls(t),r.main=this.generateExecutableCode(t,r,r.httpCalls)}catch(s){r.errors.push(`解析错误: ${s.message}`)}return r}static parseMetadata(t){const e={name:"",position:"vice",version:1},n=t.match(/\/\/\s*@name\s*=\s*(.+?)(?:\r?\n|$)/);n&&(e.name=n[1].trim());const r=t.match(/\/\/\s*@title\s*=\s*(.+?)(?:\r?\n|$)/);if(r&&(e.title=r[1].trim()),!e.name&&e.title?e.name=e.title:!e.title&&e.name&&(e.title=e.name),!e.name&&!e.title)throw new Error("脚本元数据 @name 或 @title 必须至少填写一个且不能为空");const s=t.split(`
`);let o="",l=!1,c=!1;for(let d=0;d<s.length;d++){const u=s[d].trim(),p=u.match(/^\/\/\s*@desc\s*=\s*(.*)$/);if(p){l=!0,c=!0;const x=p[1];x&&(o=x+`
`);continue}if(l)if(u.startsWith("//")){if(u.match(/^\/\/\s*@\w+/)){l=!1;break}const x=u.replace(/^\/\/\s*/,"");o+=x+`
`}else{l=!1;break}}c&&o&&(e.desc=o.trim()),e.desc=(e.desc||"").trim(),e.desc&&(e.desc=e.desc.replace(/\n+/g,`
`));const a=t.match(/\/\/\s*@position\s*=\s*(.+)$/m);if(a){const d=a[1].trim();e.position=d==="main"||d==="vice"?d:"vice"}e.position!=="main"&&e.position!=="vice"&&(e.position="vice");const h=t.match(/\/\/\s*@version\s*=\s*(\d+)/);h&&(e.version=parseInt(h[1].trim()));const f=t.match(/\/\/\s*@author\s*=\s*(.+)$/m);return f&&(e.author=f[1].trim()),e.author=(e.author||"").trim(),e}static parseInputs(t,e){const n=[],r=/(\w+)\s*=\s*(input|I)\.(\w+)\s*\(\s*([^)]+)\s*\)/g;let s;for(;(s=r.exec(t))!==null;){const[,o,,l,c]=s,a=Ir.validateVariableName(o);if(!a.isValid){e.push(`Input 变量名错误: ${a.error}`);continue}const h=this.parseDocumentInputParams(o,l,c);h&&n.push(h)}return n}static parseDocumentInputParams(t,e,n){try{const r=this.splitParams(n);if(r.length===0)return null;const s=e==="str"?"string":e,o=this.parseInputValueByType(r[0],s),l={key:t,type:s,defaultValue:o,value:o,title:t};for(let c=1;c<r.length;c++){const a=r[c].trim(),h=a.indexOf("=");if(h>0){const f=a.substring(0,h).trim(),d=a.substring(h+1).trim();f==="options"?l[f]=this.parseOptionsValue(d):l[f]=this.parseStringValue(d)}}return l}catch{return null}}static parseInputValueByType(t,e){switch(t=t.trim(),e){case"int":return parseInt(t)||0;case"float":return parseFloat(t)||0;case"string":return this.parseStringValue(t);case"bool":return t.toLowerCase()==="true";case"select":return this.parseStringValue(t);default:return t}}static parseOptionsValue(t){return t=t.trim(),t==="SOURCE"?Object.values(_l):t.startsWith("[")&&t.endsWith("]")?t.slice(1,-1).split(",").map(n=>this.parseStringValue(n.trim())):t?[this.parseStringValue(t)]:[]}static parseHttpCalls(t){const e=[],n=/(?:const|var|let)?\s*(\w+)?\s*=\s*(H|http)\.(loadHistory|get|post)\s*\(\s*([^)]*)\s*\)/g;let r;for(;(r=n.exec(t))!==null;){const[,s,o,l,c]=r,a={key:s,type:l,value:{data:[],count:0},args:c?c.split(",").map(h=>this.parseParamValue(h.trim())):[]};e.push(a)}return e}static convertToReferenceForm(t,e,n,r){let s=t;return e.forEach(o=>{const l=new RegExp(`(\\b${o.key}\\s*=\\s*)I\\.\\w+\\([^)]*\\)`,"g");s=s.replace(l,`$1ctx.inputVal.${o.key}`)}),n.forEach(o=>{const l=new RegExp(`(\\b${o.key}\\s*=\\s*)(S|style)\\.\\w+\\([^)]*\\)`,"g");s=s.replace(l,`$1ctx.styleVal.${o.key}`)}),r.forEach(o=>{const l=new RegExp(`(\\b${o.key}\\s*=\\s*)(H|http)\\.\\w+\\([^)]*\\)`,"g");s=s.replace(l,`$1ctx.httpVal.${o.key}`)}),s}static parseStyles(t,e){const n=[],r=/(\w+)\s*=\s*(style|S)\.(\w+)\s*\(/g;let s;for(;(s=r.exec(t))!==null;){const[,o,,l]=s,c=Ir.validateVariableName(o);if(!c.isValid){e.push(`Style 变量名错误: ${c.error}`);continue}const a=s.index+s[0].length,h=this.findClosingParenthesis(t,a),f=t.substring(a,h),d=this.splitParams(f),u={key:o,title:o,type:l,defaultValue:{},value:{},show:!0};for(const p of d)if(p.includes("=")){const[x,g]=p.split("=",2),m=x.trim(),y=g.trim();if(m==="title")u.title=this.parseStringValue(y);else if(m==="tip")u.tip=this.parseStringValue(y);else if(m==="show"){const v=y==="true";typeof u.defaultValue=="object"&&u.defaultValue!==null?u.defaultValue.show=v:u.defaultValue={show:v},typeof u.value=="object"&&u.value!==null?u.value.show=v:u.value={show:v}}else if(m==="min")u.min=parseFloat(y);else if(m==="max")u.max=parseFloat(y);else{const v=this.parseStyleValueByType(f,l);if(typeof v=="object"&&v!==null){const _=v.show!==void 0?v.show:u.value?.show!==void 0?u.value.show:!0;u.defaultValue={...v,show:_},u.value={...v,show:_}}else{const _=u.value?.show!==void 0?u.value.show:!0;u.defaultValue={value:v,show:_},u.value={value:v,show:_}}}}else switch(l){case"line":const x=this.parseStyleValueByType(f,l);if(typeof x=="object"&&x!==null){const F=x.show!==void 0?x.show:u.value?.show!==void 0?u.value.show:!0;u.defaultValue={...x,show:F},u.value={...x,show:F}}else{const F=u.value?.show!==void 0?u.value.show:!0;u.defaultValue={value:x,show:F},u.value={value:x,show:F}}break;case"color":const g=this.parseStyleValueByType(f,l);u.defaultValue=g,u.value=g;break;case"width":const m=this.parseStyleValueByType(f,l);u.defaultValue=m,u.value=m;break;case"size":const y=this.parseStyleValueByType(f,l);u.defaultValue=y,u.value=y;break;case"style":const v=this.parseStyleValueByType(f,l);u.defaultValue=v,u.value=v;break;case"full":const _=this.parseStyleValueByType(f,l);u.defaultValue=_,u.value=_;break;case"icon":const w=this.parseStyleValueByType(f,l);u.defaultValue=w,u.value=w;break;case"candle":const b=this.parseStyleValueByType(f,l);if(typeof b=="object"&&b!==null){const F=b.show!==void 0?b.show:u.value?.show!==void 0?u.value.show:!0;u.defaultValue={...b,show:F},u.value={...b,show:F}}else{const F=u.value?.show!==void 0?u.value.show:!0;u.defaultValue={value:b,show:F},u.value={value:b,show:F}}break;case"label":{const F=this.parseStyleValueByType(f,l);if(typeof F=="object"&&F!==null){const Y=F.show!==void 0?F.show:u.value?.show!==void 0?u.value.show:!0;u.defaultValue={...F,show:Y},u.value={...F,show:Y}}else{const Y=u.value?.show!==void 0?u.value.show:!0;u.defaultValue={value:F,show:Y},u.value={value:F,show:Y}}break}case"labelbg":const C=this.parseStyleValueByType(f,l);if(typeof C=="object"&&C!==null){const F=C.show!==void 0?C.show:u.value?.show!==void 0?u.value.show:!0;u.defaultValue={...C,show:F},u.value={...C,show:F}}else{const F=u.value?.show!==void 0?u.value.show:!0;u.defaultValue={value:C,show:F},u.value={value:C,show:F}}break;case"shape":const M=this.parseStyleValueByType(f,l);if(typeof M=="object"&&M!==null){const F=M.show!==void 0?M.show:u.value?.show!==void 0?u.value.show:!0;u.defaultValue={...M,show:F},u.value={...M,show:F}}else{const F=u.value?.show!==void 0?u.value.show:!0;u.defaultValue={value:M,show:F},u.value={value:M,show:F}}break;case"bar":const T=this.parseStyleValueByType(f,l);if(typeof T=="object"&&T!==null){const F=T.show!==void 0?T.show:u.value?.show!==void 0?u.value.show:!0;u.defaultValue={...T,show:F},u.value={...T,show:F}}else{const F=u.value?.show!==void 0?u.value.show:!0;u.defaultValue={value:T,show:F},u.value={value:T,show:F}}break;case"area":const S=this.parseStyleValueByType(f,l);if(typeof S=="object"&&S!==null){const F=S.show!==void 0?S.show:u.value?.show!==void 0?u.value.show:!0;u.defaultValue={...S,show:F},u.value={...S,show:F}}else{const F=u.value?.show!==void 0?u.value.show:!0;u.defaultValue={value:S,show:F},u.value={value:S,show:F}}break;case"circle":const E=this.parseStyleValueByType(f,l);if(typeof E=="object"&&E!==null){const F=E.show!==void 0?E.show:u.value?.show!==void 0?u.value.show:!0;u.defaultValue={...E,show:F},u.value={...E,show:F}}else{const F=u.value?.show!==void 0?u.value.show:!0;u.defaultValue={value:E,show:F},u.value={value:E,show:F}}break;case"rect":const I=this.parseStyleValueByType(f,l);if(typeof I=="object"&&I!==null){const F=I.show!==void 0?I.show:u.value?.show!==void 0?u.value.show:!0;u.defaultValue={...I,show:F},u.value={...I,show:F}}else{const F=u.value?.show!==void 0?u.value.show:!0;u.defaultValue={value:I,show:F},u.value={value:I,show:F}}break;case"srect":const k=this.parseStyleValueByType(f,l);if(typeof k=="object"&&k!==null){const F=k.show!==void 0?k.show:u.value?.show!==void 0?u.value.show:!0;u.defaultValue={...k,show:F},u.value={...k,show:F}}else{const F=u.value?.show!==void 0?u.value.show:!0;u.defaultValue={value:k,show:F},u.value={value:k,show:F}}break;case"sarea":const P=this.parseStyleValueByType(f,l);if(typeof P=="object"&&P!==null){const F=P.show!==void 0?P.show:u.value?.show!==void 0?u.value.show:!0;u.defaultValue={...P,show:F},u.value={...P,show:F}}else{const F=u.value?.show!==void 0?u.value.show:!0;u.defaultValue={value:P,show:F},u.value={value:P,show:F}}break;case"scircle":const B=this.parseStyleValueByType(f,l);if(typeof B=="object"&&B!==null){const F=B.show!==void 0?B.show:u.value?.show!==void 0?u.value.show:!0;u.defaultValue={...B,show:F},u.value={...B,show:F}}else{const F=u.value?.show!==void 0?u.value.show:!0;u.defaultValue={value:B,show:F},u.value={value:B,show:F}}break;case"sshape":const V=this.parseStyleValueByType(f,l);if(typeof V=="object"&&V!==null){const F=V.show!==void 0?V.show:u.value?.show!==void 0?u.value.show:!0;u.defaultValue={...V,show:F},u.value={...V,show:F}}else{const F=u.value?.show!==void 0?u.value.show:!0;u.defaultValue={value:V,show:F},u.value={value:V,show:F}}break;case"slabel":const R=this.parseStyleValueByType(f,l);if(typeof R=="object"&&R!==null){const F=R.show!==void 0?R.show:u.value?.show!==void 0?u.value.show:!0;u.defaultValue={...R,show:F},u.value={...R,show:F}}else{const F=u.value?.show!==void 0?u.value.show:!0;u.defaultValue={value:R,show:F},u.value={value:R,show:F}}break;default:const W=this.parseStyleValueByType(p.trim(),l);if(typeof W=="object"&&W!==null){const F=W.show!==void 0?W.show:u.value?.show!==void 0?u.value.show:!0;u.defaultValue={...W,show:F},u.value={value:W,show:F}}else{const F=u.value?.show!==void 0?u.value.show:!0;u.defaultValue={value:W,show:F},u.value={value:W,show:F}}}n.push(u)}if(e.length>0)throw new Error(`样式解析错误:
${e.join(`
`)}`);return n}static parseStyleValueByType(t,e){switch(t=t.trim(),e){case"color":const n=this.splitParams(t);return n.length>=1?n[0].replace(/['"]/g,""):t.replace(/['"]/g,"");case"width":const r=this.splitParams(t);if(r.length>=1){const k=parseInt(r[0])||1;return Math.max(1,Math.min(k,10))}const s=parseInt(t)||1;return Math.max(1,Math.min(s,10));case"size":const o=this.splitParams(t);if(o.length>=1){const k=parseInt(o[0])||5;return Math.max(1,Math.min(k,20))}const l=parseInt(t)||5;return Math.max(1,Math.min(l,20));case"style":const c=this.splitParams(t);if(c.length>=1){const k=c[0].replace(/['"]/g,"").toLowerCase();return["solid","dashed","dotted"].includes(k)?k:"solid"}const a=t.replace(/['"]/g,"").toLowerCase();return["solid","dashed","dotted"].includes(a)?a:"solid";case"full":const h=this.splitParams(t);if(h.length>=1){const k=h[0].replace(/['"]/g,"").toLowerCase();return["fill","stroke"].includes(k)?k:"fill"}const f=t.replace(/['"]/g,"").toLowerCase();return["fill","stroke"].includes(f)?f:"fill";case"sarea":case"srect":case"scircle":const d=this.splitParams(t);if(d.length>=1){const k={color:null,border:null,size:1,style:"solid"},P=[];for(const B of d){const V=B.replace(/['"]/g,"").toLowerCase(),R=B.replace(/['"]/g,"");if(this.isColor(R)&&!k.colorSet)k.color=R,k.colorSet=!0;else if(this.isNumber(V)&&!k.sizeSet){const W=parseInt(V),F=this.validateNumberRange(W,1,50,"大小");F.valid?(k.size=W,k.sizeSet=!0):P.push(F.error)}else if(B.startsWith("border=")){const W=B.substring(7).replace(/['"]/g,"");this.isColor(W)?k.border=W:P.push(`无效的边框颜色: ${W}`)}else if(B.startsWith("borcolor=")){const W=B.substring(9).replace(/['"]/g,"");this.isColor(W)?k.border=W:P.push(`无效的边框颜色: ${W}`)}else if(B.startsWith("horcolor=")){const W=B.substring(9).replace(/['"]/g,"");this.isColor(W)?k.border=W:P.push(`无效的边框颜色: ${W}`)}else if(["solid","dashed","dotted"].includes(V))k.style=V;else if(B==="true"||B==="false")k.show=B==="true";else{if(B.startsWith("title=")||B.startsWith("tip=")||B.startsWith("show=")||B.startsWith("min=")||B.startsWith("max="))continue;P.push(`无效的 ${e} 参数: ${B}`)}}if(P.length>0)throw new Error(`${e} 样式解析错误:
${P.join(`
`)}`);return delete k.colorSet,delete k.sizeSet,k}return{color:null,border:null,size:1,style:"solid",show:!0};case"sshape":const u=this.splitParams(t);if(u.length>=1){const k={icon:"circle",color:"",size:5,full:"fill"},P=[];for(const B of u){const V=B.replace(/['"]/g,"").toLowerCase(),R=B.replace(/['"]/g,"");if(["circle","square","triangle","diamond","star","cross","x","check","flag","heart","arrowup","arrowdown","arrowleft","arrowright","triangleup","triangledown","triangleleft","triangleright","drawarrowup","drawarrowdown","drawarrowleft","drawarrowright"].includes(V)){const W={arrowup:"arrowUp",arrowdown:"arrowDown",arrowleft:"arrowLeft",arrowright:"arrowRight",triangleup:"triangleUp",triangledown:"triangleDown",triangleleft:"triangleLeft",triangleright:"triangleRight",drawarrowup:"drawArrowUp",drawarrowdown:"drawArrowDown",drawarrowleft:"drawArrowLeft",drawarrowright:"drawArrowRight"};k.icon=W[V]||V}else if(R==="")k.color="";else if(this.isColor(this.parseStringValue(R)))k.color=this.parseStringValue(R);else if(this.isNumber(V)){const W=parseInt(V),F=this.validateNumberRange(W,1,20,"图形大小");F.valid?k.size=W:P.push(F.error)}else if(["fill","stroke"].includes(V))k.full=V;else if(B==="true"||B==="false")k.show=B==="true";else{if(B.startsWith("title=")||B.startsWith("tip=")||B.startsWith("show=")||B.startsWith("min=")||B.startsWith("max="))continue;P.push(`无效的 sshape 参数: ${B}`)}}if(P.length>0)throw new Error(`sshape 样式解析错误:
${P.join(`
`)}`);return k}return{icon:"circle",color:"",size:5,full:"fill",show:!0};case"shape":const p=this.splitParams(t);if(p.length>=1){const k={icon:"circle",color:"",size:5,full:"fill",position:"value",show:!0},P=[];for(let B=0;B<p.length;B++){const V=p[B],R=V.replace(/['"]/g,"").toLowerCase(),W=V.replace(/['"]/g,"");if(["circle","square","triangle","diamond","star","cross","x","check","flag","heart","arrowup","arrowdown","arrowleft","arrowright","triangleup","triangledown","triangleleft","triangleright","drawarrowup","drawarrowdown","drawarrowleft","drawarrowright"].includes(R)){const F={arrowup:"arrowUp",arrowdown:"arrowDown",arrowleft:"arrowLeft",arrowright:"arrowRight",triangleup:"triangleUp",triangledown:"triangleDown",triangleleft:"triangleLeft",triangleright:"triangleRight",drawarrowup:"drawArrowUp",drawarrowdown:"drawArrowDown",drawarrowleft:"drawArrowLeft",drawarrowright:"drawArrowRight"};k.icon=F[R]||R}else if(W==="")k.color="";else if(this.isColor(this.parseStringValue(W)))k.color=this.parseStringValue(W);else if(this.isNumber(R)){const F=parseInt(R),Y=this.validateNumberRange(F,1,20,"图形大小");Y.valid?k.size=F:P.push(Y.error)}else if(["fill","stroke","stroke_fill"].includes(R))k.full=R;else if(["value","high","low","open","close","top","bottom","center","highup","lowdown"].includes(R)){const F={highup:"highUp",lowdown:"lowDown"};k.position=F[R]||R}else if(V==="true"||V==="false")k.show=V==="true";else{if(V.startsWith("title=")||V.startsWith("tip=")||V.startsWith("options=")||V.startsWith("min=")||V.startsWith("max=")||V.startsWith("border="))continue;P.push(`无效的 shape 参数: ${V}`)}}if(P.length>0)throw new Error(`shape 样式解析错误:
${P.join(`
`)}`);return k}return{icon:"circle",color:"",size:5,full:"fill",position:"value",show:!0};case"icon":const x=this.splitParams(t);let g;return x.length>=1?g=x[0].replace(/['"]/g,"").toLowerCase():g=t.replace(/['"]/g,"").toLowerCase(),["arrowup","arrowdown","arrowleft","arrowright","triangleup","triangledown","triangleleft","triangleright","square","diamond","star","cross","circle","x","check","flag","heart"].includes(g)?{arrowup:"arrowUp",arrowdown:"arrowDown",arrowleft:"arrowLeft",arrowright:"arrowRight",triangleup:"triangleUp",triangledown:"triangleDown",triangleleft:"triangleLeft",triangleright:"triangleRight"}[g]||g:"circle";case"line":const y=this.splitParams(t);if(y.length>=1){const k={color:"",size:1,style:"solid"},P=[];for(const B of y){const V=B.replace(/['"]/g,"").toLowerCase(),R=B.replace(/['"]/g,"");if(R==="")k.color="";else if(this.isColor(this.parseStringValue(R)))k.color=this.parseStringValue(R);else if(this.isNumber(V)){const W=parseInt(V),F=this.validateNumberRange(W,1,10,"线宽");F.valid?k.size=W:P.push(F.error)}else if(["solid","dashed","dotted"].includes(V))k.style=V;else if(V==="true"||V==="false")k.show=V==="true";else{if(B.startsWith("title=")||B.startsWith("tip=")||B.startsWith("show=")||B.startsWith("min=")||B.startsWith("max="))continue;P.push(`无效的 line 参数: ${B}`)}}if(P.length>0)throw new Error(`line 样式解析错误:
${P.join(`
`)}`);return k}return{color:"",size:1,style:"solid",show:!0};case"area":const v=this.splitParams(t);let _="",w=!0;for(let k=0;k<v.length;k++){const P=v[k],B=P.replace(/['"]/g,"");if(B==="")_="";else if(this.isColor(this.parseStringValue(B)))_=this.parseStringValue(B);else if(P.startsWith("show="))w=P.substring(5).replace(/['"]/g,"").toLowerCase()==="true";else if(P==="true"||P==="false")w=P==="true";else if(P.startsWith("title=")||P.startsWith("tip="))continue}return{color:_,show:w};case"circle":const b=this.splitParams(t);if(b.length>=1){const k={color:"",size:5,style:"solid",full:"fill"},P=[];for(const B of b){const V=B.replace(/['"]/g,"").toLowerCase(),R=B.replace(/['"]/g,"");if(R==="")k.color="";else if(this.isColor(this.parseStringValue(R)))k.color=this.parseStringValue(R);else if(this.isNumber(V)){const W=parseInt(V),F=this.validateNumberRange(W,1,20,"圆形尺寸");F.valid?k.size=W:P.push(F.error)}else if(["solid","dashed","dotted"].includes(V))k.style=V;else if(["fill","stroke"].includes(V))k.full=V;else if(B==="true"||B==="false")k.show=B==="true";else{if(B.startsWith("title=")||B.startsWith("tip=")||B.startsWith("show=")||B.startsWith("min=")||B.startsWith("max="))continue;P.push(`无效的 circle 参数: ${B}`)}}if(P.length>0)throw new Error(`circle 样式解析错误:
${P.join(`
`)}`);return k}return{color:"",size:5,style:"solid",full:"fill",show:!0};case"bar":const C=this.splitParams(t);if(C.length>=1){const k={color:"",size:1,style:"solid",full:"fill",show:!0},P=[];for(const B of C){const V=B.replace(/['"]/g,"").toLowerCase(),R=B.replace(/['"]/g,"");if(R==="")k.color="";else if(this.isColor(this.parseStringValue(R)))k.color=this.parseStringValue(R);else if(this.isNumber(V)){const W=parseInt(V),F=this.validateNumberRange(W,1,10,"柱状图宽度");F.valid?k.size=W:P.push(F.error)}else if(["solid","dashed","dotted"].includes(V))k.style=V;else if(["fill","stroke"].includes(V))k.full=V;else if(B==="true"||B==="false")k.show=B==="true";else{if(B.startsWith("title=")||B.startsWith("tip=")||B.startsWith("show=")||B.startsWith("min=")||B.startsWith("max="))continue;P.push(`无效的 bar 参数: ${B}`)}}if(P.length>0)throw new Error(`bar 样式解析错误:
${P.join(`
`)}`);return k}return{color:"",size:1,style:"solid",full:"fill",show:!0};case"candle":const M=this.splitParams(t);if(M.length>=1){const k={color:"",size:1,style:"solid",full:"fill"},P=[];for(const B of M){const V=B.replace(/['"]/g,"").toLowerCase(),R=B.replace(/['"]/g,"");if(R==="")k.color="";else if(this.isColor(this.parseStringValue(R)))k.color=this.parseStringValue(R);else if(this.isNumber(V)){const W=parseInt(V),F=this.validateNumberRange(W,1,10,"蜡烛图宽度");F.valid?k.size=W:P.push(F.error)}else if(["solid","dashed","dotted"].includes(V))k.style=V;else if(["fill","stroke"].includes(V))k.full=V;else if(B==="true"||B==="false")k.show=B==="true";else{if(B.startsWith("title=")||B.startsWith("tip=")||B.startsWith("show=")||B.startsWith("min=")||B.startsWith("max="))continue;P.push(`无效的 candle 参数: ${B}`)}}if(P.length>0)throw new Error(`candle 样式解析错误:
${P.join(`
`)}`);return k}return{color:"",size:1,style:"solid",full:"fill",show:!0};case"label":const T=this.splitParams(t);if(T.length>=1){const k={color:"",size:12,align:"left",bold:!1,italic:!1,position:"value"},P=[];for(const B of T){const V=B.replace(/['"]/g,"").toLowerCase(),R=B.replace(/['"]/g,"");if(B.startsWith("text="))k.text=this.parseStringValue(B.substring(5));else if(R==="")k.color="";else if(this.isColor(this.parseStringValue(R)))k.color=this.parseStringValue(R);else if(this.isNumber(V)){const W=parseInt(V),F=this.validateNumberRange(W,8,32,"文字大小");F.valid?k.size=W:P.push(F.error)}else if(["left","center","right"].includes(V))k.align=V;else if(["value","high","low","open","close","top","bottom","center","highup","lowdown"].includes(V)){const W={highup:"highUp",lowdown:"lowDown"};k.position=W[V]||V}else if(!["arial","helvetica","sans-serif","times","serif","monospace"].includes(V))if(V==="bold")k.bold=!0;else if(V==="italic")k.italic=!0;else if(V==="true"||V==="false")k.show=V==="true";else{if(B.startsWith("title=")||B.startsWith("tip=")||B.startsWith("show=")||B.startsWith("min=")||B.startsWith("max="))continue;P.push(`无效的 label 参数: ${B}`)}}if(P.length>0)throw new Error(`label 样式解析错误:
${P.join(`
`)}`);return k}return{color:"",size:12,align:"left",bold:!1,italic:!1,position:"value",show:!0};case"slabel":const S=this.splitParams(t);if(S.length>=1){const k={color:"",size:12,align:"left",bold:!1,italic:!1},P=[];for(const B of S){const V=B.replace(/['"]/g,"").toLowerCase(),R=B.replace(/['"]/g,"");if(B.startsWith("text="))k.text=this.parseStringValue(B.substring(5));else if(R==="")k.color="";else if(this.isColor(this.parseStringValue(R)))k.color=this.parseStringValue(R);else if(this.isNumber(V)){const W=parseInt(V),F=this.validateNumberRange(W,8,32,"文字大小");F.valid?k.size=W:P.push(F.error)}else if(["left","center","right"].includes(V))k.align=V;else if(V==="bold")k.bold=!0;else if(V==="italic")k.italic=!0;else if(V==="true"||V==="false")k.show=V==="true";else{if(B.startsWith("title=")||B.startsWith("tip=")||B.startsWith("show=")||B.startsWith("min=")||B.startsWith("max="))continue;P.push(`无效的 slabel 参数: ${B}`)}}if(P.length>0)throw new Error(`slabel 样式解析错误:
${P.join(`
`)}`);return k}return{color:"",size:12,align:"left",bold:!1,italic:!1,show:!0};case"labelbg":const E=this.splitParams(t);if(E.length>=1){const k={color:"",full:"fill",size:1,style:"solid",padding:4,radius:0},P=[];for(const B of E){const V=B.replace(/['"]/g,"").toLowerCase(),R=B.replace(/['"]/g,"");if(R==="")k.color="";else if(this.isColor(this.parseStringValue(R)))k.color=this.parseStringValue(R);else if(this.isNumber(V)){const W=parseInt(V),F=this.validateNumberRange(W,1,10,"边框宽度");F.valid?k.size=W:P.push(F.error)}else if(["fill","stroke"].includes(V))k.full=V;else if(["solid","dashed","dotted"].includes(V))k.style=V;else if(V.startsWith("padding=")){const W=V.split("=")[1];if(this.isNumber(W)){const F=parseInt(W),Y=this.validateNumberRange(F,0,20,"内边距");Y.valid?k.padding=F:P.push(Y.error)}}else if(V.startsWith("radius=")){const W=V.split("=")[1];if(this.isNumber(W)){const F=parseInt(W),Y=this.validateNumberRange(F,0,20,"圆角");Y.valid?k.radius=F:P.push(Y.error)}}else if(V==="true"||V==="false")k.show=V==="true";else{if(B.startsWith("title=")||B.startsWith("tip=")||B.startsWith("show=")||B.startsWith("min=")||B.startsWith("max="))continue;P.push(`无效的 labelbg 参数: ${B}`)}}if(P.length>0)throw new Error(`labelbg 样式解析错误:
${P.join(`
`)}`);return k}return{color:"",full:"fill",size:1,style:"solid",padding:4,radius:0,show:!0};case"rect":const I=this.splitParams(t);if(I.length>=1){const k={color:"",size:1,style:"solid",full:"fill"},P=[];for(const B of I){const V=B.replace(/['"]/g,"").toLowerCase(),R=B.replace(/['"]/g,"");if(R==="")k.color="";else if(this.isColor(this.parseStringValue(R)))k.color=this.parseStringValue(R);else if(this.isNumber(V)){const W=parseInt(V),F=this.validateNumberRange(W,1,10,"边框宽度");F.valid?k.size=W:P.push(F.error)}else if(["solid","dashed","dotted"].includes(V))k.style=V;else if(["fill","stroke"].includes(V))k.full=V;else if(B==="true"||B==="false")k.show=B==="true";else{if(B.startsWith("title=")||B.startsWith("tip=")||B.startsWith("show=")||B.startsWith("min=")||B.startsWith("max="))continue;P.push(`无效的 rect 参数: ${B}`)}}if(P.length>0)throw new Error(`rect 样式解析错误:
${P.join(`
`)}`);return k}return{color:"",size:1,style:"solid",full:"fill",show:!0};default:return t.replace(/['"]/g,"")}}static generateExecutableCode(t,e,n){let r=t;r=r.replace(/\/\/[^\n\r]*/g,""),r=r.replace(/setMin\s*\(\s*[^)]+\s*\)/g,""),r=r.replace(/setMax\s*\(\s*[^)]+\s*\)/g,""),r=r.replace(/setPrecision\s*\(\s*[^)]+\s*\)/g,""),n.forEach(l=>{const c=new RegExp(`(?:const|var|let)?\\s*(\\w+)?\\s*=\\s*(H|http)\\.${l.type}\\s*\\(\\s*[^)]*\\s*\\)[^\\n]*`,"g");r=r.replace(c,"")});const s=r.split(`
`),o=[];for(const l of s){const c=l.trim();if(!c){o.push(l);continue}c.match(/(\w+)\s*=\s*(I|S|input|style)\.\w+\(/)||c.match(/(I|S|input|style)\.\w+\(/)||o.push(l)}return r=o.join(`
`),r=r.replace(/options\s*=\s*SOURCE/g,"options=['open','high','low','close','volume','hl2','hlc3','ohlc4']"),r.trim()}static splitParams(t){let e=t.replace(/['′‵]/g,"'").replace(/["″‶]/g,'"');const n=[];let r=0,s=0;for(;s<e.length;){const u=e[s];if(u==="("||u==="["){const p=u,x=u==="("?")":"]";let g=1,m=s;for(s++;s<e.length&&g>0;)e[s]===p?g++:e[s]===x&&g--,s++;if(g===0){const y=e.substring(m,s),v=`__BRACKET${r}__`;n[r]=y,e=e.substring(0,m)+v+e.substring(s),s=m+v.length,r++}}else s++}const o=[];let l=e,c=0;const a=/(['"])((?:(?!\1).)*)\1/g;let h;for(;(h=a.exec(e))!==null;){const u=h[0],p=`__STR${c}__`;o[c]=u,l=l.replace(u,p),c++}return l.split(",").map(u=>u.trim()).map(u=>{let p=u;for(let x=0;x<o.length;x++){const g=`__STR${x}__`;p.includes(g)&&(p=p.replace(g,o[x]))}for(let x=0;x<n.length;x++){const g=`__BRACKET${x}__`;p.includes(g)&&(p=p.replace(g,n[x]))}return p.trim()}).filter(u=>u!=="")}static parseValue(t,e){switch(t=t.trim(),e){case"int":return parseInt(t);case"float":return parseFloat(t);case"bool":return t==="true";case"string":case"select":return this.parseStringValue(t);case"color":case"style":return this.parseStringValue(t);case"width":return parseInt(t);default:return t}}static parseParamValue(t){return t=t.trim(),t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'")?t.slice(1,-1):t}static parseStringValue(t){return t=t.trim(),t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'")?t.slice(1,-1):t}static parseArrayValue(t){return t=t.trim(),t.startsWith("[")&&t.endsWith("]")?t.slice(1,-1).split(",").map(n=>this.parseStringValue(n.trim())):[]}static isColor(t){const e=["transparent","currentcolor","inherit","initial","unset","black","silver","gray","white","maroon","red","purple","fuchsia","green","lime","olive","yellow","navy","blue","teal","aqua","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],n=t.toLowerCase();return e.includes(n)?!0:/^#[0-9a-f]{3,6}$/i.test(t)||/^rgb\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*\)$/i.test(t)||/^rgba\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*,\s*[\d.]+\s*\)$/i.test(t)||/^hsl\(\s*\d+\s*,\s*\d+%\s*,\s*\d+%\s*\)$/i.test(t)||/^hsla\(\s*\d+\s*,\s*\d+%\s*,\s*\d+%\s*,\s*[\d.]+\s*\)$/i.test(t)||/^hwb\(\s*\d+\s*,\s*\d+%\s*,\s*\d+%\s*\)$/i.test(t)||/^hwba\(\s*\d+\s*,\s*\d+%\s*,\s*\d+%\s*,\s*[\d.]+\s*\)$/i.test(t)||/^lab\(\s*[\d.]+\s*,\s*[\d.-]+\s*,\s*[\d.-]+\s*\)$/i.test(t)||/^lch\(\s*[\d.]+\s*,\s*[\d.]+\s*,\s*[\d.]+\s*\)$/i.test(t)||/^oklab\(\s*[\d.]+\s*,\s*[\d.-]+\s*,\s*[\d.-]+\s*\)$/i.test(t)||/^oklch\(\s*[\d.]+\s*,\s*[\d.]+\s*,\s*[\d.]+\s*\)$/i.test(t)}static isNumber(t){return!isNaN(Number(t))&&t.trim()!==""}static validateShape(t){const e=["arrowUp","arrowDown","arrowLeft","arrowRight","triangleUp","triangleDown","triangleLeft","triangleRight","square","diamond","star","cross","circle","x","check","flag","heart"];return e.includes(t)?{valid:!0}:{valid:!1,error:`不支持的图形类型: ${t}。支持的图形类型: ${e.join(", ")}`}}static validateColor(t){return this.isColor(t)?{valid:!0}:{valid:!1,error:`无效的颜色格式: ${t}。支持格式: #RGB, #RRGGBB, rgb(r,g,b), rgba(r,g,b,a)`}}static validateNumberRange(t,e,n,r){return t<e||t>n?{valid:!1,error:`${r} 值 ${t} 超出范围 [${e}, ${n}]`}:{valid:!0}}static findClosingParenthesis(t,e){let n=1,r=!1,s="";for(let o=e;o<t.length;o++){const l=t[o];if(!r&&(l==='"'||l==="'"))r=!0,s=l;else if(r&&l===s)r=!1;else if(!r&&l==="(")n++;else if(!r&&l===")"&&(n--,n===0))return o}throw new Error(`未找到匹配的闭合括号，从索引 ${e} 开始`)}static applyPresetValues(t,e){const n=new Map;e.forEach(r=>{n.set(r.key,r.value)}),t.forEach(r=>{n.has(r.key)?r.value=n.get(r.key):r.value=r.defaultValue})}}const Li=class Li{static registerEngine(t){this.engines.set(t.version,t)}static getEngine(t){return this.engines.get(t)||null}static getDefaultEngine(){return this.engines.get(this.defaultVersion)||this.engines.get(1)}static getAvailableVersions(){const t=[];for(const[e,n]of this.engines)t.push({version:n.version,name:n.name,description:n.description,features:n.features||[]});return t.sort((e,n)=>e.version-n.version)}static detectVersion(t){const e=t.match(/\/\/\s*@version\s*=\s*(\d+)/);if(e){const r=parseInt(e[1]);if(this.engines.has(r))return r}return Array.from(this.engines.keys()).sort((r,s)=>s-r)[0]||this.defaultVersion}static validateVersion(t){const e=this.detectVersion(t);return this.getEngine(e)?{valid:!0,version:e}:{valid:!1,version:e,error:`不支持的脚本版本: ${e}`}}};Li.engines=new Map,Li.defaultVersion=1;let Fn=Li;class rx{constructor(t){this.inputs=t}int(t,e={}){const n=e.name||e.title||e.label||"param";return this.inputs&&this.inputs[n]!==void 0?this.inputs[n]:t}float(t,e={}){const n=e.name||e.title||e.label||"param";return this.inputs&&this.inputs[n]!==void 0?this.inputs[n]:t}bool(t,e={}){const n=e.name||e.title||e.label||"param";return this.inputs&&this.inputs[n]!==void 0?this.inputs[n]:t}str(t,e={}){const n=e.name||e.title||e.label||"param";return this.inputs&&this.inputs[n]!==void 0?this.inputs[n]:t}string(t,e={}){return this.str(t,e)}select(t,e){const n=e.name||e.title||e.label||"param";return this.inputs&&this.inputs[n]!==void 0?this.inputs[n]:t}param(t,e={}){const n=e.name||e.title||e.label||"param";return this.inputs&&this.inputs[n]!==void 0?this.inputs[n]:t}}class sx{constructor(t){this.styles=t}color(t,e={}){const n=e.name||e.title||e.label||"style";return this.styles&&this.styles[n]!==void 0?this.styles[n]:t}lineWidth(t,e={}){const n=e.name||e.title||e.label||"style";return this.styles&&this.styles[n]!==void 0?this.styles[n]:t}lineStyle(t,e={}){const n=e.name||e.title||e.label||"style";return this.styles&&this.styles[n]!==void 0?this.styles[n]:t}shape(t,e={}){const n=e.name||e.title||e.label||"style";return this.styles&&this.styles[n]!==void 0?this.styles[n]:t}size(t,e={}){const n=e.name||e.title||e.label||"style";return this.styles&&this.styles[n]!==void 0?this.styles[n]:t}full(t,e={}){const n=e.name||e.title||e.label||"style";return this.styles&&this.styles[n]!==void 0?this.styles[n]:t}line(t,e={}){const n=e.name||e.title||e.label||"style";return this.styles&&this.styles[n]!==void 0?this.styles[n]:typeof e=="string"?{color:t,lineStyle:e,lineWidth:1}:typeof e=="object"&&e!==null?{color:t,lineStyle:e.lineStyle||"solid",lineWidth:e.lineWidth||1}:{color:t,lineStyle:"solid",lineWidth:1}}style(t,e={}){const n=e.name||e.title||e.label||"style";return this.styles&&this.styles[n]!==void 0?this.styles[n]:t}}class A{static getNumVal(t,e){if(e==null)return NaN;if(typeof e=="number")return e;if(typeof e=="string"){const n=parseFloat(e);return D.isValid(n)?n:NaN}if(typeof e=="object"){if(!t||t==="")return NaN;if(t){if(t&&e[t]!==void 0){const n=e[t];return D.isValid(n)?n:NaN}switch(t){case"hl2":return(e.high+e.low)/2;case"oc2":return(e.open+e.close)/2;case"hlc3":return(e.high+e.low+e.close)/3;case"ohl3":return(e.high+e.low+e.open)/3;case"ohlc4":return(e.high+e.low+e.close+e.open)/4;case"percentage":return D.isValid(e.close)&&D.isValid(e.open)&&e.open!==0?parseFloat(((e.close-e.open)/e.open*100).toFixed(2)):NaN;default:return NaN}}else return NaN}return NaN}static attr(t,e){return t.length===0?[]:typeof e=="string"&&e!==""?t.map(n=>n?A.getNumVal(e,n):null):t.map(n=>n)}static ma(t,e,n){const r=Math.max(1,parseInt(String(e)));let s=0,o=0;return t.map((l,c)=>{const a=A.getNumVal(n,l);if(!D.isValid(a))return null;if(s+=a,o++,c>=r){const f=A.getNumVal(n,t[c-r]);D.isValid(f)?s-=f:o--}if(o<r)return null;const h=s/r;return isFinite(h)?h:null})}static ema(t,e,n){const r=Math.max(1,parseInt(String(e))),s=2/(r+1);let o=null;return t.map((l,c)=>{const a=A.getNumVal(n,l);if(!D.isValid(a)||c<r-1)return null;if(o===null){let f=0,d=0;for(let u=0;u<r;u++){const p=A.getNumVal(n,t[c-u]);D.isValid(p)&&(f+=p,d++)}return d===r?(o=f/r,o):null}const h=a*s+o*(1-s);return o=h,h})}static wma(t,e=10,n=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,t.length<e)return[];const r=[];for(let o=1;o<=e;o++)r.push(o);const s=[];for(let o=0;o<t.length;o++){if(o<e-1){s.push(null);continue}let l=0,c=0;for(let a=0;a<e;a++){const h=o-e+1+a,f=A.getNumVal(n,t[h]);D.isValid(f)&&(l+=f*r[a],c+=r[a])}if(c>0){const a=l/c;s.push(isFinite(a)?a:null)}else s.push(null)}return s}static fwma(t,e=10,n=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,t.length<e)return[];const r=A.generateFibonacciWeights(e),s=[];for(let o=0;o<t.length;o++){if(o<e-1){s.push(null);continue}let l=0,c=0;for(let a=0;a<e;a++){const h=o-e+1+a,f=A.getNumVal(n,t[h]);D.isValid(f)&&(l+=f*r[a],c+=r[a])}s.push(c>0?l/c:null)}return s}static sma(t,e=10,n=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,t.length<e)return[];const r=[];for(let s=0;s<t.length;s++){if(s<e-1){r.push(null);continue}let o=0,l=0;for(let c=0;c<e;c++){const a=s-e+1+c,h=A.getNumVal(n,t[a]);D.isValid(h)&&(o+=h,l++)}r.push(l>0?o/l:null)}return r}static rma(t,e=10,n=null){if(!Array.isArray(t)||t.length===0)return[];e=Math.max(1,Math.floor(e))||10;const r=1/e;if(t.length<e)return[];const s=[];let o=0;for(let c=0;c<e;c++){const a=A.getNumVal(n,t[c]);D.isValid(a)&&(o+=a)}let l=o/e;s.push(l);for(let c=e;c<t.length;c++){const a=A.getNumVal(n,t[c]);D.isValid(a)?(l=r*a+(1-r)*l,s.push(l)):s.push(null)}for(let c=0;c<e-1;c++)s.unshift(null);return s}static rmaWithAlpha(t,e,n,r=null){const s=Math.max(1,parseInt(String(e))),o=n!==void 0?n:1/s;let l=0,c=0,a=!1;return t.map((h,f)=>{const d=A.getNumVal(r,h);return D.isValid(d)?a?(l=l*(1-o)+d*o,l):(c+=d,f===s-1?(l=c/s,a=!0,l):null):null})}static trima(t,e=10,n=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,t.length<e)return[];const r=Math.round(.5*(e+1)),s=[];for(let c=0;c<t.length;c++){const a=A.getNumVal(n,t[c]);s.push(D.isValid(a)?a:null)}const o=A.ma(s,r);return A.ma(o,r)}static kama(t,e=10,n=2,r=30,s=1,o=null){if(!Array.isArray(t)||t.length===0)return[];e=Math.max(1,Math.floor(e))||10,n=Math.max(1,Math.floor(n))||2,r=Math.max(1,Math.floor(r))||30,s=Math.max(1,Math.floor(s))||1;const l=Math.max(n,r,e);if(t.length<l)return[];const c=m=>2/(m+1),a=c(n),h=c(r),f=[];for(let m=0;m<t.length;m++){const y=A.getNumVal(o,t[m]);f.push(D.isValid(y)?y:null)}const d=[];for(let m=0;m<t.length;m++){if(m<e){d.push(null);continue}const y=f[m],v=f[m-e];y!==null&&v!==null?d.push(Math.abs(y-v)):d.push(null)}const u=[];for(let m=0;m<t.length;m++){if(m<s){u.push(null);continue}const y=f[m],v=f[m-s];y!==null&&v!==null?u.push(Math.abs(y-v)):u.push(null)}const p=[];for(let m=0;m<t.length;m++){if(m<e-1){p.push(null);continue}let y=0,v=0;for(let _=0;_<e;_++){const w=m-_;w>=0&&u[w]!==null&&(y+=u[w],v++)}v===e?p.push(y):p.push(null)}const x=[];for(let m=0;m<t.length;m++){const y=d[m],v=p[m];if(y!==null&&v!==null&&v!==0){const w=y/v*(a-h)+h;x.push(w*w)}else x.push(null)}const g=[];for(let m=0;m<e-1;m++)g.push(null);g.push(0);for(let m=e;m<t.length;m++){const y=f[m],v=x[m],_=g[m-1];if(y!==null&&v!==null&&_!==null){const w=v*y+(1-v)*_;g.push(w)}else g.push(null)}return g}static t3(t,e=10,n=.7,r=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,n=Math.max(.1,Math.min(.9,parseFloat(n.toString())))||.7,t.length<e)return[];const s=-n*Math.pow(n,2),o=3*Math.pow(n,2)+3*Math.pow(n,3),l=-6*Math.pow(n,2)-3*n-3*Math.pow(n,3),c=Math.pow(n,3)+3*Math.pow(n,2)+3*n+1,a=A.ema(t,e,r),h=A.ema(a,e),f=A.ema(h,e),d=A.ema(f,e),u=A.ema(d,e),p=A.ema(u,e),x=[];for(let g=0;g<t.length;g++){if(g<e*6-1){x.push(null);continue}const m=p[g],y=u[g],v=d[g],_=f[g];if(m!==null&&y!==null&&v!==null&&_!==null){const w=s*m+o*y+l*v+c*_;x.push(isFinite(w)?w:null)}else x.push(null)}return x}static dema(t,e=10,n=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,t.length<e)return[];const r=A.ema(t,e,n),s=A.ema(r,e),o=[];for(let l=0;l<t.length;l++){const c=r[l],a=s[l];if(c!==null&&a!==null){const h=2*c-a;o.push(h)}else o.push(null)}return o}static tema(t,e=10,n=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,t.length<e)return[];const r=A.ema(t,e,n),s=A.ema(r,e),o=A.ema(s,e),l=[];for(let c=0;c<t.length;c++){if(c<e*3-3){l.push(null);continue}const a=r[c],h=s[c],f=o[c];if(a!==null&&h!==null&&f!==null){const d=3*(a-h)+f;l.push(isFinite(d)?d:null)}else l.push(null)}return l}static vidya(t,e=14,n=1,r=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||14,n=Math.max(1,Math.floor(n))||1,t.length<e)return[];const s=[];for(let a=0;a<t.length;a++){const h=A.getNumVal(r,t[a]);s.push(D.isValid(h)?h:null)}const o=[];for(let a=0;a<t.length;a++){if(a<n){o.push(null);continue}let h=0,f=0;for(let d=0;d<e;d++)if(a-d-n>=0&&s[a-d]!==null&&s[a-d-n]!==null){const u=s[a-d]-s[a-d-n];u>0?h+=u:f+=Math.abs(u)}h+f===0?o.push(0):o.push((h-f)/(h+f))}const l=2/(e+1),c=[];for(let a=0;a<t.length;a++){if(a<e){c.push(null);continue}const h=s[a],f=o[a],d=c[a-1];if(h!==null&&f!==null&&d!==null){const u=Math.abs(f),p=l*u*h+d*(1-l*u);c.push(isFinite(p)?p:null)}else c.push(null)}return c}static vwap(t,e="D"){if(!Array.isArray(t)||t.length===0)return[];if(e=e&&typeof e=="string"&&e.length>=1?e.toUpperCase():"D",t.length<1)return[];const n=[];let r=0,s=0;for(let o=0;o<t.length;o++){const l=t[o];if(!l||typeof l.high!="number"||typeof l.low!="number"||typeof l.close!="number"||typeof l.volume!="number"){n.push(null);continue}const a=(l.high+l.low+l.close)/3*l.volume;if(this.shouldResetAnchor(o,e)&&(r=0,s=0,this.getCurrentAnchor(o,e)),r+=a,s+=l.volume,s>0){const f=r/s;n.push(isFinite(f)?f:null)}else n.push(null)}return n}static wcp(t){if(!Array.isArray(t)||t.length===0)return[];const e=[];for(let n=0;n<t.length;n++){const r=t[n];if(r&&D.isValid(r.high)&&D.isValid(r.low)&&D.isValid(r.close)){const s=(r.high+r.low+2*r.close)/4;e.push(isFinite(s)?s:null)}else e.push(null)}return e}static vwma(t,e=10){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,t.length<e)return[];const n=[];for(let r=0;r<t.length;r++){if(r<e-1){n.push(null);continue}let s=0,o=0,l=0;for(let c=0;c<e;c++){const a=r-c;if(a>=0){const h=t[a];h&&D.isValid(h.close)&&D.isValid(h.volume)&&(s+=h.close*h.volume,o+=h.volume,l++)}}if(l===e&&o>0){const c=s/o;n.push(isFinite(c)?c:null)}else n.push(null)}return n}static zlma(t,e=10,n="ema",r=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,n=String(n).toLowerCase()||"ema",t.length<e)return[];const s=Math.floor(.5*(e-1));for(let l=0;l<t.length;l++){const c=t[l].close;if(D.isValid(c)&&l>=s){const a=t[l-s].close;D.isValid(a)}}let o=[];switch(n){case"dema":o=A.dema(t,e,r);break;case"hma":o=A.hma(t,e,r);break;case"linreg":o=A.linreg(t,e,!1,!1,!1,!1,!1,!1,r);break;case"rma":o=A.rma(t,e,r);break;case"sma":o=A.sma(t,e,r);break;case"swma":o=A.swma(t,e,!0,r);break;case"t3":o=A.t3(t,e,0,r);break;case"tema":o=A.tema(t,e,r);break;case"trima":o=A.trima(t,e,r);break;case"vidya":o=A.vidya(t,e,1,r);break;case"wma":o=A.wma(t,e,r);break;default:o=A.ema(t,e,r);break}return o}static drawdown(t){if(!Array.isArray(t)||t.length===0)return{dd:[],dd_pct:[],dd_log:[]};const e=[];let n=-1/0;for(let l=0;l<t.length;l++){const c=t[l].close;D.isValid(c)?(c>n&&(n=c),e.push(n)):e.push(null)}const r=[],s=[],o=[];for(let l=0;l<t.length;l++){const c=t[l].close,a=e[l];if(D.isValid(c)&&D.isValid(a)&&a>0){const h=a-c;r.push(isFinite(h)?h:null);const f=1-c/a;s.push(isFinite(f)?f:null);const d=Math.log(a/c);o.push(isFinite(d)?d:null)}else r.push(null),s.push(null),o.push(null)}return{dd:r,dd_pct:s,dd_log:o}}static log_return(t,e=1,n=!1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||1,n=!!n,t.length<e)return[];const r=[];for(let s=0;s<t.length;s++){if(s<e){r.push(null);continue}const o=t[s].close,l=t[s-e].close;if(D.isValid(o)&&D.isValid(l)&&l>0){const c=Math.log(o/l);r.push(isFinite(c)?c:null)}else r.push(null)}if(n){let s=0;for(let o=0;o<r.length;o++)r[o]!==null&&(s+=r[o],r[o]=s)}return r}static percent_return(t,e=1,n=!1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||1,n=!!n,t.length<e)return[];const r=[];for(let s=0;s<t.length;s++){if(s<e){r.push(null);continue}const o=t[s].close,l=t[s-e].close;if(D.isValid(o)&&D.isValid(l)&&l>0){const c=(o-l)/l;r.push(isFinite(c)?c:null)}else r.push(null)}if(n){let s=0;for(let o=0;o<r.length;o++)r[o]!==null&&(s+=r[o],r[o]=s)}return r}static trend_return(t,e,n=!0,r=!1,s=0,o=-1){if(!Array.isArray(t)||t.length===0||!Array.isArray(e)||e.length===0)return{active_returns:[],cumulative_returns:[],trends:[],trades:[],entries:[],exits:[]};if(n=!!n,r=!!r,s=Math.floor(s)||0,o=o!==0?Math.floor(o)||-1:0,t.length!==e.length)return{active_returns:[],cumulative_returns:[],trends:[],trades:[],entries:[],exits:[]};const l=n?A.log_return(t,1,!1):A.percent_return(t,1,!1),c=e.map(x=>r?!!x:Number(x)),a=[];for(let x=0;x<t.length;x++){const g=c[x],m=l[x];if(D.isValid(m)&&g){const y=typeof g=="boolean"?g?1:0:Number(g);a.push(y*m)}else a.push(0)}const h=[];let f=0;for(let x=0;x<t.length;x++){const g=c[x],m=a[x];D.isValid(m)?(typeof g=="boolean"?g?f+=m:f=0:Number(g)===s?f=0:f+=m,h.push(f)):h.push(null)}const d=[];for(let x=0;x<t.length;x++){if(x===0){d.push(0);continue}const g=c[x],m=c[x-1];if(D.isValid(g)&&D.isValid(m)){const y=typeof g=="boolean"?g?1:0:Number(g),v=typeof m=="boolean"?m?1:0:Number(m),_=y-v;d.push(_)}else d.push(null)}if(o!==0)if(o>0){for(let x=0;x<o;x++)d.unshift(null);d.splice(-o)}else{for(let x=0;x<Math.abs(o);x++)d.push(null);d.splice(0,Math.abs(o))}const u=d.map(x=>x===null?r?!1:0:r?x>0:x>0?1:0),p=d.map(x=>x===null?r?!1:0:r?x<0:Math.abs(x<0?x:0));return{active_returns:a,cumulative_returns:h,trends:c,trades:d,entries:u,exits:p}}static entropy(t,e=10,n=2){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,n=Math.max(.1,n)||2,t.length<e)return[];const r=[];for(let o=0;o<t.length;o++){const l=t[o].close;r.push(D.isValid(l)?l:null)}const s=[];for(let o=0;o<t.length;o++){if(o<e-1){s.push(null);continue}let l=0;const c=[];for(let a=0;a<e;a++){const h=o-e+1+a,f=r[h];D.isValid(f)&&(l+=f,c.push(f))}if(l>0&&c.length>0){const a=c.map(f=>f/l);let h=0;for(const f of a)if(f>0){const d=Math.log(f),u=Math.log(n);h+=-f*d/u}s.push(isFinite(h)?h:null)}else s.push(null)}return s}static kurtosis(t,e=30,n=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||30,n=n!==null?Math.max(1,Math.floor(n)):e,t.length<Math.max(e,n))return[];const r=[];for(let o=0;o<t.length;o++){const l=t[o].close;r.push(D.isValid(l)?l:null)}const s=[];for(let o=0;o<t.length;o++){if(o<Math.max(e,n)-1){s.push(null);continue}const l=[];for(let c=0;c<e;c++){const a=o-e+1+c;a>=0&&D.isValid(r[a])&&l.push(r[a])}if(l.length>=n){const c=l.reduce((h,f)=>h+f,0)/l.length,a=l.reduce((h,f)=>h+Math.pow(f-c,2),0)/l.length;if(a>0){const f=l.reduce((d,u)=>d+Math.pow(u-c,4),0)/l.length/Math.pow(a,2)-3;s.push(isFinite(f)?f:null)}else s.push(null)}else s.push(null)}return s}static mad(t,e=30,n=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||30,n=n!==null?Math.max(1,Math.floor(n)):e,t.length<Math.max(e,n))return[];const r=[];for(let o=0;o<t.length;o++){const l=t[o].close;r.push(D.isValid(l)?l:null)}const s=[];for(let o=0;o<t.length;o++){if(o<Math.max(e,n)-1){s.push(null);continue}const l=[];for(let c=0;c<e;c++){const a=o-e+1+c;a>=0&&D.isValid(r[a])&&l.push(r[a])}if(l.length>=n){const c=l.reduce((f,d)=>f+d,0)/l.length,a=l.map(f=>Math.abs(f-c)),h=a.reduce((f,d)=>f+d,0)/a.length;s.push(isFinite(h)?h:null)}else s.push(null)}return s}static median(t,e=30,n=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||30,n=n!==null?Math.max(1,Math.floor(n)):e,t.length<Math.max(e,n))return[];const r=[];for(let o=0;o<t.length;o++){const l=t[o].close;r.push(D.isValid(l)?l:null)}const s=[];for(let o=0;o<t.length;o++){if(o<Math.max(e,n)-1){s.push(null);continue}const l=[];for(let c=0;c<e;c++){const a=o-e+1+c;a>=0&&D.isValid(r[a])&&l.push(r[a])}if(l.length>=n){const c=l.slice().sort((f,d)=>f-d),a=Math.floor(c.length/2);let h;c.length%2===0?h=(c[a-1]+c[a])/2:h=c[a],s.push(isFinite(h)?h:null)}else s.push(null)}return s}static quantile(t,e=30,n=.5,r=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||30,n=Math.max(.001,Math.min(.999,n))||.5,r=r!==null?Math.max(1,Math.floor(r)):e,t.length<Math.max(e,r))return[];const s=[];for(let l=0;l<t.length;l++){const c=t[l].close;s.push(D.isValid(c)?c:null)}const o=[];for(let l=0;l<t.length;l++){if(l<Math.max(e,r)-1){o.push(null);continue}const c=[];for(let a=0;a<e;a++){const h=l-e+1+a;h>=0&&D.isValid(s[h])&&c.push(s[h])}if(c.length>=r){const a=c.slice().sort((x,g)=>x-g),h=a.length;if(h===0){o.push(null);continue}const f=n*(h-1),d=Math.floor(f),u=Math.ceil(f);let p;if(d===u)p=a[d];else{const x=a[d],g=a[u],m=f-d;p=x+m*(g-x)}o.push(isFinite(p)?p:null)}else o.push(null)}return o}static skew(t,e=30,n=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||30,n=n!==null?Math.max(1,Math.floor(n)):e,t.length<Math.max(e,n))return[];const r=[];for(let s=0;s<t.length;s++){if(s<Math.max(e,n)-1){r.push(null);continue}const o=[];for(let l=0;l<e;l++){const c=s-e+1+l;c>=0&&o.push(t[c].close)}if(o.length>=n){const l=o.length;if(l<3){r.push(null);continue}const c=o.reduce((h,f)=>h+f,0)/l,a=o.reduce((h,f)=>h+Math.pow(f-c,2),0)/l;if(a>0){const f=o.reduce((d,u)=>d+Math.pow(u-c,3),0)/l/Math.pow(a,1.5);r.push(isFinite(f)?f:null)}else r.push(null)}else r.push(null)}return r}static hma(t,e=10,n=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,t.length<e)return[];const r=Math.floor(e/2),s=Math.floor(Math.sqrt(e)),o=A.wma(t,r,n),l=A.wma(t,e,n),c=t.map((h,f)=>o[f]===null||l[f]===null?null:2*o[f]-l[f]);return A.wma(c,s,null)}static lsma(t,e,n=null){const r=Math.max(1,parseInt(String(e)));return t.map((s,o)=>{if(o<r-1)return null;const l=t.slice(o-r+1,o+1);let c=0,a=0,h=0,f=0,d=0;if(l.forEach((m,y)=>{const v=y,_=A.getNumVal(n,m);D.isValid(_)&&(c+=v,a+=_,h+=v*_,f+=v*v,d++)}),d<r)return null;const u=r*f-c*c;if(u===0)return null;const p=(r*h-c*a)/u,x=(a-p*c)/r,g=p*(r-1)+x;return isFinite(g)?g:null})}static jma(t,e,n=0,r=null){const s=Math.max(1,e),o=n<-100?.5:n>100?2.5:n/100+1.5,l=.45*(s-1)/(.45*(s-1)+2),c=Math.pow(l,o);let a=null,h=null,f=null,d=null,u=null,p=null,x=null,g=null;return t.map((m,y)=>{const v=A.getNumVal(r,m);return D.isValid(v)?a===null?(a=h=f=d=p=g=v,v):(a=(1-c)*v+c*a,h=(v-a)*(1-l)+l*h,f=(a+o*h-g)*c*c+g,d=f,u=(d-p)*(.5*(s-1)+1)/s,p=d,x=u,g=d+x,isFinite(g)?g:null):null})}static mcginley(t,e,n=null){const r=Math.max(1,e);let s=0;return t.map((o,l)=>{const c=A.getNumVal(n,o);return l===0?s=c:s=s+(c-s)/(r*Math.pow(c/s,4))})}static mcgd(t,e=10,n=1,r=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,n=Math.max(.1,Math.min(1,n))||1,t.length<e)return[];const s=[];for(let l=0;l<t.length;l++){const c=A.getNumVal(r,t[l]);s.push(D.isValid(c)?c:null)}const o=[];o.push(s[0]);for(let l=1;l<t.length;l++){const c=s[l],a=s[l-1],h=o[l-1];if(c!==null&&a!==null&&h!==null&&a!==0){const f=c/a,d=n*e*Math.pow(f,4);if(Math.abs(d)>1e-10){const u=h+(c-h)/d;o.push(isFinite(u)?u:c)}else o.push(c)}else o.push(null)}return o}static edsma(t,e,n=null){const r=Math.max(2,e);let s=0;return t.map((o,l)=>{const c=A.getNumVal(n,o);if(l===0)return s=c;const a=2/(r+1);return s=a*c+(1-a)*s})}static vama(t,e){return t.map((n,r)=>{if(r<e-1)return null;const s=t.slice(r-e+1,r+1);let o=0,l=0;return s.forEach(c=>{const a=c.close??0,h=c.volume??0;o+=a*h,l+=h}),l===0?null:o/l})}static stdev(t,e=30,n=1,r=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||30,n=Math.max(0,Math.min(n,e-1))||1,t.length<e)return[];const s=[];for(let o=0;o<t.length;o++){if(o<e-1){s.push(null);continue}const l=[];for(let c=0;c<e;c++){const a=o-e+1+c;let h=A.getNumVal(r,t[a]);a>=0&&D.isValid(h)&&l.push(h)}if(l.length>=e-n){const c=l.reduce((h,f)=>h+f,0)/l.length,a=l.reduce((h,f)=>h+Math.pow(f-c,2),0)/(l.length-n);if(a>0){const h=Math.sqrt(a);s.push(isFinite(h)?h:null)}else s.push(null)}else s.push(null)}return s}static variance(t,e=30,n=0,r=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(2,Math.floor(e))||30,n=Math.max(0,Math.min(n,e-1))||0,r=r!==null?Math.max(1,Math.floor(r)):e,t.length<Math.max(e,r))return[];const s=[];for(let l=0;l<t.length;l++){const c=t[l].close;s.push(D.isValid(c)?c:null)}const o=[];for(let l=0;l<t.length;l++){if(l<Math.max(e,r)-1){o.push(null);continue}const c=[];for(let a=0;a<e;a++){const h=l-e+1+a;h>=0&&D.isValid(s[h])&&c.push(s[h])}if(c.length>=r){const a=c.reduce((f,d)=>f+d,0)/c.length,h=c.reduce((f,d)=>f+Math.pow(d-a,2),0)/(c.length-n);isFinite(h)?o.push(h):o.push(null)}else o.push(null)}return o}static zscore(t,e=30,n=1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(2,Math.floor(e))||30,n=Math.max(.1,parseFloat(String(n)))||1,t.length<e)return[];const r=[];for(let o=0;o<t.length;o++){const l=t[o].close;r.push(D.isValid(l)?l:null)}const s=[];for(let o=0;o<t.length;o++){if(o<e-1){s.push(null);continue}const l=[];for(let c=0;c<e;c++){const a=o-e+1+c;a>=0&&D.isValid(r[a])&&l.push(r[a])}if(l.length>=e){const c=l.reduce((f,d)=>f+d,0)/l.length,a=l.reduce((f,d)=>f+Math.pow(d-c,2),0)/l.length,h=Math.sqrt(a);if(h>0){const f=r[o];if(D.isValid(f)){const d=(f-c)/(n*h);s.push(isFinite(d)?d:null)}else s.push(null)}else s.push(null)}else s.push(null)}return s}static adx(t,e=14,n=100,r="rma",s=1){if(!Array.isArray(t)||t.length===0)return{adx:[],dmp:[],dmn:[]};if(e=Math.max(1,Math.floor(e))||14,n=Math.max(.1,parseFloat(String(n)))||100,r=r||"rma",s=Math.max(1,Math.floor(s))||1,t.length<e+s)return{adx:[],dmp:[],dmn:[]};const o=[],l=[],c=[];for(let y=0;y<t.length;y++){const v=t[y].high,_=t[y].low,w=t[y].close;o.push(D.isValid(v)?v:null),l.push(D.isValid(_)?_:null),c.push(D.isValid(w)?w:null)}const a=A.atr(t,e),h=[],f=[];for(let y=0;y<t.length;y++){if(y<s){h.push(null),f.push(null);continue}const v=o[y],_=o[y-s],w=l[y],b=l[y-s];if(D.isValid(v)&&D.isValid(_)&&D.isValid(w)&&D.isValid(b)){const C=v-_,M=b-w;h.push(C),f.push(M)}else h.push(null),f.push(null)}const d=[],u=[];for(let y=0;y<t.length;y++){if(y<s){d.push(null),u.push(null);continue}const v=h[y],_=f[y];D.isValid(v)&&D.isValid(_)?(v>_&&v>0?d.push(v):d.push(0),_>v&&_>0?u.push(_):u.push(0)):(d.push(null),u.push(null))}const p=[],x=[];for(let y=0;y<t.length;y++){if(y<e-1){p.push(null),x.push(null);continue}let v=0,_=0;for(let C=0;C<e;C++){const M=y-C;M>=0&&D.isValid(d[M])&&(v+=d[M],_++)}let w=0,b=0;for(let C=0;C<e;C++){const M=y-C;M>=0&&D.isValid(u[M])&&(w+=u[M],b++)}if(_>0&&b>0&&D.isValid(a[y])){const C=a[y];if(C>0){const M=n/C;p.push(M*(v/_)),x.push(M*(w/b))}else p.push(null),x.push(null)}else p.push(null),x.push(null)}const g=[],m=[];for(let y=0;y<t.length;y++){if(y<e-1){g.push(null),m.push(null);continue}const v=p[y],_=x[y];if(D.isValid(v)&&D.isValid(_)){const w=v+_;if(w>0){const b=n*Math.abs(v-_)/w;g.push(b)}else g.push(null)}else g.push(null)}for(let y=0;y<t.length;y++){if(y<e-1){m.push(null);continue}let v=0,_=0;for(let w=0;w<e;w++){const b=y-w;b>=0&&D.isValid(g[b])&&(v+=g[b],_++)}_>0?m.push(v/_):m.push(null)}return{adx:m,dmp:p,dmn:x}}static amat(t,e=8,n=21,r="ema",s=2){if(!Array.isArray(t)||t.length===0)return{mas_long:[],mas_short:[]};e=Math.max(1,Math.floor(e))||8,n=Math.max(1,Math.floor(n))||21,s=Math.max(1,Math.floor(s))||2,r=r||"ema";const o=Math.max(e,n,s);if(t.length<o)return{mas_long:[],mas_short:[]};const l=[];for(let d=0;d<t.length;d++){const u=t[d].close;l.push(D.isValid(u)?u:null)}let c=[],a=[];switch(r.toLowerCase()){case"sma":c=A.sma(t,e,"close"),a=A.sma(t,n,"close");break;case"ema":c=A.ema(t,e,"close"),a=A.ema(t,n,"close");break;case"rma":c=A.rma(t,e,"close"),a=A.rma(t,n,"close");break;case"hma":c=A.hma(t,e,"close"),a=A.hma(t,n,"close");break;case"wma":c=A.wma(t,e,"close"),a=A.wma(t,n,"close");break;default:c=A.ema(t,e,"close"),a=A.ema(t,n,"close");break}const h=[];for(let d=0;d<t.length;d++){if(d<s-1){h.push(null);continue}let u=0;for(let p=0;p<s;p++){const x=d-p;x>=0&&D.isValid(c[x])&&D.isValid(a[x])&&c[x]>a[x]&&u++}h.push(u>s/2?1:0)}const f=[];for(let d=0;d<t.length;d++){if(d<s-1){f.push(null);continue}let u=0;for(let p=0;p<s;p++){const x=d-p;x>=0&&D.isValid(c[x])&&D.isValid(a[x])&&c[x]<a[x]&&u++}f.push(u>s/2?1:0)}return{mas_long:h,mas_short:f}}static aroon(t,e=14,n=100){if(!Array.isArray(t)||t.length===0)return{aroon_up:[],aroon_down:[],aroon_osc:[]};if(e=Math.max(1,Math.floor(e))||14,n=Math.max(.1,parseFloat(String(n)))||100,t.length<e+1)return{aroon_up:[],aroon_down:[],aroon_osc:[]};const r=[],s=[];for(let a=0;a<t.length;a++){const h=t[a].high,f=t[a].low;r.push(D.isValid(h)?h:null),s.push(D.isValid(f)?f:null)}const o=[],l=[];for(let a=0;a<t.length;a++){if(a<e){o.push(null),l.push(null);continue}let h=0,f=-1/0,d=a;for(let y=0;y<=e;y++){const v=a-y;v>=0&&D.isValid(r[v])&&r[v]>f&&(f=r[v],d=v)}h=a-d;let u=0,p=1/0,x=a;for(let y=0;y<=e;y++){const v=a-y;v>=0&&D.isValid(s[v])&&s[v]<p&&(p=s[v],x=v)}u=a-x;const g=n*(1-h/e),m=n*(1-u/e);o.push(isFinite(g)?g:null),l.push(isFinite(m)?m:null)}const c=[];for(let a=0;a<t.length;a++){if(a<e){c.push(null);continue}const h=o[a],f=l[a];if(D.isValid(h)&&D.isValid(f)){const d=h-f;c.push(isFinite(d)?d:null)}else c.push(null)}return{aroon_up:o,aroon_down:l,aroon_osc:c}}static chop(t,e=14,n=1,r=100,s=1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||14,n=Math.max(1,Math.floor(n))||1,r=Math.max(.1,parseFloat(String(r)))||100,s=Math.floor(s)||1,t.length<Math.max(e,n))return[];const o=[],l=[],c=[];for(let h=0;h<t.length;h++){const f=t[h].high,d=t[h].low,u=t[h].close;o.push(D.isValid(f)?f:null),l.push(D.isValid(d)?d:null),c.push(D.isValid(u)?u:null)}const a=[];for(let h=0;h<t.length;h++){if(h<e-1){a.push(null);continue}let f=-1/0,d=1/0;for(let g=0;g<e;g++){const m=h-g;m>=0&&D.isValid(o[m])&&D.isValid(l[m])&&(f=Math.max(f,o[m]),d=Math.min(d,l[m]))}const u=f-d;let p=0,x=0;for(let g=0;g<e;g++){const m=h-g;if(m>=0){let y=0;if(m>0&&D.isValid(o[m])&&D.isValid(l[m])&&D.isValid(c[m-1])){const v=o[m]-l[m],_=Math.abs(o[m]-c[m-1]),w=Math.abs(l[m]-c[m-1]);y=Math.max(v,_,w)}else D.isValid(o[m])&&D.isValid(l[m])&&(y=o[m]-l[m]);y>0&&(p+=y,x++)}}if(x>0&&u>0&&p>0){const g=Math.log10(p),m=Math.log10(u),y=Math.log10(e),v=r*(g-m)/y;a.push(isFinite(v)?v:null)}else a.push(null)}return a}static cksp(t,e=10,n=1,r=9,s=!0){if(!Array.isArray(t)||t.length===0)return{long_stop:[],short_stop:[]};e=Math.max(1,Math.floor(e))||10,n=Math.max(.1,parseFloat(String(n)))||(s?1:3),r=Math.max(1,Math.floor(r))||(s?9:20),s=!!s;const o=Math.max(e,r,n);if(t.length<o)return{long_stop:[],short_stop:[]};const l=[],c=[],a=[];for(let u=0;u<t.length;u++){const p=t[u].high,x=t[u].low,g=t[u].close;l.push(D.isValid(p)?p:null),c.push(D.isValid(x)?x:null),a.push(D.isValid(g)?g:null)}const h=[];for(let u=0;u<t.length;u++){if(u<e-1){h.push(null);continue}let p=0,x=0;for(let g=0;g<e;g++){const m=u-g;if(m>=0){let y=0;if(m>0&&D.isValid(l[m])&&D.isValid(c[m])&&D.isValid(a[m-1])){const v=l[m]-c[m],_=Math.abs(l[m]-a[m-1]),w=Math.abs(c[m]-a[m-1]);y=Math.max(v,_,w)}else D.isValid(l[m])&&D.isValid(c[m])&&(y=l[m]-c[m]);y>0&&(p+=y,x++)}}if(x>0){const g=p/x;h.push(isFinite(g)?g:null)}else h.push(null)}const f=[],d=[];for(let u=0;u<t.length;u++){if(u<o-1){f.push(null),d.push(null);continue}let p=-1/0,x=1/0;for(let y=0;y<e;y++){const v=u-y;if(v>=0&&D.isValid(l[v])&&D.isValid(c[v])&&D.isValid(h[v])){const _=l[v]-n*h[v],w=c[v]+n*h[v];p=Math.max(p,_),x=Math.min(x,w)}}let g=-1/0,m=1/0;for(let y=0;y<r;y++){const v=u-y;if(v>=0&&v<f.length&&f[v]!==null){const _=f[v];_!==null&&(g=Math.max(g,_))}if(v>=0&&v<d.length&&d[v]!==null){const _=d[v];_!==null&&(m=Math.min(m,_))}}g===-1/0&&(g=p),m===1/0&&(m=x),f.push(isFinite(g)?g:null),d.push(isFinite(m)?m:null)}return{long_stop:f,short_stop:d}}static decay(t,e=5,n="linear"){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||5,n=(n||"linear").toLowerCase(),t.length<e)return[];const r=[];for(let s=0;s<t.length;s++){const o=t[s].close;if(s===0){r.push(o);continue}if(s<e){r.push(o);continue}const l=t[s-1].close;if(!D.isValid(o)||!D.isValid(l)){r.push(null);continue}let c;n==="exp"?c=l-Math.exp(-e):c=l-1/e;const a=Math.max(o,c,0);r.push(isFinite(a)?a:null)}return r}static decreasing(t,e=1,n=!1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||1,n=!!n,t.length<e)return[];const r=[];for(let s=0;s<t.length;s++){if(s<e){r.push(null);continue}let o;if(n){let l=!0;for(let c=0;c<e;c++){const a=s-c,h=s-c-1;if(a>=0&&h>=0){if(t[a].close>=t[h].close){l=!1;break}}else{l=!1;break}}o=l}else{const l=t[s].close,c=t[s-e].close;D.isValid(l)&&D.isValid(c)?o=l-c<0:o=!1}r.push(o?1:0)}return r}static dpo(t,e=20,n=!0){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||20,n=!!n,t.length<e)return[];const r=[],s=Math.floor(.5*e)+1;for(let o=0;o<t.length;o++){if(o<e-1){r.push(null);continue}let l=0,c=0;for(let f=0;f<e;f++){const d=o-f;d>=0&&(l+=t[d].close,c++)}if(c===0){r.push(null);continue}const a=l/c;let h;if(n){const f=o+s<t.length?t[o+s].close:null;f!==null&&D.isValid(f)?h=f-a:h=0}else{const f=o-s>=0?a:0;h=t[o].close-f}r.push(isFinite(h)?h:null)}return r}static increasing(t,e=1,n=!1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||1,n=!!n,t.length<e)return[];const r=[];for(let s=0;s<t.length;s++){if(s<e){r.push(null);continue}let o;if(n){let l=!0;for(let c=0;c<e;c++){const a=s-c,h=s-c-1;if(a>=0&&h>=0){if(t[a].close<=t[h].close){l=!1;break}}else{l=!1;break}}o=l}else{const l=t[s].close,c=t[s-e].close;D.isValid(l)&&D.isValid(c)?o=l-c>0:o=!1}r.push(o?1:0)}return r}static longRun(t,e,n=2){if(!Array.isArray(t)||!Array.isArray(e)||t.length===0||e.length===0)return[];n=Math.max(1,Math.floor(n))||2;const r=Math.max(n,2);if(t.length<r||e.length<r)return[];const s=[];for(let o=0;o<Math.min(t.length,e.length);o++){if(o<r-1){s.push(null);continue}let l=!1,c=!1,a=!1,h=!1;o>=n&&D.isValid(t[o])&&D.isValid(t[o-n])&&(l=t[o]>t[o-n]),o>=n&&D.isValid(e[o])&&D.isValid(e[o-n])&&(c=e[o]<e[o-n]),o>=n&&D.isValid(t[o])&&D.isValid(t[o-n])&&(a=t[o]>t[o-n]),o>=n&&D.isValid(e[o])&&D.isValid(e[o-n])&&(h=e[o]>e[o-n]);const u=l&&c||a&&h;s.push(u?1:0)}return s}static psar(t,e=.02,n=.2){if(!Array.isArray(t)||t.length===0)return{long:[],short:[],af:[],reversal:[]};if(e=Math.max(.001,Math.min(e,1))||.02,n=Math.max(.001,Math.min(n,1))||.2,t.length<3)return{long:[],short:[],af:[],reversal:[]};const r=t.length,s=e;let o=!0,l=t[0].high,c=t[0].low;const a=[],h=[],f=[],d=[];for(let u=0;u<2;u++)a.push(null),h.push(null),f.push(0),d.push(s);for(let u=2;u<r;u++){let p=!1;if(d.push(e),o){let x=(a[u-1]||t[u-1].low||0)+e*(l-(a[u-1]||t[u-1].low||0));t[u].low&&x&&t[u].low<x&&(o=!1,p=!0,e=s,x=l,c=t[u].low),a.push(x),h.push(null)}else{let x=(h[u-1]||t[u-1].high||0)+e*(c-(h[u-1]||t[u-1].high||0));t[u].high&&x&&t[u].high>x&&(o=!0,p=!0,e=s,x=c,l=t[u].high),a.push(null),h.push(x)}f.push(p?1:0),p||(o?(t[u].high&&t[u].high>l&&(l=t[u].high,e=Math.min(e+s,n)),a[u]!==null&&(t[u-1].low&&t[u-1].low<a[u]&&(a[u]=t[u-1].low),t[u-2].low&&t[u-2].low<a[u]&&(a[u]=t[u-2].low))):(t[u].low&&t[u].low<c&&(c=t[u].low,e=Math.min(e+s,n)),h[u]!==null&&(t[u-1].high&&t[u-1].high>h[u]&&(h[u]=t[u-1].high),t[u-2].high&&t[u-2].high>h[u]&&(h[u]=t[u-2].high))))}return{long:a,short:h,af:d,reversal:f}}static qstick(t,e=10,n="sma"){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,n=n.toLowerCase()||"sma",t.length<e)return[];const r=[];for(let l=0;l<t.length;l++){const c=t[l].open,a=t[l].close;D.isValid(c)&&D.isValid(a)?r.push(a-c):r.push(null)}let s=[];const o=r.map((l,c)=>({timestamp:t[c]?.timestamp||0,open:l||0,high:l||0,low:l||0,close:l||0,volume:0}));switch(n){case"dema":s=A.dema(o,e);break;case"ema":s=A.ema(r,e);break;case"hma":s=A.hma(r,e);break;case"rma":s=A.rma(r,e);break;default:s=A.sma(r,e);break}return s}static short_run(t,e,n=2){if(!Array.isArray(t)||!Array.isArray(e)||t.length===0||e.length===0)return[];n=Math.max(1,Math.floor(n))||2;const r=Math.max(n,2);if(t.length<r||e.length<r)return[];const s=[];for(let o=0;o<Math.min(t.length,e.length);o++){if(o<r-1){s.push(null);continue}let l=!1,c=!1,a=!1,h=!1;o>=n&&D.isValid(t[o])&&D.isValid(t[o-n])&&(l=t[o]<t[o-n]),o>=n&&D.isValid(e[o])&&D.isValid(e[o-n])&&(c=e[o]>e[o-n]),o>=n&&D.isValid(t[o])&&D.isValid(t[o-n])&&(a=t[o]<t[o-n]),o>=n&&D.isValid(e[o])&&D.isValid(e[o-n])&&(h=e[o]<e[o-n]);const u=l&&c||a&&h;s.push(u?1:0)}return s}static ttm_trend(t,e=6){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||6,t.length<e)return[];const n=[];for(let r=0;r<t.length;r++){if(r<e-1){n.push(null);continue}let s=0,o=0;for(let l=0;l<e;l++){const c=r-l;if(c>=0){const a=t[c].high,h=t[c].low;if(D.isValid(a)&&D.isValid(h)){const f=(a+h)/2;s+=f,o++}}}if(o>=e){s=s/e;const l=t[r].close;if(D.isValid(l)){const c=l>s?1:-1;n.push(c)}else n.push(null)}else n.push(null)}return n}static vortex(t,e=14,n=1){if(!Array.isArray(t)||t.length===0)return{vip:[],vim:[]};e=Math.max(1,Math.floor(e))||14,n=Math.max(1,Math.floor(n))||1;const r=Math.max(e,n);if(t.length<r)return{vip:[],vim:[]};const s=[],o=[];for(let l=0;l<t.length;l++){if(l<r-1){s.push(null),o.push(null);continue}if(l>0){const c=t[l].high,a=t[l].low,h=t[l-1].close;D.isValid(c)&&D.isValid(a)&&D.isValid(h)}if(l>=n){const c=t[l].high,a=t[l].low,h=t[l-n].high,f=t[l-n].low;D.isValid(c)&&D.isValid(a)&&D.isValid(h)&&D.isValid(f)}if(l>=e-1){let c=0,a=0,h=0,f=0;for(let d=0;d<e;d++){const u=l-d;if(u>=0){if(u>0){const p=t[u].high,x=t[u].low,g=t[u-1].close;if(D.isValid(p)&&D.isValid(x)&&D.isValid(g)){const m=Math.abs(p-x),y=Math.abs(p-g),v=Math.abs(x-g),_=Math.max(m,y,v);c+=_}}if(u>=n){const p=t[u].high,x=t[u].low,g=t[u-n].high,m=t[u-n].low;D.isValid(p)&&D.isValid(x)&&D.isValid(g)&&D.isValid(m)&&(a+=Math.abs(p-m),h+=Math.abs(x-g))}f++}}if(f>=e&&c>0){const d=a/c,u=h/c;s.push(d),o.push(u)}else s.push(null),o.push(null)}else s.push(null),o.push(null)}return{vip:s,vim:o}}static aberration(t,e=5,n=15){if(!Array.isArray(t)||t.length===0)return{zg:[],sg:[],xg:[],atr:[]};e=Math.max(1,Math.floor(e))||5,n=Math.max(1,Math.floor(n))||15;const r=Math.max(n,e);if(t.length<r)return{zg:[],sg:[],xg:[],atr:[]};const s=[],o=[],l=[],c=[];for(let a=0;a<t.length;a++){if(a<r-1){s.push(null),o.push(null),l.push(null),c.push(null);continue}const h=t[a].high,f=t[a].low,d=t[a].close;if(!D.isValid(h)||!D.isValid(f)||!D.isValid(d)){s.push(null),o.push(null),l.push(null),c.push(null);continue}let u=0;if(a>=n-1){let m=0,y=0;for(let v=0;v<n;v++){const _=a-v;if(_>0){const w=t[_].high,b=t[_].low,C=t[_-1].close;if(D.isValid(w)&&D.isValid(b)&&D.isValid(C)){const M=Math.abs(w-b),T=Math.abs(w-C),S=Math.abs(b-C),E=Math.max(M,T,S);m+=E,y++}}}y>0&&(u=m/y)}let p=0;if(a>=e-1){let m=0,y=0;for(let v=0;v<e;v++){const _=a-v;if(_>=0){const w=t[_].high,b=t[_].low,C=t[_].close;if(D.isValid(w)&&D.isValid(b)&&D.isValid(C)){const M=(w+b+C)/3;m+=M,y++}}}y>0&&(p=m/y)}const x=p+u,g=p-u;s.push(p>0?p:null),o.push(x>0?x:null),l.push(g>0?g:null),c.push(u>0?u:null)}return{zg:s,sg:o,xg:l,atr:c}}static accbands(t,e=20,n=4,r=1,s="sma"){if(!Array.isArray(t)||t.length===0)return{lower:[],mid:[],upper:[]};e=Math.max(1,Math.floor(e))||20,n=Math.max(.1,n)||4,r=Math.max(1,Math.floor(r))||1,s=s?.toLowerCase()||"sma";const o=Math.max(e,r);if(t.length<o)return{lower:[],mid:[],upper:[]};const l=[],c=[],a=[];for(let h=0;h<t.length;h++){if(h<o-1){l.push(null),c.push(null),a.push(null);continue}const f=t[h].high,d=t[h].low,u=t[h].close;if(!D.isValid(f)||!D.isValid(d)||!D.isValid(u)){l.push(null),c.push(null),a.push(null);continue}const p=f-d,x=f+d;if(x===0){l.push(null),c.push(null),a.push(null);continue}const g=n*p/x,m=d*(1-g),y=f*(1+g);let v=0,_=0,w=0;if(h>=e-1){let b=0,C=0,M=0,T=0;for(let S=0;S<e;S++){const E=h-S;if(E>=0){const I=t[E].high,k=t[E].low,P=t[E].close;if(D.isValid(I)&&D.isValid(k)&&D.isValid(P)){const B=I-k,V=I+k;if(V!==0){const R=n*B/V,W=k*(1-R),F=I*(1+R);b+=W,C+=P,M+=F,T++}}}}if(T>0)if(s==="ema"){const S=2/(e+1);if(h===e-1)v=b/T,_=C/T,w=M/T;else{const E=l[h-1],I=c[h-1],k=a[h-1];E!==null&&I!==null&&k!==null?(v=S*m+(1-S)*E,_=S*u+(1-S)*I,w=S*y+(1-S)*k):(v=b/T,_=C/T,w=M/T)}}else v=b/T,_=C/T,w=M/T}l.push(v>0?v:null),c.push(_>0?_:null),a.push(w>0?w:null)}return{lower:l,mid:c,upper:a}}static slope(t,e=1,n=!1,r=!1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||1,n=!!n,r=!!r,t.length<e)return[];const s=[];for(let o=0;o<t.length;o++){if(o<e-1){s.push(null);continue}const l=t[o].close,c=t[o-e].close;if(!D.isValid(l)||!D.isValid(c)){s.push(null);continue}let a=(l-c)/e;n&&(a=Math.atan(a),r&&(a*=180/Math.PI)),s.push(a)}return s}static linreg(t,e=14,n=!1,r=!1,s=!1,o=!1,l=!1,c=!1,a=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||14,t.length<e)return[];const h=Array.from({length:e},(g,m)=>m+1),f=.5*e*(e+1),d=f*(2*e+1)/3,u=e*d-f*f,p=g=>{if(g.length!==e)return 0;let m=0,y=0;for(let w=0;w<e;w++)m+=g[w],y+=h[w]*g[w];const v=(e*y-f*m)/u;if(l)return v;const _=(m*d-f*y)/u;if(r)return _;if(n){let w=Math.atan(v);return s&&(w*=180/Math.PI),w}if(o){let w=0;for(let M=0;M<e;M++)w+=g[M]*g[M];const b=e*y-f*m,C=Math.sqrt(u*(e*w-m*m));return Math.abs(C)<1e-10?0:b/C}return c?v*e+_:v*(e-1)+_},x=[];for(let g=0;g<t.length;g++){if(g<e-1){x.push(null);continue}try{const m=[];for(let y=0;y<e;y++){const v=g-e+1+y;if(v>=0&&v<t.length){const _=A.getNumVal(a,t[v]);D.isValid(_)?m.push(_):m.push(0)}}if(m.length===e){const y=p(m);x.push(isFinite(y)?y:null)}else x.push(null)}catch{x.push(null)}}return x}static midpoint(t,e=2,n=null,r=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||2,n=n!==null?Math.max(1,Math.floor(n)):e,t.length<Math.max(e,n))return[];const s=[];for(let o=0;o<t.length;o++){if(o<n-1){s.push(null);continue}let l=-1/0,c=1/0,a=0;for(let h=0;h<e;h++){const f=o-h;if(f>=0){const d=A.getNumVal(r,t[f]);D.isValid(d)&&(l=Math.max(l,d),c=Math.min(c,d),a++)}}if(a>=n){const h=.5*(c+l);s.push(isFinite(h)?h:null)}else s.push(null)}return s}static midprice(t,e=2,n=null){if(!Array.isArray(t)||t.length===0)return[];e=Math.max(1,Math.floor(e))||2,n=n!==null?Math.max(1,Math.floor(n)):e;const r=Math.max(e,n);if(t.length<r)return[];const s=[];for(let o=0;o<t.length;o++){if(o<n-1){s.push(null);continue}let l=-1/0,c=1/0,a=0;for(let h=0;h<e;h++){const f=o-h;if(f>=0){const d=t[f].high,u=t[f].low;D.isValid(d)&&D.isValid(u)&&(l=Math.max(l,d),c=Math.min(c,u),a++)}}if(a>=n){const h=.5*(c+l);s.push(isFinite(h)?h:null)}else s.push(null)}return s}static pwma(t,e=10,n=!0,r=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,n=!!n,t.length<e)return[];const s=A.generatePascalsTriangle(e-1,n),o=[];for(let l=0;l<t.length;l++){if(l<e-1){o.push(null);continue}let c=0,a=0;for(let h=0;h<e;h++){const f=l-e+1+h,d=A.getNumVal(r,t[f]);D.isValid(d)&&(c+=d*s[h],a+=s[h])}o.push(a>0?c/a:null)}return o}static generatePascalsTriangle(t,e=!0){const n=[];for(let r=0;r<=t;r++)if(r===0||r===t)n.push(1);else{let s=1,o=1;for(let l=0;l<r;l++)s*=t-l,o*=l+1;n.push(s/o)}return e?n:n.reverse()}static sinwma(t,e=14,n=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||14,t.length<e)return[];const r=A.generateSineWeights(e),s=r.map(l=>l/r.reduce((c,a)=>c+a,0)),o=[];for(let l=0;l<t.length;l++){if(l<e-1){o.push(null);continue}let c=0,a=0;for(let h=0;h<Math.min(e,t.length-(l-e+1));h++){const f=l-e+1+h;if(f>=0&&f<t.length){const d=A.getNumVal(n,t[f]);D.isValid(d)&&(c+=d*s[h],a+=s[h])}}o.push(a>0?c/a:null)}return o}static generateSineWeights(t){const e=[];for(let n=0;n<t;n++){const r=Math.sin((n+1)*Math.PI/(t+1));e.push(r)}return e}static ssf(t,e=10,n=2,r=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,n=n===3?3:2,t.length<e)return[];const s=[],o=t.length;for(let l=0;l<Math.min(n,o);l++){const c=A.getNumVal(r,t[l]);s.push(D.isValid(c)?c:null)}if(n===3){const l=Math.PI/e,c=Math.exp(-l),a=2*c*Math.cos(Math.sqrt(3)*l),h=c*c,f=h*h,d=-h*(1+a),u=h+a,p=1-u-d-f;for(let x=n;x<o;x++){const g=A.getNumVal(r,t[x]);if(!D.isValid(g)){s.push(null);continue}let m=p*g;x-1>=0&&s[x-1]!==null&&(m+=u*(s[x-1]||0)),x-2>=0&&s[x-2]!==null&&(m+=d*(s[x-2]||0)),x-3>=0&&s[x-3]!==null&&(m+=f*(s[x-3]||0)),s.push(m)}}else{const l=Math.PI*Math.sqrt(2)/e,c=Math.exp(-l),a=-c*c,h=2*c*Math.cos(l),f=1-a-h;for(let d=n;d<o;d++){const u=A.getNumVal(r,t[d]);if(!D.isValid(u)){s.push(null);continue}let p=f*u;d-1>=0&&s[d-1]!==null&&(p+=h*(s[d-1]||0)),d-2>=0&&s[d-2]!==null&&(p+=a*(s[d-2]||0)),s.push(p)}}return s}static supertrend(t,e=7,n=3){if(!Array.isArray(t)||t.length===0)return{trend:[],direction:[],long:[],short:[]};if(e=Math.max(1,Math.floor(e))||7,n=Math.max(.1,parseFloat(n.toString()))||3,t.length<e)return{trend:[],direction:[],long:[],short:[]};const r=t.length,s=new Array(r).fill(1),o=new Array(r).fill(null),l=new Array(r).fill(null),c=new Array(r).fill(null),a=[];for(let u=0;u<r;u++){const p=t[u].high,x=t[u].low;D.isValid(p)&&D.isValid(x)?a.push((p+x)/2):a.push(null)}const h=A.atr(t,e),f=[],d=[];for(let u=0;u<r;u++)if(a[u]!==null&&h[u]!==null){const p=n*h[u];f.push(a[u]+p),d.push(a[u]-p)}else f.push(null),d.push(null);for(let u=1;u<r;u++){const p=t[u].close,x=f[u-1],g=d[u-1];!D.isValid(p)||x===null||g===null||(p>x?s[u]=1:p<g?s[u]=-1:(s[u]=s[u-1],s[u]===1&&d[u]!==null&&g!==null&&d[u]<g&&(d[u]=g),s[u]===-1&&f[u]!==null&&x!==null&&f[u]>x&&(f[u]=x)),s[u]===1?(o[u]=l[u]=d[u],c[u]=null):(o[u]=c[u]=f[u],l[u]=null))}return{trend:o,direction:s,long:l,short:c}}static swma(t,e=10,n=!0,r=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,n=n!==!1,t.length<e)return[];const s=A.generateSymmetricTriangleWeights(e),o=[];for(let l=0;l<t.length;l++){if(l<e-1){o.push(null);continue}let c=0,a=0;for(let h=0;h<e;h++){const f=l-e+1+h,d=A.getNumVal(r,t[f]);if(D.isValid(d)){const u=n?s[h]:s[e-1-h];c+=d*u,a+=u}}o.push(a>0?c/a:null)}return o}static generateSymmetricTriangleWeights(t){const e=[],n=Math.floor(t/2);for(let r=0;r<t;r++)t%2===0?r<n?e.push(r+1):e.push(t-r):r<=n?e.push(r+1):e.push(t-r);return e}static calcVolatility(t,e=20){return t.map((n,r)=>{if(r<e)return null;const s=[];for(let c=r-e+1;c<=r;c++){const a=t[c].close,h=t[c-1]?.close||a;h!==0&&s.push(Math.log(a/h))}if(s.length===0)return null;const o=s.reduce((c,a)=>c+a,0)/s.length,l=s.reduce((c,a)=>c+Math.pow(a-o,2),0)/s.length;return Math.sqrt(l*252)*100})}static avg(t,e=null,n=4){let r=0,s=0;return t.forEach(o=>{const l=A.getNumVal(e,o);D.isValid(l)&&(r+=l,s++)}),s>0?Number((r/s).toFixed(n)):0}static hhv(t,e,n=null){const r=Math.max(1,parseInt(String(e)));return t.map((s,o)=>{if(o<r-1)return null;let l=null;for(let c=o-r+1;c<=o;c++){const a=A.getNumVal(n,t[c]);D.isValid(a)&&(l=l===null?a:Math.max(l,a))}return l})}static llv(t,e,n=null){const r=Math.max(1,parseInt(String(e)));return t.map((s,o)=>{if(o<r-1)return null;let l=null;for(let c=o-r+1;c<=o;c++){const a=A.getNumVal(n,t[c]);D.isValid(a)&&(l=l===null?a:Math.min(l,a))}return l})}static cross(t,e,n=null){let r=null,s=null,o=null;if(Array.isArray(t))if(Array.isArray(e))r=t.length<=e.length?t:e,s=t.length<=e.length?e:t;else{const a=Number(e);D.isValid(a)&&(r=t,o=a)}else if(Array.isArray(e)){const a=Number(t);D.isValid(a)&&(r=e,o=a)}if(!r)return[];let l,c;return r.map((a,h)=>{if(o===null&&s===null)return null;const f=A.getNumVal(n,a);let d;o===null&&s?d=A.getNumVal(n,s[h]):d=o;let u=null;return h>0&&D.isValid(l)&&D.isValid(c)&&D.isValid(f)&&D.isValid(d)&&(l>c&&f<=d?u={val1:f,val2:d,type:"down"}:l<c&&f>=d&&(u={val1:f,val2:d,type:"up"})),l=f,c=d,u})}static throughUp(t,e,n=null){let r,s;return t.map((o,l)=>{const c=A.getNumVal(n,o);let a;Array.isArray(e)?a=A.getNumVal(n,e[l]):a=A.getNumVal(n,e);let h=null;return l>0&&D.isValid(r)&&D.isValid(s)&&D.isValid(c)&&D.isValid(a)&&r<s&&c>=a&&(h={val1:c,val2:a}),r=c,s=a,h})}static throughDown(t,e,n=null){let r,s;return t.map((o,l)=>{const c=A.getNumVal(n,o);let a;Array.isArray(e)?a=A.getNumVal(n,e[l]):a=A.getNumVal(n,e);let h=null;return l>0&&D.isValid(r)&&D.isValid(s)&&D.isValid(c)&&D.isValid(a)&&r>s&&c<=a&&(h={val1:c,val2:a}),r=c,s=a,h})}static kdj(t,e=9,n=3){if(!Array.isArray(t)||t.length===0)return{k:[],d:[],j:[]};e=Math.max(1,Math.floor(e))||9,n=Math.max(1,Math.floor(n))||3;const r=Math.max(e,n);if(t.length<r)return{k:[],d:[],j:[]};const s=[],o=[],l=[];for(let f=0;f<t.length;f++){if(f<e-1){o.push(null),l.push(null);continue}let d=-1/0,u=1/0,p=0;for(let x=0;x<e;x++){const g=f-x;if(g>=0&&t[g]){const m=t[g];D.isValid(m.high)&&D.isValid(m.low)&&(d=Math.max(d,m.high),u=Math.min(u,m.low),p++)}}if(p===0){o.push(null),l.push(null);continue}o.push(d),l.push(u)}const c=[];for(let f=0;f<t.length;f++){const d=t[f],u=o[f],p=l[f];if(!d||u===null||p===null||!D.isValid(d.close)||!D.isValid(d.high)||!D.isValid(d.low)){c.push(null);continue}const x=u-p;if(x===0){c.push(0);continue}const g=100*(d.close-p)/x;c.push(g)}const a=A.rma(c,n),h=A.rma(a,n);for(let f=0;f<t.length;f++){const d=a[f],u=h[f];if(d===null||u===null){s.push(null);continue}s.push(3*d-2*u)}return{k:a,d:h,j:s}}static boll(t,e=20,n=2,r=null){const s=e;let o=0;return t.map((l,c)=>{const a=A.getNumVal(r,l),h={};if(c<s-1)return o+=a,h;if(c===s-1)o+=a;else{const u=A.getNumVal(r,t[c-s]);o=o-u+a}h.mid=o/s;let f=0;for(let u=c-s+1;u<=c;u++){const p=A.getNumVal(r,t[u]);f+=Math.pow(p-h.mid,2)}const d=Math.sqrt(f/s);return h.ub=h.mid+n*d,h.lb=h.mid-n*d,h})}static macd(t,e=12,n=26,r=9){if(!Array.isArray(t)||t.length===0)return{macd:[],histogram:[],signal:[]};e=Math.max(1,Math.floor(e))||12,n=Math.max(1,Math.floor(n))||26,r=Math.max(1,Math.floor(r))||9,n<e&&([e,n]=[n,e]);const s=Math.max(e,n,r);if(t.length<s)return{macd:[],histogram:[],signal:[]};const o=A.ema(t,e,"close"),l=A.ema(t,n,"close"),c=[];for(let f=0;f<t.length;f++){const d=o[f],u=l[f];if(d===null||u===null){c.push(null);continue}c.push(d-u)}const a=A.ema(c,r),h=[];for(let f=0;f<t.length;f++){const d=c[f],u=a[f];if(d===null||u===null){h.push(null);continue}h.push(d-u)}return{macd:c,histogram:h,signal:a}}static tr(t,e=1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||1,t.length<e)return[];const n=[];for(let r=0;r<t.length;r++){if(r<e){n.push(null);continue}const s=t[r],o=t[r-e],l=s.high-s.low,c=Math.abs(s.high-o.close),a=Math.abs(s.low-o.close);n.push(Math.max(l,c,a))}return n}static atr(t,e=14,n="rma",r=1,s=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||14,r=Math.max(1,Math.floor(r))||1,n=n.toLowerCase(),t.length<Math.max(e,r))return[];const o=A.tr(t,r);let l;switch(n){case"sma":l=A.sma(o,e,s);break;case"ema":l=A.ema(o,e,s);break;case"wma":l=A.wma(o,e,s);break;default:l=A.rma(o,e,s);break}return l}static atrWithRMA(t,e=14){const n=t.map((r,s)=>{if(s===0)return{tr:r.high-r.low};const o=t[s-1];return{tr:Math.max(r.high-r.low,Math.abs(r.high-o.close),Math.abs(r.low-o.close))}});return A.rma(n,e,"tr")}static adxWithRMA(t,e=14){const n=t.map((f,d)=>{if(d===0)return{tr:0,dmPlus:0,dmMinus:0};const u=t[d-1],p=f.high,x=f.low,g=u.high,m=u.low,y=u.close,v=Math.max(p-x,Math.abs(p-y),Math.abs(x-y)),_=p-g,w=m-x;let b=0,C=0;return _>w&&_>0&&(b=_),w>_&&w>0&&(C=w),{tr:v,dmPlus:b,dmMinus:C}}),r=A.rma(n,e,"tr"),s=A.rma(n,e,"dmPlus"),o=A.rma(n,e,"dmMinus"),l=t.map((f,d)=>r[d]===null||r[d]===0||s[d]===null?null:s[d]/r[d]*100),c=t.map((f,d)=>r[d]===null||r[d]===0||o[d]===null?null:o[d]/r[d]*100),h=t.map((f,d)=>{if(l[d]===null||c[d]===null)return null;const u=l[d],p=c[d],x=u+p;return x===0?null:Math.abs(u-p)/x*100}).map((f,d)=>({dx:f||0}));return A.rma(h,e,"dx")}static rsi(t,e=14,n=100,r=1,s=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||14,n=Math.max(.1,n)||100,r=Math.max(1,Math.floor(r))||1,t.length<Math.max(e,r))return[];const o=[];for(let d=0;d<t.length;d++){if(d<r){o.push(null);continue}const u=A.getNumVal(s,t[d]),p=A.getNumVal(s,t[d-r]);if(!D.isValid(u)||!D.isValid(p)){o.push(null);continue}o.push(u-p)}const l=[],c=[];for(let d=0;d<t.length;d++){const u=o[d];if(u===null){l.push(null),c.push(null);continue}l.push(u>0?u:0),c.push(u<0?Math.abs(u):0)}const a=A.rma(l,e),h=A.rma(c,e),f=[];for(let d=0;d<t.length;d++){const u=a[d],p=h[d];if(u===null||p===null){f.push(null);continue}const x=u+p;if(x===0){f.push(0);continue}f.push(n*u/x)}return f}static cci(t,e=20){const n=e;let r=0;return t.map((s,o)=>{const l=(s.high+s.low+s.close)/3;if(o<n-1)return r+=l,null;if(o===n-1)r+=l;else{const f=(t[o-n].high+t[o-n].low+t[o-n].close)/3;r=r-f+l}const c=r/n;let a=0;for(let f=o-n+1;f<=o;f++){const d=(t[f].high+t[f].low+t[f].close)/3;a+=Math.abs(d-c)}const h=a/n;return h!==0?(l-c)/h/.015:0})}static mom(t,e=1,n=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||1,t.length<e)return[];const r=[];for(let s=0;s<t.length;s++){if(s<e){r.push(null);continue}const o=A.getNumVal(n,t[s]),l=A.getNumVal(n,t[s-e]);if(!D.isValid(o)||!D.isValid(l)){r.push(null);continue}r.push(o-l)}return r}static pgo(t,e=14,n=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||14,t.length<e)return[];const r=A.atr(t,e),s=A.sma(t,e),o=A.ema(r,e),l=[];for(let c=0;c<t.length;c++){const a=A.getNumVal(n,t[c]),h=s[c],f=o[c];if(!D.isValid(a)||h===null||f===null||f===0){l.push(null);continue}const d=(a-h)/f;l.push(d)}return l}static ppo(t,e=12,n=26,r=9,s=100){if(!Array.isArray(t)||t.length===0)return{ppo:[],histogram:[],signal:[]};e=Math.max(1,Math.floor(e))||12,n=Math.max(1,Math.floor(n))||26,r=Math.max(1,Math.floor(r))||9,s=Math.max(.1,s)||100,n<e&&([e,n]=[n,e]);const o=Math.max(e,n,r);if(t.length<o)return{ppo:[],histogram:[],signal:[]};const l=A.sma(t,e),c=A.sma(t,n),a=[];for(let d=0;d<t.length;d++){const u=l[d],p=c[d];if(u===null||p===null||p===0){a.push(null);continue}const x=s*(u-p)/p;a.push(x)}const h=A.ema(a,r),f=[];for(let d=0;d<t.length;d++){const u=a[d],p=h[d];if(u===null||p===null){f.push(null);continue}f.push(u-p)}return{ppo:a,histogram:f,signal:h}}static sign(t){return t>0?1:t<0?-1:0}static psl(t,e=12,n=100,r=1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||12,n=Math.max(.1,n)||100,r=Math.max(1,Math.floor(r))||1,t.length<Math.max(e,r))return[];const s=[];for(let l=0;l<t.length;l++){if(l<r){s.push(0);continue}const c=t[l].close,a=t[l-r].close;if(!D.isValid(c)||!D.isValid(a)){s.push(0);continue}const h=c-a,f=A.sign(h);s.push(f>0?1:0)}const o=[];for(let l=0;l<t.length;l++){if(l<e-1){o.push(null);continue}let c=0,a=0;for(let f=0;f<e;f++){const d=l-f;d>=0&&s[d]!==void 0&&(c+=s[d],a++)}if(a===0){o.push(null);continue}const h=n*c/e;o.push(h)}return o}static pvo(t,e=12,n=26,r=9,s=100){if(!Array.isArray(t)||t.length===0)return{pvo:[],histogram:[],signal:[]};e=Math.max(1,Math.floor(e))||12,n=Math.max(1,Math.floor(n))||26,r=Math.max(1,Math.floor(r))||9,s=Math.max(.1,s)||100,n<e&&([e,n]=[n,e]);const o=Math.max(e,n,r);if(t.length<o)return{pvo:[],histogram:[],signal:[]};const l=t.map(u=>u.volume||0),c=A.ema(l,e),a=A.ema(l,n),h=[];for(let u=0;u<t.length;u++){if(u<n-1){h.push(null);continue}const p=c[u],x=a[u];if(p===null||x===null||x===0){h.push(null);continue}const g=s*(p-x)/x;h.push(g)}const f=A.ema(h,r),d=[];for(let u=0;u<t.length;u++){const p=h[u],x=f[u];if(p===null||x===null){d.push(null);continue}d.push(p-x)}return{pvo:h,histogram:d,signal:f}}static qqe(t,e=14,n=5,r=4.236,s="ema",o=1){if(!Array.isArray(t)||t.length===0)return{qqe:[],rsi_ma:[],qqe_long:[],qqe_short:[]};e=Math.max(1,Math.floor(e))||14,n=Math.max(1,Math.floor(n))||5,r=Math.max(.1,r)||4.236,o=Math.max(1,Math.floor(o))||1;const l=2*e-1,c=Math.max(e,n,l);if(t.length<c)return{qqe:[],rsi_ma:[],qqe_long:[],qqe_short:[]};const a=A.rsi(t,e);let h;switch(s.toLowerCase()){case"sma":h=A.sma(a,n);break;case"ema":h=A.ema(a,n);break;case"hma":h=A.hma(a,n);break;case"rma":h=A.rma(a,n);break;case"wma":h=A.wma(a,n);break;default:h=A.ema(a,n)}const f=[];for(let b=0;b<t.length;b++){if(b<o){f.push(null);continue}const C=h[b],M=h[b-o];if(C===null||M===null){f.push(null);continue}f.push(Math.abs(C-M))}const d=A.ema(f,l),u=A.ema(d,l).map(b=>b!==null?r*b:null),p=[],x=[];for(let b=0;b<t.length;b++){const C=h[b],M=u[b];if(C===null||M===null){p.push(null),x.push(null);continue}p.push(C+M),x.push(C-M)}const g=new Array(t.length).fill(null),m=new Array(t.length).fill(null),y=new Array(t.length).fill(1),v=new Array(t.length).fill(null),_=new Array(t.length).fill(null),w=new Array(t.length).fill(null);v[0]=h[0],_[0]=h[0],w[0]=h[0];for(let b=1;b<t.length;b++){const C=h[b],M=h[b-1],T=g[b-1],S=b>1?g[b-2]:T,E=m[b-1],I=b>1?m[b-2]:E;C===null||M===null||(M>(T||0)&&C>(T||0)?g[b]=Math.max(T||0,x[b]||0):g[b]=x[b],M<(E||100)&&C<(E||100)?m[b]=Math.min(E||100,p[b]||100):m[b]=p[b],C>(E||0)&&M<=(I||0)||C<=(E||0)&&M>=(I||0)?(y[b]=1,v[b]=_[b]=g[b]):C>(T||0)&&M<=(S||0)||C<=(T||0)&&M>=(S||0)?(y[b]=-1,v[b]=w[b]=m[b]):(y[b]=y[b-1],y[b]===1?v[b]=_[b]=g[b]:v[b]=w[b]=m[b]))}return{qqe:v,rsi_ma:h,qqe_long:_,qqe_short:w}}static rsx(t,e=14,n=1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||14,n=Math.max(1,Math.floor(n))||1,t.length<Math.max(e,n))return[];let r=0,s=0,o=0,l=0,c=0,a=0,h=0,f=0,d=0,u=0,p=0,x=0,g=0,m=0,y=0,v=0,_=0,w=0,b=0,C=0,M=0,T=0,S=0,E=0,I=0,k=0,P=0;const B=[];for(let V=0;V<e-1;V++)B.push(null);B.push(0);for(let V=e;V<t.length;V++)P===0?(P=1,d=0,e-1>=5?k=e-1:k=5,u=100*t[V].close,x=3/(e+2),g=1-x):(k<=P?P=k+1:P=P+1,p=u,u=100*t[V].close,l=u-p,m=g*m+x*l,y=x*m+g*y,r=1.5*m-.5*y,v=g*v+x*r,_=x*v+g*_,c=1.5*v-.5*_,w=g*w+x*c,b=x*w+g*b,a=1.5*w-.5*b,C=g*C+x*Math.abs(l),M=x*C+g*M,h=1.5*C-.5*M,T=g*T+x*h,S=x*T+g*S,s=1.5*T-.5*S,E=g*E+x*s,I=x*E+g*I,f=1.5*E-.5*I,k>=P&&u!==p&&(d=1),k===P&&d===0&&(P=0)),k<P&&f>1e-10?(o=(a/f+1)*50,o>100&&(o=100),o<0&&(o=0)):o=50,B.push(o);return B}static rvgi(t,e=14,n=4){if(!Array.isArray(t)||t.length===0)return{rvgi:[],signal:[]};e=Math.max(1,Math.floor(e))||14,n=Math.max(1,Math.floor(n))||4;const r=Math.max(e,n);if(t.length<r)return{rvgi:[],signal:[]};const s=[],o=[];for(let f=0;f<t.length;f++){const d=t[f];if(!D.isValid(d.close)||!D.isValid(d.open)||!D.isValid(d.high)||!D.isValid(d.low)){s.push(null),o.push(null);continue}s.push(d.close-d.open),o.push(d.high-d.low)}const l=A.swmaLegacy(s,n),c=A.swmaLegacy(o,n),a=[];for(let f=0;f<t.length;f++){if(f<r-1){a.push(null);continue}let d=0,u=0;for(let m=0;m<e;m++){const y=f-m,v=l[y];v!==null&&(d+=v,u++)}let p=0,x=0;for(let m=0;m<e;m++){const y=f-m,v=c[y];v!==null&&(p+=v,x++)}if(u===0||x===0||p===0){a.push(null);continue}const g=d/p;a.push(g)}const h=A.swma(a,n);return{rvgi:a,signal:h}}static smi(t,e=5,n=20,r=5,s=1){if(!Array.isArray(t)||t.length===0)return{smi:[],signal:[],osc:[]};e=Math.max(1,Math.floor(e))||5,n=Math.max(1,Math.floor(n))||20,r=Math.max(1,Math.floor(r))||5,s=Number(s)||1,n<e&&([e,n]=[n,e]);const o=Math.max(e,n,r);if(t.length<o+1)return{smi:[],signal:[],osc:[]};const l=A.tsi(t,e,n,s),c=A.ema(l,r),a=[];for(let h=0;h<t.length;h++){const f=l[h],d=c[h];if(f===null||d===null){a.push(null);continue}a.push(f-d)}return{smi:l,signal:c,osc:a}}static squeeze(t,e=20,n=2,r=20,s=1.5,o=12,l=6,c="sma"){if(!Array.isArray(t)||t.length===0)return{sqz:[],sqz_on:[],sqz_off:[],no_sqz:[]};e=Math.max(1,Math.floor(e))||20,n=Number(n)||2,r=Math.max(1,Math.floor(r))||20,s=Number(s)||1.5,o=Math.max(1,Math.floor(o))||12,l=Math.max(1,Math.floor(l))||6,c=String(c).toLowerCase();const a=Math.max(e,r,o,l);if(t.length<a+1)return{sqz:[],sqz_on:[],sqz_off:[],no_sqz:[]};const h={upper:[],lower:[]},f=A.kc(t,r,s,"ema"),d=A.mom(t,o);let u;c==="ema"?u=A.ema(d,l):u=A.sma(d,l);const p=[],x=[],g=[];for(let m=0;m<t.length;m++){const y=h.lower[m],v=h.upper[m],_=f.lower[m],w=f.upper[m];if(y===null||v===null||_===null||w===null){p.push(null),x.push(null),g.push(null);continue}const b=y>_&&v<w,C=y<_&&v>w,M=!b&&!C;p.push(b?1:0),x.push(C?1:0),g.push(M?1:0)}return{sqz:u,sqz_on:p,sqz_off:x,no_sqz:g}}static stochrsi(t,e=14,n=14,r=3,s=3){if(!Array.isArray(t)||t.length===0)return{k:[],d:[]};e=Math.max(1,Math.floor(e))||14,n=Math.max(1,Math.floor(n))||14,r=Math.max(1,Math.floor(r))||3,s=Math.max(1,Math.floor(s))||3;const o=Math.max(e,n,r,s);if(t.length<o)return{k:[],d:[]};const l=A.rsi(t,n),c=[],a=[];for(let u=0;u<t.length;u++){if(u<e-1){c.push(null),a.push(null);continue}let p=l[u],x=l[u];for(let g=1;g<e;g++){const m=u-g;m>=0&&l[m]!==null&&((p===null||l[m]<p)&&(p=l[m]),(x===null||l[m]>x)&&(x=l[m]))}c.push(p),a.push(x)}const h=[];for(let u=0;u<t.length;u++){const p=l[u],x=c[u],g=a[u];if(p===null||x===null||g===null){h.push(null);continue}const m=g-x;if(m===0)h.push(0);else{const y=100*(p-x)/m;h.push(y)}}const f=A.sma(h,r),d=A.sma(f,s);return{k:f,d}}static td_seq(t,e=!1,n=!0){if(!Array.isArray(t)||t.length===0)return{up:[],down:[]};if(e=!!e,n=!!n,t.length<4)return{up:[],down:[]};const r=[],s=[];for(let h=0;h<t.length;h++){if(h<4){r.push(!1),s.push(!1);continue}const f=t[h].close,d=t[h-4].close;f>d?(r.push(!0),s.push(!1)):f<d?(r.push(!1),s.push(!0)):(r.push(!1),s.push(!1))}const o=h=>{let f=0,d=-1;for(let u=h.length-1;u>=0;u--)if(!h[u]){d=u;break}return d===-1?f=h.length:f=h.length-d-1,f},l=(h,f)=>{const d=[];for(let u=0;u<h.length;u++){if(u<4){d.push(null);continue}const p=Math.min(13,u+1),x=h.slice(u-p+1,u+1);let g=0;h[u]&&(g=o(x)),n?d.push(g===0?null:g):d.push(g>=6&&g<=9?g:null)}return d},c=l(r),a=l(s);if(e)for(let h=0;h<c.length;h++)c[h]=c[h]===null?0:c[h],a[h]=a[h]===null?0:a[h];return{up:c,down:a}}static tsi(t,e=13,n=25,r=100,s=1){if(!Array.isArray(t)||t.length===0)return[];e=Math.max(1,Math.floor(e))||13,n=Math.max(1,Math.floor(n))||25,r=Number(r)||100,s=Math.max(1,Math.floor(s))||1;const o=Math.max(e,n);if(t.length<o+s)return[];const l=[];for(let p=0;p<t.length;p++){if(p<s){l.push(null);continue}const x=t[p].close,g=t[p-s].close;if(!D.isValid(x)||!D.isValid(g)){l.push(null);continue}l.push(x-g)}const c=A.ema(l,n),a=A.ema(c,e),h=[];for(let p=0;p<t.length;p++){const x=l[p];if(x===null){h.push(null);continue}h.push(Math.abs(x))}const f=A.ema(h,n),d=A.ema(f,e),u=[];for(let p=0;p<t.length;p++){if(p<o){u.push(null);continue}const x=a[p],g=d[p];if(x===null||g===null||g===0){u.push(null);continue}const m=r*(x/g);u.push(m)}return u}static uo(t,e=7,n=14,r=28,s=4,o=2,l=1,c=1){if(!Array.isArray(t)||t.length===0)return[];e=Math.max(1,Math.floor(e))||7,n=Math.max(1,Math.floor(n))||14,r=Math.max(1,Math.floor(r))||28,s=Number(s)||4,o=Number(o)||2,l=Number(l)||1,c=Math.max(1,Math.floor(c))||1;const a=Math.max(e,n,r);if(t.length<a+c)return[];const h=[],f=[];for(let m=0;m<t.length;m++){if(m<c){h.push(null),f.push(null);continue}const y=t[m].high,v=t[m].low,_=t[m].close,w=t[m-c].close;if(!D.isValid(y)||!D.isValid(v)||!D.isValid(_)||!D.isValid(w)){h.push(null),f.push(null);continue}const b=Math.min(v,w),C=Math.max(y,w);h.push(_-b),f.push(C-b)}const d=[],u=[],p=[];for(let m=0;m<t.length;m++){if(m<e-1){d.push(null);continue}let y=0,v=0,_=0;for(let w=0;w<e;w++){const b=h[m-w],C=f[m-w];b!==null&&C!==null&&(y+=b,v+=C,_++)}_===e&&v!==0?d.push(y/v):d.push(null)}for(let m=0;m<t.length;m++){if(m<n-1){u.push(null);continue}let y=0,v=0,_=0;for(let w=0;w<n;w++){const b=h[m-w],C=f[m-w];b!==null&&C!==null&&(y+=b,v+=C,_++)}_===n&&v!==0?u.push(y/v):u.push(null)}for(let m=0;m<t.length;m++){if(m<r-1){p.push(null);continue}let y=0,v=0,_=0;for(let w=0;w<r;w++){const b=h[m-w],C=f[m-w];b!==null&&C!==null&&(y+=b,v+=C,_++)}_===r&&v!==0?p.push(y/v):p.push(null)}const x=s+o+l,g=[];for(let m=0;m<t.length;m++){const y=d[m],v=u[m],_=p[m];if(y!==null&&v!==null&&_!==null){const b=100*(s*y+o*v+l*_)/x;g.push(b)}else g.push(null)}return g}static willr(t,e=14){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||14,t.length<e)return[];const n=[];for(let r=0;r<t.length;r++){if(r<e-1){n.push(null);continue}let s=t[r].high,o=t[r].low;for(let c=1;c<e;c++){const a=r-c;if(a>=0){const h=t[a].high,f=t[a].low;D.isValid(h)&&h>s&&(s=h),D.isValid(f)&&f<o&&(o=f)}}const l=t[r].close;if(!D.isValid(l)||!D.isValid(s)||!D.isValid(o)){n.push(null);continue}if(s===o)n.push(0);else{const c=100*((l-o)/(s-o)-1);n.push(c)}}return n}static alma(t,e=10,n=6,r=.85){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,n=Number(n)||6,r=Math.max(0,Math.min(1,Number(r)))||.85,t.length<e)return[];const s=r*(e-1),o=e/n,l=[];for(let a=0;a<e;a++)l[a]=Math.exp(-1*((a-s)*(a-s))/(2*o*o));const c=[];for(let a=0;a<e-1;a++)c.push(null);c.push(0);for(let a=e;a<t.length;a++){let h=0,f=0;for(let d=0;d<e;d++){const u=t[a-d].close;D.isValid(u)&&(h+=l[d]*u,f+=l[d])}if(f===0)c.push(null);else{const d=h/f;c.push(d)}}return c}static roc(t,e=10){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,t.length<e)return[];const n=A.mom(t,e,"close"),r=[];for(let s=0;s<t.length;s++){if(s<e){r.push(null);continue}const o=n[s],l=t[s-e].close;if(o===null||!D.isValid(l)||l===0){r.push(null);continue}r.push(100*o/l)}return r}static kijunV2(t,e=26,n=1){return t.map((r,s)=>{if(s<e-1)return null;const o=t.slice(s-e+1,s+1),l=Math.max(...o.map(f=>f.high)),c=Math.min(...o.map(f=>f.low)),a=(l+c)/2,h=r.close;return a+(h-a)*(n-1)})}static trix(t,e=30,n=9,r=100,s=1){if(!Array.isArray(t)||t.length===0)return{trix:[],signal:[]};e=Math.max(1,Math.floor(e))||30,n=Math.max(1,Math.floor(n))||9,r=Number(r)||100,s=Math.max(1,Math.floor(s))||1;const o=Math.max(e,n);if(t.length<o)return{trix:[],signal:[]};const l=A.ema(t,e,"close"),c=A.ema(l,e),a=A.ema(c,e),h=[];for(let d=0;d<t.length;d++){if(d<s){h.push(null);continue}const u=a[d],p=a[d-s];if(u!==null&&p!==null&&p!==0){const x=(u-p)/p;h.push(r*x)}else h.push(null)}const f=A.sma(h,n);return{trix:h,signal:f}}static brar(t,e=26,n=100,r=1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||26,n=parseFloat(n.toString())||100,r=Math.max(1,Math.floor(r))||1,t.length<e)return[];const s=[],o=[],l=[],c=[],a=[];for(let h=0;h<t.length;h++){const f=t[h];if(!f||!D.isValid(f.open)||!D.isValid(f.high)||!D.isValid(f.low)||!D.isValid(f.close)){o.push(NaN),l.push(NaN),c.push(NaN),a.push(NaN);continue}if(o.push(f.high-f.open),l.push(f.open-f.low),h>=r){const d=t[h-r].close;if(D.isValid(d)){const u=f.high-d,p=d-f.low;c.push(u<0?0:u),a.push(p<0?0:p)}else c.push(NaN),a.push(NaN)}else c.push(NaN),a.push(NaN)}for(let h=0;h<t.length;h++){if(h<e-1){s.push(null);continue}let f=0,d=0,u=0,p=0,x=0;for(let y=h-e+1;y<=h;y++)y>=0&&!isNaN(o[y])&&!isNaN(l[y])&&!isNaN(c[y])&&!isNaN(a[y])&&(f+=o[y],d+=l[y],u+=c[y],p+=a[y],x++);if(x===0||d===0||p===0){s.push(null);continue}const g=n*f/d,m=n*u/p;s.push({ar:g,br:m})}return s}static vr(t,e=26){let n=0,r=0,s=0;return t.map((o,l)=>{const c=o.close,a=l===0?o.open:t[l-1].close,h=o.volume??0;if(c>a?n+=h:c<a?r+=h:s+=h,l>=e-1){const f=s/2,d=r+f===0?0:(n+f)/(r+f)*100,u=l-(e-1),p=t[u],x=u===0?p.open:t[u-1].close,g=p.close,m=p.volume??0;return g>x?n-=m:g<x?r-=m:s-=m,d}return null})}static obv(t){if(!Array.isArray(t)||t.length===0)return[];const e=A.attr(t,"close"),n=A.attr(t,"volume");if(!e||!n||e.length===0||n.length===0)return[];const r=[];let s=0;for(let o=0;o<t.length;o++){if(o===0){r.push(0);continue}const l=e[o],c=e[o-1],a=n[o];if(!D.isValid(l)||!D.isValid(c)||!D.isValid(a)){r.push(null);continue}const h=l-c;let f=0;h>0?f=a:h<0&&(f=-a),s+=f,isFinite(s)?r.push(s):r.push(null)}return r}static emv(t,e=14){let n=0;const r=[];return t.map((s,o)=>{if(o===0)return null;const l=t[o-1],c=s.volume??0,a=(s.high+s.low)/2,h=(l.high+l.low)/2,f=s.high-s.low;let d=0;if(c!==0&&(d=(a-h)*f/c),d=Number(d),r.push(d),n+=d,o>=e-1){const u=n;return n-=r[o-(e-1)],u}return null})}static vo(t,e=5,n=10){return t.map((r,s)=>{const o={up:0,down:0,val:0};if(s===0||!D.isValid(r.close)||!D.isValid(t[s-1].close))return o;const l=t[s-1],c=r.volume??0;if(r.close>l.close?(o.up=c,o.down=0):r.close<l.close?(o.up=0,o.down=c):(o.up=c/2,o.down=c/2),s>=Math.max(e,n)-1){let a=0,h=0,f=0,d=0;for(let x=s-e+1;x<=s;x++){const g=t[x],m=x>0?t[x-1]:g,y=g.volume??0;!D.isValid(g.close)||!D.isValid(m.close)||(g.close>m.close?a+=y:g.close<m.close?h+=y:(a+=y/2,h+=y/2))}for(let x=s-n+1;x<=s;x++){const g=t[x],m=x>0?t[x-1]:g,y=g.volume??0;!D.isValid(g.close)||!D.isValid(m.close)||(g.close>m.close?f+=y:g.close<m.close?d+=y:(f+=y/2,d+=y/2))}const u=a+h!==0?a/(a+h)*100:50,p=f+d!==0?f/(f+d)*100:50;o.val=u-p}return o})}static dmi(t,e=14,n=6){let r=0,s=0,o=0,l=0,c=0,a=0,h=0,f=0;return t.map((d,u)=>{const p={},x=t[u-1]||d,g=x.close,m=d.high,y=d.low,v=m-y,_=Math.abs(m-g),w=Math.abs(g-y),b=m-x.high,C=x.low-y,M=Math.max(Math.max(v,_),w),T=b>0&&b>C?b:0,S=C>0&&C>b?C:0;if(r+=M,s+=T,o+=S,u>=e-1){u>e-1?(l=l-l/e+M,c=c-c/e+T,a=a-a/e+S):(l=r,c=s,a=o);let E=0,I=0;l!==0&&(E=c*100/l,I=a*100/l),p.pdi=E,p.mdi=I;let k=0;I+E!==0&&(k=Math.abs(I-E)/(I+E)*100),u===e-1?h=k:h=(k+h*(n-1))/n,u>=e+n-2&&(p.adx=h),u>=e+n*2-3&&(u===e+n*2-3?f=h:f=(h+f*(n-1))/n,p.adxr=f)}return p})}static dma(t,e=10,n=50){const r=Math.max(e,n);let s=0,o=0;return t.map((l,c)=>{const a=l.close;s+=a,o+=a;let h=null,f=null;return c>=e-1&&(h=s/e,s-=t[c-(e-1)].close),c>=n-1&&(f=o/n,o-=t[c-(n-1)].close),c>=r-1&&h!==null&&f!==null?h-f:null})}static asi(t,e=6){let n=0;return t.map((r,s)=>{if(s===0)return null;const o=t[s-1],l=r.high,c=r.low,a=r.close,h=r.open;o.high;const f=o.low,d=o.close,u=Math.abs(l-d),p=Math.abs(c-d),x=Math.abs(l-f),g=Math.abs(d-f);let m=0;u>p&&u>x?m=u+p/2+g/4:p>x&&p>u?m=p+u/2+g/4:x>u&&x>p&&(m=x+g/4);const y=a-d,v=a-h,_=d-d;let w=0;return m!==0&&(w=16*(y+v/2+_)/m*Math.max(u,p)),n+=w,s>=e-1?n:null})}static stochastic(t,e=14,n=3,r=3){if(!Array.isArray(t)||t.length===0)return{k:[],d:[]};e=Math.max(1,Math.floor(e))||14,n=Math.max(1,Math.floor(n))||3,r=Math.max(1,Math.floor(r))||3;const s=Math.max(e,n,r);if(t.length<s)return{k:[],d:[]};const o=[];for(let a=0;a<t.length;a++){if(a<e-1){o.push(null);continue}let h=t[a].high,f=t[a].low;for(let p=1;p<e;p++){const x=a-p;x>=0&&(h=Math.max(h,t[x].high),f=Math.min(f,t[x].low))}const d=t[a].close,u=h-f;if(u===0)o.push(0);else{const p=100*(d-f)/u;o.push(p)}}const l=A.sma(o,r),c=A.sma(l,n);return{k:l,d:c}}static donchianChannel(t,e=20,n=20,r,s){if(!Array.isArray(t)||t.length===0)return{lower:[],middle:[],upper:[]};e=Math.max(1,Math.floor(e))||20,n=Math.max(1,Math.floor(n))||20;const o=r!==void 0?Math.max(1,Math.floor(r)):e,l=s!==void 0?Math.max(1,Math.floor(s)):n,c=Math.max(e,o,n,l);if(t.length<c)return{lower:[],middle:[],upper:[]};const a=[];for(let d=0;d<t.length;d++){if(d<e-1){a.push(null);continue}let u=Number.MAX_VALUE,p=0;for(let x=0;x<e;x++){const g=d-e+1+x;if(g>=0&&g<t.length){const m=t[g].low;D.isValid(m)&&(u=Math.min(u,m),p++)}}p>=o?a.push(u===Number.MAX_VALUE?null:u):a.push(null)}const h=[];for(let d=0;d<t.length;d++){if(d<n-1){h.push(null);continue}let u=Number.MIN_VALUE,p=0;for(let x=0;x<n;x++){const g=d-n+1+x;if(g>=0&&g<t.length){const m=t[g].high;D.isValid(m)&&(u=Math.max(u,m),p++)}}p>=l?h.push(u===Number.MIN_VALUE?null:u):h.push(null)}const f=[];for(let d=0;d<t.length;d++){const u=a[d],p=h[d];u!==null&&p!==null?f.push(.5*(u+p)):f.push(null)}return{lower:a,middle:f,upper:h}}static hwc(t,e=.2,n=.1,r=.1,s=.1,o=1,l=null){if(!Array.isArray(t)||t.length===0)return{hw_mid:[],hw_upper:[],hw_lower:[]};e=Math.max(0,Math.min(1,e))||.2,n=Math.max(0,Math.min(1,n))||.1,r=Math.max(0,Math.min(1,r))||.1,s=Math.max(0,Math.min(1,s))||.1,o=Math.max(0,o)||1;const c=A.attr(t,l);if(!c||c.length===0)return{hw_mid:[],hw_upper:[],hw_lower:[]};const a=c.length;if(a===0)return{hw_mid:[],hw_upper:[],hw_lower:[]};let h=0,f=0,d=0,u=c[0],p=c[0],x=c[0];const g=[],m=[],y=[],v=[],_=[];for(let w=0;w<a;w++){const b=c[w];if(!D.isValid(b)){m.push(null),y.push(null),g.push(null),_.push(null),v.push(null);continue}const C=(1-e)*(u+f+.5*h)+e*b,M=(1-n)*(f+h)+n*(C-u),T=(1-r)*h+r*(M-f),S=C+M+.5*T;m.push(S);const E=(1-s)*d+s*(p-x)*(p-x),I=Math.sqrt(Math.max(0,E)),k=S+o*I,P=S-o*I;y.push(k),g.push(P);const B=k-P;_.push(B);const V=B>0?(b-P)/B:0;v.push(V),p=b,h=T,u=C,f=M,d=E,x=S}return{hw_mid:m,hw_upper:y,hw_lower:g,hw_width:_,hw_pctwidth:v}}static kc(t,e=20,n=2,r="ema",s=!0){if(!Array.isArray(t)||t.length===0)return{lower:[],basis:[],upper:[]};if(e=Math.max(1,Math.floor(e))||20,n=Math.max(0,Number(n))||2,r=r||"ema",s=!!s,t.length<e)return{lower:[],basis:[],upper:[]};const o=A.attr(t,"high"),l=A.attr(t,"low"),c=A.attr(t,"close");if(!o||!l||!c||o.length===0||l.length===0||c.length===0)return{lower:[],basis:[],upper:[]};const a=[];for(let p=0;p<t.length;p++){if(p===0){a.push(null);continue}const x=o[p],g=l[p],m=c[p-1];if(!D.isValid(x)||!D.isValid(g)||!D.isValid(m)){a.push(null);continue}if(s){const y=x-g,v=Math.abs(x-m),_=Math.abs(g-m);a.push(Math.max(y,v,_))}else a.push(x-g)}let h;r.toLowerCase()==="ema"?h=A.ema(c,e):h=A.sma(c,e);let f;r.toLowerCase()==="ema"?f=A.ema(a,e):f=A.sma(a,e);const d=[],u=[];for(let p=0;p<t.length;p++){const x=h[p],g=f[p];if(x===null||g===null){d.push(null),u.push(null);continue}d.push(x+n*g),u.push(x-n*g)}return{lower:u,basis:h,upper:d}}static massi(t,e=9,n=25){if(!Array.isArray(t)||t.length===0)return[];e=Math.max(1,Math.floor(e))||9,n=Math.max(1,Math.floor(n))||25,n<e&&([e,n]=[n,e]);const r=Math.max(e,n);if(t.length<r)return[];const s=[];for(let h=0;h<t.length;h++){const f=t[h].high,d=t[h].low;D.isValid(f)&&D.isValid(d)&&f>d?s.push(f-d):s.push(null)}const o=A.ema(s,e),l=A.ema(o,e),c=[];for(let h=0;h<t.length;h++){const f=o[h],d=l[h];f!==null&&d!==null&&d!==0?c.push(f/d):c.push(null)}const a=[];for(let h=0;h<t.length;h++){if(h<n-1){a.push(null);continue}let f=0,d=0;for(let u=0;u<n;u++){const p=h-n+1+u;if(p>=0&&p<c.length){const x=c[p];x!==null&&(f+=x,d++)}}d>=n?a.push(f):a.push(null)}return a}static natr(t,e=14,n="ema",r=100,s=1,o=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||14,r=Math.max(0,Number(r))||100,s=Math.max(1,Math.floor(s))||1,n=n||"ema",t.length<e)return[];const l=A.atr(t,e,n,s,o),c=[];for(let a=0;a<t.length;a++){const h=l[a],f=t[a].close;h!==null&&f!==null&&f>0?c.push(r/f*h):c.push(null)}return c}static pdist(t,e=1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||1,t.length<e+1)return[];const n=[];return t.forEach((r,s)=>{const o=s-e;if(o<0)n.push(null);else{const l=t[o].close,c=r.high-r.low,a=Math.abs(r.close-r.open),h=Math.abs(r.open-l),f=2*c-a+h;isFinite(f)?n.push(f):n.push(null)}}),n}static rvi(t,e=14,n=100,r=!1,s=!1,o="ema",l=1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||14,n=Math.max(0,Number(n))||100,r=!!r,s=!!s,o=o||"ema",l=Math.max(1,Math.floor(l))||1,t.length<e+l)return[];const c=A.attr(t,"close"),a=A.attr(t,"high"),h=A.attr(t,"low");if(!c||!a||!h||c.length===0||a.length===0||h.length===0)return[];if((r||s)&&(!a||!h||a.length===0||h.length===0))return[];const f=(u,p,x,g,m)=>{const y=A.stdev(u,p),v=[],_=[];for(let S=0;S<u.length;S++){if(S<m){v.push(null),_.push(null);continue}const E=u[S],I=u[S-m];if(E!==null&&I!==null){const k=E-I;k>0?(v.push(k),_.push(0)):(v.push(0),_.push(Math.abs(k)))}else v.push(null),_.push(null)}const w=[],b=[];for(let S=0;S<u.length;S++){const E=v[S],I=_[S],k=y[S];E!==null&&k!==null?w.push(E*k):w.push(null),I!==null&&k!==null?b.push(I*k):b.push(null)}let C,M;g.toLowerCase()==="ema"?(C=A.ema(w,p),M=A.ema(b,p)):(C=A.sma(w,p),M=A.sma(b,p));const T=[];for(let S=0;S<u.length;S++){const E=C[S],I=M[S];if(E!==null&&I!==null&&E+I>0){const k=x*E/(E+I);T.push(isFinite(k)?k:null)}else T.push(null)}return T};let d;if(r){const u=f(a,e,n,o,l),p=f(h,e,n,o,l);d=[];for(let x=0;x<t.length;x++){const g=u[x],m=p[x];g!==null&&m!==null?d.push(.5*(g+m)):d.push(null)}}else if(s){const u=f(a,e,n,o,l),p=f(h,e,n,o,l),x=f(c,e,n,o,l);d=[];for(let g=0;g<t.length;g++){const m=u[g],y=p[g],v=x[g];m!==null&&y!==null&&v!==null?d.push((m+y+v)/3):d.push(null)}}else d=f(c,e,n,o,l);return d}static thermo(t,e=20,n=2,r=.5,s="ema",o=1){if(!Array.isArray(t)||t.length===0)return{thermo:[],thermo_ma:[],thermo_short:[],thermo_long:[]};if(e=Math.max(1,Math.floor(e))||20,n=Math.max(0,Number(n))||2,r=Math.max(0,Number(r))||.5,s=s||"ema",o=Math.max(1,Math.floor(o))||1,t.length<e+o)return{thermo:[],thermo_ma:[],thermo_short:[],thermo_long:[]};const l=[];for(let f=0;f<t.length;f++){if(f<o){l.push(null);continue}const d=t[f].low,u=t[f].high,p=t[f-o].low,x=t[f-o].high;if(!D.isValid(d)||!D.isValid(u)||!D.isValid(p)||!D.isValid(x)){l.push(null);continue}const g=Math.abs(p-d),m=Math.abs(u-x),y=Math.max(g,m);l.push(y)}let c;s.toLowerCase()==="ema"?c=A.ema(l,e):s.toLowerCase()==="sma"?c=A.sma(l,e):s.toLowerCase()==="hma"?c=A.hma(l,e):c=A.ema(l,e);const a=[],h=[];for(let f=0;f<t.length;f++){const d=l[f],u=c[f];if(d!==null&&u!==null){const p=u*n,x=d<p,g=u*r,m=d>g;a.push(x?1:0),h.push(m?1:0)}else a.push(null),h.push(null)}return{thermo:l,thermo_ma:c,thermo_long:a,thermo_short:h}}static trueRange(t,e=1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||1,t.length<e+1)return[];const n=[];for(let r=0;r<t.length;r++){if(r<e){n.push(null);continue}const s=t[r].high,o=t[r].low,l=t[r].close,c=t[r-e].close;if(!D.isValid(s)||!D.isValid(o)||!D.isValid(l)||!D.isValid(c)){n.push(null);continue}const a=s-o,h=s-c,f=c-o,d=Math.max(Math.abs(a),Math.abs(h),Math.abs(f));isFinite(d)?n.push(d):n.push(null)}return n}static ui(t,e=14,n=100,r=!1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||14,n=Math.max(0,Number(n))||100,r=!!r,t.length<e)return[];const s=A.attr(t,"close");if(!s||s.length===0)return[];const o=[];for(let l=0;l<t.length;l++){if(l<e-1){o.push(null);continue}let c=-1/0;for(let d=0;d<e;d++){const u=s[l-d];D.isValid(u)&&u>c&&(c=u)}if(c<=0){o.push(null);continue}const a=s[l];if(!D.isValid(a)){o.push(null);continue}const h=[];for(let d=0;d<e;d++){const u=s[l-d];let p=-1/0;for(let x=0;x<e;x++){const g=s[l-d-x];D.isValid(g)&&g>p&&(p=g)}if(p>0){const x=n*(u-p)/p;h.push(x*x)}else h.push(0)}let f;if(r)f=A.sma(h,e).map(u=>u&&isFinite(u)?Math.sqrt(u/e):null);else{const d=h.reduce((u,p)=>u+p,0);f=[isFinite(d)?Math.sqrt(d/e):null]}o.push(...f)}return o}static ad(t){if(!Array.isArray(t)||t.length===0)return[];const e=[];let n=0;for(let r=0;r<t.length;r++){const s=t[r].high,o=t[r].low,l=t[r].close,c=t[r].volume,a=t[r].open,h=s-o;if(h<=0){e.push(null);continue}let f;a!==null&&D.isValid(a)?f=l-a:f=2*l-s-o;const d=f*c/h;n+=d,isFinite(n)?e.push(n):e.push(null)}return e}static adosc(t,e=3,n=10){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.floor(e)||3,n=Math.floor(n)||10,e<=0||n<=0)return[];const r=A.ad(t);if(!r||r.length===0)return[];const s=A.ema(r,e),o=A.ema(r,n);if(!s||!o||s.length===0||o.length===0)return[];const l=[],c=Math.min(s.length,o.length);for(let a=0;a<c;a++){const h=s[a],f=o[a];if(h!==null&&f!==null){const d=h-f;isFinite(d)?l.push(d):l.push(null)}else l.push(null)}return l}static aobv(t,e=4,n=12,r="ema",s=2,o=2,l=2){if(!Array.isArray(t)||t.length===0)return{obv:[],obvMin:[],obvMax:[],obvFast:[],obvSlow:[],obvLong:[],obvShort:[]};if(e=Math.floor(e)||4,n=Math.floor(n)||12,s=Math.floor(s)||2,o=Math.floor(o)||2,l=Math.floor(l)||2,e<=0||n<=0||s<=0||o<=0||l<=0)return{obv:[],obvMin:[],obvMax:[],obvFast:[],obvSlow:[],obvLong:[],obvShort:[]};n<e&&([e,n]=[n,e]);const c=A.obv(t);if(!c||c.length===0)return{obv:[],obvMin:[],obvMax:[],obvFast:[],obvSlow:[],obvLong:[],obvShort:[]};let a,h;if(r.toLowerCase()==="ema"?(a=A.ema(c,e),h=A.ema(c,n)):r.toLowerCase()==="sma"?(a=A.sma(c,e),h=A.sma(c,n)):r.toLowerCase()==="wma"?(a=A.wma(c,e),h=A.wma(c,n)):(a=A.ema(c,e),h=A.ema(c,n)),!a||!h||a.length===0||h.length===0)return{obv:[],obvMin:[],obvMax:[],obvFast:[],obvSlow:[],obvLong:[],obvShort:[]};const f=[],d=[];for(let x=0;x<c.length;x++){if(x<o-1){f.push(null),d.push(null);continue}let g=1/0,m=-1/0;for(let y=0;y<o;y++){const v=c[x-y];v!==null&&D.isValid(v)&&(g=Math.min(g,v),m=Math.max(m,v))}isFinite(g)&&isFinite(m)?(f.push(g),d.push(m)):(f.push(null),d.push(null))}const u=[],p=[];for(let x=0;x<a.length;x++){if(x<l-1){u.push(null),p.push(null);continue}let g=0,m=0;for(let y=0;y<l;y++){const v=a[x-y],_=h[x-y];v!==null&&_!==null&&(v>_?g++:v<_&&m++)}u.push(g),p.push(m)}return{obv:c,obvMin:f,obvMax:d,obvFast:a,obvSlow:h,obvLong:u,obvShort:p}}static cmf(t,e=20){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.floor(e)||20,e<=0)return[];const n=[];for(let r=0;r<t.length;r++){if(r<e-1){n.push(null);continue}let s=0,o=0;for(let l=0;l<e;l++){const c=r-l,a=t[c].high,h=t[c].low,f=t[c].close,d=t[c].volume,u=t[c].open;if(!D.isValid(a)||!D.isValid(h)||!D.isValid(f)||!D.isValid(d))continue;const p=a-h;if(p<=0)continue;let x;u!==null&&D.isValid(u)?x=f-u:x=2*f-a-h;const g=x*d/p;s+=g,o+=d}if(o>0){const l=s/o;isFinite(l)?n.push(l):n.push(null)}else n.push(null)}return n}static efi(t,e=13,n=1,r="ema"){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.floor(e)||13,n=Math.floor(n)||1,e<=0||n<=0)return[];const s=[];for(let l=0;l<t.length;l++){if(l<n){s.push(null);continue}const c=t[l].close,a=t[l-n].close,h=t[l].volume;if(!D.isValid(c)||!D.isValid(a)||!D.isValid(h)){s.push(null);continue}const d=(c-a)*h;isFinite(d)?s.push(d):s.push(null)}let o;return r.toLowerCase()==="sma"?o=A.sma(s,e):o=A.ema(s,e),!o||o.length===0?[]:o}static eom(t,e=14,n=1e8,r=1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.floor(e)||14,n=n||1e8,r=Math.floor(r)||1,e<=0||n<=0||r<=0)return[];const s=[];for(let o=0;o<t.length;o++){if(o<e-1||o<r){s.push(null);continue}let l=0,c=0;for(let a=0;a<e;a++){const h=o-a,f=t[h].high,d=t[h].low,u=t[h].volume;if(!D.isValid(f)||!D.isValid(d)||!D.isValid(u)||h<r)continue;const p=t[h-r].high,x=t[h-r].low;if(!D.isValid(p)||!D.isValid(x))continue;const g=f-d;if(g<=0)continue;const m=f-p,y=d-x,v=.5*(m+y),_=u/n/g;if(_===0)continue;const w=v/_;isFinite(w)&&(l+=w,c++)}if(c>0){const a=l/c;isFinite(a)?s.push(a):s.push(null)}else s.push(null)}return s}static nvi(t,e=1,n=1e3){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.floor(e)||1,n=n||1e3,e<=0||n<=0)return[];const r=[];for(let s=0;s<t.length;s++){if(s<e){s===0?r.push(n):r.push(null);continue}const o=t[s].close,l=t[s-e].close;if(!D.isValid(o)||!D.isValid(l)){r.push(null);continue}const c=(o-l)/l,a=t[s].volume,h=t[s-1].volume;if(!D.isValid(a)||!D.isValid(h)){r.push(null);continue}const f=(a-h)/h;let d=0;f<0&&(d=Math.abs(f)*c),s>0&&r[s-1]!==null&&(d+=r[s-1]),isFinite(d)?r.push(d):r.push(null)}return r}static pvi(t,e=1,n=1e3){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.floor(e)||1,n=n||1e3,e<=0||n<=0)return[];const r=[];for(let s=0;s<t.length;s++){if(s<e){s===0?r.push(n):r.push(null);continue}const o=t[s].close,l=t[s-e].close;if(!D.isValid(o)||!D.isValid(l)){r.push(null);continue}const c=(o-l)/l,a=t[s].volume,h=t[s-1].volume;if(!D.isValid(a)||!D.isValid(h)){r.push(null);continue}const f=(a-h)/h;let d=0;f>0&&(d=Math.abs(f)*c),s>0&&r[s-1]!==null&&(d+=r[s-1]),isFinite(d)?r.push(d):r.push(null)}return r}static pvol(t,e=!1){if(!Array.isArray(t)||t.length===0)return[];e=!!e;const n=[];for(let r=0;r<t.length;r++){const s=t[r].close,o=t[r].volume;if(!D.isValid(s)||!D.isValid(o)){n.push(null);continue}let l;if(e&&r>0){const c=close[r-1];if(!D.isValid(c)){n.push(null);continue}const a=s-c;l=(a>0?1:a<0?-1:0)*s*o}else l=s*o;isFinite(l)?n.push(l):n.push(null)}return n}static pvr(t){if(!Array.isArray(t)||t.length===0)return[];const e=[];for(let n=0;n<t.length;n++){if(n===0){e.push(null);continue}const r=t[n].close,s=t[n-1].close,o=t[n].volume,l=t[n-1].volume;if(!D.isValid(r)||!D.isValid(s)||!D.isValid(o)||!D.isValid(l)){e.push(null);continue}const c=r-s,a=o-l;let h;c>=0&&a>=0?h=1:c>=0&&a<0?h=2:c<0&&a>=0?h=3:h=4,e.push(h)}return e}static pvt(t,e=1){if(!Array.isArray(t)||t.length===0)return[];e=Math.max(1,Math.floor(e))||1;const n=[];let r=0;for(let s=0;s<t.length;s++){if(s<e){n.push(null);continue}const o=t[s].close,l=t[s-e].close,c=t[s].volume;if(!D.isValid(o)||!D.isValid(l)||!D.isValid(c)){n.push(null);continue}const h=(o-l)/l*c;r+=h,isFinite(r)?n.push(r):n.push(null)}return n}static vp(t,e=10,n=!1){if(!Array.isArray(t)||t.length===0)return[];e=Math.max(1,Math.floor(e))||10,n=!!n;const r=[];for(let f=0;f<t.length;f++){const d=t[f].close,u=t[f].volume;if(!D.isValid(d)||!D.isValid(u))continue;let p=0,x=0;if(f>0){const g=t[f-1].close;D.isValid(g)&&(d>=g?(p=u,x=0):(p=0,x=u))}else p=u,x=0;r.push({close:d,pos_volume:p,neg_volume:x})}if(r.length===0)return[];n&&r.sort((f,d)=>f.close-d.close);const s=Math.min(...r.map(f=>f.close)),o=Math.max(...r.map(f=>f.close)),l=o-s;if(l<=0){const f=r.reduce((u,p)=>u+p.pos_volume,0),d=r.reduce((u,p)=>u+p.neg_volume,0);return[{low_price:s,mean_price:s,high_price:o,pos_volume:f,neg_volume:d,total_volume:f+d}]}const c=l/e,a=[];for(let f=0;f<e;f++){const d=s+f*c,u=f===e-1?o:s+(f+1)*c,p=r.filter(x=>x.close>=d&&(f===e-1?x.close<=u:x.close<u));a.push({low:d,high:u,data:p})}const h=[];for(const f of a){if(f.data.length===0){h.push({low_price:f.low,mean_price:(f.low+f.high)/2,high_price:f.high,pos_volume:0,neg_volume:0,total_volume:0});continue}const d=f.data.map(x=>x.close),u=f.data.reduce((x,g)=>x+g.pos_volume,0),p=f.data.reduce((x,g)=>x+g.neg_volume,0);h.push({low_price:Math.min(...d),mean_price:d.reduce((x,g)=>x+g,0)/d.length,high_price:Math.max(...d),pos_volume:u,neg_volume:p,total_volume:u+p})}return h}static mfi(t,e=14,n=1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.floor(e)||14,n=Math.floor(n)||1,e<=0||n<=0)return[];const r=[];for(let s=0;s<t.length;s++){if(s<e-1||s<n){r.push(null);continue}let o=0,l=0;for(let c=0;c<e;c++){const a=s-c,h=t[a].high,f=t[a].low,d=t[a].close,u=t[a].volume;if(!D.isValid(h)||!D.isValid(f)||!D.isValid(d)||!D.isValid(u)||a<n)continue;const p=t[a-n].high,x=t[a-n].low,g=t[a-n].close;if(!D.isValid(p)||!D.isValid(x)||!D.isValid(g))continue;const m=(h+f+d)/3,y=(p+x+g)/3,v=m*u,_=m-y;_>0?o+=v:_<0&&(l+=v)}if(l===0)r.push(100);else if(o===0)r.push(0);else{const c=100*o/(o+l);isFinite(c)?r.push(c):r.push(null)}}return r}static moneyFlow(t){return t.map((e,n)=>{if(n===0)return null;const r=e,s=t[n-1],o=(r.high+r.low+r.close)/3,l=(s.high+s.low+s.close)/3,c=o*(r.volume??0);return o>l?c:o<l?-c:0})}static getTrend(t,e=10,n=20,r=null){const s=A.ma(t,e,r),o=A.ma(t,n,r);return t.map((l,c)=>{if(c<n-1||s[c]===null||o[c]===null)return null;const a=s[c],h=o[c],f=h*.001;return a>h+f?"up":a<h-f?"down":"sideways"})}static fibonacciRetracement(t,e){const n=[0,.236,.382,.5,.618,.786,1],r=t-e;return n.map(s=>({level:s,price:t-r*s,percentage:`${(s*100).toFixed(1)}%`}))}static sar(t,e=2,n=20,r=20){const s=e/100,o=n/100,l=r/100;let c=s,a=-100,h=!1,f=0;return t.map((u,p)=>{const x=f,g=u.high,m=u.low;if(h){(a===-100||a<g)&&(a=g,c=Math.min(c+o,l)),f=x+c*(a-x);const y=Math.min(t[Math.max(1,p)-1].low,m);f>u.low?(f=a,c=s,a=-100,h=!h):f>y&&(f=y)}else{(a===-100||a>m)&&(a=m,c=Math.min(c+o,l)),f=x+c*(a-x);const y=Math.max(t[Math.max(1,p)-1].high,g);f<u.high?(f=a,c=0,a=-100,h=!h):f<y&&(f=y)}return f})}static high(t,e=null){const n={index:-1,val:null};return t.forEach((r,s)=>{const o=A.getNumVal(e,r);D.isValid(o)&&(n.val===null||o>n.val)&&(n.val=o,n.index=s)}),n}static low(t,e=null){const n={index:-1,val:null};return t.forEach((r,s)=>{const o=A.getNumVal(e,r);D.isValid(o)&&(n.val===null||o<n.val)&&(n.val=o,n.index=s)}),n}static bias(t,e=26,n="sma"){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||26,t.length<e)return[];const r=[];let s;switch(n.toLowerCase()){case"ema":s=A.ema(t,e,"close");break;case"hma":s=A.hma(t,e,"close");break;case"rma":s=A.rma(t,e,"close");break;case"wma":s=A.wma(t,e,"close");break;default:s=A.sma(t,e,"close");break}for(let o=0;o<t.length;o++){if(o<e-1){r.push(null);continue}const l=t[o].close,c=s[o];l!==null&&c!==null&&c!==0?r.push(l/c-1):r.push(null)}return r}static cdl_doji(t,e=10,n=10,r=100){if(!Array.isArray(t)||t.length===0)return[];e=Math.max(1,Math.floor(e)),n=parseFloat(n.toString())||10,r=parseFloat(r.toString())||100;const s=[];for(let o=0;o<t.length;o++){if(o<e-1){s.push(null);continue}const l=t[o];if(!l||!D.isValid(l.open)||!D.isValid(l.high)||!D.isValid(l.low)||!D.isValid(l.close)){s.push(null);continue}const c=Math.abs(l.close-l.open);let a=0,h=0;for(let p=o-e+1;p<=o;p++){const x=t[p];x&&D.isValid(x.high)&&D.isValid(x.low)&&(a+=Math.abs(x.high-x.low),h++)}if(h===0){s.push(null);continue}const f=a/h,u=c<.01*n*f?r:0;s.push(u)}return s}static cdl_inside(t){if(!Array.isArray(t)||t.length===0)return[];const e=[];for(let n=0;n<t.length;n++){if(n===0){e.push(null);continue}const r=t[n],s=t[n-1];if(!r||!s||!D.isValid(r.high)||!D.isValid(r.low)||!D.isValid(s.high)||!D.isValid(s.low)||!D.isValid(r.open)||!D.isValid(r.close)){e.push(null);continue}const o=r.high-s.high,l=r.low-s.low;if(!(o<0&&l>0))e.push(0);else{const a=r.close>r.open?1:-1;e.push(a)}}return e}static ha(t){if(!Array.isArray(t)||t.length===0)return[];const e=[];for(let n=0;n<t.length;n++){const r=t[n];if(!r||!D.isValid(r.open)||!D.isValid(r.high)||!D.isValid(r.low)||!D.isValid(r.close)){e.push(null);continue}let s,o;if(n===0)s=.5*(r.open+r.close),o=.25*(r.open+r.high+r.low+r.close);else{const a=e[n-1];if(!a){e.push(null);continue}s=.5*(a.open+a.close),o=.25*(r.open+r.high+r.low+r.close)}const l=Math.max(s,r.high,o),c=Math.min(s,r.low,o);e.push({open:s,high:l,low:c,close:o})}return e}static ebsw(t,e=40,n=10){if(!Array.isArray(t)||t.length===0)return[];e=Math.max(39,Math.floor(e))||40,n=Math.max(1,Math.floor(n))||10;const r=[];let s=0,o=0,l=0,c=0,a=0,h=0,f=0,d=0,u=0,p=0,x=0,g=0;const m=[0,0];for(let y=0;y<e-1;y++)r.push(null);if(t.length>=e){const y=t[e-1];y&&D.isValid(y.close)?(x=y.close,r.push(0)):r.push(null)}for(let y=e;y<t.length;y++){const v=t[y];if(!v||!D.isValid(v.close)){r.push(null);continue}s=(1-Math.sin(360/e*Math.PI/180))/Math.cos(360/e*Math.PI/180),o=.5*(1+s)*(v.close-x)+s*g,l=Math.exp(-Math.sqrt(2)*Math.PI/n),c=2*l*Math.cos(Math.sqrt(2)*180/n*Math.PI/180),h=c,f=-1*l*l,a=1-h-f,d=a*(o+g)/2+h*m[1]+f*m[0],p=(d+m[1]+m[0])/3,u=(d*d+m[1]*m[1]+m[0]*m[0])/3,u>0?p=p/Math.sqrt(u):p=0,m.push(d),m.shift(),g=o,x=v.close,r.push(p)}return r}static ao(t,e=5,n=34){if(!Array.isArray(t)||t.length===0)return[];e=Math.max(1,Math.floor(e))||5,n=Math.max(1,Math.floor(n))||34,n<e&&([e,n]=[n,e]);const r=Math.max(e,n);if(t.length<r)return[];const s=[],o=[];for(let a=0;a<t.length;a++){const h=t[a];h&&D.isValid(h.high)&&D.isValid(h.low)?o.push(.5*(h.high+h.low)):o.push(NaN)}const l=A.sma(o,e),c=A.sma(o,n);for(let a=0;a<t.length;a++){if(a<r-1){s.push(null);continue}const h=l[a],f=c[a];h!==null&&f!==null?s.push(h-f):s.push(null)}return s}static apo(t,e=12,n=26){if(!Array.isArray(t)||t.length===0)return[];e=Math.max(1,Math.floor(e))||12,n=Math.max(1,Math.floor(n))||26,n<e&&([e,n]=[n,e]);const r=Math.max(e,n);if(t.length<r)return[];const s=[],o=[];for(let a=0;a<t.length;a++){const h=t[a];h&&D.isValid(h.close)?o.push(h.close):o.push(NaN)}const l=A.sma(o,e),c=A.sma(o,n);for(let a=0;a<t.length;a++){if(a<r-1){s.push(null);continue}const h=l[a],f=c[a];h!==null&&f!==null?s.push(h-f):s.push(null)}return s}static bop(t,e=1){if(!Array.isArray(t)||t.length===0)return[];e=parseFloat(e.toString())||1;const n=[];for(let r=0;r<t.length;r++){const s=t[r];if(!s||!D.isValid(s.open)||!D.isValid(s.high)||!D.isValid(s.low)||!D.isValid(s.close)){n.push(null);continue}const o=s.high-s.low,l=s.close-s.open;if(o===0){n.push(null);continue}const c=e*l/o;n.push(c)}return n}static cfo(t,e=9,n=100,r=1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||9,n=parseFloat(n.toString())||100,r=Math.max(1,Math.floor(r))||1,t.length<e)return[];const s=[],o=A.linreg(t,e,!1,!1,!1,!1,!1,!0,"close");for(let l=0;l<t.length;l++){if(l<e-1){s.push(null);continue}const c=t[l],a=o[l];if(!c||!D.isValid(c.close)||a===null||a===0){s.push(null);continue}const h=n*(c.close-a)/c.close;s.push(h)}return s}static cg(t,e=10){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,t.length<e)return[];const n=[],r=[];for(let s=0;s<e;s++)r.push(e-s);for(let s=0;s<t.length;s++){if(s<e-1){n.push(null);continue}let o=0,l=0;for(let a=0;a<e;a++){const h=t[s-a];if(!h||!D.isValid(h.close)){n.push(null);continue}const f=h.close,d=r[a];o+=f*d,l+=f}if(l===0){n.push(null);continue}const c=-o/l;n.push(c)}return n}static cmo(t,e=14,n=100,r=1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||14,n=parseFloat(n.toString())||100,r=Math.max(1,Math.floor(r))||1,t.length<e+r)return[];const s=[],o=[];for(let f=0;f<t.length;f++){if(f<r){o.push(NaN);continue}const d=t[f],u=t[f-r];if(!d||!u||!D.isValid(d.close)||!D.isValid(u.close)){o.push(NaN);continue}o.push(d.close-u.close)}const l=[],c=[];for(let f=0;f<o.length;f++){const d=o[f];if(isNaN(d)){l.push(NaN),c.push(NaN);continue}l.push(d>0?d:0),c.push(d<0?Math.abs(d):0)}const a=A.rma(l,e),h=A.rma(c,e);for(let f=0;f<t.length;f++){if(f<e-1){s.push(null);continue}const d=a[f],u=h[f];if(d===null||u===null||d+u===0){s.push(null);continue}const p=n*(d-u)/(d+u);s.push(p)}return s}static coppock(t,e=10,n=11,r=14){if(!Array.isArray(t)||t.length===0)return[];e=Math.max(1,Math.floor(e))||10,n=Math.max(1,Math.floor(n))||11,r=Math.max(1,Math.floor(r))||14;const s=Math.max(e,n,r);if(t.length<s)return[];const o=A.roc(t,n),l=A.roc(t,r),c=[];for(let h=0;h<t.length;h++){const f=o[h],d=l[h];if(f===null||d===null){c.push(null);continue}c.push(f+d)}return A.wma(c,e)}static er(t,e=10,n=1){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(1,Math.floor(e))||10,n=Math.max(1,Math.floor(n))||1,t.length<e+n)return[];const r=[],s=[];for(let l=0;l<t.length;l++){if(l<e){s.push(null);continue}const c=t[l],a=t[l-e];if(!c||!a||!D.isValid(c.close)||!D.isValid(a.close)){s.push(null);continue}s.push(Math.abs(c.close-a.close))}const o=[];for(let l=0;l<t.length;l++){if(l<n){o.push(null);continue}const c=t[l],a=t[l-n];if(!c||!a||!D.isValid(c.close)||!D.isValid(a.close)){o.push(null);continue}o.push(Math.abs(c.close-a.close))}for(let l=0;l<t.length;l++){if(l<e){r.push(null);continue}const c=s[l];if(c===null){r.push(null);continue}let a=0,h=0;for(let d=0;d<e;d++){const u=l-d;u>=0&&o[u]!==null&&(a+=o[u],h++)}if(h===0||a===0){r.push(null);continue}const f=c/a;r.push(f)}return r}static eri(t,e=13){if(!Array.isArray(t)||t.length===0)return{bull:[],bear:[]};if(e=Math.max(1,Math.floor(e))||13,t.length<e)return{bull:[],bear:[]};const n=A.ema(t,e,"close"),r=[],s=[];for(let o=0;o<t.length;o++){const l=t[o],c=n[o];if(!l||c===null||!D.isValid(l.high)||!D.isValid(l.low)){r.push(null),s.push(null);continue}r.push(l.high-c),s.push(l.low-c)}return{bull:r,bear:s}}static fisher(t,e=9,n=1){if(!Array.isArray(t)||t.length===0)return{fisher:[],signal:[]};e=Math.max(1,Math.floor(e))||9,n=Math.max(1,Math.floor(n))||1;const r=Math.max(e,n);if(t.length<r)return{fisher:[],signal:[]};const s=[];for(let f=0;f<t.length;f++){const d=t[f];if(!d||!D.isValid(d.high)||!D.isValid(d.low)){s.push(null);continue}s.push((d.high+d.low)/2)}const o=[],l=[];for(let f=0;f<t.length;f++){if(f<e-1){o.push(null),l.push(null);continue}let d=-1/0,u=1/0,p=0;for(let x=0;x<e;x++){const g=f-x;g>=0&&s[g]!==null&&(d=Math.max(d,s[g]),u=Math.min(u,s[g]),p++)}if(p===0){o.push(null),l.push(null);continue}o.push(d),l.push(u)}const c=[];let a=0;for(let f=0;f<e-1;f++)c.push(null);c.push(0);for(let f=e;f<t.length;f++){const d=s[f],u=o[f],p=l[f];if(d===null||u===null||p===null){c.push(null);continue}let x=u-p;x=Math.max(x,.001),a=.66*((d-p)/x-.5)+.67*a,a=Math.max(-.999,Math.min(.999,a));const m=.5*(Math.log((1+a)/(1-a))+c[f-1]);c.push(m)}const h=[];for(let f=0;f<t.length;f++){if(f<n){h.push(null);continue}h.push(c[f-n])}return{fisher:c,signal:h}}static hilo(t,e=13,n=21,r="sma"){if(!Array.isArray(t)||t.length===0)return{hilo:[],long:[],short:[]};e=Math.max(1,Math.floor(e))||13,n=Math.max(1,Math.floor(n))||21,r=r.toLowerCase();const s=Math.max(e,n);if(t.length<s)return{hilo:[],long:[],short:[]};let o,l;switch(r){case"ema":o=A.ema(t,e,"close"),l=A.ema(t,n,"close");break;case"hma":o=A.hma(t,e),l=A.hma(t,n);break;default:o=A.sma(t,e,"close"),l=A.sma(t,n,"close");break}const c=[],a=[],h=[];c.push(null),a.push(null),h.push(null);for(let f=1;f<t.length;f++){const d=t[f].close,u=o[f-1],p=l[f];if(!D.isValid(d)||u===null||p===null){c.push(null),a.push(null),h.push(null);continue}if(d>u)c.push(p),a.push(p),h.push(null);else if(d<u)c.push(u),a.push(null),h.push(u);else{const x=c[f-1];c.push(x),a.push(x),h.push(x)}}return{hilo:c,long:a,short:h}}static hwma(t,e=.2,n=.1,r=.1,s=null){if(!Array.isArray(t)||t.length===0)return[];if(e=Math.max(0,Math.min(1,parseFloat(e.toString())))||.2,n=Math.max(0,Math.min(1,parseFloat(n.toString())))||.1,r=Math.max(0,Math.min(1,parseFloat(r.toString())))||.1,t.length<1)return[];const o=[];let l=0,c=0,a=null;for(let h=0;h<t.length;h++){const f=A.getNumVal(s,t[h]);if(!D.isValid(f)){o.push(null);continue}if(a===null){a=f,o.push(f);continue}const d=(1-e)*(a+c+.5*l)+e*f,u=(1-n)*(c+l)+n*(d-a),p=(1-r)*l+r*(u-c),x=d+u+.5*p;o.push(x),l=p,a=d,c=u}return o}static ichimoku(t,e=9,n=26,r=52){if(!Array.isArray(t)||t.length===0)return{spanA:[],spanB:[],tenkanSen:[],kijunSen:[],chikouSpan:[],spanAFuture:[],spanBFuture:[]};e=Math.max(1,Math.floor(e))||9,n=Math.max(1,Math.floor(n))||26,r=Math.max(1,Math.floor(r))||52;const s=Math.max(e,n,r);if(t.length<s)return{spanA:[],spanB:[],tenkanSen:[],kijunSen:[],chikouSpan:[],spanAFuture:[],spanBFuture:[]};const o=(g,m)=>(g+m)/2,l=[];for(let g=0;g<t.length;g++){if(g<e-1){l.push(null);continue}let m=-1/0,y=1/0,v=0;for(let _=0;_<e;_++){const w=g-_;if(w>=0){const b=t[w];b&&D.isValid(b.high)&&D.isValid(b.low)&&(m=Math.max(m,b.high),y=Math.min(y,b.low),v++)}}v===0?l.push(null):l.push(o(m,y))}const c=[];for(let g=0;g<t.length;g++){if(g<n-1){c.push(null);continue}let m=-1/0,y=1/0,v=0;for(let _=0;_<n;_++){const w=g-_;if(w>=0){const b=t[w];b&&D.isValid(b.high)&&D.isValid(b.low)&&(m=Math.max(m,b.high),y=Math.min(y,b.low),v++)}}v===0?c.push(null):c.push(o(m,y))}const a=[];for(let g=0;g<t.length;g++){const m=l[g],y=c[g];m===null||y===null?a.push(null):a.push(.5*(m+y))}const h=[];for(let g=0;g<t.length;g++){if(g<r-1){h.push(null);continue}let m=-1/0,y=1/0,v=0;for(let _=0;_<r;_++){const w=g-_;if(w>=0){const b=t[w];b&&D.isValid(b.high)&&D.isValid(b.low)&&(m=Math.max(m,b.high),y=Math.min(y,b.low),v++)}}v===0?h.push(null):h.push(o(m,y))}const f=[];for(let g=0;g<t.length;g++){if(g<n){f.push(null);continue}const m=t[g-n];m&&D.isValid(m.close)?f.push(m.close):f.push(null)}const d=[],u=[],p=a.slice(-n),x=h.slice(-n);for(let g=0;g<n;g++)d.push(p[g]||null),u.push(x[g]||null);return{spanA:a,spanB:h,tenkanSen:l,kijunSen:c,chikouSpan:f,spanAFuture:d,spanBFuture:u}}static inertia(t,e=20,n=14,r=100,s=!1,o=!1,l="ema",c=1){if(!Array.isArray(t)||t.length===0)return[];e=Math.max(1,Math.floor(e))||20,n=Math.max(1,Math.floor(n))||14,r=parseFloat(r.toString())||100,c=Math.max(1,Math.floor(c))||1;const a=Math.max(e,n);if(t.length<a)return[];const h=A.rvi(t,n,r,s,o,l);return A.linreg(h,e)}static kst(t,e=10,n=15,r=20,s=30,o=10,l=10,c=10,a=15,h=9,f=1){if(!Array.isArray(t)||t.length===0)return{kst:[],signal:[]};e=Math.max(1,Math.floor(e))||10,n=Math.max(1,Math.floor(n))||15,r=Math.max(1,Math.floor(r))||20,s=Math.max(1,Math.floor(s))||30,o=Math.max(1,Math.floor(o))||10,l=Math.max(1,Math.floor(l))||10,c=Math.max(1,Math.floor(c))||10,a=Math.max(1,Math.floor(a))||15,h=Math.max(1,Math.floor(h))||9,f=Math.max(1,Math.floor(f))||1;const d=Math.max(e,n,r,s,o,l,c,a,h);if(t.length<d)return{kst:[],signal:[]};const u=A.sma(A.roc(t,e),o),p=A.sma(A.roc(t,n),l),x=A.sma(A.roc(t,r),c),g=A.sma(A.roc(t,s),a),m=[];for(let v=0;v<t.length;v++){const _=u[v],w=p[v],b=x[v],C=g[v];if(_===null||w===null||b===null||C===null){m.push(null);continue}const M=100*(_+2*w+3*b+4*C);m.push(M)}const y=A.sma(m,h);return{kst:m,signal:y}}static generateFibonacciWeights(t,e=!0){const n=[];for(let r=0;r<t;r++)r===0||r===1?n.push(1):n.push(n[r-1]+n[r-2]);return e?n:n.reverse()}static getCurrentAnchor(t,e){switch(e){case"D":return`D${Math.floor(t/1)}`;case"W":return`W${Math.floor(t/7)}`;case"M":return`M${Math.floor(t/30)}`;case"Q":return`Q${Math.floor(t/90)}`;case"Y":return`Y${Math.floor(t/365)}`;default:return`D${Math.floor(t/1)}`}}static shouldResetAnchor(t,e){switch(e){case"D":return t===0;case"W":return t%7===0;case"M":return t%30===0;case"Q":return t%90===0;case"Y":return t%365===0;default:return t===0}}static swmaLegacy(t,e){if(!Array.isArray(t)||t.length===0||e<=0)return[];const n=[];for(let r=0;r<t.length;r++){if(r<e-1){n.push(null);continue}let s=0,o=0;for(let l=0;l<e;l++){const c=r-l,a=t[c];if(a===null)continue;const h=e-Math.abs(l-(e-1)/2);s+=a*h,o+=h}o===0?n.push(null):n.push(s/o)}return n}static percentileLinearInterpolation(t,e,n){if(!Array.isArray(t)||t.length===0)return[];const r=[];for(let s=0;s<t.length;s++)if(s<e-1)r.push(null);else{const l=t.slice(s-e+1,s+1).filter(a=>a!=null&&!isNaN(a));if(l.length===0){r.push(null);continue}l.sort((a,h)=>a-h);const c=A.calculatePercentile(l,n);r.push(c)}return r}static calculatePercentile(t,e){if(t.length===0)return null;if(t.length===1)return t[0];const r=Math.max(0,Math.min(100,e))/100*(t.length-1);if(Number.isInteger(r))return t[r];const s=Math.floor(r),o=Math.ceil(r),l=r-s,c=t[s],a=t[o];return c+l*(a-c)}static call(t,...e){switch(t.toLowerCase()){case"attr":return A.attr(e[0],e[1]);case"ma":return A.ma(e[0],e[1],e[2]);case"ema":return A.ema(e[0],e[1],e[2]);case"wma":return A.wma(e[0],e[1],e[2]);case"fwma":return A.fwma(e[0],e[1],e[2]);case"sma":return A.sma(e[0],e[1],e[2]);case"rma":return A.rma(e[0],e[1],e[2]);case"rmawithalpha":return A.rmaWithAlpha(e[0],e[1],e[2],e[3]);case"trima":return A.trima(e[0],e[1],e[2]);case"kama":return A.kama(e[0],e[1],e[2],e[3],e[4],e[5]);case"t3":return A.t3(e[0],e[1],e[2],e[3]);case"dema":return A.dema(e[0],e[1],e[2]);case"tema":return A.tema(e[0],e[1],e[2]);case"vidya":return A.vidya(e[0],e[1],e[2],e[3]);case"vwap":return A.vwap(e[0],e[1]);case"wcp":return A.wcp(e[0]);case"vwma":return A.vwma(e[0],e[1]);case"zlma":return A.zlma(e[0],e[1],e[2],e[3]);case"drawdown":return A.drawdown(e[0]);case"log_return":return A.log_return(e[0],e[1],e[2]);case"percent_return":return A.percent_return(e[0],e[1],e[2]);case"trend_return":return A.trend_return(e[0],e[1],e[2],e[3],e[4],e[5]);case"entropy":return A.entropy(e[0],e[1],e[2]);case"kurtosis":return A.kurtosis(e[0],e[1],e[2]);case"mad":return A.mad(e[0],e[1],e[2]);case"median":return A.median(e[0],e[1],e[2]);case"quantile":return A.quantile(e[0],e[1],e[2],e[3]);case"skew":return A.skew(e[0],e[1],e[2]);case"hma":return A.hma(e[0],e[1],e[2]);case"lsma":return A.lsma(e[0],e[1],e[2]);case"jma":return A.jma(e[0],e[1],e[2],e[3]);case"mcginley":return A.mcginley(e[0],e[1],e[2]);case"mcgd":return A.mcgd(e[0],e[1],e[2],e[3]);case"edsma":return A.edsma(e[0],e[1],e[2]);case"vama":return A.vama(e[0],e[1]);case"stdev":return A.stdev(e[0],e[1],e[2],e[3]);case"variance":return A.variance(e[0],e[1],e[2],e[3]);case"zscore":return A.zscore(e[0],e[1],e[2]);case"adx":return A.adx(e[0],e[1],e[2],e[3],e[4]);case"amat":return A.amat(e[0],e[1],e[2],e[3],e[4]);case"aroon":return A.aroon(e[0],e[1],e[2]);case"chop":return A.chop(e[0],e[1],e[2],e[3],e[4]);case"cksp":return A.cksp(e[0],e[1],e[2],e[3],e[4]);case"decay":return A.decay(e[0],e[1],e[2]);case"decreasing":return A.decreasing(e[0],e[1],e[2]);case"dpo":return A.dpo(e[0],e[1],e[2]);case"increasing":return A.increasing(e[0],e[1],e[2]);case"longRun":return A.longRun(e[0],e[1],e[2]);case"psar":return A.psar(e[0],e[1],e[2]);case"qstick":return A.qstick(e[0],e[1],e[2]);case"short_run":return A.short_run(e[0],e[1],e[2]);case"ttm_trend":return A.ttm_trend(e[0],e[1]);case"vortex":return A.vortex(e[0],e[1],e[2]);case"aberration":return A.aberration(e[0],e[1],e[2]);case"accbands":return A.accbands(e[0],e[1],e[2],e[3],e[4]);case"slope":return A.slope(e[0],e[1],e[2],e[3]);case"linreg":return A.linreg(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]);case"midpoint":return A.midpoint(e[0],e[1],e[2],e[3]);case"midprice":return A.midprice(e[0],e[1],e[2]);case"pwma":return A.pwma(e[0],e[1],e[2],e[3]);case"sinwma":return A.sinwma(e[0],e[1],e[2]);case"ssf":return A.ssf(e[0],e[1],e[2],e[3]);case"supertrend":return A.supertrend(e[0],e[1],e[2]);case"swma":return A.swma(e[0],e[1],e[2],e[3]);case"calcvolatility":return A.calcVolatility(e[0],e[1]);case"avg":return A.avg(e[0],e[1],e[2]);case"hhv":return A.hhv(e[0],e[1],e[2]);case"llv":return A.llv(e[0],e[1],e[2]);case"cross":return A.cross(e[0],e[1],e[2]);case"throughUp":return A.throughUp(e[0],e[1],e[2]);case"throughDown":return A.throughDown(e[0],e[1],e[2]);case"kdj":return A.kdj(e[0],e[1],e[2]);case"boll":return A.boll(e[0],e[1],e[2]);case"macd":return A.macd(e[0],e[1],e[2],e[3]);case"tr":return A.tr(e[0],e[1]);case"atr":return A.atr(e[0],e[1],e[2],e[3],e[4]);case"atrwithrma":return A.atrWithRMA(e[0],e[1]);case"adxwithrma":return A.adxWithRMA(e[0],e[1]);case"rsi":return A.rsi(e[0],e[1],e[2],e[3],e[4]);case"cci":return A.cci(e[0],e[1]);case"mom":return A.mom(e[0],e[1],e[2]);case"pgo":return A.pgo(e[0],e[1],e[2]);case"ppo":return A.ppo(e[0],e[1],e[2],e[3],e[4]);case"psl":return A.psl(e[0],e[1],e[2],e[3]);case"pvo":return A.pvo(e[0],e[1],e[2],e[3],e[4]);case"qqe":return A.qqe(e[0],e[1],e[2],e[3],e[4],e[5]);case"rsx":return A.rsx(e[0],e[1],e[2]);case"rvgi":return A.rvgi(e[0],e[1],e[2]);case"smi":return A.smi(e[0],e[1],e[2],e[3],e[4]);case"squeeze":return A.squeeze(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]);case"stochrsi":return A.stochrsi(e[0],e[1],e[2],e[3],e[4]);case"td_seq":return A.td_seq(e[0],e[1],e[2]);case"tsi":return A.tsi(e[0],e[1],e[2],e[3],e[4]);case"uo":return A.uo(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]);case"willr":return A.willr(e[0],e[1]);case"alma":return A.alma(e[0],e[1],e[2],e[3]);case"roc":return A.roc(e[0],e[1]);case"kijunV2":return A.kijunV2(e[0],e[1],e[2]);case"trix":return A.trix(e[0],e[1],e[2],e[3],e[4]);case"brar":return A.brar(e[0],e[1],e[2],e[3]);case"vr":return A.vr(e[0],e[1]);case"obv":return A.obv(e[0]);case"emv":return A.emv(e[0],e[1]);case"vo":return A.vo(e[0],e[1],e[2]);case"dmi":return A.dmi(e[0],e[1],e[2]);case"dma":return A.dma(e[0],e[1],e[2]);case"asi":return A.asi(e[0],e[1]);case"stochastic":return A.stochastic(e[0],e[1],e[2],e[3]);case"donchianchannel":return A.donchianChannel(e[0],e[1],e[2],e[3],e[4]);case"hwc":return A.hwc(e[0],e[1],e[2],e[3],e[4],e[5],e[6]);case"kc":return A.kc(e[0],e[1],e[2],e[3],e[4]);case"massi":return A.massi(e[0],e[1],e[2]);case"natr":return A.natr(e[0],e[1],e[2],e[3],e[4],e[5]);case"pdist":return A.pdist(e[0],e[1]);case"rvi":return A.rvi(e[0],e[1],e[2],e[3],e[4],e[5],e[6]);case"thermo":return A.thermo(e[0],e[1],e[2],e[3],e[4],e[5]);case"truerange":return A.trueRange(e[0],e[1]);case"ui":return A.ui(e[0],e[1],e[2],e[3]);case"ad":return A.ad(e[0]);case"adosc":return A.adosc(e[0],e[1],e[2]);case"aobv":return A.aobv(e[0],e[1],e[2],e[3],e[4],e[5],e[6]);case"cmf":return A.cmf(e[0],e[1]);case"efi":return A.efi(e[0],e[1],e[2],e[3]);case"eom":return A.eom(e[0],e[1],e[2],e[3]);case"nvi":return A.nvi(e[0],e[1],e[2]);case"pvi":return A.pvi(e[0],e[1],e[2]);case"pvol":return A.pvol(e[0],e[1]);case"pvr":return A.pvr(e[0]);case"pvt":return A.pvt(e[0],e[1]);case"vp":return A.vp(e[0],e[1],e[2]);case"mfi":return A.mfi(e[0],e[1],e[2]);case"moneyflow":return A.moneyFlow(e[0]);case"gettrend":return A.getTrend(e[0],e[1],e[2],e[3]);case"fibonacciretracement":return A.fibonacciRetracement(e[0],e[1]);case"sar":return A.sar(e[0],e[1],e[2],e[3]);case"high":return A.high(e[0],e[1]);case"low":return A.low(e[0],e[1]);case"bias":return A.bias(e[0],e[1],e[2]);case"cdl_doji":return A.cdl_doji(e[0],e[1],e[2],e[3]);case"cdl_inside":return A.cdl_inside(e[0]);case"ha":return A.ha(e[0]);case"ebsw":return A.ebsw(e[0],e[1],e[2]);case"ao":return A.ao(e[0],e[1],e[2]);case"apo":return A.apo(e[0],e[1],e[2]);case"bop":return A.bop(e[0],e[1]);case"cfo":return A.cfo(e[0],e[1],e[2],e[3]);case"cg":return A.cg(e[0],e[1]);case"cmo":return A.cmo(e[0],e[1],e[2],e[3]);case"coppock":return A.coppock(e[0],e[1],e[2],e[3]);case"er":return A.er(e[0],e[1],e[2]);case"eri":return A.eri(e[0],e[1]);case"fisher":return A.fisher(e[0],e[1],e[2]);case"hilo":return A.hilo(e[0],e[1],e[2],e[3]);case"hwma":return A.hwma(e[0],e[1],e[2],e[3],e[4]);case"ichimoku":return A.ichimoku(e[0],e[1],e[2],e[3]);case"inertia":return A.inertia(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]);case"kst":return A.kst(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10]);case"percentilelinearinterpolation":return A.percentileLinearInterpolation(e[0],e[1],e[2]);case"calculatePercentile":return A.calculatePercentile(e[0],e[1]);default:return console.warn(`未知的方法: ${t}，请检查方法名是否正确`),null}}}const ox={version:1,name:"Script Engine v1",description:"基础脚本引擎，支持基本的技术指标和策略脚本",features:["基础语法解析","技术指标计算","图形绘制","参数配置","样式设置"],Parser:Vn,Inputs:rx,Styles:sx,Outputs:null,Formula:A,Utils:D,Constants:{SOURCE:_l,TIMEFRAME:ix},Keywords:Ir,validateScript(i){const t=[];try{const e=Vn.parse(i);e.errors.length>0&&t.push(...e.errors)}catch(e){t.push(`脚本解析失败: ${e}`)}return{valid:t.length===0,errors:t}}};Fn.registerEngine(ox);Fn.getAvailableVersions();class ax{static extractName(t){const e=t.match(/\/\/\s*@name\s*=\s*(.+)$/m);return e?e[1].trim():""}static extractTitle(t){const e=t.match(/\/\/\s*@title\s*=\s*(.+)$/m);return e?e[1].trim():""}static extractDesc(t){return""}static extractVersion(t){return"1.0.0"}static extractType(t){return"indicator"}}class lx{constructor(t){this.scripts=new Map,this.scriptCounters=new Map,this.registeredVicePanes=new Set,this._httpRedrawScheduled=!1,this.chart=t,this.versionManager=Fn}markAllScriptsDirty(){this.scripts.forEach(t=>{t._dirty=!0})}_scheduleOverlayRedraw(){this._httpRedrawScheduled||(this._httpRedrawScheduled=!0,ot(()=>{this._httpRedrawScheduled=!1;try{this.chart.requestOverlayUpdateOnce()}catch{}}))}async executeHttpCalls(t,e,n){if(!e._httpExecuting){e._httpExecuting=!0;try{for(const r of t)try{if(e.http){let s;const o=r.args;switch(r.type){case"loadHistory":s=await e.http.loadHistory(...o);break;case"get":s=await e.http.get(...o);break;case"post":s=await e.http.post(...o);break}s!=null&&(r.value=s,e._httpVal&&e._httpVal[r.key]!==void 0&&(e._httpVal[r.key]=s))}else console.warn("script.http不存在，无法执行HTTP请求")}catch(s){console.error("HTTP请求失败:",s),r.value=null}}finally{e._httpExecuting=!1,this._scheduleOverlayRedraw()}}}hasStateChanged(t,e){if(!t.lastState)return!0;const n=t.lastState;return n.symbol!==e.symbol||n.period!==e.period||n.dataLength!==e.dataLength||JSON.stringify(n.inputs)!==JSON.stringify(e.inputs)}async recompileScript(t,e){const n=this.scripts.get(t);if(n&&!n._compiling&&this.hasStateChanged(n,e)){n._compiling=!0,n.lastState={...e};try{if(!n.script){console.error("脚本代码为空，无法重新编�?",t);return}const r=Vn.parse(n.script,n.inputs,n.styles),s=r.main;n.httpCalls=r.httpCalls||[],n.httpCalls&&n.httpCalls.length>0&&n.httpCalls.some(d=>!d.value||d.value&&d.value.data&&d.value.data.length===0)&&await this.executeHttpCalls(n.httpCalls,n);const o={main:s,inputs:n.inputs||[],styles:n.styles||[],httpCalls:n.httpCalls},l=this.compileScript(o,n.key,n.msgCallback);n._compiledFunction=l.draw,n._executableCode=s;const h=this.chart.getChartStore().getScriptsByPaneId(n.paneId).find(f=>f.key===n.key);h&&(h._compiledFunction=n._compiledFunction,h._executableCode=n._executableCode,h.httpCalls=n.httpCalls)}catch(r){console.error("重新编译脚本失败:",r)}finally{n._compiling=!1}}}async checkAllScriptsState(t){for(const[e,n]of this.scripts)if(n.httpCalls&&n.httpCalls.length>0){const r={...t,inputs:n.inputs||[],styles:n.styles||[]};await this.recompileScript(e,r)}}async onScriptConfigChanged(t){const e=this.scripts.get(t);e&&(this.chart.getSymbol()?.symbol,this.chart.getPeriod()&&`${this.chart.getPeriod().type}${this.chart.getPeriod().span}`,this.chart.getDataList().length,e.inputs,e.styles)}triggerScriptRefresh(t){this.chart&&this.chart.layout&&this.chart.layout({update:!0})}registerScriptObject(t,e){this.scripts.set(t,e)}registerScript(t){if(this.scripts.has(t.key)){const d=this.scripts.get(t.key);d&&this.removeScript(d.key)}const e=Vn.parse(t.script,t.inputs,t.styles),n=ax.extractMetadata(t.script),r=e.inputs,s=e.styles,o=n.position==="main"?"main":"vice",l=e.main,c={...t,id:t.id,name:n.name||t.name,code:t.encryptedScript||t.script,script:t.script,inputs:r,styles:s,visible:!0,key:t.key,position:o==="main"?"main":"vice",paneId:t.paneId||(o==="main"?"candle_pane":"vice"),user_id:t.user_id||0,info:{...n,...t.info},createTooltipDataSource:t.createTooltipDataSource,msgCallback:t.msgCallback,http:t.http,httpCalls:e.httpCalls,tooltipTools:[],tools:[],precision:null,account:t.account||null,extendData:t.extendData||null,_executableCode:l,_compiledFunction:void 0},a=t.script.match(/setMin\s*\(\s*([^)]+)\s*\)/);if(a){const d=a[1].trim();c._default={...c._default,min:parseFloat(d)}}const h=t.script.match(/setMax\s*\(\s*([^)]+)\s*\)/);if(h){const d=h[1].trim();c._default={...c._default,max:parseFloat(d)}}const f=t.script.match(/setPrecision\s*\(\s*([^)]+)\s*\)/);if(f){const d=f[1].trim();let u=null;if(d==="'price'"||d==='"price"')u="price";else if(d==="'volume'"||d==='"volume"')u="volume";else{const p=parseFloat(d);!isNaN(p)&&p>=0&&(u=p)}u!==null&&(c.precision=u)}try{const d={main:l,inputs:r,styles:s,httpCalls:c.httpCalls||[]},{execute:u,draw:p}=this.compileScript(d,c.key,c.msgCallback);c._compiledFunction=p,c._executableCode=l,this.registerScriptObject(c.key,c);const x=o==="main"?"candle_pane":o||"vice";this.registerScriptsToChartStore([c],x),c.msgCallback&&c.msgCallback(c.key,"sys",`脚本 "${c.name}" 注册成功`)}catch(d){c.msgCallback&&c.msgCallback(c.key,"error",`脚本编译失败: ${d.message}`)}}compileScript(t,e,n){try{const r=t.main,s=t.inputs||[],o=t.styles||[],l=this.wrapWithTemplate(r,s,o,t.httpCalls),c=new Function("ctx",l);return{execute:(a,h,f,d)=>[],draw:a=>{const h={ctx:a.ctx,bounding:a.bounding,yAxis:a.yAxis,xAxis:a.xAxis,chart:a.chart,indicator:a.indicator},f=this.scripts.get(e||"");if(!f)return!0;if(f.position==="vice"){const u=a.chart.getDrawPaneById(f.paneId);u&&u._mdDrawData&&(u._mdDrawData=u._mdDrawData.filter(p=>p.scriptId!==f.id))}f.httpCalls&&f.httpCalls.length>0&&f.httpCalls.some(p=>!p.value||p.value&&p.value.data&&p.value.data.length===0)&&this.executeHttpCalls(f.httpCalls,f).catch(p=>{console.error("HTTP请求执行失败:",p)});const d=this.createContext(this.chart.getDataList(),e,n,h,f);f&&(f.tooltipTools=[],f.tools=[]);try{const u=c(d)}catch(u){console.error("脚本执行异常:",u)}return!0}}}catch(r){throw console.error("compileScript 方法内部异常:",r),r}}wrapWithTemplate(t,e,n,r=[]){const s=e.map(d=>`var ${d.key} = ctx.inputVal.${d.key};`).join(`
    `),o=n.map(d=>`var ${d.key} = ctx.styleVal.${d.key};`).join(`
    `),l=r.map(d=>`var ${d.key} = ctx.httpVal.${d.key};`).join(`
    `),c=new Set;t.split(`
`).forEach(d=>{const u=d.match(/^(\w+)\s*=\s*(.+)$/);if(u){const p=u[1],x=e.some(y=>y.key===p),g=n.some(y=>y.key===p),m=r.some(y=>y.key===p);!x&&!g&&!m&&c.add(p)}});const h=Array.from(c).map(d=>`var ${d};`).join(`
    `),f=`    var ChartInfo = ctx.ChartInfo;
    var dataList = ctx.dataList;
    var visibleList = ctx.visibleList;
    var O = ctx.O;
    var output = ctx.O;
    var D = ctx.D;
    var draw = ctx.D;
    var F = ctx.F;
    var formula = ctx.formula;
    var U = ctx.U;
    var util = ctx.util;
    var Math = ctx.Math;
    var MD = ctx.MD;
    var maindraw = ctx.MD;
    var open = ctx.open;
    var high = ctx.high;
    var low = ctx.low;
    var close = ctx.close;
    var volume = ctx.volume;
    var time = ctx.time;
    var Open = ctx.Open;
    var High = ctx.High;
    var Low = ctx.Low;
    var Close = ctx.Close;
    var Volume = ctx.Volume;
    var Time = ctx.Time;
    var rev = ctx.rev;
    var balance = ctx.balance;
    var equity = ctx.equity;
    var orders = ctx.orders;
    var positions = ctx.positions;
    var accountId = ctx.accountId;
    var extendData = ctx.extendData;
    
`+(s?`    ${s}
`:"")+(o?`    ${o}
`:"")+`    
    // HTTP变量声明
`+(l?`    ${l}
`:"")+(h?`    ${h}
`:"")+`    
    // 执行用户脚本
    `+t+`
    
    return { result: true };
`;try{new Function("ctx",f)}catch(d){console.error("脚本语法错误:",d),console.error("错误位置附近的代�?");const u=f.split(`
`),p=d.message.match(/line (\d+)/);if(p){const x=parseInt(p[1]);for(let g=Math.max(0,x-2);g<Math.min(u.length,x+2);g++)console.error(`${g+1}: ${u[g]}`)}}return f}createContext(t,e,n,r,s){if(s&&s._executing)return null;s&&(s._executing=!0);const o=this.versionManager.getDefaultEngine(),l=o.Formula;let c=-1,a=-1;const h=[],f=r?.chart._chartStore._gapBarSpace/2||0;r.chart._chartStore._visibleRangeDataList.forEach(E=>{E&&E.dataIndex>=0&&E.x>=-f&&E.data?.current?.close&&h.push({...E.data.current,index:E.dataIndex})}),h.length>0&&(c=h[0].index,a=h[h.length-1].index);const d={width:r.bounding.width,height:r.bounding.height,symbol:r?.chart?._chartStore?._symbol?.symbol,period:r?.chart?._chartStore?._period?.key,gapBarSpace:r?.chart?._chartStore?._gapBarSpace,barSpace:r?.chart?._chartStore?._barSpace,startIndex:c,endIndex:a,toIndex:r?.chart._chartStore._visibleRange.realTo-1,pricePrecision:r?.chart._chartStore._symbol?.pricePrecision,volumePrecision:r?.chart._chartStore._symbol?.volumePrecision},u=bh({ctx:r?.ctx,bounding:r?.bounding,yAxis:r?.yAxis,xAxis:r?.xAxis,chart:r?.chart,msgCallback:n,scriptId:e,script:s}),p=ws({ctx:r?.ctx,bounding:r?.bounding,yAxis:r?.yAxis,xAxis:r?.xAxis,chart:r?.chart,script:s,dataList:t});s&&r?.chart&&(s.chart=r.chart);const x={},g={},m={};s.inputs&&s.inputs.forEach(E=>{x[E.key]=E.value}),s.styles&&s.styles.forEach(E=>{g[E.key]=E.value}),s.httpCalls&&s.httpCalls.forEach(E=>{m[E.key]=E.value||null}),s._inputVal=x,s._styleVal=g,s._httpVal=m;const y={F:l,formula:l,U:o.Utils,Math,dataList:t,visibleList:h,ctx:r?.ctx,bounding:r?.bounding,yAxis:r?.yAxis,xAxis:r?.xAxis,chart:r?.chart,O:u,output:u,D:p,draw:p,MD:p.maindraw,script:s,inputs:s.inputs||[],styles:s.styles||[],inputVal:x,styleVal:g,httpVal:m,extendData:typeof s.extendData=="function"?s.extendData():s.extendData,balance:(()=>{if(typeof s.getBalance=="function")try{return s.getBalance()}catch{return 0}return 0})(),equity:(()=>{if(typeof s.getEquity=="function")try{return s.getEquity()}catch{return 0}return 0})(),orders:(()=>{if(typeof s.getOrders=="function")try{return s.getOrders()}catch{return[]}return[]})(),positions:(()=>{if(typeof s.getPositions=="function")try{return s.getPositions()}catch{return[]}return[]})(),accountId:(()=>{if(typeof s.getAccount=="function")try{return s.getAccount()}catch{return""}return""})(),ChartInfo:d,mainChart:s.position==="vice"?{getDrawAPI:()=>{const E=r?.chart?.getDrawPaneById("candle_pane");if(E){const I={ctx:E._mainWidget._mainCanvas._ctx,bounding:E.getBounding(),yAxis:E.getAxisComponent(),xAxis:r?.chart?.getXAxisPane()?.getAxisComponent(),chart:r?.chart,script:{position:"main"},dataList:r?.dataList||[]};return ws(I)}return null},getCtx:()=>r?.chart?.getDrawPaneById("candle_pane")?._mainWidget?._mainCanvas?._ctx,getYAxis:()=>r?.chart?.getDrawPaneById("candle_pane")?.getAxisComponent(),getXAxis:()=>(r?.chart?.getDrawPaneById("candle_pane"),r?.chart?.getXAxisPane()?.getAxisComponent())}:null},v=t.map(E=>E.open),_=t.map(E=>E.high),w=t.map(E=>E.low),b=t.map(E=>E.close),C=t.map(E=>E.volume),M=t.map(E=>E.timestamp??E.time??null),T=(E,I)=>{const k=E.length,P=I>=0?I:k+I;return P>=0&&P<k?E[P]:null},S=E=>new Proxy(E,{get(I,k){if(typeof k=="string"&&/^\d+$/.test(k)){const P=Number(k),B=I.length-1-P;return B>=0&&B<I.length?I[B]:null}return k==="at"?P=>T(I,P):I[k]}});return y.open=v,y.high=_,y.low=w,y.close=b,y.volume=C,y.time=M,y.Open=S(v),y.High=S(_),y.Low=S(w),y.Close=S(b),y.Volume=S(C),y.Time=S(M),y.rev=(E,I=0)=>E&&typeof I=="number"?E.at?E.at(-(I+1)):E[E.length-1-I]:null,s&&(s._executing=!1),y}registerScriptsToChartStore(t,e){const n=this.chart.getChartStore();t.forEach(r=>{n.getScriptsByFilter({key:r.key,paneId:e})[0]&&n.removeScript({key:r.key,paneId:e})}),t.forEach(r=>{try{const s={id:r.id,name:r.name,code:r.code,info:r.info,paneId:e,key:r.key,visible:r.visible,position:r.position,figures:[],minValue:r.minValue||null,maxValue:r.maxValue||null,styles:null,shouldUpdate:null,_dirty:!0,_offscreen:null,_offctx:null,_cacheSize:{w:0,h:0},_lastChartSize:{w:0,h:0},calc:()=>r.outputs?.[0]?.data||[],regenerateFigures:null,createTooltipDataSource:r.createTooltipDataSource||null,draw:o=>{const l=o.bounding,c=Math.max(1,Math.floor(l.width)),a=Math.max(1,Math.floor(l.height)),h=s._cacheSize.w!==c||s._cacheSize.h!==a;if((!s._offscreen||h)&&(s._offscreen=document.createElement("canvas"),s._offscreen.width=c,s._offscreen.height=a,s._offctx=s._offscreen.getContext("2d"),s._cacheSize={w:c,h:a},s._dirty=!0),h&&(s._dirty=!0),s._dirty){const u=s._offctx;u.clearRect(0,0,c,a);try{const p={ctx:u,bounding:{...l,left:0,top:0},yAxis:o.yAxis,xAxis:o.xAxis,chart:o.chart,indicator:o.indicator},x=this.createContext(this.chart.getDataList(),r.key,r.msgCallback,p,r);r._compiledFunction&&r._compiledFunction(x)}catch(p){console.error("脚本离屏重画错误:",p)}s._dirty=!1}o.ctx.drawImage(s._offscreen,0,0)},onDataStateChange:null,result:r.outputs?.[0]?.data||[],toolData:r.toolData,extendData:r.extendData,calcImp:async(o,l,c="init")=>{try{const a=r.calc?r.calc(o,null,l,c):[];return s._dirty=!0,Array.isArray(a)?s.result=a.map(h=>typeof h=="number"?{value:h}:h&&typeof h=="object"&&"value"in h?h:{value:h}):s.result=r.outputs?.[0]?.data||[],!0}catch(a){return console.error("ScriptManager.calcImp 错误:",a),!1}},setSeriesPrecision:o=>{s.precision=o},override:o=>{Object.assign(s,o),s._dirty=!0},shouldUpdateImp:()=>({calc:!1,draw:!0,sort:!1})}}catch{}})}getScripts(){return Array.from(this.scripts.values())}getScript(t){return this.scripts.get(t)}removeScript(t){const e=this.scripts.get(t),n=t;if(e){if(e.msgCallback&&e.msgCallback(n,"sys",`脚本 "${e.name}" 已删除`),e.events&&e.events.forEach(s=>{this.chart.unsubscribeAction(s.type,s.handler)}),e.position==="vice"){const s=this.chart.getChartStore();s.removeScript({key:e.key,paneId:e.paneId}),e.msgCallback&&e.msgCallback(e.key,"sys",`删除脚本: ${e.name}, paneId: ${e.paneId}`);const o=s.getScriptsByPaneId(e.paneId),l=s.hasScripts(e.paneId);if(e.msgCallback&&e.msgCallback(e.key,"sys",`面板剩余脚本数量: ${o.length}, hasScripts: ${l}`),l)e.msgCallback&&e.msgCallback(e.key,"sys",`面板中还有其他脚本，保留面板: ${e.paneId}`);else{e.msgCallback&&e.msgCallback(e.key,"sys",`准备删除面板: ${e.paneId||"unknown"}`),e.paneId&&this.registeredVicePanes.delete(e.paneId);const c=this.chart.getDrawPaneById(e.paneId);if(c){const a=this.chart._drawPanes.findIndex(h=>h.getId()===e.paneId);a>-1?(this.chart._drawPanes.splice(a,1),c.destroy(),e.msgCallback&&e.msgCallback(e.key,"sys",`面板已删�? ${e.paneId}`)):e.msgCallback&&e.msgCallback(e.key,"sys",`面板在_drawPanes中未找到: ${e.paneId}`)}else e.msgCallback&&e.msgCallback(e.key,"sys",`面板对象未找�? ${e.paneId}`)}}else this.chart.getChartStore().removeScript({key:e.key,paneId:"candle_pane"}),e.msgCallback&&e.msgCallback(e.key,"sys",`删除主图脚本: ${e.name}, paneId: candle_pane`);this.scripts.delete(n);const r=n.split("_")[0];if(r!=="0"){const s=this.scriptCounters.get(r)||0;s>0&&this.scriptCounters.set(r,s-1)}return this.chart.layout({sort:!0,measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0}),!0}return!1}setScriptVisible(t,e){let n;for(const[r,s]of this.scripts)if(s.key===t){n=s;break}if(n){const r=n.visible;n.visible=e,n.msgCallback&&r!==e&&n.msgCallback(n.key,"sys",`脚本 "${n.name}" ?{action}`),this.chart.layout({update:!0})}}async setScriptConfig(t,e){const n=this.scripts.get(t);if(n){e.inputs&&(n.inputs=e.inputs),e.styles&&(Array.isArray(e.styles)&&Array.isArray(n.styles)?e.styles.forEach((r,s)=>{n.styles[s]&&(r.value!==void 0&&(n.styles[s].value=JSON.parse(JSON.stringify(r.value))),Object.keys(r).forEach(o=>{o!=="defaultValue"&&o!=="value"&&(n.styles[s][o]=JSON.parse(JSON.stringify(r[o])))}))}):n.styles=JSON.parse(JSON.stringify(e.styles)));try{if(e.inputs&&n._inputVal&&e.inputs.forEach(r=>{n._inputVal[r.key]!==void 0&&(n._inputVal[r.key]=r.value)}),e.styles&&n._styleVal&&e.styles.forEach(r=>{n._styleVal[r.key]!==void 0&&(n._styleVal[r.key]=r.value)}),e.inputs&&n.httpCalls&&n.httpCalls.length>0&&await this.executeHttpCalls(n.httpCalls,n),this.triggerScriptRefresh(n.key),n.msgCallback){if(e.inputs){let r="";Array.isArray(e.inputs)?r=e.inputs.map((s,o)=>`${s.name||`param${o}`}=${s.value}`).join(", "):r=Object.entries(e.inputs).map(([s,o])=>`${s}=${o}`).join(", "),n.msgCallback(n.key,"sys",`修改参数成功: ${r}`)}if(e.styles){let r="";Array.isArray(e.styles)?r=e.styles.map((s,o)=>`${s.name||`style${o}`}=${s.value}`).join(", "):r=Object.entries(e.styles).map(([s,o])=>`${s}=${o}`).join(", "),n.msgCallback(n.key,"sys",`修改样式成功: ${r}`)}}}catch(r){console.error("脚本重新编译失败:",r)}}else console.warn("ScriptManager.setScriptConfig: 未找到脚本",{key:t})}}class bl{constructor(t,e){if(this._debugUpdateCount=0,this._debugUpdateTicking=!1,this._debugLoopId=null,this._overlayUpdateScheduled=!1,this._chartBounding=zi(),this._drawPanes=[],this._separatorPanes=new Map,this._layoutOptions={sort:!0,measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!1,cacheYAxisWidth:!1,forceBuildYAxisTick:!1},this._layoutPending=!1,this._cacheYAxisWidth={left:0,right:0},this._watermarkImages=[],this._watermarkOptions=[],this._watermarkList=[],this._lastDataLength=0,this._lastSymbol="",this._lastPeriod="",this._stateCheckTimer=null,this.id=Qt("chart"),this._container=t,this._chartStore=new l0(this,e),this._initContainer(t),this._chartEvent=new Uh(this._chartContainer,this),this._initPanes(e),this._layout(),e?.watermark){let n=[];if(typeof e.watermark=="string")n=[{src:e.watermark}];else if(Array.isArray(e.watermark)){const r=e.watermark;r.length>0?n=r.map(s=>typeof s=="string"?{src:s}:s):n=[]}else n=[e.watermark];this.setWatermark(n)}this._ScriptManager=new lx(this),this.subscribeAction("onZoom",()=>{this._ScriptManager.markAllScriptsDirty(),this.requestOverlayUpdateOnce()}),this.subscribeAction("onScroll",()=>{this._ScriptManager.markAllScriptsDirty(),this.requestOverlayUpdateOnce()}),this.subscribeAction("onVisibleRangeChange",()=>{this._ScriptManager.markAllScriptsDirty(),this.requestOverlayUpdateOnce()})}getDebugUpdateCount(){return this._debugUpdateCount}getDebugActionSubscriberCounts(){const e=this._chartStore?._actions,n=r=>e?.get(r)?._callbacks?.length??0;return{onVisibleRangeChange:n("onVisibleRangeChange"),onScroll:n("onScroll"),onZoom:n("onZoom")}}startDebugUpdateLogger(){if(this._debugLoopId!==null)return;const t=()=>{this._debugLoopId=ot(t)};this._debugLoopId=ot(t)}stopDebugUpdateLogger(){if(this._debugLoopId!==null){try{(window.cancelAnimationFrame||window.clearTimeout)(this._debugLoopId)}catch{}this._debugLoopId=null}}requestOverlayUpdateOnce(t){this._overlayUpdateScheduled||(this._overlayUpdateScheduled=!0,ot(()=>{this._overlayUpdateScheduled=!1,this.updatePane(J.Overlay,t)}))}_initContainer(t){this._container=t,this._chartContainer=xt("div",{position:"relative",width:"100%",height:"100%",outline:"none",borderStyle:"none",cursor:"crosshair",boxSizing:"border-box",userSelect:"none",webkitUserSelect:"none",overflow:"hidden",msUserSelect:"none",MozUserSelect:"none",webkitTapHighlightColor:"transparent"}),this._chartContainer.tabIndex=1,t.appendChild(this._chartContainer),this._cacheChartBounding()}_cacheChartBounding(){this._chartBounding.width=Math.floor(this._chartContainer.clientWidth),this._chartBounding.height=Math.floor(this._chartContainer.clientHeight)}_initPanes(t){const e=t?.layout??[{type:"candle"}],n=s=>{if(!H(this._candlePane)){const o=s.options??{};Se(o,{id:Q.CANDLE}),this._candlePane=this._createPane(Th,Q.CANDLE,o),(s.content??[]).forEach(c=>{this.createIndicator(c,!0,o)})}},r=s=>{if(!H(this._xAxisPane)){const o=this._createPane(Oh,Q.X_AXIS,s??{});this._xAxisPane=o}};e.forEach(s=>{switch(s.type){case"candle":{n(s);break}case"indicator":{const o=s.content??[];if(o.length>0){let l=s.options?.id??null;H(l)&&(l=Qt(Q.INDICATOR));const c={...s.options,id:l};o.forEach(a=>{this.createIndicator(a,!0,c)})}break}case"xAxis":{r(s.options);break}}}),n({}),r({order:Number.MAX_SAFE_INTEGER})}_createPane(t,e,n){const r=new t(this,e,n??{});return this._drawPanes.push(r),r}_recalculatePaneHeight(t,e,n){if(n===0)return!1;const r=this._drawPanes.filter(o=>{const l=o.getId();return o.getOptions().state==="normal"&&l!==t.getId()&&l!==Q.X_AXIS}),s=r.length;if(s===0)return!1;if(t.getId()!==Q.CANDLE&&H(this._candlePane)&&this._candlePane.getOptions().state==="normal"){const o=this._candlePane.getBounding().height;if(o>0){const l=this._candlePane.getOptions().minHeight;let c=o+n;c<l&&(c=l,e-=o+n-c),this._candlePane.setBounding({height:c})}}else{let o=n;const l=Math.floor(n/s);r.forEach((c,a)=>{const h=c.getBounding().height;let f=0;a===s-1?f=h+o:f=h+l,f<c.getOptions().minHeight&&(f=c.getOptions().minHeight),c.setBounding({height:f}),o-=f-h}),Math.abs(o)>0&&(e-=o)}return t.setBounding({height:e}),!0}getDrawPaneById(t){return t===Q.CANDLE?this._candlePane:t===Q.X_AXIS?this._xAxisPane:this._drawPanes.find(n=>n.getId()===t)??null}getContainer(){return this._container}getChartStore(){return this._chartStore}getXAxisPane(){return this._xAxisPane}getDrawPanes(){return this._drawPanes}getSeparatorPanes(){return this._separatorPanes}layout(t){(t.sort??!1)&&(this._layoutOptions.sort=t.sort),(t.measureHeight??!1)&&(this._layoutOptions.measureHeight=t.measureHeight),(t.measureWidth??!1)&&(this._layoutOptions.measureWidth=t.measureWidth),(t.update??!1)&&(this._layoutOptions.update=t.update),(t.buildYAxisTick??!1)&&(this._layoutOptions.buildYAxisTick=t.buildYAxisTick),(t.cacheYAxisWidth??!1)&&(this._layoutOptions.cacheYAxisWidth=t.cacheYAxisWidth),(t.buildYAxisTick??!1)&&(this._layoutOptions.forceBuildYAxisTick=t.forceBuildYAxisTick),this._layoutPending||(this._layoutPending=!0,Promise.resolve().then(async e=>{this._layout(),(r=>{ot(()=>r())})(()=>{this.checkScriptStateChanges(),this.requestOverlayUpdateOnce(),this._layoutPending=!1})}).catch(e=>{}))}_layout(){const{sort:t,measureHeight:e,measureWidth:n,update:r,buildYAxisTick:s,cacheYAxisWidth:o,forceBuildYAxisTick:l}=this._layoutOptions;if(t){for(;H(this._chartContainer.firstChild);)this._chartContainer.removeChild(this._chartContainer.firstChild);this._separatorPanes.clear(),this._drawPanes.sort((h,f)=>h.getOptions().order-f.getOptions().order);let a=null;this._drawPanes.forEach(h=>{if(h.getId()!==Q.X_AXIS){if(H(a)){const f=new Yh(this,"",a,h);this._chartContainer.appendChild(f.getContainer()),this._separatorPanes.set(h,f)}a=h}this._chartContainer.appendChild(h.getContainer())})}if(e){const a=this._chartBounding.height,h=this.getStyles().separator.size,f=this._xAxisPane.getAxisComponent().getAutoSize();let d=a-f;d<0&&(d=0),this._drawPanes.forEach(p=>{const x=p.getId();if(H(this._separatorPanes.get(p))&&(d-=h),x!==Q.X_AXIS&&x!==Q.CANDLE&&p.getVisible()){let g=p.getBounding().height;g>d?(g=d,d=0):d-=g,p.setBounding({height:g})}}),this._candlePane.setBounding({height:Math.max(d,0)}),this._xAxisPane.setBounding({height:f});let u=0;this._drawPanes.forEach(p=>{const x=this._separatorPanes.get(p);H(x)&&(x.setBounding({height:h,top:u}),u+=h),p.setBounding({top:u}),u+=p.getBounding().height})}let c=n;if((s||l)&&this._drawPanes.forEach(a=>{const h=a.getAxisComponent().buildTicks(l);c||=h}),c){const a=this._chartBounding.width,h=this.getStyles();let f=0,d=!0,u=0,p=!0;this._drawPanes.forEach(M=>{if(M.getId()!==Q.X_AXIS){const T=M.getAxisComponent(),S=T.inside,E=T.getAutoSize();T.position==="left"?(f=Math.max(f,E),S&&(d=!1)):(u=Math.max(u,E),S&&(p=!1))}}),o&&(f=Math.max(this._cacheYAxisWidth.left,f),u=Math.max(this._cacheYAxisWidth.right,u)),this._cacheYAxisWidth.left=f,this._cacheYAxisWidth.right=u;let x=a,g=0,m=0;d&&(x-=f,g=f),p&&(x-=u,m=u),this._chartStore.setTotalBarSpace(x);const y={width:a},v={width:x,left:g,right:m},_={width:f},w={width:u},b=h.separator.fill;let C={};b?C=y:C=v,this._drawPanes.forEach(M=>{this._separatorPanes.get(M)?.setBounding(C),M.setBounding(y,v,_,w)})}r&&(this._xAxisPane.getAxisComponent().buildTicks(!0),this.updatePane(J.All)),this._layoutOptions={sort:!1,measureHeight:!1,measureWidth:!1,update:!1,buildYAxisTick:!1,cacheYAxisWidth:!1,forceBuildYAxisTick:!1}}updatePane(t,e){this._debugUpdateTicking||(this._debugUpdateTicking=!0,ot(()=>{this._debugUpdateCount=0,this._debugUpdateTicking=!1})),this._debugUpdateCount++,H(e)?this.getDrawPaneById(e)?.update(t):this._drawPanes.forEach(n=>{n.update(t),this._separatorPanes.get(n)?.update(t)})}crosshairChange(t){if(this._chartStore.hasAction("onCrosshairChange")){const e={};this._drawPanes.forEach(n=>{const r=n.getId(),s={};this._chartStore.getIndicatorsByPaneId(r).forEach(l=>{const c=l.result;s[l.name]=c[t.dataIndex??c.length-1]}),e[r]=s}),se(t.paneId)&&this._chartStore.executeAction("onCrosshairChange",{crosshair:t,indicatorData:e})}}getDom(t,e){if(H(t)){const n=this.getDrawPaneById(t);if(H(n))switch(e??"root"){case"root":return n.getContainer();case"main":return n.getMainWidget().getContainer();case"yAxis":return n.getYAxisWidget()?.getContainer()??null}}else return this._chartContainer;return null}getSize(t,e){if(H(t)){const n=this.getDrawPaneById(t);if(H(n))switch(e??"root"){case"root":return n.getBounding();case"main":return n.getMainWidget().getBounding();case"yAxis":return n.getYAxisWidget()?.getBounding()??null}}else return this._chartBounding;return null}setSymbol(t){this._chartStore.setSymbol(t)}getSymbol(){return this._chartStore.getSymbol()}setPeriod(t){this._chartStore.setPeriod(t)}getPeriod(){return this._chartStore.getPeriod()}setStyles(t){this._setOptions(()=>{this._chartStore.setStyles(t)})}getStyles(){return this._chartStore.getStyles()}setFormatter(t){this._setOptions(()=>{this._chartStore.setFormatter(t)})}getFormatter(){return this._chartStore.getFormatter()}setLocale(t){this._setOptions(()=>{this._chartStore.setLocale(t)})}getLocale(){return this._chartStore.getLocale()}setTimezone(t){this._setOptions(()=>{this._chartStore.setTimezone(t)})}getTimezone(){return this._chartStore.getTimezone()}setThousandsSeparator(t){this._setOptions(()=>{this._chartStore.setThousandsSeparator(t)})}getThousandsSeparator(){return this._chartStore.getThousandsSeparator()}setDecimalFold(t){this._setOptions(()=>{this._chartStore.setDecimalFold(t)})}getDecimalFold(){return this._chartStore.getDecimalFold()}_setOptions(t){t(),this.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}setOffsetRightDistance(t){this._chartStore.setOffsetRightDistance(t,!0)}getOffsetRightDistance(){return this._chartStore.getOffsetRightDistance()}setMaxOffsetLeftDistance(t){t<0||this._chartStore.setMaxOffsetLeftDistance(t)}setMaxOffsetRightDistance(t){t<0||this._chartStore.setMaxOffsetRightDistance(t)}setLeftMinVisibleBarCount(t){t<0||this._chartStore.setLeftMinVisibleBarCount(Math.ceil(t))}setRightMinVisibleBarCount(t){t<0||this._chartStore.setRightMinVisibleBarCount(Math.ceil(t))}setBarSpace(t){this._chartStore.setBarSpace(t)}getBarSpace(){return this._chartStore.getBarSpace()}getVisibleRange(){return this._chartStore.getVisibleRange()}resetData(){this._chartStore.resetData()}getDataList(){return this._chartStore.getDataList()}setDataList(t){this._chartStore.setDataList(t)}setDataLoader(t){this._chartStore.setDataLoader(t)}upsertDataList(t){this._chartStore.upsertDataList(t)}appendData(t){const e=Array.isArray(t)?t:[t];this._chartStore.upsertDataList(e)}createIndicator(t,e,n){const r=se(t)?{name:t}:t;if(ea(r.name)===null)return null;const s=n??{};if(se(s.id)||(s.id=Qt(Q.INDICATOR)),se(r.id)||(r.id=Qt(r.name)),this._chartStore.addIndicator(r,s.id,e??!1)){let l=!1;return H(this.getDrawPaneById(s.id))||(this._createPane(Ra,s.id,s),s.height??=vr,l=!0),this.setPaneOptions(s),this.layout({sort:l,measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0}),r.id}return null}overrideIndicator(t){return this._chartStore.overrideIndicator(t)}overrideScript(t){return this._chartStore.overrideScript(t)}getIndicators(t){return this._chartStore.getIndicatorsByFilter(t??{})}removeIndicator(t){const e=this._chartStore.removeIndicator(t??{});if(e){let n=!1;const r=[];this._drawPanes.forEach(s=>{const o=s.getId();o!==Q.CANDLE&&o!==Q.X_AXIS&&r.push(o)}),r.forEach(s=>{if(!this._chartStore.hasIndicators(s)){const o=this._drawPanes.findIndex(c=>c.getId()===s),l=this._drawPanes[o];H(l)&&(n=!0,this._recalculatePaneHeight(l,0,l.getBounding().height),this._drawPanes.splice(o,1),l.destroy())}}),this._drawPanes.length===2&&(this._candlePane.setVisible(!0),this._candlePane.setBounding({height:this._chartBounding.height-this._xAxisPane.getBounding().height})),this.layout({sort:n,measureHeight:n,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}return e}createOverlay(t){const e=[],n=[],r=o=>{!H(o.paneId)||this.getDrawPaneById(o.paneId)===null?(o.paneId=Q.CANDLE,n.push(!1)):n.push(!0),e.push(o)};se(t)?r({name:t}):ze(t)?t.forEach(o=>{let l=null;se(o)?l={name:o}:l=o,r(l)}):r(t);const s=this._chartStore.addOverlays(e,n);return ze(t)?s:s[0]}getOverlays(t){return this._chartStore.getOverlaysByFilter(t??{})}overrideOverlay(t){return this._chartStore.overrideOverlay(t)}removeOverlay(t){return this._chartStore.removeOverlay(t??{})}removeOverlays(t){return this._chartStore.removeOverlays(t)}setPaneOptions(t){let e=!1,n=!1;const r=H(t.id);for(const s of this._drawPanes){const o=s.getId();if(r&&t.id===o||!r){if(o!==Q.X_AXIS){if(L(t.height)&&t.height>0){const c=Math.max(t.minHeight??s.getOptions().minHeight,0),a=Math.max(c,t.height);n=!0,e=!0,s.setOriginalBounding({height:a}),this._recalculatePaneHeight(s,a,-a)}if(H(t.state)&&s.getOptions().state!==t.state){e=!0,n=!0;const c=t.state;switch(c){case"maximize":{const a=this._drawPanes.find(h=>{const f=h.getId();return h.getOptions().state==="maximize"&&f!==Q.X_AXIS});if(!H(a)){s.getOptions().state==="normal"&&s.setOriginalBounding({height:s.getBounding().height}),s.setOptions({state:c});const h=this._chartBounding.height;s.setBounding({height:h-this._xAxisPane.getBounding().height}),this._drawPanes.forEach(f=>{f.getId()!==Q.X_AXIS&&f.getId()!==o&&(f.setBounding({height:f.getOriginalBounding().height}),f.setVisible(!1),this._separatorPanes.get(f)?.setVisible(!1))})}break}case"minimize":{const a=s.getBounding().height,h=s.getOptions().state;let f=a-Qn;h==="maximize"&&(f=s.getOriginalBounding().height-Qn),this._recalculatePaneHeight(s,Qn,f)&&(h==="normal"&&s.setOriginalBounding({height:a}),s.setOptions({state:c})),this._drawPanes.forEach(d=>{d.getId()!==Q.X_AXIS&&(d.setVisible(!0),this._separatorPanes.get(d)?.setVisible(!0))});break}default:{const a=s.getOriginalBounding().height;this._recalculatePaneHeight(s,a,s.getBounding().height-a)&&s.setOptions({state:c}),this._drawPanes.forEach(h=>{h.getId()!==Q.X_AXIS&&(h.setVisible(!0),this._separatorPanes.get(h)?.setVisible(!0))});break}}}}H(t.axis)&&(n=!0);const l={...t};if(delete l.state,s.setOptions(l),o===t.id)break}}n&&this.layout({measureHeight:e,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}getPaneOptions(t){return H(t)?this.getDrawPaneById(t)?.getOptions()??null:this._drawPanes.map(e=>e.getOptions())}setZoomEnabled(t){this._chartStore.setZoomEnabled(t)}isZoomEnabled(){return this._chartStore.isZoomEnabled()}setScrollEnabled(t){this._chartStore.setScrollEnabled(t)}isScrollEnabled(){return this._chartStore.isScrollEnabled()}scrollByDistance(t,e){const n=L(e)&&e>0?e:0;if(this._chartStore.startScroll(),n>0){const r=new Ni({duration:n});r.doFrame(s=>{const o=t*(s/n);this._chartStore.scroll(o)}),r.start()}else this._chartStore.scroll(t)}scrollToRealTime(t){const{bar:e}=this._chartStore.getBarSpace(),r=(this._chartStore.getLastBarRightSideDiffBarCount()-this._chartStore.getInitialOffsetRightDistance()/e)*e;this.scrollByDistance(r,t)}scrollToDataIndex(t,e){const n=(this._chartStore.getLastBarRightSideDiffBarCount()+(this.getDataList().length-1-t))*this._chartStore.getBarSpace().bar;this.scrollByDistance(n,e)}scrollToTimestamp(t,e){const n=yr(this.getDataList(),"timestamp",t);this.scrollToDataIndex(n,e)}zoomAtCoordinate(t,e,n){const r=L(n)&&n>0?n:0,{bar:s}=this._chartStore.getBarSpace(),l=s*t-s;if(r>0){let c=0;const a=new Ni({duration:r});a.doFrame(h=>{const f=l*(h/r),d=(f-c)/this._chartStore.getBarSpace().bar*_r;this._chartStore.zoom(d,e),c=f}),a.start()}else this._chartStore.zoom(l/s*_r,e)}zoomAtDataIndex(t,e,n){const r=this._chartStore.dataIndexToCoordinate(e);this.zoomAtCoordinate(t,{x:r,y:0},n)}zoomAtTimestamp(t,e,n){const r=yr(this.getDataList(),"timestamp",e);this.zoomAtDataIndex(t,r,n)}convertToPixel(t,e){const{paneId:n=Q.CANDLE,absolute:r=!1}=e??{};let s=[];if(n!==Q.X_AXIS){const o=this.getDrawPaneById(n);if(o!==null){const l=o.getBounding(),c=[].concat(t),a=this._xAxisPane.getAxisComponent(),h=o.getAxisComponent();s=c.map(f=>{const d={};let u=f.dataIndex;if(L(f.timestamp)&&(u=this._chartStore.timestampToDataIndex(f.timestamp)),L(u)&&(d.x=a.convertToPixel(u)),L(f.value)){const p=h.convertToPixel(f.value);d.y=r?l.top+p:p}return d})}}return ze(t)?s:s[0]??{}}convertFromPixel(t,e){const{paneId:n=Q.CANDLE,absolute:r=!1}=e??{};let s=[];if(n!==Q.X_AXIS){const o=this.getDrawPaneById(n);if(o!==null){const l=o.getBounding(),c=[].concat(t),a=this._xAxisPane.getAxisComponent(),h=o.getAxisComponent();s=c.map(f=>{const d={};if(L(f.x)){const u=a.convertFromPixel(f.x);d.dataIndex=u,d.timestamp=this._chartStore.dataIndexToTimestamp(u)??void 0}if(L(f.y)){const u=r?f.y-l.top:f.y;d.value=h.convertFromPixel(u)}return d})}}return ze(t)?s:s[0]??{}}executeAction(t,e){if(t==="onCrosshairChange"){const n={...e};n.paneId??=Q.CANDLE,this._chartStore.setCrosshair(n,{notExecuteAction:!0})}}subscribeAction(t,e){this._chartStore.subscribeAction(t,e)}unsubscribeAction(t,e){this._chartStore.unsubscribeAction(t,e)}setWatermark(t){this._watermarkList=[],t.forEach((e,n)=>{const r=new window.Image;r.src=e.src,r.onload=()=>{this.updatePane(J.All)},this._watermarkList[n]={...e,img:r}})}getConvertPictureUrl(t,e,n){const{width:r,height:s}=this._chartBounding,o=xt("canvas",{width:`${r}px`,height:`${s}px`,boxSizing:"border-box"}),l=o.getContext("2d"),c=Ct(o);o.width=r*c,o.height=s*c,l.scale(c,c),l.fillStyle=n??"#FFFFFF",l.fillRect(0,0,r,s);const a=t??!1;return this._drawPanes.forEach(h=>{const f=this._separatorPanes.get(h);if(H(f)){const u=f.getBounding();l.drawImage(f.getImage(a),u.left,u.top,u.width,u.height)}const d=h.getBounding();l.drawImage(h.getImage(a),0,d.top,r,d.height)}),o.toDataURL(`image/${e??"jpeg"}`)}resize(){this._cacheChartBounding(),this.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}destroy(){this._chartEvent.destroy(),this._drawPanes.forEach(t=>{t.destroy()}),this._drawPanes=[],this._separatorPanes.clear(),this._chartStore.destroy(),this._container.removeChild(this._chartContainer)}get watermarkImage(){return this._watermarkImages[0]}get watermarkOptions(){return this._watermarkOptions[0]}get watermarkImages(){return this._watermarkImages}get watermarkOptionsList(){return this._watermarkOptions}get watermarkList(){return this._watermarkList}setPriceVolumePrecision(t){this._chartStore.setPriceVolumePrecision(t)}synchronousCrosshair(t,e){this._chartStore.setCrosshair(t,{...e,notExecuteAction:!0})}addScript(t,e,n){return t&&typeof t=="object"&&t.code&&this.processScriptAdd(t),null}processScriptAdd(t){try{const{id:e,code:n,paneId:r,...s}=t,l=hx(n,"gainlab-script");if(!l){console.error("❌ 脚本解密失败");return}const c=Vn.parse(l),a=c.info.name||t.name||"Script",h=c.info.position||"main";let f;h==="main"?f=Q.CANDLE:f=Qt(Q.INDICATOR);const d=e,{name:u,...p}=s;this._ScriptManager.registerScript({id:d,name:a,script:l,encryptedScript:n,user_id:t.user_id||0,paneId:f,createTooltipDataSource:t.createTooltipDataSource,msgCallback:t.msgCallback||(()=>{}),http:t.http,...p});const x=this._ScriptManager.getScript(t.key);if(!x){console.error("❌ 脚本注册失败");return}if(this._chartStore.addScript(x,f,!1)){const m=this._chartStore.getScriptsByPaneId(f);if(h!=="main"&&!this.getDrawPaneById(f)){const y={height:vr};this._createPane(Ph,f,y),this.setPaneOptions(y),this.layout({sort:!0,measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}else this.layout({measureHeight:!0,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0});return}return}catch(e){console.error("❌ 添加脚本失败:",e);return}}async checkScriptStateChanges(){try{const t=this._chartStore.getDataList().length,n=this._chartStore.getSymbol()?.symbol||"",r=this._chartStore.getPeriod(),s=r?`${r.type}${r.span}`:"";if(n!==this._lastSymbol||s!==this._lastPeriod||t!==this._lastDataLength){const o={symbol:n,period:s,dataLength:t,inputs:{},styles:{}};this._lastSymbol=n,this._lastPeriod=s,this._lastDataLength=t,await this._ScriptManager.checkAllScriptsState(o)}}catch(t){console.error("检查脚本状态变化失败:",t)}}getScripts(t){if(!t||Object.keys(t).length===0){const n=[];return this._drawPanes.forEach(r=>{const s=r.getId(),o=this._chartStore.getScriptsByPaneId(s);n.push(...o)}),this._filterInternalFields(n)}const e=this._chartStore.getScriptsByFilter(t);return this._filterInternalFields(e)}_filterInternalFields(t){return t.map(e=>{const n={};return Object.keys(e).forEach(r=>{r==="_compiledFunction"||r==="_executableCode"||(n[r]=e[r])}),n})}removeScript(t){const e=t?.key;e&&this._ScriptManager.removeScript(e);const n=this._chartStore.removeScript(t||{});if(n){let r=!1;const s=[];this._drawPanes.forEach(o=>{const l=o.getId();l!==Q.CANDLE&&l!==Q.X_AXIS&&s.push(l)}),s.forEach(o=>{if(!this._chartStore.hasScripts(o)){const l=this._drawPanes.findIndex(a=>a.getId()===o),c=this._drawPanes[l];H(c)&&(r=!0,this._recalculatePaneHeight(c,0,c.getBounding().height),this._drawPanes.splice(l,1),c.destroy())}}),this._drawPanes.length===2&&(this._candlePane.setVisible(!0),this._candlePane.setBounding({height:this._chartBounding.height-this._xAxisPane.getBounding().height})),this.layout({sort:r,measureHeight:r,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}return n}removeAllScripts(){const t=this._chartStore.getScriptsByFilter({});let e=0;if(t.forEach(n=>{const r=n.key;r&&(this._ScriptManager.removeScript(r),this._chartStore.removeScript({key:r})&&e++)}),e>0){let n=!1;const r=[];this._drawPanes.forEach(s=>{const o=s.getId();o!==Q.CANDLE&&o!==Q.X_AXIS&&r.push(o)}),r.forEach(s=>{if(!this._chartStore.hasScripts(s)){const o=this._drawPanes.findIndex(c=>c.getId()===s),l=this._drawPanes[o];H(l)&&(n=!0,this._recalculatePaneHeight(l,0,l.getBounding().height),this._drawPanes.splice(o,1),l.destroy())}}),this._drawPanes.length===2&&(this._candlePane.setVisible(!0),this._candlePane.setBounding({height:this._chartBounding.height-this._xAxisPane.getBounding().height})),this.layout({sort:n,measureHeight:n,measureWidth:!0,update:!0,buildYAxisTick:!0,forceBuildYAxisTick:!0})}return e>0}setScriptVisible(t,e){this._chartStore.getScriptsByFilter({key:t}).forEach(r=>{r.visible=e}),this.layout({update:!0})}async setScriptConfig(t,e){await this._ScriptManager.setScriptConfig(t,e),this._chartStore.getScriptsByFilter({key:t}).forEach(r=>{e.inputs&&(r.inputs=e.inputs),e.styles&&(r.styles=e.styles)}),this._chartStore.overrideScript({key:t}),(e.inputs||e.styles)&&this._ScriptManager.onScriptConfigChanged(t).catch(r=>{console.error("脚本配置变化后重新编译失败:",r)})}getScriptsByPaneId(t){const e=this._chartStore.getScriptsByPaneId(t);return this._filterInternalFields(e)}getScriptsByFilter(t){const e=this._chartStore.getScriptsByFilter(t||{});return this._filterInternalFields(e)}hasScripts(t){return this._chartStore.hasScripts(t)}}function cx(i,t,e,n,r){let s=0,o=0;switch(i){case 1:s=0,o=0;break;case 2:s=(t-n)/2,o=0;break;case 3:s=t-n,o=0;break;case 4:s=0,o=(e-r)/2;break;case 5:s=(t-n)/2,o=(e-r)/2;break;case 6:s=t-n,o=(e-r)/2;break;case 7:s=0,o=e-r;break;case 8:s=(t-n)/2,o=e-r;break;case 9:s=t-n,o=e-r;break;default:s=0,o=0;break}return{x:s,y:o}}function hx(i,t){const n=lo.AES.decrypt(i,t).toString(lo.enc.Utf8);try{const r=new Uint8Array(atob(n).split("").map(o=>o.charCodeAt(0))),s=nx.inflate(r,{to:"string"});if(s&&typeof s=="string"&&s!=="")return s}catch{}return n}const $i=new Map;let ux=1;function fx(i,t){let e=null;if(se(i)?e=document.getElementById(i):e=i,e===null)return null;let n=$i.get(e.id);if(H(n))return n;const r=`k_line_chart_${ux++}`;return n=new bl(e,t),n.id=r,e.setAttribute("k-line-chart-id",r),$i.set(r,n),n}function dx(i){let t=null;if(i instanceof bl)t=i.id;else{let e=null;se(i)?e=document.getElementById(i):e=i,t=e?.getAttribute("k-line-chart-id")??null}t!==null&&($i.get(t)?.destroy(),$i.delete(t))}const Yi={clone:An,merge:Se,isString:se,isNumber:L,isValid:H,isObject:tt,isArray:ze,isFunction:Ve,isBoolean:Ri,formatValue:Ue,formatPrecision:ke,formatBigNumber:Ko,formatDate:Go,formatThousands:Qo,formatFoldDecimal:Jo,calcTextWidth:qe,getLinearSlopeIntercept:qi,getLinearYFromSlopeIntercept:Rr,getLinearYFromCoordinates:Sn,checkCoordinateOnArc:da,checkCoordinateOnCircle:aa,checkCoordinateOnLine:ta,checkCoordinateOnPolygon:la,checkCoordinateOnRect:Nr,checkCoordinateOnText:fa},px={bullish:{fill:"rgba(34, 197, 94, 0.25)",border:"rgba(34, 197, 94, 0.6)"},bearish:{fill:"rgba(239, 68, 68, 0.25)",border:"rgba(239, 68, 68, 0.6)"}},xx={name:"wrb_highlight",totalStep:0,lock:!0,visible:!0,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createPointFigures:({coordinates:i,overlay:t})=>{if(i.length<2)return[];const e=t.extendData?.direction??"bullish",n=px[e],r=i[0].x,s=i[0].y,o=i[1].y,l=Math.min(s,o),c=Math.abs(o-s),a=8;return[{type:"rect",attrs:{x:r-a/2,y:l,width:a,height:Math.max(c,1)},styles:{style:"stroke_fill",color:n.fill,borderColor:n.border,borderSize:1},ignoreEvent:!0}]}},gx=.25,mx=.85,_t={poc:"rgba(255, 193, 7, 0.6)",pocBorder:"rgba(255, 193, 7, 0.9)",valueArea:"rgba(34, 197, 94, 0.3)",buy:"rgba(34, 197, 94, 0.45)",sell:"rgba(239, 68, 68, 0.35)",pocLine:"rgba(255, 193, 7, 0.4)",vahValLine:"rgba(34, 197, 94, 0.25)"},yx={name:"volume_profile",totalStep:0,lock:!0,visible:!0,needDefaultPointFigure:!1,needDefaultXAxisFigure:!1,needDefaultYAxisFigure:!1,createPointFigures:({overlay:i,bounding:t,yAxis:e})=>{const n=i.extendData?.vpData;if(!n||!n.levels||n.levels.length===0||!e)return[];const{levels:r,poc:s,vah:o,val:l}=n,c=[],a=t.width,h=a*gx,f=Math.max(...r.map(b=>b.volume));if(f===0)return[];const d=r.length,u=r[d-1].price-r[0].price,p=e.convertToPixel(r[d-1].price),x=e.convertToPixel(r[0].price),g=Math.abs(x-p),m=Math.max(g/d*mx,1),y=a;for(const b of r){const C=e.convertToPixel(b.price),M=b.volume/f*h;if(M<.5)continue;const T=Math.abs(b.price-s)<u/d,S=b.price>=l&&b.price<=o,E=b.volume||1,I=b.buyVolume/E,k=M*I,P=M-k;P>.5&&c.push({type:"rect",attrs:{x:y-M,y:C-m/2,width:P,height:m},styles:{style:"fill",color:_t.sell},ignoreEvent:!0}),k>.5&&c.push({type:"rect",attrs:{x:y-k,y:C-m/2,width:k,height:m},styles:{style:"fill",color:T?_t.poc:S?_t.valueArea:_t.buy},ignoreEvent:!0}),T&&c.push({type:"rect",attrs:{x:y-M,y:C-m/2,width:M,height:m},styles:{style:"stroke",borderColor:_t.pocBorder,borderSize:1},ignoreEvent:!0})}const v=e.convertToPixel(s);c.push({type:"line",attrs:{coordinates:[{x:0,y:v},{x:a,y:v}]},styles:{style:"dashed",color:_t.pocLine,dashedValue:[4,4],size:1},ignoreEvent:!0});const _=e.convertToPixel(o);c.push({type:"line",attrs:{coordinates:[{x:0,y:_},{x:a,y:_}]},styles:{style:"dashed",color:_t.vahValLine,dashedValue:[3,5],size:1},ignoreEvent:!0});const w=e.convertToPixel(l);return c.push({type:"line",attrs:{coordinates:[{x:0,y:w},{x:a,y:w}]},styles:{style:"dashed",color:_t.vahValLine,dashedValue:[3,5],size:1},ignoreEvent:!0}),c}};sa(xx);sa(yx);const vx=[{timestamp:17079552e5,open:48e3,high:48800,low:47200,close:48500,volume:25e3},{timestamp:17080416e5,open:48500,high:49200,low:48100,close:49e3,volume:28e3},{timestamp:1708128e6,open:49e3,high:51500,low:48800,close:51200,volume:42e3},{timestamp:17082144e5,open:51200,high:52e3,low:50500,close:51800,volume:35e3},{timestamp:17083008e5,open:51800,high:52300,low:51e3,close:52100,volume:3e4},{timestamp:17083872e5,open:52100,high:52800,low:51500,close:51700,volume:27e3},{timestamp:17084736e5,open:51700,high:52500,low:51200,close:52300,volume:31e3},{timestamp:170856e7,open:52300,high:53e3,low:52e3,close:52800,volume:33e3},{timestamp:17086464e5,open:52800,high:54200,low:52500,close:54e3,volume:45e3},{timestamp:17087328e5,open:54e3,high:55500,low:53800,close:55200,volume:5e4},{timestamp:17088192e5,open:55200,high:57e3,low:55e3,close:56800,volume:55e3},{timestamp:17089056e5,open:56800,high:58e3,low:56200,close:57500,volume:48e3},{timestamp:1708992e6,open:57500,high:58500,low:56800,close:58200,volume:42e3},{timestamp:17090784e5,open:58200,high:6e4,low:57800,close:59500,volume:52e3},{timestamp:17091648e5,open:59500,high:61e3,low:59e3,close:60800,volume:58e3},{timestamp:17092512e5,open:60800,high:62e3,low:6e4,close:61500,volume:62e3},{timestamp:17093376e5,open:61500,high:63500,low:61e3,close:63e3,volume:7e4},{timestamp:1709424e6,open:63e3,high:64e3,low:62e3,close:62500,volume:55e3},{timestamp:17095104e5,open:62500,high:63500,low:61500,close:63200,volume:48e3},{timestamp:17095968e5,open:63200,high:65e3,low:63e3,close:64800,volume:6e4},{timestamp:17096832e5,open:64800,high:66e3,low:64200,close:65500,volume:65e3},{timestamp:17097696e5,open:65500,high:67e3,low:65e3,close:66800,volume:72e3},{timestamp:1709856e6,open:66800,high:68e3,low:66e3,close:67200,volume:58e3},{timestamp:17099424e5,open:67200,high:68500,low:66500,close:68e3,volume:63e3},{timestamp:17100288e5,open:68e3,high:69500,low:67500,close:69e3,volume:68e3},{timestamp:17101152e5,open:69e3,high:7e4,low:68e3,close:69500,volume:55e3},{timestamp:17102016e5,open:69500,high:71e3,low:69e3,close:70500,volume:75e3},{timestamp:1710288e6,open:70500,high:72e3,low:7e4,close:71800,volume:8e4},{timestamp:17103744e5,open:71800,high:73e3,low:71e3,close:72500,volume:7e4},{timestamp:17104608e5,open:72500,high:73500,low:71500,close:73e3,volume:65e3}];async function _x(i){try{const t=new AbortController,e=setTimeout(()=>t.abort(),5e3),n=`https://api.binance.com/api/v3/klines?symbol=${i}&interval=1d&limit=100`,r=await fetch(n,{signal:t.signal});return clearTimeout(e),r.ok?(await r.json()).map(o=>({timestamp:o[0],open:parseFloat(o[1]),high:parseFloat(o[2]),low:parseFloat(o[3]),close:parseFloat(o[4]),volume:parseFloat(o[5])})):null}catch{return null}}function Ex({symbol:i="BTCUSDT",data:t,indicators:e=["RSI"],showWRB:n=!1,showVP:r=!1}){const s=qt.useRef(null),o=qt.useRef(null),[l,c]=qt.useState(null);return qt.useEffect(()=>{if(!s.current)return;const a=fx(s.current,{styles:{grid:{show:!0,horizontal:{show:!0,color:"#1e1e3a"},vertical:{show:!0,color:"#1e1e3a"}},candle:{bar:{upColor:"#26a69a",downColor:"#ef5350",upBorderColor:"#26a69a",downBorderColor:"#ef5350",upWickColor:"#26a69a",downWickColor:"#ef5350"},tooltip:{showRule:"follow_cross"}},indicator:{lastValueMark:{show:!0}},crosshair:{show:!0,horizontal:{show:!0,line:{color:"#4a4a8a",dashedValue:[4,2]}},vertical:{show:!0,line:{color:"#4a4a8a",dashedValue:[4,2]}}},separator:{color:"#2a2a4a"}}});if(!a)return;o.current=a;for(const f of e)a.createIndicator(f,!1,{id:`pane_${f}`});t&&t.length>0?a.setDataList(t):(a.setDataList(vx),_x(i).then(f=>{f&&o.current?(o.current.setDataList(f),c(null)):c("Binance API 不可用，使用样本数据")}));const h=s.current;return()=>{h&&dx(h),o.current=null}},[i,t,e]),qt.useEffect(()=>{const a=o.current;if(a)if(n){const h=t??a.getDataList?.()??[],f=Tl(h);for(const d of f){const u=h.find(p=>p.timestamp===d.timestamp);u&&a.createOverlay({name:"wrb_highlight",lock:!0,visible:!0,points:[{timestamp:u.timestamp,value:u.open},{timestamp:u.timestamp,value:u.close}],extendData:{direction:d.direction,score:d.score}})}}else a.removeOverlay({name:"wrb_highlight"})},[n,t]),qt.useEffect(()=>{const a=o.current;if(a)if(r){const h=t??a.getDataList?.()??[];if(h.length>0){const f=Il(h,50),d=(f.vah+f.val)/2||h[0].close,u=h[Math.floor(h.length/2)].timestamp;a.createOverlay({name:"volume_profile",lock:!0,visible:!0,points:[{timestamp:u,value:d}],extendData:{vpData:f}})}}else a.removeOverlay({name:"volume_profile"})},[r,t]),er.jsxs("div",{style:{width:"100%",height:"100%",position:"relative",background:"#12122a"},children:[l&&er.jsx("div",{style:{position:"absolute",top:8,right:8,padding:"4px 8px",borderRadius:4,background:"#3a2a00",color:"#ffc107",fontSize:12,zIndex:10},children:l}),er.jsx("div",{ref:s,style:{width:"100%",height:"100%"}})]})}export{Ex as KLineWidget};
